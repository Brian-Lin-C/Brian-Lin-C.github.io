<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>MySQL 运维篇 03-02 拆分方式详解 | 过拟合的炸鱼薯条</title><meta name="author" content="过拟合的炸鱼薯条"><meta name="copyright" content="过拟合的炸鱼薯条"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="MySQL 运维篇 03-02 拆分方式详解本文将详细讲解各种分库分表的拆分方式，包括垂直拆分、水平拆分的实战案例和代码示例。 一、垂直拆分实战1.1 场景描述原始表结构： 1234567891011CREATE TABLE products (    id INT PRIMARY KEY AUTO_INCREMENT,    name VARCHAR(100),    description T">
<meta property="og:type" content="article">
<meta property="og:title" content="MySQL 运维篇 03-02 拆分方式详解">
<meta property="og:url" content="https://brian-lin-c.github.io/2026/02/24/MySQL%20%E8%BF%90%E7%BB%B4%E7%AF%87%2003-02%20%E6%8B%86%E5%88%86%E6%96%B9%E5%BC%8F%E8%AF%A6%E8%A7%A3/index.html">
<meta property="og:site_name" content="过拟合的炸鱼薯条">
<meta property="og:description" content="MySQL 运维篇 03-02 拆分方式详解本文将详细讲解各种分库分表的拆分方式，包括垂直拆分、水平拆分的实战案例和代码示例。 一、垂直拆分实战1.1 场景描述原始表结构： 1234567891011CREATE TABLE products (    id INT PRIMARY KEY AUTO_INCREMENT,    name VARCHAR(100),    description T">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://brian-lin-c.github.io/img/%E5%A4%B4%E5%83%8F.jpg">
<meta property="article:published_time" content="2026-02-24T11:05:00.000Z">
<meta property="article:modified_time" content="2026-02-24T11:16:58.437Z">
<meta property="article:author" content="过拟合的炸鱼薯条">
<meta property="article:tag" content="MySQL">
<meta property="article:tag" content="分库分表">
<meta property="article:tag" content="实战">
<meta property="article:tag" content="拆分方式">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://brian-lin-c.github.io/img/%E5%A4%B4%E5%83%8F.jpg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "MySQL 运维篇 03-02 拆分方式详解",
  "url": "https://brian-lin-c.github.io/2026/02/24/MySQL%20%E8%BF%90%E7%BB%B4%E7%AF%87%2003-02%20%E6%8B%86%E5%88%86%E6%96%B9%E5%BC%8F%E8%AF%A6%E8%A7%A3/",
  "image": "https://brian-lin-c.github.io/img/%E5%A4%B4%E5%83%8F.jpg",
  "datePublished": "2026-02-24T11:05:00.000Z",
  "dateModified": "2026-02-24T11:16:58.437Z",
  "author": [
    {
      "@type": "Person",
      "name": "过拟合的炸鱼薯条",
      "url": "https://brian-lin-c.github.io"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://brian-lin-c.github.io/2026/02/24/MySQL%20%E8%BF%90%E7%BB%B4%E7%AF%87%2003-02%20%E6%8B%86%E5%88%86%E6%96%B9%E5%BC%8F%E8%AF%A6%E8%A7%A3/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=5.5.4"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@7.1.0/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"top_n_per_article":1,"unescape":false,"pagination":{"enable":false,"hitsPerPage":8},"languages":{"hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.13.0/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'MySQL 运维篇 03-02 拆分方式详解',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 8.1.1"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/%E5%A4%B4%E5%83%8F.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">68</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">157</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">9</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-user"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">过拟合的炸鱼薯条</span></a><a class="nav-page-title" href="/"><span class="site-name">MySQL 运维篇 03-02 拆分方式详解</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  返回首页</span></span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-user"></i><span> 关于</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">MySQL 运维篇 03-02 拆分方式详解</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2026-02-24T11:05:00.000Z" title="发表于 2026-02-24 19:05:00">2026-02-24</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2026-02-24T11:16:58.437Z" title="更新于 2026-02-24 19:16:58">2026-02-24</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/MySQL-%E8%BF%90%E7%BB%B4%E7%AF%87/">MySQL 运维篇</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">1.8k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>8分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h1 id="MySQL-运维篇-03-02-拆分方式详解"><a href="#MySQL-运维篇-03-02-拆分方式详解" class="headerlink" title="MySQL 运维篇 03-02 拆分方式详解"></a>MySQL 运维篇 03-02 拆分方式详解</h1><p>本文将详细讲解各种分库分表的拆分方式，包括垂直拆分、水平拆分的实战案例和代码示例。</p>
<h2 id="一、垂直拆分实战"><a href="#一、垂直拆分实战" class="headerlink" title="一、垂直拆分实战"></a>一、垂直拆分实战</h2><h3 id="1-1-场景描述"><a href="#1-1-场景描述" class="headerlink" title="1.1 场景描述"></a>1.1 场景描述</h3><p><strong>原始表结构</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> products (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT,</span><br><span class="line">    name <span class="type">VARCHAR</span>(<span class="number">100</span>),</span><br><span class="line">    description TEXT,        <span class="comment">-- 大字段</span></span><br><span class="line">    detail TEXT,             <span class="comment">-- 大字段</span></span><br><span class="line">    price <span class="type">DECIMAL</span>(<span class="number">10</span>, <span class="number">2</span>),</span><br><span class="line">    stock <span class="type">INT</span>,</span><br><span class="line">    images <span class="type">BLOB</span>,             <span class="comment">-- 图片数据</span></span><br><span class="line">    created_at DATETIME,</span><br><span class="line">    updated_at DATETIME</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p><strong>问题</strong>：</p>
<ul>
<li>单表 1000 万数据</li>
<li>description、detail、images 占用大量空间</li>
<li>查询商品列表时不需要大字段</li>
</ul>
<h3 id="1-2-垂直拆分方案"><a href="#1-2-垂直拆分方案" class="headerlink" title="1.2 垂直拆分方案"></a>1.2 垂直拆分方案</h3><p><strong>拆分后表结构</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 商品主表（常用字段）</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> products_main (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT,</span><br><span class="line">    name <span class="type">VARCHAR</span>(<span class="number">100</span>),</span><br><span class="line">    price <span class="type">DECIMAL</span>(<span class="number">10</span>, <span class="number">2</span>),</span><br><span class="line">    stock <span class="type">INT</span>,</span><br><span class="line">    created_at DATETIME,</span><br><span class="line">    updated_at DATETIME,</span><br><span class="line">    INDEX idx_price (price),</span><br><span class="line">    INDEX idx_stock (stock)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 商品详情表（大字段）</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> products_detail (</span><br><span class="line">    product_id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span>,</span><br><span class="line">    description TEXT,</span><br><span class="line">    detail TEXT,</span><br><span class="line">    images <span class="type">BLOB</span>,</span><br><span class="line">    <span class="keyword">FOREIGN KEY</span> (product_id) <span class="keyword">REFERENCES</span> products_main(id)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB;</span><br></pre></td></tr></table></figure>

<h3 id="1-3-数据迁移"><a href="#1-3-数据迁移" class="headerlink" title="1.3 数据迁移"></a>1.3 数据迁移</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 迁移数据</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> products_main (id, name, price, stock, created_at, updated_at)</span><br><span class="line"><span class="keyword">SELECT</span> id, name, price, stock, created_at, updated_at <span class="keyword">FROM</span> products;</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT INTO</span> products_detail (product_id, description, detail, images)</span><br><span class="line"><span class="keyword">SELECT</span> id, description, detail, images <span class="keyword">FROM</span> products;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 验证数据</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">FROM</span> products_main;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">FROM</span> products_detail;</span><br></pre></td></tr></table></figure>

<h3 id="1-4-查询优化"><a href="#1-4-查询优化" class="headerlink" title="1.4 查询优化"></a>1.4 查询优化</h3><p><strong>拆分前</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询商品列表（扫描大量不必要数据）</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> products <span class="keyword">WHERE</span> price <span class="keyword">BETWEEN</span> <span class="number">100</span> <span class="keyword">AND</span> <span class="number">500</span>;</span><br></pre></td></tr></table></figure>

<p><strong>拆分后</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询商品列表（只查主表）</span></span><br><span class="line"><span class="keyword">SELECT</span> id, name, price, stock <span class="keyword">FROM</span> products_main</span><br><span class="line"><span class="keyword">WHERE</span> price <span class="keyword">BETWEEN</span> <span class="number">100</span> <span class="keyword">AND</span> <span class="number">500</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询商品详情（需要时再 JOIN）</span></span><br><span class="line"><span class="keyword">SELECT</span> p.<span class="operator">*</span>, d.description, d.detail</span><br><span class="line"><span class="keyword">FROM</span> products_main p</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> products_detail d <span class="keyword">ON</span> p.id <span class="operator">=</span> d.product_id</span><br><span class="line"><span class="keyword">WHERE</span> p.id <span class="operator">=</span> <span class="number">12345</span>;</span><br></pre></td></tr></table></figure>

<h2 id="二、水平拆分实战"><a href="#二、水平拆分实战" class="headerlink" title="二、水平拆分实战"></a>二、水平拆分实战</h2><h3 id="2-1-场景描述"><a href="#2-1-场景描述" class="headerlink" title="2.1 场景描述"></a>2.1 场景描述</h3><p><strong>订单表</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> orders (</span><br><span class="line">    id <span class="type">BIGINT</span> <span class="keyword">PRIMARY KEY</span>,</span><br><span class="line">    order_no <span class="type">VARCHAR</span>(<span class="number">50</span>),</span><br><span class="line">    user_id <span class="type">BIGINT</span>,</span><br><span class="line">    amount <span class="type">DECIMAL</span>(<span class="number">10</span>, <span class="number">2</span>),</span><br><span class="line">    status TINYINT,</span><br><span class="line">    created_at DATETIME,</span><br><span class="line">    updated_at DATETIME,</span><br><span class="line">    INDEX idx_user (user_id),</span><br><span class="line">    INDEX idx_created (created_at)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB;</span><br></pre></td></tr></table></figure>

<p><strong>问题</strong>：</p>
<ul>
<li>单表 1 亿数据</li>
<li>按 user_id 查询占 90%</li>
<li>按日期查询占 10%</li>
</ul>
<h3 id="2-2-按-user-id-取模拆分"><a href="#2-2-按-user-id-取模拆分" class="headerlink" title="2.2 按 user_id 取模拆分"></a>2.2 按 user_id 取模拆分</h3><p><strong>分表规则</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">table_name = &#x27;orders_&#x27; + LPAD(user_id % 4, 2, &#x27;0&#x27;)</span><br></pre></td></tr></table></figure>

<p><strong>拆分后表</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 创建 4 个分表</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> orders_00 <span class="keyword">LIKE</span> orders;</span><br><span class="line"><span class="keyword">CREATE TABLE</span> orders_01 <span class="keyword">LIKE</span> orders;</span><br><span class="line"><span class="keyword">CREATE TABLE</span> orders_02 <span class="keyword">LIKE</span> orders;</span><br><span class="line"><span class="keyword">CREATE TABLE</span> orders_03 <span class="keyword">LIKE</span> orders;</span><br></pre></td></tr></table></figure>

<p><strong>分片计算</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- user_id = 100 → orders_00 (100 % 4 = 0)</span></span><br><span class="line"><span class="comment">-- user_id = 101 → orders_01 (101 % 4 = 1)</span></span><br><span class="line"><span class="comment">-- user_id = 102 → orders_02 (102 % 4 = 2)</span></span><br><span class="line"><span class="comment">-- user_id = 103 → orders_03 (103 % 4 = 3)</span></span><br><span class="line"><span class="comment">-- user_id = 104 → orders_00 (104 % 4 = 0)</span></span><br></pre></td></tr></table></figure>

<h3 id="2-3-数据迁移脚本"><a href="#2-3-数据迁移脚本" class="headerlink" title="2.3 数据迁移脚本"></a>2.3 数据迁移脚本</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER $$</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> migrate_orders()</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">DECLARE</span> done <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="literal">FALSE</span>;</span><br><span class="line">    <span class="keyword">DECLARE</span> v_id <span class="type">BIGINT</span>;</span><br><span class="line">    <span class="keyword">DECLARE</span> v_order_no <span class="type">VARCHAR</span>(<span class="number">50</span>);</span><br><span class="line">    <span class="keyword">DECLARE</span> v_user_id <span class="type">BIGINT</span>;</span><br><span class="line">    <span class="keyword">DECLARE</span> v_amount <span class="type">DECIMAL</span>(<span class="number">10</span>, <span class="number">2</span>);</span><br><span class="line">    <span class="keyword">DECLARE</span> v_status TINYINT;</span><br><span class="line">    <span class="keyword">DECLARE</span> v_created_at DATETIME;</span><br><span class="line">    <span class="keyword">DECLARE</span> v_updated_at DATETIME;</span><br><span class="line">    <span class="keyword">DECLARE</span> v_table_suffix <span class="type">INT</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">DECLARE</span> cur <span class="keyword">CURSOR</span> <span class="keyword">FOR</span></span><br><span class="line">        <span class="keyword">SELECT</span> id, order_no, user_id, amount, status, created_at, updated_at</span><br><span class="line">        <span class="keyword">FROM</span> orders;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">DECLARE</span> CONTINUE HANDLER <span class="keyword">FOR</span> <span class="keyword">NOT</span> FOUND <span class="keyword">SET</span> done <span class="operator">=</span> <span class="literal">TRUE</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">OPEN</span> cur;</span><br><span class="line"></span><br><span class="line">    read_loop: LOOP</span><br><span class="line">        <span class="keyword">FETCH</span> cur <span class="keyword">INTO</span> v_id, v_order_no, v_user_id, v_amount, v_status, v_created_at, v_updated_at;</span><br><span class="line">        IF done <span class="keyword">THEN</span></span><br><span class="line">            LEAVE read_loop;</span><br><span class="line">        <span class="keyword">END</span> IF;</span><br><span class="line"></span><br><span class="line">        <span class="comment">-- 计算分表后缀</span></span><br><span class="line">        <span class="keyword">SET</span> v_table_suffix <span class="operator">=</span> v_user_id <span class="operator">%</span> <span class="number">4</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">-- 插入到对应分表</span></span><br><span class="line">        <span class="keyword">CASE</span> v_table_suffix</span><br><span class="line">            <span class="keyword">WHEN</span> <span class="number">0</span> <span class="keyword">THEN</span></span><br><span class="line">                <span class="keyword">INSERT INTO</span> orders_00 <span class="keyword">VALUES</span> (v_id, v_order_no, v_user_id, v_amount, v_status, v_created_at, v_updated_at);</span><br><span class="line">            <span class="keyword">WHEN</span> <span class="number">1</span> <span class="keyword">THEN</span></span><br><span class="line">                <span class="keyword">INSERT INTO</span> orders_01 <span class="keyword">VALUES</span> (v_id, v_order_no, v_user_id, v_amount, v_status, v_created_at, v_updated_at);</span><br><span class="line">            <span class="keyword">WHEN</span> <span class="number">2</span> <span class="keyword">THEN</span></span><br><span class="line">                <span class="keyword">INSERT INTO</span> orders_02 <span class="keyword">VALUES</span> (v_id, v_order_no, v_user_id, v_amount, v_status, v_created_at, v_updated_at);</span><br><span class="line">            <span class="keyword">WHEN</span> <span class="number">3</span> <span class="keyword">THEN</span></span><br><span class="line">                <span class="keyword">INSERT INTO</span> orders_03 <span class="keyword">VALUES</span> (v_id, v_order_no, v_user_id, v_amount, v_status, v_created_at, v_updated_at);</span><br><span class="line">        <span class="keyword">END</span> <span class="keyword">CASE</span>;</span><br><span class="line">    <span class="keyword">END</span> LOOP;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">CLOSE</span> cur;</span><br><span class="line"><span class="keyword">END</span>$$</span><br><span class="line"></span><br><span class="line">DELIMITER ;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 执行迁移</span></span><br><span class="line"><span class="keyword">CALL</span> migrate_orders();</span><br></pre></td></tr></table></figure>

<h3 id="2-4-查询示例"><a href="#2-4-查询示例" class="headerlink" title="2.4 查询示例"></a>2.4 查询示例</h3><p><strong>按 user_id 查询</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- user_id = 100 → orders_00</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> orders_00 <span class="keyword">WHERE</span> user_id <span class="operator">=</span> <span class="number">100</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- user_id = 101 → orders_01</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> orders_01 <span class="keyword">WHERE</span> user_id <span class="operator">=</span> <span class="number">101</span>;</span><br></pre></td></tr></table></figure>

<p><strong>统计查询</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 需要 union 所有分表</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">SUM</span>(amount) <span class="keyword">FROM</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> <span class="built_in">SUM</span>(amount) <span class="keyword">AS</span> amount <span class="keyword">FROM</span> orders_00</span><br><span class="line">    <span class="keyword">UNION</span> <span class="keyword">ALL</span></span><br><span class="line">    <span class="keyword">SELECT</span> <span class="built_in">SUM</span>(amount) <span class="keyword">FROM</span> orders_01</span><br><span class="line">    <span class="keyword">UNION</span> <span class="keyword">ALL</span></span><br><span class="line">    <span class="keyword">SELECT</span> <span class="built_in">SUM</span>(amount) <span class="keyword">FROM</span> orders_02</span><br><span class="line">    <span class="keyword">UNION</span> <span class="keyword">ALL</span></span><br><span class="line">    <span class="keyword">SELECT</span> <span class="built_in">SUM</span>(amount) <span class="keyword">FROM</span> orders_03</span><br><span class="line">) t;</span><br></pre></td></tr></table></figure>

<h2 id="三、按日期范围拆分"><a href="#三、按日期范围拆分" class="headerlink" title="三、按日期范围拆分"></a>三、按日期范围拆分</h2><h3 id="3-1-场景描述"><a href="#3-1-场景描述" class="headerlink" title="3.1 场景描述"></a>3.1 场景描述</h3><p><strong>日志表</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> operation_log (</span><br><span class="line">    id <span class="type">BIGINT</span> <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT,</span><br><span class="line">    user_id <span class="type">BIGINT</span>,</span><br><span class="line">    operation <span class="type">VARCHAR</span>(<span class="number">100</span>),</span><br><span class="line">    created_at DATETIME,</span><br><span class="line">    INDEX idx_user_time (user_id, created_at)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB;</span><br></pre></td></tr></table></figure>

<p><strong>特点</strong>：</p>
<ul>
<li>每天新增 100 万数据</li>
<li>主要查询最近 3 个月</li>
<li>历史数据很少访问</li>
</ul>
<h3 id="3-2-按月分表"><a href="#3-2-按月分表" class="headerlink" title="3.2 按月分表"></a>3.2 按月分表</h3><p><strong>分表规则</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">table_name = &#x27;operation_log_&#x27; + DATE_FORMAT(created_at, &#x27;%Y%m&#x27;)</span><br></pre></td></tr></table></figure>

<p><strong>创建分表</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 预创建 12 个月的表</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> operation_log_202401 <span class="keyword">LIKE</span> operation_log;</span><br><span class="line"><span class="keyword">CREATE TABLE</span> operation_log_202402 <span class="keyword">LIKE</span> operation_log;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">CREATE TABLE</span> operation_log_202412 <span class="keyword">LIKE</span> operation_log;</span><br></pre></td></tr></table></figure>

<h3 id="3-3-自动创建表存储过程"><a href="#3-3-自动创建表存储过程" class="headerlink" title="3.3 自动创建表存储过程"></a>3.3 自动创建表存储过程</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER $$</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> create_monthly_table(p_year_month <span class="type">VARCHAR</span>(<span class="number">6</span>))</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">DECLARE</span> table_name <span class="type">VARCHAR</span>(<span class="number">50</span>);</span><br><span class="line">    <span class="keyword">SET</span> table_name <span class="operator">=</span> CONCAT(<span class="string">&#x27;operation_log_&#x27;</span>, p_year_month);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">SET</span> <span class="variable">@sql</span> <span class="operator">=</span> CONCAT(<span class="string">&#x27;CREATE TABLE IF NOT EXISTS &#x27;</span>, table_name, <span class="string">&#x27; (</span></span><br><span class="line"><span class="string">        id BIGINT PRIMARY KEY AUTO_INCREMENT,</span></span><br><span class="line"><span class="string">        user_id BIGINT,</span></span><br><span class="line"><span class="string">        operation VARCHAR(100),</span></span><br><span class="line"><span class="string">        created_at DATETIME,</span></span><br><span class="line"><span class="string">        INDEX idx_user_time (user_id, created_at)</span></span><br><span class="line"><span class="string">    ) ENGINE=InnoDB&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">PREPARE</span> stmt <span class="keyword">FROM</span> <span class="variable">@sql</span>;</span><br><span class="line">    <span class="keyword">EXECUTE</span> stmt;</span><br><span class="line">    <span class="keyword">DEALLOCATE</span> <span class="keyword">PREPARE</span> stmt;</span><br><span class="line"><span class="keyword">END</span>$$</span><br><span class="line"></span><br><span class="line">DELIMITER ;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建下个月的表</span></span><br><span class="line"><span class="keyword">CALL</span> create_monthly_table(<span class="string">&#x27;202403&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="3-4-查询示例"><a href="#3-4-查询示例" class="headerlink" title="3.4 查询示例"></a>3.4 查询示例</h3><p><strong>查询当月数据</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> operation_log_202402</span><br><span class="line"><span class="keyword">WHERE</span> created_at <span class="operator">&gt;=</span> <span class="string">&#x27;2024-02-01&#x27;</span> <span class="keyword">AND</span> created_at <span class="operator">&lt;</span> <span class="string">&#x27;2024-03-01&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p><strong>查询多个月份</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> operation_log_202401 <span class="keyword">WHERE</span> created_at <span class="operator">&gt;=</span> <span class="string">&#x27;2024-01-15&#x27;</span></span><br><span class="line">    <span class="keyword">UNION</span> <span class="keyword">ALL</span></span><br><span class="line">    <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> operation_log_202402 <span class="keyword">WHERE</span> created_at <span class="operator">&lt;</span> <span class="string">&#x27;2024-02-15&#x27;</span></span><br><span class="line">) t <span class="keyword">ORDER</span> <span class="keyword">BY</span> created_at <span class="keyword">DESC</span>;</span><br></pre></td></tr></table></figure>

<h3 id="3-5-历史数据清理"><a href="#3-5-历史数据清理" class="headerlink" title="3.5 历史数据清理"></a>3.5 历史数据清理</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 删除 1 年前的数据（直接 DROP 表，速度快）</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> operation_log_202301;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 或者删除特定数据</span></span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> operation_log_202302</span><br><span class="line"><span class="keyword">WHERE</span> created_at <span class="operator">&lt;</span> <span class="string">&#x27;2023-02-01&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h2 id="四、按地区拆分"><a href="#四、按地区拆分" class="headerlink" title="四、按地区拆分"></a>四、按地区拆分</h2><h3 id="4-1-场景描述"><a href="#4-1-场景描述" class="headerlink" title="4.1 场景描述"></a>4.1 场景描述</h3><p><strong>用户表</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> users (</span><br><span class="line">    id <span class="type">BIGINT</span> <span class="keyword">PRIMARY KEY</span>,</span><br><span class="line">    name <span class="type">VARCHAR</span>(<span class="number">50</span>),</span><br><span class="line">    province <span class="type">VARCHAR</span>(<span class="number">50</span>),</span><br><span class="line">    city <span class="type">VARCHAR</span>(<span class="number">50</span>),</span><br><span class="line">    phone <span class="type">VARCHAR</span>(<span class="number">20</span>),</span><br><span class="line">    created_at DATETIME</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB;</span><br></pre></td></tr></table></figure>

<p><strong>特点</strong>：</p>
<ul>
<li>用户遍布全国</li>
<li>本地化服务需求</li>
<li>需要符合数据合规要求</li>
</ul>
<h3 id="4-2-按省份分库"><a href="#4-2-按省份分库" class="headerlink" title="4.2 按省份分库"></a>4.2 按省份分库</h3><p><strong>分库规则</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">database_name = &#x27;users_&#x27; + province_code</span><br></pre></td></tr></table></figure>

<p><strong>分库示例</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 北京用户库</span></span><br><span class="line"><span class="keyword">CREATE</span> DATABASE users_beijing;</span><br><span class="line"><span class="comment">-- 上海用户库</span></span><br><span class="line"><span class="keyword">CREATE</span> DATABASE users_shanghai;</span><br><span class="line"><span class="comment">-- 广东用户库</span></span><br><span class="line"><span class="keyword">CREATE</span> DATABASE users_guangdong;</span><br></pre></td></tr></table></figure>

<p><strong>表结构</strong>（每个库相同）：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">USE users_beijing;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE TABLE</span> users (</span><br><span class="line">    id <span class="type">BIGINT</span> <span class="keyword">PRIMARY KEY</span>,</span><br><span class="line">    name <span class="type">VARCHAR</span>(<span class="number">50</span>),</span><br><span class="line">    province <span class="type">VARCHAR</span>(<span class="number">50</span>),</span><br><span class="line">    city <span class="type">VARCHAR</span>(<span class="number">50</span>),</span><br><span class="line">    phone <span class="type">VARCHAR</span>(<span class="number">20</span>),</span><br><span class="line">    created_at DATETIME,</span><br><span class="line">    INDEX idx_city (city)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB;</span><br></pre></td></tr></table></figure>

<h3 id="4-3-路由规则"><a href="#4-3-路由规则" class="headerlink" title="4.3 路由规则"></a>4.3 路由规则</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 根据省份确定数据库</span></span><br><span class="line"><span class="comment">-- province = &#x27;beijing&#x27; → users_beijing 库</span></span><br><span class="line"><span class="comment">-- province = &#x27;shanghai&#x27; → users_shanghai 库</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询北京用户</span></span><br><span class="line">USE users_beijing;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> city <span class="operator">=</span> <span class="string">&#x27;北京&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询上海用户</span></span><br><span class="line">USE users_shanghai;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> city <span class="operator">=</span> <span class="string">&#x27;上海&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h2 id="五、组合拆分策略"><a href="#五、组合拆分策略" class="headerlink" title="五、组合拆分策略"></a>五、组合拆分策略</h2><h3 id="5-1-场景描述"><a href="#5-1-场景描述" class="headerlink" title="5.1 场景描述"></a>5.1 场景描述</h3><p><strong>电商订单系统</strong>：</p>
<ul>
<li>日订单量 100 万</li>
<li>需要支持按用户查询</li>
<li>需要支持按商家查询</li>
<li>需要支持按日期统计</li>
</ul>
<h3 id="5-2-组合方案"><a href="#5-2-组合方案" class="headerlink" title="5.2 组合方案"></a>5.2 组合方案</h3><p><strong>一级分片：按商家分库</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">database = &#x27;orders_&#x27; + (merchant_id % 10)</span><br></pre></td></tr></table></figure>

<p><strong>二级分片：按用户分表</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">table = &#x27;orders_&#x27; + (user_id % 100)</span><br></pre></td></tr></table></figure>

<p><strong>最终路由</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">orders_05.orders_42  (merchant_id % 10 = 5, user_id % 100 = 42)</span><br></pre></td></tr></table></figure>

<h3 id="5-3-表结构"><a href="#5-3-表结构" class="headerlink" title="5.3 表结构"></a>5.3 表结构</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 创建 10 个库</span></span><br><span class="line"><span class="comment">-- orders_db_0 到 orders_db_9</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 每个库创建 100 个表</span></span><br><span class="line">USE orders_db_0;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE TABLE</span> orders_00 <span class="keyword">LIKE</span> orders_template;</span><br><span class="line"><span class="keyword">CREATE TABLE</span> orders_01 <span class="keyword">LIKE</span> orders_template;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">CREATE TABLE</span> orders_99 <span class="keyword">LIKE</span> orders_template;</span><br></pre></td></tr></table></figure>

<h2 id="六、拆分方案对比"><a href="#六、拆分方案对比" class="headerlink" title="六、拆分方案对比"></a>六、拆分方案对比</h2><h3 id="6-1-方案对比表"><a href="#6-1-方案对比表" class="headerlink" title="6.1 方案对比表"></a>6.1 方案对比表</h3><table>
<thead>
<tr>
<th>方案</th>
<th>优点</th>
<th>缺点</th>
<th>适用场景</th>
</tr>
</thead>
<tbody><tr>
<td>取模</td>
<td>分布均匀</td>
<td>扩容困难</td>
<td>用户订单</td>
</tr>
<tr>
<td>范围</td>
<td>扩容容易</td>
<td>可能不均</td>
<td>日期数据</td>
</tr>
<tr>
<td>哈希</td>
<td>分布均匀</td>
<td>范围查询无效</td>
<td>随机查询</td>
</tr>
<tr>
<td>地理</td>
<td>就近访问</td>
<td>分布不均</td>
<td>本地化服务</td>
</tr>
<tr>
<td>组合</td>
<td>灵活</td>
<td>复杂度高</td>
<td>多维度查询</td>
</tr>
</tbody></table>
<h3 id="6-2-选择建议"><a href="#6-2-选择建议" class="headerlink" title="6.2 选择建议"></a>6.2 选择建议</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">1. 优先选择取模分片</span><br><span class="line">   - 数据分布最均匀</span><br><span class="line">   - 查询效率最高</span><br><span class="line"></span><br><span class="line">2. 日期数据选择范围分片</span><br><span class="line">   - 便于历史数据归档</span><br><span class="line">   - 便于按时间统计</span><br><span class="line"></span><br><span class="line">3. 国际化业务选择地理分片</span><br><span class="line">   - 符合数据合规</span><br><span class="line">   - 降低访问延迟</span><br><span class="line"></span><br><span class="line">4. 复杂场景选择组合分片</span><br><span class="line">   - 先按业务分库</span><br><span class="line">   - 再按用户分表</span><br></pre></td></tr></table></figure>

<h2 id="七、小结"><a href="#七、小结" class="headerlink" title="七、小结"></a>七、小结</h2><h3 id="核心知识点"><a href="#核心知识点" class="headerlink" title="核心知识点"></a>核心知识点</h3><ol>
<li><strong>垂直拆分</strong>：按列拆分，分离大字段</li>
<li><strong>水平拆分</strong>：按行拆分，降低单表数据量</li>
<li><strong>取模分片</strong>：分布均匀，扩容困难</li>
<li><strong>范围分片</strong>：便于归档，可能不均</li>
</ol>
<h3 id="拆分决策流程"><a href="#拆分决策流程" class="headerlink" title="拆分决策流程"></a>拆分决策流程</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">1. 分析业务场景</span><br><span class="line">   ├── 查询模式</span><br><span class="line">   ├── 数据量增长</span><br><span class="line">   └── 访问频率</span><br><span class="line"></span><br><span class="line">2. 选择拆分方式</span><br><span class="line">   ├── 垂直拆分 → 大字段、低频字段</span><br><span class="line">   └── 水平拆分 → 数据量大</span><br><span class="line"></span><br><span class="line">3. 选择分片策略</span><br><span class="line">   ├── 取模 → 均匀分布</span><br><span class="line">   ├── 范围 → 时间序列</span><br><span class="line">   ├── 哈希 → 随机分布</span><br><span class="line">   └── 地理 → 区域化</span><br><span class="line"></span><br><span class="line">4. 验证方案</span><br><span class="line">   ├── 数据分布</span><br><span class="line">   ├── 查询性能</span><br><span class="line">   └── 扩展性</span><br></pre></td></tr></table></figure>

<hr>
<p><strong>下一篇</strong>：[MySQL 运维篇 03-03 分库分表 MyCat 概述](&#x2F;2026&#x2F;02&#x2F;24&#x2F;MySQL 运维篇 03-03 分库分表 MyCat 概述&#x2F;)</p>
<p><strong>上一篇</strong>：[MySQL 运维篇 03-01 分库分表介绍](&#x2F;2026&#x2F;02&#x2F;24&#x2F;MySQL 运维篇 03-01 分库分表介绍&#x2F;)</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://brian-lin-c.github.io">过拟合的炸鱼薯条</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://brian-lin-c.github.io/2026/02/24/MySQL%20%E8%BF%90%E7%BB%B4%E7%AF%87%2003-02%20%E6%8B%86%E5%88%86%E6%96%B9%E5%BC%8F%E8%AF%A6%E8%A7%A3/">https://brian-lin-c.github.io/2026/02/24/MySQL%20%E8%BF%90%E7%BB%B4%E7%AF%87%2003-02%20%E6%8B%86%E5%88%86%E6%96%B9%E5%BC%8F%E8%AF%A6%E8%A7%A3/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://brian-lin-c.github.io" target="_blank">过拟合的炸鱼薯条</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/MySQL/">MySQL</a><a class="post-meta__tags" href="/tags/%E5%AE%9E%E6%88%98/">实战</a><a class="post-meta__tags" href="/tags/%E5%88%86%E5%BA%93%E5%88%86%E8%A1%A8/">分库分表</a><a class="post-meta__tags" href="/tags/%E6%8B%86%E5%88%86%E6%96%B9%E5%BC%8F/">拆分方式</a></div><div class="post-share"><div class="social-share" data-image="/img/%E5%A4%B4%E5%83%8F.jpg" data-sites="facebook,x,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2026/02/24/MySQL%20%E8%BF%90%E7%BB%B4%E7%AF%87%2003-03%20%E5%88%86%E5%BA%93%E5%88%86%E8%A1%A8%20MyCat%20%E6%A6%82%E8%BF%B0/" title="MySQL 运维篇 03-03 分库分表 MyCat 概述"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">MySQL 运维篇 03-03 分库分表 MyCat 概述</div></div><div class="info-2"><div class="info-item-1">MySQL 运维篇 03-03 分库分表 MyCat 概述MyCat 是一个开源的数据库中间件，位于应用程序和数据库之间，负责 SQL 解析、路由和结果合并。本文将介绍 MyCat 的基本概念、架构和核心功能。 一、MyCat 介绍1.1 什么是 MyCat？MyCat 是一个基于 Java 开发的数据库中间件，前身是阿里巴巴的 Cobar 项目。 12应用程序 → MyCat → MySQL 集群         (数据库中间件)  核心功能：  SQL 解析和路由 分库分表 读写分离 连接池管理 负载均衡  1.2 MyCat 特点   特点 说明    协议兼容 完全兼容 MySQL 协议   透明分片 应用无需修改代码   多种分片 支持 10+ 种分片规则   读写分离 自动路由读写请求   高可用 支持主从切换   1.3 适用场景   场景 说明    分库分表 单表数据量过大   读写分离 读多写少场景   数据库迁移 平滑迁移数据   多租户 SaaS 应用数据隔离   二、MyCat 架构2.1 整体架构1应用程序 → MyCat → MySQL 集群  核心...</div></div></div></a><a class="pagination-related" href="/2026/02/24/Python%20%E5%B8%B8%E7%94%A8%E5%BA%93%EF%BC%88%E4%B8%89%EF%BC%89logging%20%E6%97%A5%E5%BF%97%E6%A8%A1%E5%9D%97/" title="Python 常用库（三）logging 日志模块"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">Python 常用库（三）logging 日志模块</div></div><div class="info-2"><div class="info-item-1">Python 常用库（三）logging 日志模块日志是程序调试、监控和问题排查的重要工具。本篇将详细介绍 Python 内置的 logging 模块。 一、logging 简介1.1 为什么使用 logging？ 标准库：无需安装，开箱即用 灵活配置：可配置输出格式、级别、目标等 高性能：内置优化，适合生产环境 可扩展：支持自定义 Handler、Formatter、Filter  1.2 日志级别   级别 数值 说明 使用场景    DEBUG 10 调试信息 开发调试时的详细信息   INFO 20 一般信息 程序正常运行的信息   WARNING 30 警告信息 不影响运行但需要注意   ERROR 40 错误信息 程序错误但不影响继续运行   CRITICAL 50 严重错误 严重错误，程序可能无法继续   1234567import logginglogging.debug(&quot;调试信息&quot;)logging.info(&quot;一般信息&quot;)logging.warning(&quot;警告信息&quot;)logging.error(&qu...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2026/02/24/MySQL%20%E8%BF%90%E7%BB%B4%E7%AF%87%2004-01%20MyCat%20%E5%85%A5%E9%97%A8/" title="MySQL 运维篇 04-01 MyCat 入门"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2026-02-24</div><div class="info-item-2">MySQL 运维篇 04-01 MyCat 入门</div></div><div class="info-2"><div class="info-item-1">MySQL 运维篇 04-01 MyCat 入门本文是 MyCat 分库分表的入门教程，将介绍如何使用 MyCat 实现简单的分库分表功能。 一、MyCat 简介1.1 什么是 MyCatMyCat 是一个数据库中间件层，位于应用程序和 MySQL 数据库之间，提供分库分表、读写分离等功能。 1应用程序 → MyCat (中间件) → MySQL 集群  1.2 MyCat 功能   功能 说明    分库分表 将数据分布到多个库&#x2F;表中   读写分离 自动将读请求路由到从库   SQL 路由 根据规则路由 SQL 到对应节点   结果合并 合并多个分片的查询结果   连接池 管理数据库连接   1.3 MyCat 版本 MyCat 1.x：经典版本，稳定 MyCat 2.x：重构版本，性能更好  二、快速开始2.1 环境准备软件版本：  MyCat 2.0 MySQL 8.0 JDK 1.8+  服务器：    服务器 IP 角色    server1 192.168.1.100 MyCat + MySQL   2.2 目录结构123456789/opt/mycat/├...</div></div></div></a><a class="pagination-related" href="/2026/02/24/MySQL%20%E8%BF%90%E7%BB%B4%E7%AF%87%2003-03%20%E5%88%86%E5%BA%93%E5%88%86%E8%A1%A8%20MyCat%20%E6%A6%82%E8%BF%B0/" title="MySQL 运维篇 03-03 分库分表 MyCat 概述"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2026-02-24</div><div class="info-item-2">MySQL 运维篇 03-03 分库分表 MyCat 概述</div></div><div class="info-2"><div class="info-item-1">MySQL 运维篇 03-03 分库分表 MyCat 概述MyCat 是一个开源的数据库中间件，位于应用程序和数据库之间，负责 SQL 解析、路由和结果合并。本文将介绍 MyCat 的基本概念、架构和核心功能。 一、MyCat 介绍1.1 什么是 MyCat？MyCat 是一个基于 Java 开发的数据库中间件，前身是阿里巴巴的 Cobar 项目。 12应用程序 → MyCat → MySQL 集群         (数据库中间件)  核心功能：  SQL 解析和路由 分库分表 读写分离 连接池管理 负载均衡  1.2 MyCat 特点   特点 说明    协议兼容 完全兼容 MySQL 协议   透明分片 应用无需修改代码   多种分片 支持 10+ 种分片规则   读写分离 自动路由读写请求   高可用 支持主从切换   1.3 适用场景   场景 说明    分库分表 单表数据量过大   读写分离 读多写少场景   数据库迁移 平滑迁移数据   多租户 SaaS 应用数据隔离   二、MyCat 架构2.1 整体架构1应用程序 → MyCat → MySQL 集群  核心...</div></div></div></a><a class="pagination-related" href="/2026/02/24/MySQL%20%E8%BF%90%E7%BB%B4%E7%AF%87%2003-01%20%E5%88%86%E5%BA%93%E5%88%86%E8%A1%A8%E4%BB%8B%E7%BB%8D/" title="MySQL 运维篇 03-01 分库分表介绍"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2026-02-24</div><div class="info-item-2">MySQL 运维篇 03-01 分库分表介绍</div></div><div class="info-2"><div class="info-item-1">MySQL 运维篇 03-01 分库分表介绍当单表数据量过大时，数据库性能会显著下降。分库分表是解决大数据量存储和查询的有效方案。本文将介绍分库分表的概念、场景和常见方案。 一、为什么需要分库分表1.1 单表数据量限制经验法则： 12345单表数据量建议：├── 100 万以内：性能良好├── 100 万 -500 万：需要优化├── 500 万 -1000 万：需要考虑分表└── 1000 万以上：必须分表  性能瓶颈：    数据量 查询性能 索引大小 维护成本    100 万 &lt; 100ms 较小 低   500 万 100-500ms 中等 中   1000 万 &gt; 500ms 较大 高   1 亿+ &gt; 1s 很大 很高   1.2 常见问题存储问题： 123- 单表数据占用过多磁盘空间- 索引文件过大- binlog 增长过快  性能问题： 1234- 查询响应时间变长- 索引效率下降- 锁竞争加剧- 缓冲池命中率降低  维护问题： 123- DDL 操作耗时过长- 备份恢复困难- 数据清理影响性能  二、分库分表概念2.1 基本概念分库分表（Sh...</div></div></div></a><a class="pagination-related" href="/2026/02/24/MySQL%20%E8%BF%90%E7%BB%B4%E7%AF%87%2003-04%20MyCat%20%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE/" title="MySQL 运维篇 03-04 MyCat 安装与配置"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2026-02-24</div><div class="info-item-2">MySQL 运维篇 03-04 MyCat 安装与配置</div></div><div class="info-2"><div class="info-item-1">MySQL 运维篇 03-04 MyCat 安装与配置本文将详细讲解 MyCat 的下载、安装、配置和启动过程，帮助你快速搭建 MyCat 环境。 一、环境准备1.1 系统要求   组件 要求    Java JDK 1.8+   内存 最少 2GB，推荐 4GB+   磁盘 最少 10GB 可用空间   MySQL 5.6+   1.2 环境信息   服务器 IP 地址 角色 软件    server1 192.168.1.100 MyCat + Master MyCat, MySQL   server2 192.168.1.101 Slave MySQL   1.3 安装 JavaLinux (CentOS&#x2F;RHEL)： 12345# 安装 OpenJDK 8yum install -y java-1.8.0-openjdk java-1.8.0-openjdk-devel# 验证安装java -version  Linux (Ubuntu&#x2F;Debian)： 123456# 安装 OpenJDK 8apt-get updateapt-get install...</div></div></div></a><a class="pagination-related" href="/2026/02/24/MySQL%20%E8%BF%90%E7%BB%B4%E7%AF%87%2002-03%20%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E4%B8%BB%E5%BA%93%E9%85%8D%E7%BD%AE/" title="MySQL 运维篇 02-03 主从复制主库配置"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2026-02-24</div><div class="info-item-2">MySQL 运维篇 02-03 主从复制主库配置</div></div><div class="info-2"><div class="info-item-1">MySQL 运维篇 02-03 主从复制主库配置本文将详细讲解主从复制中主库的配置步骤，包括配置文件修改、复制用户创建、权限设置等。 一、配置前准备1.1 环境信息   服务器 IP 地址 角色 server_id    master 192.168.1.100 主库 1   slave1 192.168.1.101 从库 2   slave2 192.168.1.102 从库 3   1.2 MySQL 版本12345# 检查 MySQL 版本mysql --version# 示例输出mysql  Ver 8.0.32 for Linux on x86_64 (MySQL Community Server - GPL)  1.3 配置检查清单  确保主从网络互通  确保 3306 端口开放  准备 replication 用户密码  记录当前数据状态  二、主库配置文件修改2.1 找到配置文件1234567# Linux/etc/my.cnf/etc/mysql/my.cnf/etc/mysql/mysql.conf.d/mysqld.cnf# WindowsC:\Progra...</div></div></div></a><a class="pagination-related" href="/2026/02/24/MySQL%20%E8%BF%90%E7%BB%B4%E7%AF%87%2004-06%20MyCat%20%E6%B0%B4%E5%B9%B3%E5%88%86%E8%A1%A8/" title="MySQL 运维篇 04-06 MyCat 水平分表"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2026-02-24</div><div class="info-item-2">MySQL 运维篇 04-06 MyCat 水平分表</div></div><div class="info-2"><div class="info-item-1">MySQL 运维篇 04-06 MyCat 水平分表水平分表是将一个大表的数据按照某种规则分布到多个表中。本文将介绍如何使用 MyCat 实现水平分表。 一、水平分表介绍1.1 什么是水平分表水平分表：将同一个表的数据按照行拆分到多个物理表中。 12345678原始表：orders (1 亿条数据)水平分表后：orders_0000 (250 万条)orders_0001 (250 万条)orders_0002 (250 万条)orders_0003 (250 万条)  1.2 适用场景   场景 说明    单表数据量大 超过 1000 万行   查询性能下降 索引效率低   维护困难 DDL 操作耗时过长   1.3 分片规则   规则 说明 适用场景    取模 id % 分片数 均匀分布   范围 按 ID 或日期范围 历史数据归档   哈希 hash(key) % 分片数 随机分布   二、环境准备2.1 数据库规划12345order_db├── orders_0000├── orders_0001├── orders_0002└── orders_0003  2.2...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/%E5%A4%B4%E5%83%8F.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">过拟合的炸鱼薯条</div><div class="author-info-description">好好学习，天天向上</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">68</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">157</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">9</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/Brian-Lin-C"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/Brian-Lin-C" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">欢迎来到我的个人博客！</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#MySQL-%E8%BF%90%E7%BB%B4%E7%AF%87-03-02-%E6%8B%86%E5%88%86%E6%96%B9%E5%BC%8F%E8%AF%A6%E8%A7%A3"><span class="toc-number">1.</span> <span class="toc-text">MySQL 运维篇 03-02 拆分方式详解</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E5%9E%82%E7%9B%B4%E6%8B%86%E5%88%86%E5%AE%9E%E6%88%98"><span class="toc-number">1.1.</span> <span class="toc-text">一、垂直拆分实战</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-%E5%9C%BA%E6%99%AF%E6%8F%8F%E8%BF%B0"><span class="toc-number">1.1.1.</span> <span class="toc-text">1.1 场景描述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-%E5%9E%82%E7%9B%B4%E6%8B%86%E5%88%86%E6%96%B9%E6%A1%88"><span class="toc-number">1.1.2.</span> <span class="toc-text">1.2 垂直拆分方案</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-%E6%95%B0%E6%8D%AE%E8%BF%81%E7%A7%BB"><span class="toc-number">1.1.3.</span> <span class="toc-text">1.3 数据迁移</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-4-%E6%9F%A5%E8%AF%A2%E4%BC%98%E5%8C%96"><span class="toc-number">1.1.4.</span> <span class="toc-text">1.4 查询优化</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E6%B0%B4%E5%B9%B3%E6%8B%86%E5%88%86%E5%AE%9E%E6%88%98"><span class="toc-number">1.2.</span> <span class="toc-text">二、水平拆分实战</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-%E5%9C%BA%E6%99%AF%E6%8F%8F%E8%BF%B0"><span class="toc-number">1.2.1.</span> <span class="toc-text">2.1 场景描述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-%E6%8C%89-user-id-%E5%8F%96%E6%A8%A1%E6%8B%86%E5%88%86"><span class="toc-number">1.2.2.</span> <span class="toc-text">2.2 按 user_id 取模拆分</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-%E6%95%B0%E6%8D%AE%E8%BF%81%E7%A7%BB%E8%84%9A%E6%9C%AC"><span class="toc-number">1.2.3.</span> <span class="toc-text">2.3 数据迁移脚本</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-%E6%9F%A5%E8%AF%A2%E7%A4%BA%E4%BE%8B"><span class="toc-number">1.2.4.</span> <span class="toc-text">2.4 查询示例</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E6%8C%89%E6%97%A5%E6%9C%9F%E8%8C%83%E5%9B%B4%E6%8B%86%E5%88%86"><span class="toc-number">1.3.</span> <span class="toc-text">三、按日期范围拆分</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-%E5%9C%BA%E6%99%AF%E6%8F%8F%E8%BF%B0"><span class="toc-number">1.3.1.</span> <span class="toc-text">3.1 场景描述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-%E6%8C%89%E6%9C%88%E5%88%86%E8%A1%A8"><span class="toc-number">1.3.2.</span> <span class="toc-text">3.2 按月分表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-%E8%87%AA%E5%8A%A8%E5%88%9B%E5%BB%BA%E8%A1%A8%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B"><span class="toc-number">1.3.3.</span> <span class="toc-text">3.3 自动创建表存储过程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-%E6%9F%A5%E8%AF%A2%E7%A4%BA%E4%BE%8B"><span class="toc-number">1.3.4.</span> <span class="toc-text">3.4 查询示例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-5-%E5%8E%86%E5%8F%B2%E6%95%B0%E6%8D%AE%E6%B8%85%E7%90%86"><span class="toc-number">1.3.5.</span> <span class="toc-text">3.5 历史数据清理</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E6%8C%89%E5%9C%B0%E5%8C%BA%E6%8B%86%E5%88%86"><span class="toc-number">1.4.</span> <span class="toc-text">四、按地区拆分</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-%E5%9C%BA%E6%99%AF%E6%8F%8F%E8%BF%B0"><span class="toc-number">1.4.1.</span> <span class="toc-text">4.1 场景描述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-%E6%8C%89%E7%9C%81%E4%BB%BD%E5%88%86%E5%BA%93"><span class="toc-number">1.4.2.</span> <span class="toc-text">4.2 按省份分库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-%E8%B7%AF%E7%94%B1%E8%A7%84%E5%88%99"><span class="toc-number">1.4.3.</span> <span class="toc-text">4.3 路由规则</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94%E3%80%81%E7%BB%84%E5%90%88%E6%8B%86%E5%88%86%E7%AD%96%E7%95%A5"><span class="toc-number">1.5.</span> <span class="toc-text">五、组合拆分策略</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-%E5%9C%BA%E6%99%AF%E6%8F%8F%E8%BF%B0"><span class="toc-number">1.5.1.</span> <span class="toc-text">5.1 场景描述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-%E7%BB%84%E5%90%88%E6%96%B9%E6%A1%88"><span class="toc-number">1.5.2.</span> <span class="toc-text">5.2 组合方案</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-%E8%A1%A8%E7%BB%93%E6%9E%84"><span class="toc-number">1.5.3.</span> <span class="toc-text">5.3 表结构</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AD%E3%80%81%E6%8B%86%E5%88%86%E6%96%B9%E6%A1%88%E5%AF%B9%E6%AF%94"><span class="toc-number">1.6.</span> <span class="toc-text">六、拆分方案对比</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1-%E6%96%B9%E6%A1%88%E5%AF%B9%E6%AF%94%E8%A1%A8"><span class="toc-number">1.6.1.</span> <span class="toc-text">6.1 方案对比表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-%E9%80%89%E6%8B%A9%E5%BB%BA%E8%AE%AE"><span class="toc-number">1.6.2.</span> <span class="toc-text">6.2 选择建议</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%83%E3%80%81%E5%B0%8F%E7%BB%93"><span class="toc-number">1.7.</span> <span class="toc-text">七、小结</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%B8%E5%BF%83%E7%9F%A5%E8%AF%86%E7%82%B9"><span class="toc-number">1.7.1.</span> <span class="toc-text">核心知识点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8B%86%E5%88%86%E5%86%B3%E7%AD%96%E6%B5%81%E7%A8%8B"><span class="toc-number">1.7.2.</span> <span class="toc-text">拆分决策流程</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2026/02/24/IDE%20%E5%B7%A5%E5%85%B7%E9%85%8D%E7%BD%AE%EF%BC%9AVS%20Code%20+%20Jupyter%20+%20DataGrip/" title="IDE 工具配置：VS Code + Jupyter + DataGrip">IDE 工具配置：VS Code + Jupyter + DataGrip</a><time datetime="2026-02-24T15:00:00.000Z" title="发表于 2026-02-24 23:00:00">2026-02-24</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2026/02/24/Git%20%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6%E4%B8%8E%E5%9B%A2%E9%98%9F%E5%8D%8F%E4%BD%9C/" title="Git 版本控制与团队协作">Git 版本控制与团队协作</a><time datetime="2026-02-24T14:00:00.000Z" title="发表于 2026-02-24 22:00:00">2026-02-24</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2026/02/24/Linux%20%E4%B8%8E%20Shell%EF%BC%88%E4%BA%8C%EF%BC%89Shell%20%E8%84%9A%E6%9C%AC%E7%BC%96%E5%86%99/" title="Linux 与 Shell（二）Shell 脚本编写">Linux 与 Shell（二）Shell 脚本编写</a><time datetime="2026-02-24T13:00:00.000Z" title="发表于 2026-02-24 21:00:00">2026-02-24</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2026/02/24/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5%E8%AF%A6%E8%A7%A3%20-%20%E7%BB%B4%E5%BA%A6%E5%BB%BA%E6%A8%A1%E3%80%81%E6%95%B0%E6%8D%AE%E5%88%86%E5%B1%82%E4%B8%8E%20SCD%20%E5%A4%84%E7%90%86/" title="数据仓库核心概念详解 - 维度建模、数据分层与 SCD 处理">数据仓库核心概念详解 - 维度建模、数据分层与 SCD 处理</a><time datetime="2026-02-24T13:00:00.000Z" title="发表于 2026-02-24 21:00:00">2026-02-24</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2026/02/24/MySQL%20%E8%BF%90%E7%BB%B4%E7%AF%87%2004-10%20MyCat%20%E7%AE%A1%E7%90%86%E4%B8%8E%E7%9B%91%E6%8E%A7/" title="MySQL 运维篇 04-10 MyCat 管理与监控">MySQL 运维篇 04-10 MyCat 管理与监控</a><time datetime="2026-02-24T12:05:00.000Z" title="发表于 2026-02-24 20:05:00">2026-02-24</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2025 - 2026 By 过拟合的炸鱼薯条</span><span class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 8.1.1</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.5.4</a></span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=5.5.4"></script><script src="/js/main.js?v=5.5.4"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><i class="fas fa-spinner fa-pulse" id="loading-status" hidden="hidden"></i><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据加载中</span></div><div class="local-search-input"><input placeholder="搜索..." type="text"/></div><hr/><div id="local-search-results"></div><div class="ais-Pagination" id="local-search-pagination" style="display:none;"><ul class="ais-Pagination-list"></ul></div><div id="local-search-stats"></div></div><div id="search-mask"></div><script src="/js/search/local-search.js?v=5.5.4"></script></div></div></body></html>