<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>MySQL 运维篇 02-04 主从复制从库配置 | 过拟合的炸鱼薯条</title><meta name="author" content="过拟合的炸鱼薯条"><meta name="copyright" content="过拟合的炸鱼薯条"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="MySQL 运维篇 02-04 主从复制从库配置本文将详细讲解主从复制中从库的配置步骤，包括配置文件修改、数据恢复、复制连接等。 一、配置前准备1.1 环境信息   服务器 IP 地址 角色 server_id    master 192.168.1.100 主库 1   slave1 192.168.1.101 从库 2   1.2 主库配置完成确认在配置从库前，确保主库已完成：   binlo">
<meta property="og:type" content="article">
<meta property="og:title" content="MySQL 运维篇 02-04 主从复制从库配置">
<meta property="og:url" content="https://brian-lin-c.github.io/2026/02/24/MySQL%20%E8%BF%90%E7%BB%B4%E7%AF%87%2002-04%20%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E4%BB%8E%E5%BA%93%E9%85%8D%E7%BD%AE/index.html">
<meta property="og:site_name" content="过拟合的炸鱼薯条">
<meta property="og:description" content="MySQL 运维篇 02-04 主从复制从库配置本文将详细讲解主从复制中从库的配置步骤，包括配置文件修改、数据恢复、复制连接等。 一、配置前准备1.1 环境信息   服务器 IP 地址 角色 server_id    master 192.168.1.100 主库 1   slave1 192.168.1.101 从库 2   1.2 主库配置完成确认在配置从库前，确保主库已完成：   binlo">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://brian-lin-c.github.io/img/%E5%A4%B4%E5%83%8F.jpg">
<meta property="article:published_time" content="2026-02-24T10:45:00.000Z">
<meta property="article:modified_time" content="2026-02-24T11:13:16.630Z">
<meta property="article:author" content="过拟合的炸鱼薯条">
<meta property="article:tag" content="MySQL">
<meta property="article:tag" content="主从复制">
<meta property="article:tag" content="从库配置">
<meta property="article:tag" content="实战">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://brian-lin-c.github.io/img/%E5%A4%B4%E5%83%8F.jpg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "MySQL 运维篇 02-04 主从复制从库配置",
  "url": "https://brian-lin-c.github.io/2026/02/24/MySQL%20%E8%BF%90%E7%BB%B4%E7%AF%87%2002-04%20%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E4%BB%8E%E5%BA%93%E9%85%8D%E7%BD%AE/",
  "image": "https://brian-lin-c.github.io/img/%E5%A4%B4%E5%83%8F.jpg",
  "datePublished": "2026-02-24T10:45:00.000Z",
  "dateModified": "2026-02-24T11:13:16.630Z",
  "author": [
    {
      "@type": "Person",
      "name": "过拟合的炸鱼薯条",
      "url": "https://brian-lin-c.github.io"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://brian-lin-c.github.io/2026/02/24/MySQL%20%E8%BF%90%E7%BB%B4%E7%AF%87%2002-04%20%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E4%BB%8E%E5%BA%93%E9%85%8D%E7%BD%AE/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=5.5.4"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@7.1.0/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"top_n_per_article":1,"unescape":false,"pagination":{"enable":false,"hitsPerPage":8},"languages":{"hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.13.0/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'MySQL 运维篇 02-04 主从复制从库配置',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 8.1.1"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/%E5%A4%B4%E5%83%8F.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">68</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">157</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">9</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-user"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">过拟合的炸鱼薯条</span></a><a class="nav-page-title" href="/"><span class="site-name">MySQL 运维篇 02-04 主从复制从库配置</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  返回首页</span></span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-user"></i><span> 关于</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">MySQL 运维篇 02-04 主从复制从库配置</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2026-02-24T10:45:00.000Z" title="发表于 2026-02-24 18:45:00">2026-02-24</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2026-02-24T11:13:16.630Z" title="更新于 2026-02-24 19:13:16">2026-02-24</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/MySQL-%E8%BF%90%E7%BB%B4%E7%AF%87/">MySQL 运维篇</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">1.9k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>8分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h1 id="MySQL-运维篇-02-04-主从复制从库配置"><a href="#MySQL-运维篇-02-04-主从复制从库配置" class="headerlink" title="MySQL 运维篇 02-04 主从复制从库配置"></a>MySQL 运维篇 02-04 主从复制从库配置</h1><p>本文将详细讲解主从复制中从库的配置步骤，包括配置文件修改、数据恢复、复制连接等。</p>
<h2 id="一、配置前准备"><a href="#一、配置前准备" class="headerlink" title="一、配置前准备"></a>一、配置前准备</h2><h3 id="1-1-环境信息"><a href="#1-1-环境信息" class="headerlink" title="1.1 环境信息"></a>1.1 环境信息</h3><table>
<thead>
<tr>
<th>服务器</th>
<th>IP 地址</th>
<th>角色</th>
<th>server_id</th>
</tr>
</thead>
<tbody><tr>
<td>master</td>
<td>192.168.1.100</td>
<td>主库</td>
<td>1</td>
</tr>
<tr>
<td>slave1</td>
<td>192.168.1.101</td>
<td>从库</td>
<td>2</td>
</tr>
</tbody></table>
<h3 id="1-2-主库配置完成确认"><a href="#1-2-主库配置完成确认" class="headerlink" title="1.2 主库配置完成确认"></a>1.2 主库配置完成确认</h3><p>在配置从库前，确保主库已完成：</p>
<ul>
<li><input checked="" disabled="" type="checkbox"> binlog 已开启</li>
<li><input checked="" disabled="" type="checkbox"> server_id 已设置</li>
<li><input checked="" disabled="" type="checkbox"> 复制用户已创建</li>
<li><input checked="" disabled="" type="checkbox"> 防火墙已配置</li>
<li><input checked="" disabled="" type="checkbox"> 已记录 binlog 位置（File 和 Position）</li>
</ul>
<h2 id="二、从库配置文件修改"><a href="#二、从库配置文件修改" class="headerlink" title="二、从库配置文件修改"></a>二、从库配置文件修改</h2><h3 id="2-1-必需配置项"><a href="#2-1-必需配置项" class="headerlink" title="2.1 必需配置项"></a>2.1 必需配置项</h3><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[mysqld]</span></span><br><span class="line"><span class="comment"># ===== 复制必需配置 =====</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. server_id（必须唯一，不能与主库和其他从库重复）</span></span><br><span class="line"><span class="attr">server_id</span> = <span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. relay log 配置</span></span><br><span class="line"><span class="attr">relay_log</span> = /var/log/mysql/mysql-relay-bin.log</span><br><span class="line"><span class="attr">relay_log_index</span> = /var/log/mysql/mysql-relay-bin.index</span><br><span class="line"></span><br><span class="line"><span class="comment"># ===== 推荐配置 =====</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 只读模式（防止误写入）</span></span><br><span class="line"><span class="attr">read_only</span> = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. 记录从库的 binlog（级联复制需要）</span></span><br><span class="line"><span class="attr">log_slave_updates</span> = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 5. 超级用户只读限制</span></span><br><span class="line"><span class="attr">super_read_only</span> = <span class="number">1</span></span><br></pre></td></tr></table></figure>

<h3 id="2-2-可选配置项"><a href="#2-2-可选配置项" class="headerlink" title="2.2 可选配置项"></a>2.2 可选配置项</h3><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[mysqld]</span></span><br><span class="line"><span class="comment"># GTID 模式（与主库保持一致）</span></span><br><span class="line"><span class="attr">gtid_mode</span> = <span class="literal">ON</span></span><br><span class="line"><span class="attr">enforce_gtid_consistency</span> = <span class="literal">ON</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 并行复制（MySQL 5.7+）</span></span><br><span class="line"><span class="attr">slave_parallel_workers</span> = <span class="number">4</span></span><br><span class="line"><span class="attr">slave_parallel_type</span> = <span class="string">&#x27;LOGICAL_CLOCK&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 复制过滤</span></span><br><span class="line"><span class="attr">replicate_do_db</span> = db1</span><br><span class="line"><span class="attr">replicate_ignore_db</span> = test</span><br><span class="line"></span><br><span class="line"><span class="comment"># 复制表过滤</span></span><br><span class="line"><span class="attr">replicate_do_table</span> = db1.table1</span><br><span class="line"><span class="attr">replicate_ignore_table</span> = db1.table2</span><br><span class="line"></span><br><span class="line"><span class="comment"># 跳过特定错误</span></span><br><span class="line"><span class="comment"># slave_skip_errors = 1062,1032</span></span><br></pre></td></tr></table></figure>

<h3 id="2-3-完整配置示例"><a href="#2-3-完整配置示例" class="headerlink" title="2.3 完整配置示例"></a>2.3 完整配置示例</h3><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[mysqld]</span></span><br><span class="line"><span class="comment"># 基本配置</span></span><br><span class="line"><span class="attr">port</span> = <span class="number">3306</span></span><br><span class="line"><span class="attr">basedir</span> = /usr/local/mysql</span><br><span class="line"><span class="attr">datadir</span> = /var/lib/mysql</span><br><span class="line"><span class="attr">socket</span> = /var/lib/mysql/mysql.sock</span><br><span class="line"></span><br><span class="line"><span class="comment"># 复制配置</span></span><br><span class="line"><span class="attr">server_id</span> = <span class="number">2</span></span><br><span class="line"><span class="attr">relay_log</span> = /var/log/mysql/mysql-relay-bin.log</span><br><span class="line"><span class="attr">relay_log_index</span> = /var/log/mysql/mysql-relay-bin.index</span><br><span class="line"><span class="attr">read_only</span> = <span class="number">1</span></span><br><span class="line"><span class="attr">super_read_only</span> = <span class="number">1</span></span><br><span class="line"><span class="attr">log_slave_updates</span> = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># GTID 配置（与主库一致）</span></span><br><span class="line"><span class="attr">gtid_mode</span> = <span class="literal">ON</span></span><br><span class="line"><span class="attr">enforce_gtid_consistency</span> = <span class="literal">ON</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 并行复制</span></span><br><span class="line"><span class="attr">slave_parallel_workers</span> = <span class="number">4</span></span><br><span class="line"><span class="attr">slave_parallel_type</span> = <span class="string">&#x27;LOGICAL_CLOCK&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 性能优化</span></span><br><span class="line"><span class="attr">innodb_buffer_pool_size</span> = <span class="number">1</span>G</span><br><span class="line"><span class="attr">innodb_flush_log_at_trx_commit</span> = <span class="number">2</span></span><br></pre></td></tr></table></figure>

<h3 id="2-4-重启-MySQL"><a href="#2-4-重启-MySQL" class="headerlink" title="2.4 重启 MySQL"></a>2.4 重启 MySQL</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Linux (systemd)</span></span><br><span class="line">systemctl restart mysqld</span><br><span class="line"></span><br><span class="line"><span class="comment"># Linux (init.d)</span></span><br><span class="line">service mysql restart</span><br><span class="line"></span><br><span class="line"><span class="comment"># Windows</span></span><br><span class="line">net stop MySQL80</span><br><span class="line">net start MySQL80</span><br></pre></td></tr></table></figure>

<h3 id="2-5-验证配置"><a href="#2-5-验证配置" class="headerlink" title="2.5 验证配置"></a>2.5 验证配置</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 检查 server_id</span></span><br><span class="line"><span class="keyword">SHOW</span> VARIABLES <span class="keyword">LIKE</span> <span class="string">&#x27;server_id&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 检查 relay log</span></span><br><span class="line"><span class="keyword">SHOW</span> VARIABLES <span class="keyword">LIKE</span> <span class="string">&#x27;relay_log&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 检查只读状态</span></span><br><span class="line"><span class="keyword">SHOW</span> VARIABLES <span class="keyword">LIKE</span> <span class="string">&#x27;read_only&#x27;</span>;</span><br><span class="line"><span class="keyword">SHOW</span> VARIABLES <span class="keyword">LIKE</span> <span class="string">&#x27;super_read_only&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 检查 GTID 模式</span></span><br><span class="line"><span class="keyword">SHOW</span> VARIABLES <span class="keyword">LIKE</span> <span class="string">&#x27;gtid_mode&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h2 id="三、数据同步"><a href="#三、数据同步" class="headerlink" title="三、数据同步"></a>三、数据同步</h2><h3 id="3-1-方法一：mysqldump-恢复"><a href="#3-1-方法一：mysqldump-恢复" class="headerlink" title="3.1 方法一：mysqldump 恢复"></a>3.1 方法一：mysqldump 恢复</h3><p><strong>步骤 1：从主库备份</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在主库执行</span></span><br><span class="line">mysqldump -u root -p \</span><br><span class="line">    --single-transaction \</span><br><span class="line">    --master-data=2 \</span><br><span class="line">    --all-databases \</span><br><span class="line">    &gt; /backup/full_backup.sql</span><br></pre></td></tr></table></figure>

<p><strong>步骤 2：传输备份文件到从库</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用 scp 传输</span></span><br><span class="line">scp /backup/full_backup.sql root@192.168.1.101:/backup/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 或使用 rsync</span></span><br><span class="line">rsync -avz /backup/full_backup.sql root@192.168.1.101:/backup/</span><br></pre></td></tr></table></figure>

<p><strong>步骤 3：在从库恢复数据</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在从库执行</span></span><br><span class="line">mysql -u root -p &lt; /backup/full_backup.sql</span><br></pre></td></tr></table></figure>

<h3 id="3-2-方法二：XtraBackup-热备"><a href="#3-2-方法二：XtraBackup-热备" class="headerlink" title="3.2 方法二：XtraBackup 热备"></a>3.2 方法二：XtraBackup 热备</h3><p><strong>步骤 1：在主库备份</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">xtrabackup --backup \</span><br><span class="line">    --target-dir=/backup/full_backup \</span><br><span class="line">    --user=root \</span><br><span class="line">    --password=RootPass</span><br></pre></td></tr></table></figure>

<p><strong>步骤 2：准备备份</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">xtrabackup --prepare \</span><br><span class="line">    --target-dir=/backup/full_backup</span><br></pre></td></tr></table></figure>

<p><strong>步骤 3：传输到从库</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 打包备份</span></span><br><span class="line">tar -czf backup.tar.gz -C /backup full_backup</span><br><span class="line"></span><br><span class="line"><span class="comment"># 传输</span></span><br><span class="line">scp backup.tar.gz root@192.168.1.101:/backup/</span><br></pre></td></tr></table></figure>

<p><strong>步骤 4：在从库恢复</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 解压</span></span><br><span class="line">tar -xzf backup.tar.gz -C /backup/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 停止 MySQL</span></span><br><span class="line">systemctl stop mysqld</span><br><span class="line"></span><br><span class="line"><span class="comment"># 清空数据目录</span></span><br><span class="line"><span class="built_in">rm</span> -rf /var/lib/mysql/*</span><br><span class="line"></span><br><span class="line"><span class="comment"># 恢复数据</span></span><br><span class="line">xtrabackup --copy-back \</span><br><span class="line">    --target-dir=/backup/full_backup</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改权限</span></span><br><span class="line"><span class="built_in">chown</span> -R mysql:mysql /var/lib/mysql</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动 MySQL</span></span><br><span class="line">systemctl start mysqld</span><br></pre></td></tr></table></figure>

<h3 id="3-3-方法三：GTID-自动定位（MySQL-5-7-）"><a href="#3-3-方法三：GTID-自动定位（MySQL-5-7-）" class="headerlink" title="3.3 方法三：GTID 自动定位（MySQL 5.7+）"></a>3.3 方法三：GTID 自动定位（MySQL 5.7+）</h3><p>如果主从都启用了 GTID，可以自动定位：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 在从库执行</span></span><br><span class="line">CHANGE MASTER <span class="keyword">TO</span></span><br><span class="line">    MASTER_HOST <span class="operator">=</span> <span class="string">&#x27;192.168.1.100&#x27;</span>,</span><br><span class="line">    MASTER_USER <span class="operator">=</span> <span class="string">&#x27;repl&#x27;</span>,</span><br><span class="line">    MASTER_PASSWORD <span class="operator">=</span> <span class="string">&#x27;Repl@2024Pass&#x27;</span>,</span><br><span class="line">    MASTER_AUTO_POSITION <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">START</span> SLAVE;</span><br></pre></td></tr></table></figure>

<h2 id="四、配置复制连接"><a href="#四、配置复制连接" class="headerlink" title="四、配置复制连接"></a>四、配置复制连接</h2><h3 id="4-1-获取主库-binlog-位置"><a href="#4-1-获取主库-binlog-位置" class="headerlink" title="4.1 获取主库 binlog 位置"></a>4.1 获取主库 binlog 位置</h3><p><strong>在主库执行</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> MASTER STATUS;</span><br></pre></td></tr></table></figure>

<p><strong>记录以下信息</strong>：</p>
<ul>
<li>File: <code>mysql-bin.000001</code></li>
<li>Position: <code>154</code></li>
<li>Executed_Gtid_Set: <code>abc123:1-10</code>（如果使用 GTID）</li>
</ul>
<h3 id="4-2-配置-CHANGE-MASTER-TO"><a href="#4-2-配置-CHANGE-MASTER-TO" class="headerlink" title="4.2 配置 CHANGE MASTER TO"></a>4.2 配置 CHANGE MASTER TO</h3><p><strong>传统方式（基于位置）</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 在从库执行</span></span><br><span class="line">CHANGE MASTER <span class="keyword">TO</span></span><br><span class="line">    MASTER_HOST <span class="operator">=</span> <span class="string">&#x27;192.168.1.100&#x27;</span>,</span><br><span class="line">    MASTER_PORT <span class="operator">=</span> <span class="number">3306</span>,</span><br><span class="line">    MASTER_USER <span class="operator">=</span> <span class="string">&#x27;repl&#x27;</span>,</span><br><span class="line">    MASTER_PASSWORD <span class="operator">=</span> <span class="string">&#x27;Repl@2024Pass&#x27;</span>,</span><br><span class="line">    MASTER_LOG_FILE <span class="operator">=</span> <span class="string">&#x27;mysql-bin.000001&#x27;</span>,</span><br><span class="line">    MASTER_LOG_POS <span class="operator">=</span> <span class="number">154</span>;</span><br></pre></td></tr></table></figure>

<p><strong>GTID 方式（推荐）</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 在从库执行</span></span><br><span class="line">CHANGE MASTER <span class="keyword">TO</span></span><br><span class="line">    MASTER_HOST <span class="operator">=</span> <span class="string">&#x27;192.168.1.100&#x27;</span>,</span><br><span class="line">    MASTER_PORT <span class="operator">=</span> <span class="number">3306</span>,</span><br><span class="line">    MASTER_USER <span class="operator">=</span> <span class="string">&#x27;repl&#x27;</span>,</span><br><span class="line">    MASTER_PASSWORD <span class="operator">=</span> <span class="string">&#x27;Repl@2024Pass&#x27;</span>,</span><br><span class="line">    MASTER_AUTO_POSITION <span class="operator">=</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<h3 id="4-3-完整参数说明"><a href="#4-3-完整参数说明" class="headerlink" title="4.3 完整参数说明"></a>4.3 完整参数说明</h3><table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
<th>必填</th>
</tr>
</thead>
<tbody><tr>
<td>MASTER_HOST</td>
<td>主库 IP 地址</td>
<td>是</td>
</tr>
<tr>
<td>MASTER_PORT</td>
<td>主库端口</td>
<td>否 (默认 3306)</td>
</tr>
<tr>
<td>MASTER_USER</td>
<td>复制用户名</td>
<td>是</td>
</tr>
<tr>
<td>MASTER_PASSWORD</td>
<td>复制用户密码</td>
<td>是</td>
</tr>
<tr>
<td>MASTER_LOG_FILE</td>
<td>主库 binlog 文件名</td>
<td>否 (GTID 模式不需要)</td>
</tr>
<tr>
<td>MASTER_LOG_POS</td>
<td>主库 binlog 位置</td>
<td>否 (GTID 模式不需要)</td>
</tr>
<tr>
<td>MASTER_AUTO_POSITION</td>
<td>GTID 自动定位</td>
<td>否 (GTID 模式设为 1)</td>
</tr>
<tr>
<td>MASTER_CONNECT_RETRY</td>
<td>连接重试间隔</td>
<td>否 (默认 60 秒)</td>
</tr>
<tr>
<td>MASTER_RETRY_COUNT</td>
<td>重试次数</td>
<td>否 (默认 86400)</td>
</tr>
</tbody></table>
<h3 id="4-4-验证配置"><a href="#4-4-验证配置" class="headerlink" title="4.4 验证配置"></a>4.4 验证配置</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查看复制配置</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> mysql.slave_master_info\G</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 或</span></span><br><span class="line"><span class="keyword">SHOW</span> SLAVE STATUS\G</span><br></pre></td></tr></table></figure>

<h2 id="五、启动复制"><a href="#五、启动复制" class="headerlink" title="五、启动复制"></a>五、启动复制</h2><h3 id="5-1-启动复制"><a href="#5-1-启动复制" class="headerlink" title="5.1 启动复制"></a>5.1 启动复制</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 启动复制</span></span><br><span class="line"><span class="keyword">START</span> SLAVE;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 或（MySQL 8.0+）</span></span><br><span class="line"><span class="keyword">START</span> REPLICA;</span><br></pre></td></tr></table></figure>

<h3 id="5-2-检查复制状态"><a href="#5-2-检查复制状态" class="headerlink" title="5.2 检查复制状态"></a>5.2 检查复制状态</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> SLAVE STATUS\G</span><br></pre></td></tr></table></figure>

<p><strong>关键字段检查</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Slave_IO_Running: Yes        -- I/O 线程必须运行</span><br><span class="line">Slave_SQL_Running: Yes       -- SQL 线程必须运行</span><br><span class="line">Seconds_Behind_Master: 0     -- 延迟时间（越小越好）</span><br><span class="line">Last_Error:                  -- 应该为空</span><br><span class="line">Last_IO_Error:               -- 应该为空</span><br><span class="line">Last_SQL_Error:              -- 应该为空</span><br></pre></td></tr></table></figure>

<h3 id="5-3-复制状态详解"><a href="#5-3-复制状态详解" class="headerlink" title="5.3 复制状态详解"></a>5.3 复制状态详解</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> SLAVE STATUS\G</span><br><span class="line"><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span> <span class="number">1.</span> <span class="type">row</span> <span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span></span><br><span class="line">               Slave_IO_State: Waiting <span class="keyword">for</span> master <span class="keyword">to</span> send event</span><br><span class="line">                  Master_Host: <span class="number">192.168</span><span class="number">.1</span><span class="number">.100</span></span><br><span class="line">                  Master_User: repl</span><br><span class="line">                  Master_Port: <span class="number">3306</span></span><br><span class="line">                Connect_Retry: <span class="number">60</span></span><br><span class="line">              Master_Log_File: mysql<span class="operator">-</span>bin<span class="number">.000001</span></span><br><span class="line">          Read_Master_Log_Pos: <span class="number">154</span></span><br><span class="line">               Relay_Log_File: mysql<span class="operator">-</span>relay<span class="operator">-</span>bin<span class="number">.000002</span></span><br><span class="line">                Relay_Log_Pos: <span class="number">320</span></span><br><span class="line">        Relay_Master_Log_File: mysql<span class="operator">-</span>bin<span class="number">.000001</span></span><br><span class="line">             Slave_IO_Running: Yes</span><br><span class="line">            Slave_SQL_Running: Yes</span><br><span class="line">             Replicate_Do_DB:</span><br><span class="line">          Replicate_Ignore_DB:</span><br><span class="line">           Replicate_Do_Table:</span><br><span class="line">       Replicate_Ignore_Table:</span><br><span class="line">      Replicate_Wild_Do_Table:</span><br><span class="line">  Replicate_Wild_Ignore_Table:</span><br><span class="line">                   Last_Errno: <span class="number">0</span></span><br><span class="line">                   Last_Error:</span><br><span class="line">                 Skip_Counter: <span class="number">0</span></span><br><span class="line">          Exec_Master_Log_Pos: <span class="number">154</span></span><br><span class="line">              Relay_Log_Space: <span class="number">533</span></span><br><span class="line">              Until_Condition: <span class="keyword">None</span></span><br><span class="line">               Until_Log_File:</span><br><span class="line">                Until_Log_Pos: <span class="number">0</span></span><br><span class="line">           Master_SSL_Allowed: <span class="keyword">No</span></span><br><span class="line">           Master_SSL_CA_File:</span><br><span class="line">           Master_SSL_CA_Path:</span><br><span class="line">              Master_SSL_Cert:</span><br><span class="line">            Master_SSL_Cipher:</span><br><span class="line">               Master_SSL_Key:</span><br><span class="line">        Seconds_Behind_Master: <span class="number">0</span></span><br><span class="line">Master_SSL_Verify_Server_Cert: <span class="keyword">No</span></span><br><span class="line">                Last_IO_Errno: <span class="number">0</span></span><br><span class="line">                Last_IO_Error:</span><br><span class="line">               Last_SQL_Errno: <span class="number">0</span></span><br><span class="line">               Last_SQL_Error:</span><br></pre></td></tr></table></figure>

<h2 id="六、复制测试"><a href="#六、复制测试" class="headerlink" title="六、复制测试"></a>六、复制测试</h2><h3 id="6-1-测试数据同步"><a href="#6-1-测试数据同步" class="headerlink" title="6.1 测试数据同步"></a>6.1 测试数据同步</h3><p><strong>在主库执行</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 创建测试数据库</span></span><br><span class="line"><span class="keyword">CREATE</span> DATABASE test_replication;</span><br><span class="line">USE test_replication;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建测试表</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> users (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT,</span><br><span class="line">    name <span class="type">VARCHAR</span>(<span class="number">50</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 插入测试数据</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> users (name) <span class="keyword">VALUES</span> (<span class="string">&#x27;张三&#x27;</span>), (<span class="string">&#x27;李四&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看 binlog 位置</span></span><br><span class="line"><span class="keyword">SHOW</span> MASTER STATUS;</span><br></pre></td></tr></table></figure>

<p><strong>在从库验证</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查看数据库</span></span><br><span class="line"><span class="keyword">SHOW</span> DATABASES;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看表</span></span><br><span class="line">USE test_replication;</span><br><span class="line"><span class="keyword">SHOW</span> TABLES;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看数据</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 检查复制状态</span></span><br><span class="line"><span class="keyword">SHOW</span> SLAVE STATUS\G</span><br></pre></td></tr></table></figure>

<h3 id="6-2-测试写操作限制"><a href="#6-2-测试写操作限制" class="headerlink" title="6.2 测试写操作限制"></a>6.2 测试写操作限制</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 在从库尝试写入（应该失败）</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> users (name) <span class="keyword">VALUES</span> (<span class="string">&#x27;王五&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 错误：The MySQL server is running with the --read-only option</span></span><br></pre></td></tr></table></figure>

<h3 id="6-3-测试延迟"><a href="#6-3-测试延迟" class="headerlink" title="6.3 测试延迟"></a>6.3 测试延迟</h3><p><strong>在主库执行</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 记录时间</span></span><br><span class="line"><span class="keyword">SELECT</span> NOW();</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 插入数据</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> users (name) <span class="keyword">VALUES</span> (<span class="string">&#x27;测试时间&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p><strong>在从库检查</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查看数据是否同步</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">ORDER</span> <span class="keyword">BY</span> id <span class="keyword">DESC</span> LIMIT <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看延迟</span></span><br><span class="line"><span class="keyword">SHOW</span> SLAVE STATUS\G</span><br><span class="line"><span class="comment">-- 检查 Seconds_Behind_Master</span></span><br></pre></td></tr></table></figure>

<h2 id="七、故障排查"><a href="#七、故障排查" class="headerlink" title="七、故障排查"></a>七、故障排查</h2><h3 id="7-1-I-O-线程无法启动"><a href="#7-1-I-O-线程无法启动" class="headerlink" title="7.1 I&#x2F;O 线程无法启动"></a>7.1 I&#x2F;O 线程无法启动</h3><p><strong>错误</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Slave_IO_Running: No</span><br><span class="line">Last_IO_Error: error connecting to master</span><br></pre></td></tr></table></figure>

<p><strong>排查步骤</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. 检查网络连通性</span></span><br><span class="line">ping 192.168.1.100</span><br><span class="line">telnet 192.168.1.100 3306</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 检查防火墙</span></span><br><span class="line"><span class="comment"># 在主库检查 3306 端口是否开放</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 检查复制用户</span></span><br><span class="line"><span class="comment"># 在主库验证用户权限</span></span><br><span class="line">SHOW GRANTS FOR <span class="string">&#x27;repl&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p><strong>解决</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 重新配置连接信息</span></span><br><span class="line">STOP SLAVE;</span><br><span class="line">CHANGE MASTER <span class="keyword">TO</span></span><br><span class="line">    MASTER_HOST <span class="operator">=</span> <span class="string">&#x27;192.168.1.100&#x27;</span>,</span><br><span class="line">    MASTER_USER <span class="operator">=</span> <span class="string">&#x27;repl&#x27;</span>,</span><br><span class="line">    MASTER_PASSWORD <span class="operator">=</span> <span class="string">&#x27;Repl@2024Pass&#x27;</span>,</span><br><span class="line">    MASTER_AUTO_POSITION <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">START</span> SLAVE;</span><br></pre></td></tr></table></figure>

<h3 id="7-2-SQL-线程无法启动"><a href="#7-2-SQL-线程无法启动" class="headerlink" title="7.2 SQL 线程无法启动"></a>7.2 SQL 线程无法启动</h3><p><strong>错误</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Slave_SQL_Running: No</span><br><span class="line">Last_SQL_Error: Duplicate entry &#x27;1&#x27; for key &#x27;PRIMARY&#x27;</span><br></pre></td></tr></table></figure>

<p><strong>解决 1：跳过错误（谨慎使用）</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">STOP SLAVE;</span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span> sql_slave_skip_counter <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">START</span> SLAVE;</span><br></pre></td></tr></table></figure>

<p><strong>解决 2：重新同步数据</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 停止复制</span></span><br><span class="line">STOP SLAVE;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 重置复制信息</span></span><br><span class="line">RESET SLAVE;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 重新配置（需要先恢复数据）</span></span><br><span class="line">CHANGE MASTER <span class="keyword">TO</span> ...;</span><br><span class="line"><span class="keyword">START</span> SLAVE;</span><br></pre></td></tr></table></figure>

<h3 id="7-3-复制延迟"><a href="#7-3-复制延迟" class="headerlink" title="7.3 复制延迟"></a>7.3 复制延迟</h3><p><strong>检查</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> SLAVE STATUS\G</span><br><span class="line"><span class="comment">-- 查看 Seconds_Behind_Master</span></span><br></pre></td></tr></table></figure>

<p><strong>解决</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 开启并行复制</span></span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span> slave_parallel_workers <span class="operator">=</span> <span class="number">4</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 检查是否有大事务</span></span><br><span class="line"><span class="keyword">SHOW</span> PROCESSLIST;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 优化从库性能</span></span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span> innodb_flush_log_at_trx_commit <span class="operator">=</span> <span class="number">2</span>;</span><br></pre></td></tr></table></figure>

<h2 id="八、小结"><a href="#八、小结" class="headerlink" title="八、小结"></a>八、小结</h2><h3 id="从库配置步骤总结"><a href="#从库配置步骤总结" class="headerlink" title="从库配置步骤总结"></a>从库配置步骤总结</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">1. 修改配置文件</span><br><span class="line">   - server_id = 2</span><br><span class="line">   - relay_log = /path/to/relay-bin.log</span><br><span class="line">   - read_only = 1</span><br><span class="line"></span><br><span class="line">2. 重启 MySQL</span><br><span class="line"></span><br><span class="line">3. 恢复主库数据</span><br><span class="line">   - mysqldump 或 XtraBackup</span><br><span class="line"></span><br><span class="line">4. 配置复制连接</span><br><span class="line">   - CHANGE MASTER TO ...</span><br><span class="line"></span><br><span class="line">5. 启动复制</span><br><span class="line">   - START SLAVE</span><br><span class="line"></span><br><span class="line">6. 验证复制状态</span><br><span class="line">   - SHOW SLAVE STATUS</span><br></pre></td></tr></table></figure>

<h3 id="配置验证命令"><a href="#配置验证命令" class="headerlink" title="配置验证命令"></a>配置验证命令</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 检查配置</span></span><br><span class="line"><span class="keyword">SHOW</span> VARIABLES <span class="keyword">LIKE</span> <span class="string">&#x27;server_id&#x27;</span>;</span><br><span class="line"><span class="keyword">SHOW</span> VARIABLES <span class="keyword">LIKE</span> <span class="string">&#x27;read_only&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 检查复制状态</span></span><br><span class="line"><span class="keyword">SHOW</span> SLAVE STATUS\G</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 关键指标</span></span><br><span class="line"><span class="comment">-- Slave_IO_Running: Yes</span></span><br><span class="line"><span class="comment">-- Slave_SQL_Running: Yes</span></span><br><span class="line"><span class="comment">-- Seconds_Behind_Master: 0</span></span><br></pre></td></tr></table></figure>

<h3 id="下一步"><a href="#下一步" class="headerlink" title="下一步"></a>下一步</h3><p>完成从库配置后，进行复制测试：</p>
<ul>
<li>02-05：复制测试</li>
</ul>
<hr>
<p><strong>下一篇</strong>：[MySQL 运维篇 02-05 主从复制测试](&#x2F;2026&#x2F;02&#x2F;24&#x2F;MySQL 运维篇 02-05 主从复制测试&#x2F;)</p>
<p><strong>上一篇</strong>：[MySQL 运维篇 02-03 主从复制主库配置](&#x2F;2026&#x2F;02&#x2F;24&#x2F;MySQL 运维篇 02-03 主从复制主库配置&#x2F;)</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://brian-lin-c.github.io">过拟合的炸鱼薯条</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://brian-lin-c.github.io/2026/02/24/MySQL%20%E8%BF%90%E7%BB%B4%E7%AF%87%2002-04%20%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E4%BB%8E%E5%BA%93%E9%85%8D%E7%BD%AE/">https://brian-lin-c.github.io/2026/02/24/MySQL%20%E8%BF%90%E7%BB%B4%E7%AF%87%2002-04%20%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E4%BB%8E%E5%BA%93%E9%85%8D%E7%BD%AE/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://brian-lin-c.github.io" target="_blank">过拟合的炸鱼薯条</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/MySQL/">MySQL</a><a class="post-meta__tags" href="/tags/%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6/">主从复制</a><a class="post-meta__tags" href="/tags/%E5%AE%9E%E6%88%98/">实战</a><a class="post-meta__tags" href="/tags/%E4%BB%8E%E5%BA%93%E9%85%8D%E7%BD%AE/">从库配置</a></div><div class="post-share"><div class="social-share" data-image="/img/%E5%A4%B4%E5%83%8F.jpg" data-sites="facebook,x,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2026/02/24/MySQL%20%E8%BF%90%E7%BB%B4%E7%AF%87%2002-05%20%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E6%B5%8B%E8%AF%95/" title="MySQL 运维篇 02-05 主从复制测试"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">MySQL 运维篇 02-05 主从复制测试</div></div><div class="info-2"><div class="info-item-1">MySQL 运维篇 02-05 主从复制测试完成主从配置后，需要进行全面的测试以验证复制功能正常。本文将介绍各种测试场景和验证方法。 一、复制状态检查1.1 基础状态检查12-- 在从库执行SHOW SLAVE STATUS\G  关键指标： 12345678Slave_IO_Running: Yes        ✓ I/O 线程运行正常Slave_SQL_Running: Yes       ✓ SQL 线程运行正常Seconds_Behind_Master: 0     ✓ 无延迟Master_Host: 192.168.1.100   ✓ 主库连接正确Master_Port: 3306            ✓ 端口正确Last_Error:                  ✓ 无错误Last_IO_Error:               ✓ 无错误Last_SQL_Error:              ✓ 无错误  1.2 详细状态检查123456789101112131415-- 检查复制配置SELECT    Master_Host,    Master_Po...</div></div></div></a><a class="pagination-related" href="/2026/02/24/MySQL%20%E8%BF%90%E7%BB%B4%E7%AF%87%2002-03%20%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E4%B8%BB%E5%BA%93%E9%85%8D%E7%BD%AE/" title="MySQL 运维篇 02-03 主从复制主库配置"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">MySQL 运维篇 02-03 主从复制主库配置</div></div><div class="info-2"><div class="info-item-1">MySQL 运维篇 02-03 主从复制主库配置本文将详细讲解主从复制中主库的配置步骤，包括配置文件修改、复制用户创建、权限设置等。 一、配置前准备1.1 环境信息   服务器 IP 地址 角色 server_id    master 192.168.1.100 主库 1   slave1 192.168.1.101 从库 2   slave2 192.168.1.102 从库 3   1.2 MySQL 版本12345# 检查 MySQL 版本mysql --version# 示例输出mysql  Ver 8.0.32 for Linux on x86_64 (MySQL Community Server - GPL)  1.3 配置检查清单  确保主从网络互通  确保 3306 端口开放  准备 replication 用户密码  记录当前数据状态  二、主库配置文件修改2.1 找到配置文件1234567# Linux/etc/my.cnf/etc/mysql/my.cnf/etc/mysql/mysql.conf.d/mysqld.cnf# WindowsC:\Progra...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2026/02/24/MySQL%20%E8%BF%90%E7%BB%B4%E7%AF%87%2002-03%20%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E4%B8%BB%E5%BA%93%E9%85%8D%E7%BD%AE/" title="MySQL 运维篇 02-03 主从复制主库配置"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2026-02-24</div><div class="info-item-2">MySQL 运维篇 02-03 主从复制主库配置</div></div><div class="info-2"><div class="info-item-1">MySQL 运维篇 02-03 主从复制主库配置本文将详细讲解主从复制中主库的配置步骤，包括配置文件修改、复制用户创建、权限设置等。 一、配置前准备1.1 环境信息   服务器 IP 地址 角色 server_id    master 192.168.1.100 主库 1   slave1 192.168.1.101 从库 2   slave2 192.168.1.102 从库 3   1.2 MySQL 版本12345# 检查 MySQL 版本mysql --version# 示例输出mysql  Ver 8.0.32 for Linux on x86_64 (MySQL Community Server - GPL)  1.3 配置检查清单  确保主从网络互通  确保 3306 端口开放  准备 replication 用户密码  记录当前数据状态  二、主库配置文件修改2.1 找到配置文件1234567# Linux/etc/my.cnf/etc/mysql/my.cnf/etc/mysql/mysql.conf.d/mysqld.cnf# WindowsC:\Progra...</div></div></div></a><a class="pagination-related" href="/2026/02/24/MySQL%20%E8%BF%90%E7%BB%B4%E7%AF%87%2002-05%20%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E6%B5%8B%E8%AF%95/" title="MySQL 运维篇 02-05 主从复制测试"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2026-02-24</div><div class="info-item-2">MySQL 运维篇 02-05 主从复制测试</div></div><div class="info-2"><div class="info-item-1">MySQL 运维篇 02-05 主从复制测试完成主从配置后，需要进行全面的测试以验证复制功能正常。本文将介绍各种测试场景和验证方法。 一、复制状态检查1.1 基础状态检查12-- 在从库执行SHOW SLAVE STATUS\G  关键指标： 12345678Slave_IO_Running: Yes        ✓ I/O 线程运行正常Slave_SQL_Running: Yes       ✓ SQL 线程运行正常Seconds_Behind_Master: 0     ✓ 无延迟Master_Host: 192.168.1.100   ✓ 主库连接正确Master_Port: 3306            ✓ 端口正确Last_Error:                  ✓ 无错误Last_IO_Error:               ✓ 无错误Last_SQL_Error:              ✓ 无错误  1.2 详细状态检查123456789101112131415-- 检查复制配置SELECT    Master_Host,    Master_Po...</div></div></div></a><a class="pagination-related" href="/2026/02/24/MySQL%20%E8%BF%90%E7%BB%B4%E7%AF%87%2004-04%20MyCat%20%E5%9E%82%E7%9B%B4%E5%88%86%E5%BA%93/" title="MySQL 运维篇 04-04 MyCat 垂直分库"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2026-02-24</div><div class="info-item-2">MySQL 运维篇 04-04 MyCat 垂直分库</div></div><div class="info-2"><div class="info-item-1">MySQL 运维篇 04-04 MyCat 垂直分库垂直分库是将不同的业务表分布到不同的数据库中。本文将介绍如何使用 MyCat 实现垂直分库。 一、垂直分库介绍1.1 什么是垂直分库垂直分库：按照业务模块将表拆分到不同的数据库中。 1234567原始架构：single_db (users, orders, products, logs, ...)垂直分库后：user_db (users, user_profile, user_login, ...)order_db (orders, order_detail, order_log, ...)product_db (products, category, brand, ...)  1.2 适用场景   场景 说明    业务模块清晰 各模块相对独立   表数量过多 单库表数量超过 100   访问量差异大 热门表和冷门表分离   团队分工 不同团队负责不同模块   1.3 优缺点优点：  业务清晰，便于管理 减少单库压力 便于水平扩展  缺点：  跨库 JOIN 复杂 事务处理困难 增加运维成本  二、环境准备2.1 数据库规划 ...</div></div></div></a><a class="pagination-related" href="/2026/02/24/MySQL%20%E8%BF%90%E7%BB%B4%E7%AF%87%2004-06%20MyCat%20%E6%B0%B4%E5%B9%B3%E5%88%86%E8%A1%A8/" title="MySQL 运维篇 04-06 MyCat 水平分表"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2026-02-24</div><div class="info-item-2">MySQL 运维篇 04-06 MyCat 水平分表</div></div><div class="info-2"><div class="info-item-1">MySQL 运维篇 04-06 MyCat 水平分表水平分表是将一个大表的数据按照某种规则分布到多个表中。本文将介绍如何使用 MyCat 实现水平分表。 一、水平分表介绍1.1 什么是水平分表水平分表：将同一个表的数据按照行拆分到多个物理表中。 12345678原始表：orders (1 亿条数据)水平分表后：orders_0000 (250 万条)orders_0001 (250 万条)orders_0002 (250 万条)orders_0003 (250 万条)  1.2 适用场景   场景 说明    单表数据量大 超过 1000 万行   查询性能下降 索引效率低   维护困难 DDL 操作耗时过长   1.3 分片规则   规则 说明 适用场景    取模 id % 分片数 均匀分布   范围 按 ID 或日期范围 历史数据归档   哈希 hash(key) % 分片数 随机分布   二、环境准备2.1 数据库规划12345order_db├── orders_0000├── orders_0001├── orders_0002└── orders_0003  2.2...</div></div></div></a><a class="pagination-related" href="/2026/02/24/MySQL%20%E8%BF%90%E7%BB%B4%E7%AF%87%2004-08%20MyCat%20%E5%8F%96%E6%A8%A1%E5%88%86%E7%89%87/" title="MySQL 运维篇 04-08 MyCat 取模分片"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2026-02-24</div><div class="info-item-2">MySQL 运维篇 04-08 MyCat 取模分片</div></div><div class="info-2"><div class="info-item-1">MySQL 运维篇 04-08 MyCat 取模分片取模分片是最常用的分片方式，按照分片键对分片数取模来路由数据。本文将详细介绍取模分片的配置和使用。 一、取模分片介绍1.1 什么是取模分片取模分片：根据分片键对分片数量取模来确定数据存储位置。 12345678公式：分片索引 = 分片键 % 分片数量示例（4 个分片）：id=1 → 1%4=1 → 分片 1id=2 → 2%4=2 → 分片 2id=3 → 3%4=3 → 分片 3id=4 → 4%4=0 → 分片 0id=5 → 5%4=1 → 分片 1  1.2 适用场景   场景 说明    用户订单 按 user_id 取模   用户数据 按用户 ID 取模   均匀分布 需要数据均匀分布   1.3 优缺点优点：  数据分布均匀 算法简单高效 查询效率高  缺点：  扩容困难（需要 rehash） 范围查询效率低  二、基础配置2.1 rule.yml12345678910tableRules:  - name: mod-long    function: mod-long    columns: idfunction...</div></div></div></a><a class="pagination-related" href="/2026/02/24/MySQL%20%E8%BF%90%E7%BB%B4%E7%AF%87%2003-02%20%E6%8B%86%E5%88%86%E6%96%B9%E5%BC%8F%E8%AF%A6%E8%A7%A3/" title="MySQL 运维篇 03-02 拆分方式详解"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2026-02-24</div><div class="info-item-2">MySQL 运维篇 03-02 拆分方式详解</div></div><div class="info-2"><div class="info-item-1">MySQL 运维篇 03-02 拆分方式详解本文将详细讲解各种分库分表的拆分方式，包括垂直拆分、水平拆分的实战案例和代码示例。 一、垂直拆分实战1.1 场景描述原始表结构： 1234567891011CREATE TABLE products (    id INT PRIMARY KEY AUTO_INCREMENT,    name VARCHAR(100),    description TEXT,        -- 大字段    detail TEXT,             -- 大字段    price DECIMAL(10, 2),    stock INT,    images BLOB,             -- 图片数据    created_at DATETIME,    updated_at DATETIME);  问题：  单表 1000 万数据 description、detail、images 占用大量空间 查询商品列表时不需要大字段  1.2 垂直拆分方案拆分后表结构： 1234567891011121314151617181920-- 商...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/%E5%A4%B4%E5%83%8F.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">过拟合的炸鱼薯条</div><div class="author-info-description">好好学习，天天向上</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">68</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">157</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">9</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/Brian-Lin-C"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/Brian-Lin-C" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">欢迎来到我的个人博客！</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#MySQL-%E8%BF%90%E7%BB%B4%E7%AF%87-02-04-%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E4%BB%8E%E5%BA%93%E9%85%8D%E7%BD%AE"><span class="toc-number">1.</span> <span class="toc-text">MySQL 运维篇 02-04 主从复制从库配置</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E9%85%8D%E7%BD%AE%E5%89%8D%E5%87%86%E5%A4%87"><span class="toc-number">1.1.</span> <span class="toc-text">一、配置前准备</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-%E7%8E%AF%E5%A2%83%E4%BF%A1%E6%81%AF"><span class="toc-number">1.1.1.</span> <span class="toc-text">1.1 环境信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-%E4%B8%BB%E5%BA%93%E9%85%8D%E7%BD%AE%E5%AE%8C%E6%88%90%E7%A1%AE%E8%AE%A4"><span class="toc-number">1.1.2.</span> <span class="toc-text">1.2 主库配置完成确认</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E4%BB%8E%E5%BA%93%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%BF%AE%E6%94%B9"><span class="toc-number">1.2.</span> <span class="toc-text">二、从库配置文件修改</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-%E5%BF%85%E9%9C%80%E9%85%8D%E7%BD%AE%E9%A1%B9"><span class="toc-number">1.2.1.</span> <span class="toc-text">2.1 必需配置项</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-%E5%8F%AF%E9%80%89%E9%85%8D%E7%BD%AE%E9%A1%B9"><span class="toc-number">1.2.2.</span> <span class="toc-text">2.2 可选配置项</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-%E5%AE%8C%E6%95%B4%E9%85%8D%E7%BD%AE%E7%A4%BA%E4%BE%8B"><span class="toc-number">1.2.3.</span> <span class="toc-text">2.3 完整配置示例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-%E9%87%8D%E5%90%AF-MySQL"><span class="toc-number">1.2.4.</span> <span class="toc-text">2.4 重启 MySQL</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-5-%E9%AA%8C%E8%AF%81%E9%85%8D%E7%BD%AE"><span class="toc-number">1.2.5.</span> <span class="toc-text">2.5 验证配置</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E6%95%B0%E6%8D%AE%E5%90%8C%E6%AD%A5"><span class="toc-number">1.3.</span> <span class="toc-text">三、数据同步</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-%E6%96%B9%E6%B3%95%E4%B8%80%EF%BC%9Amysqldump-%E6%81%A2%E5%A4%8D"><span class="toc-number">1.3.1.</span> <span class="toc-text">3.1 方法一：mysqldump 恢复</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-%E6%96%B9%E6%B3%95%E4%BA%8C%EF%BC%9AXtraBackup-%E7%83%AD%E5%A4%87"><span class="toc-number">1.3.2.</span> <span class="toc-text">3.2 方法二：XtraBackup 热备</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-%E6%96%B9%E6%B3%95%E4%B8%89%EF%BC%9AGTID-%E8%87%AA%E5%8A%A8%E5%AE%9A%E4%BD%8D%EF%BC%88MySQL-5-7-%EF%BC%89"><span class="toc-number">1.3.3.</span> <span class="toc-text">3.3 方法三：GTID 自动定位（MySQL 5.7+）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E9%85%8D%E7%BD%AE%E5%A4%8D%E5%88%B6%E8%BF%9E%E6%8E%A5"><span class="toc-number">1.4.</span> <span class="toc-text">四、配置复制连接</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-%E8%8E%B7%E5%8F%96%E4%B8%BB%E5%BA%93-binlog-%E4%BD%8D%E7%BD%AE"><span class="toc-number">1.4.1.</span> <span class="toc-text">4.1 获取主库 binlog 位置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-%E9%85%8D%E7%BD%AE-CHANGE-MASTER-TO"><span class="toc-number">1.4.2.</span> <span class="toc-text">4.2 配置 CHANGE MASTER TO</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-%E5%AE%8C%E6%95%B4%E5%8F%82%E6%95%B0%E8%AF%B4%E6%98%8E"><span class="toc-number">1.4.3.</span> <span class="toc-text">4.3 完整参数说明</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-4-%E9%AA%8C%E8%AF%81%E9%85%8D%E7%BD%AE"><span class="toc-number">1.4.4.</span> <span class="toc-text">4.4 验证配置</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94%E3%80%81%E5%90%AF%E5%8A%A8%E5%A4%8D%E5%88%B6"><span class="toc-number">1.5.</span> <span class="toc-text">五、启动复制</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-%E5%90%AF%E5%8A%A8%E5%A4%8D%E5%88%B6"><span class="toc-number">1.5.1.</span> <span class="toc-text">5.1 启动复制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-%E6%A3%80%E6%9F%A5%E5%A4%8D%E5%88%B6%E7%8A%B6%E6%80%81"><span class="toc-number">1.5.2.</span> <span class="toc-text">5.2 检查复制状态</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-%E5%A4%8D%E5%88%B6%E7%8A%B6%E6%80%81%E8%AF%A6%E8%A7%A3"><span class="toc-number">1.5.3.</span> <span class="toc-text">5.3 复制状态详解</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AD%E3%80%81%E5%A4%8D%E5%88%B6%E6%B5%8B%E8%AF%95"><span class="toc-number">1.6.</span> <span class="toc-text">六、复制测试</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1-%E6%B5%8B%E8%AF%95%E6%95%B0%E6%8D%AE%E5%90%8C%E6%AD%A5"><span class="toc-number">1.6.1.</span> <span class="toc-text">6.1 测试数据同步</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-%E6%B5%8B%E8%AF%95%E5%86%99%E6%93%8D%E4%BD%9C%E9%99%90%E5%88%B6"><span class="toc-number">1.6.2.</span> <span class="toc-text">6.2 测试写操作限制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-3-%E6%B5%8B%E8%AF%95%E5%BB%B6%E8%BF%9F"><span class="toc-number">1.6.3.</span> <span class="toc-text">6.3 测试延迟</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%83%E3%80%81%E6%95%85%E9%9A%9C%E6%8E%92%E6%9F%A5"><span class="toc-number">1.7.</span> <span class="toc-text">七、故障排查</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#7-1-I-O-%E7%BA%BF%E7%A8%8B%E6%97%A0%E6%B3%95%E5%90%AF%E5%8A%A8"><span class="toc-number">1.7.1.</span> <span class="toc-text">7.1 I&#x2F;O 线程无法启动</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-2-SQL-%E7%BA%BF%E7%A8%8B%E6%97%A0%E6%B3%95%E5%90%AF%E5%8A%A8"><span class="toc-number">1.7.2.</span> <span class="toc-text">7.2 SQL 线程无法启动</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-3-%E5%A4%8D%E5%88%B6%E5%BB%B6%E8%BF%9F"><span class="toc-number">1.7.3.</span> <span class="toc-text">7.3 复制延迟</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AB%E3%80%81%E5%B0%8F%E7%BB%93"><span class="toc-number">1.8.</span> <span class="toc-text">八、小结</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8E%E5%BA%93%E9%85%8D%E7%BD%AE%E6%AD%A5%E9%AA%A4%E6%80%BB%E7%BB%93"><span class="toc-number">1.8.1.</span> <span class="toc-text">从库配置步骤总结</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E9%AA%8C%E8%AF%81%E5%91%BD%E4%BB%A4"><span class="toc-number">1.8.2.</span> <span class="toc-text">配置验证命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8B%E4%B8%80%E6%AD%A5"><span class="toc-number">1.8.3.</span> <span class="toc-text">下一步</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2026/02/24/IDE%20%E5%B7%A5%E5%85%B7%E9%85%8D%E7%BD%AE%EF%BC%9AVS%20Code%20+%20Jupyter%20+%20DataGrip/" title="IDE 工具配置：VS Code + Jupyter + DataGrip">IDE 工具配置：VS Code + Jupyter + DataGrip</a><time datetime="2026-02-24T15:00:00.000Z" title="发表于 2026-02-24 23:00:00">2026-02-24</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2026/02/24/Git%20%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6%E4%B8%8E%E5%9B%A2%E9%98%9F%E5%8D%8F%E4%BD%9C/" title="Git 版本控制与团队协作">Git 版本控制与团队协作</a><time datetime="2026-02-24T14:00:00.000Z" title="发表于 2026-02-24 22:00:00">2026-02-24</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2026/02/24/Linux%20%E4%B8%8E%20Shell%EF%BC%88%E4%BA%8C%EF%BC%89Shell%20%E8%84%9A%E6%9C%AC%E7%BC%96%E5%86%99/" title="Linux 与 Shell（二）Shell 脚本编写">Linux 与 Shell（二）Shell 脚本编写</a><time datetime="2026-02-24T13:00:00.000Z" title="发表于 2026-02-24 21:00:00">2026-02-24</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2026/02/24/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5%E8%AF%A6%E8%A7%A3%20-%20%E7%BB%B4%E5%BA%A6%E5%BB%BA%E6%A8%A1%E3%80%81%E6%95%B0%E6%8D%AE%E5%88%86%E5%B1%82%E4%B8%8E%20SCD%20%E5%A4%84%E7%90%86/" title="数据仓库核心概念详解 - 维度建模、数据分层与 SCD 处理">数据仓库核心概念详解 - 维度建模、数据分层与 SCD 处理</a><time datetime="2026-02-24T13:00:00.000Z" title="发表于 2026-02-24 21:00:00">2026-02-24</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2026/02/24/MySQL%20%E8%BF%90%E7%BB%B4%E7%AF%87%2004-10%20MyCat%20%E7%AE%A1%E7%90%86%E4%B8%8E%E7%9B%91%E6%8E%A7/" title="MySQL 运维篇 04-10 MyCat 管理与监控">MySQL 运维篇 04-10 MyCat 管理与监控</a><time datetime="2026-02-24T12:05:00.000Z" title="发表于 2026-02-24 20:05:00">2026-02-24</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2025 - 2026 By 过拟合的炸鱼薯条</span><span class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 8.1.1</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.5.4</a></span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=5.5.4"></script><script src="/js/main.js?v=5.5.4"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><i class="fas fa-spinner fa-pulse" id="loading-status" hidden="hidden"></i><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据加载中</span></div><div class="local-search-input"><input placeholder="搜索..." type="text"/></div><hr/><div id="local-search-results"></div><div class="ais-Pagination" id="local-search-pagination" style="display:none;"><ul class="ais-Pagination-list"></ul></div><div id="local-search-stats"></div></div><div id="search-mask"></div><script src="/js/search/local-search.js?v=5.5.4"></script></div></div></body></html>