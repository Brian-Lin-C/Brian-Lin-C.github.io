<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>MySQL 进阶教程（四）事务详解 | 过拟合的炸鱼薯条</title><meta name="author" content="过拟合的炸鱼薯条"><meta name="copyright" content="过拟合的炸鱼薯条"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="MySQL 进阶教程（四）事务详解事务是数据库管理的核心技术之一，用于保证数据的完整性和一致性。本文将详细讲解事务的概念、ACID 特性、并发问题以及隔离级别。 一、事务简介1.1 什么是事务？事务（Transaction） 是数据库管理系统执行过程中的一个逻辑单位，由一个有限的数据库操作序列构成。这些操作要么全部成功执行，要么全部不执行，是一个不可分割的工作单位。 1.2 事务的特点 原子性：事">
<meta property="og:type" content="article">
<meta property="og:title" content="MySQL 进阶教程（四）事务详解">
<meta property="og:url" content="https://brian-lin-c.github.io/2026/02/23/MySQL%20%E8%BF%9B%E9%98%B6%E6%95%99%E7%A8%8B%EF%BC%88%E5%9B%9B%EF%BC%89%E4%BA%8B%E5%8A%A1%E8%AF%A6%E8%A7%A3/index.html">
<meta property="og:site_name" content="过拟合的炸鱼薯条">
<meta property="og:description" content="MySQL 进阶教程（四）事务详解事务是数据库管理的核心技术之一，用于保证数据的完整性和一致性。本文将详细讲解事务的概念、ACID 特性、并发问题以及隔离级别。 一、事务简介1.1 什么是事务？事务（Transaction） 是数据库管理系统执行过程中的一个逻辑单位，由一个有限的数据库操作序列构成。这些操作要么全部成功执行，要么全部不执行，是一个不可分割的工作单位。 1.2 事务的特点 原子性：事">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://brian-lin-c.github.io/img/%E5%A4%B4%E5%83%8F.jpg">
<meta property="article:published_time" content="2026-02-23T10:00:00.000Z">
<meta property="article:modified_time" content="2026-02-23T03:58:50.015Z">
<meta property="article:author" content="过拟合的炸鱼薯条">
<meta property="article:tag" content="ACID">
<meta property="article:tag" content="MySQL">
<meta property="article:tag" content="事务">
<meta property="article:tag" content="并发控制">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://brian-lin-c.github.io/img/%E5%A4%B4%E5%83%8F.jpg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "MySQL 进阶教程（四）事务详解",
  "url": "https://brian-lin-c.github.io/2026/02/23/MySQL%20%E8%BF%9B%E9%98%B6%E6%95%99%E7%A8%8B%EF%BC%88%E5%9B%9B%EF%BC%89%E4%BA%8B%E5%8A%A1%E8%AF%A6%E8%A7%A3/",
  "image": "https://brian-lin-c.github.io/img/%E5%A4%B4%E5%83%8F.jpg",
  "datePublished": "2026-02-23T10:00:00.000Z",
  "dateModified": "2026-02-23T03:58:50.015Z",
  "author": [
    {
      "@type": "Person",
      "name": "过拟合的炸鱼薯条",
      "url": "https://brian-lin-c.github.io"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://brian-lin-c.github.io/2026/02/23/MySQL%20%E8%BF%9B%E9%98%B6%E6%95%99%E7%A8%8B%EF%BC%88%E5%9B%9B%EF%BC%89%E4%BA%8B%E5%8A%A1%E8%AF%A6%E8%A7%A3/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=5.5.4"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@7.1.0/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"top_n_per_article":1,"unescape":false,"pagination":{"enable":false,"hitsPerPage":8},"languages":{"hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.13.0/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'MySQL 进阶教程（四）事务详解',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 8.1.1"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/%E5%A4%B4%E5%83%8F.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">12</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">26</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">3</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-user"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">过拟合的炸鱼薯条</span></a><a class="nav-page-title" href="/"><span class="site-name">MySQL 进阶教程（四）事务详解</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  返回首页</span></span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-user"></i><span> 关于</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">MySQL 进阶教程（四）事务详解</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2026-02-23T10:00:00.000Z" title="发表于 2026-02-23 18:00:00">2026-02-23</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2026-02-23T03:58:50.015Z" title="更新于 2026-02-23 11:58:50">2026-02-23</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/MySQL-%E8%BF%9B%E9%98%B6%E6%95%99%E7%A8%8B/">MySQL 进阶教程</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">3.3k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>12分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h1 id="MySQL-进阶教程（四）事务详解"><a href="#MySQL-进阶教程（四）事务详解" class="headerlink" title="MySQL 进阶教程（四）事务详解"></a>MySQL 进阶教程（四）事务详解</h1><p>事务是数据库管理的核心技术之一，用于保证数据的完整性和一致性。本文将详细讲解事务的概念、ACID 特性、并发问题以及隔离级别。</p>
<h2 id="一、事务简介"><a href="#一、事务简介" class="headerlink" title="一、事务简介"></a>一、事务简介</h2><h3 id="1-1-什么是事务？"><a href="#1-1-什么是事务？" class="headerlink" title="1.1 什么是事务？"></a>1.1 什么是事务？</h3><p><strong>事务（Transaction）</strong> 是数据库管理系统执行过程中的一个逻辑单位，由一个有限的数据库操作序列构成。这些操作要么全部成功执行，要么全部不执行，是一个不可分割的工作单位。</p>
<h3 id="1-2-事务的特点"><a href="#1-2-事务的特点" class="headerlink" title="1.2 事务的特点"></a>1.2 事务的特点</h3><ol>
<li><strong>原子性</strong>：事务是一个不可分割的操作序列</li>
<li><strong>一致性</strong>：事务执行前后，数据保持一致</li>
<li><strong>独立性</strong>：多个事务并发执行时互不干扰</li>
<li><strong>持久性</strong>：事务一旦提交，修改永久保存</li>
</ol>
<h3 id="1-3-事务的使用场景"><a href="#1-3-事务的使用场景" class="headerlink" title="1.3 事务的使用场景"></a>1.3 事务的使用场景</h3><table>
<thead>
<tr>
<th>场景</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>银行转账</td>
<td>A 转给 B 钱，A 扣款和 B 收款必须同时成功或失败</td>
</tr>
<tr>
<td>订单创建</td>
<td>创建订单、扣减库存、生成物流单必须同时成功</td>
</tr>
<tr>
<td>批量操作</td>
<td>批量导入数据，要么全部导入成功，要么全部回滚</td>
</tr>
<tr>
<td>数据一致性</td>
<td>更新多个关联表时保持一致性</td>
</tr>
</tbody></table>
<h3 id="1-4-不使用事务的问题"><a href="#1-4-不使用事务的问题" class="headerlink" title="1.4 不使用事务的问题"></a>1.4 不使用事务的问题</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 不使用事务的转账操作</span></span><br><span class="line"><span class="comment">-- 步骤 1：A 账户扣款</span></span><br><span class="line"><span class="keyword">UPDATE</span> accounts <span class="keyword">SET</span> balance <span class="operator">=</span> balance <span class="operator">-</span> <span class="number">100</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 假设这里系统故障或断电...</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 步骤 2：B 账户收款（可能永远不会执行）</span></span><br><span class="line"><span class="keyword">UPDATE</span> accounts <span class="keyword">SET</span> balance <span class="operator">=</span> balance <span class="operator">+</span> <span class="number">100</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 结果：A 的钱扣了，但 B 没收到，数据不一致！</span></span><br></pre></td></tr></table></figure>

<h2 id="二、事务操作演示"><a href="#二、事务操作演示" class="headerlink" title="二、事务操作演示"></a>二、事务操作演示</h2><h3 id="2-1-事务控制语句"><a href="#2-1-事务控制语句" class="headerlink" title="2.1 事务控制语句"></a>2.1 事务控制语句</h3><table>
<thead>
<tr>
<th>语句</th>
<th>功能</th>
</tr>
</thead>
<tbody><tr>
<td>START TRANSACTION &#x2F; BEGIN</td>
<td>开启事务</td>
</tr>
<tr>
<td>COMMIT</td>
<td>提交事务</td>
</tr>
<tr>
<td>ROLLBACK</td>
<td>回滚事务</td>
</tr>
<tr>
<td>SAVEPOINT</td>
<td>设置保存点</td>
</tr>
<tr>
<td>ROLLBACK TO SAVEPOINT</td>
<td>回滚到保存点</td>
</tr>
<tr>
<td>SET autocommit &#x3D; 0&#x2F;1</td>
<td>设置自动提交</td>
</tr>
</tbody></table>
<h3 id="2-2-准备测试数据"><a href="#2-2-准备测试数据" class="headerlink" title="2.2 准备测试数据"></a>2.2 准备测试数据</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 创建账户表</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> accounts;</span><br><span class="line"><span class="keyword">CREATE TABLE</span> accounts (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT,</span><br><span class="line">    account_name <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">    balance <span class="type">DECIMAL</span>(<span class="number">12</span>, <span class="number">2</span>) <span class="keyword">DEFAULT</span> <span class="number">0</span></span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 插入测试数据</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> accounts (account_name, balance) <span class="keyword">VALUES</span></span><br><span class="line">(<span class="string">&#x27;张三&#x27;</span>, <span class="number">10000</span>),</span><br><span class="line">(<span class="string">&#x27;李四&#x27;</span>, <span class="number">5000</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看初始数据</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> accounts;</span><br></pre></td></tr></table></figure>

<h3 id="2-3-基础事务操作"><a href="#2-3-基础事务操作" class="headerlink" title="2.3 基础事务操作"></a>2.3 基础事务操作</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查看自动提交状态</span></span><br><span class="line"><span class="keyword">SELECT</span> @<span class="variable">@autocommit</span>;  <span class="comment">-- 1 表示开启，0 表示关闭</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 开启事务</span></span><br><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"><span class="comment">-- 或</span></span><br><span class="line"><span class="keyword">BEGIN</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 执行 DML 操作</span></span><br><span class="line"><span class="keyword">UPDATE</span> accounts <span class="keyword">SET</span> balance <span class="operator">=</span> balance <span class="operator">-</span> <span class="number">100</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">UPDATE</span> accounts <span class="keyword">SET</span> balance <span class="operator">=</span> balance <span class="operator">+</span> <span class="number">100</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看临时结果（当前会话可见）</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> accounts;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 提交事务（使更改永久生效）</span></span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 再次查看（其他会话也可见）</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> accounts;</span><br></pre></td></tr></table></figure>

<h3 id="2-4-事务回滚"><a href="#2-4-事务回滚" class="headerlink" title="2.4 事务回滚"></a>2.4 事务回滚</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 开启事务</span></span><br><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 执行操作</span></span><br><span class="line"><span class="keyword">UPDATE</span> accounts <span class="keyword">SET</span> balance <span class="operator">=</span> balance <span class="operator">-</span> <span class="number">1000</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">UPDATE</span> accounts <span class="keyword">SET</span> balance <span class="operator">=</span> balance <span class="operator">+</span> <span class="number">1000</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 发现问题，回滚事务</span></span><br><span class="line"><span class="keyword">ROLLBACK</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 数据恢复原状</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> accounts;</span><br></pre></td></tr></table></figure>

<h3 id="2-5-保存点（SAVEPOINT）"><a href="#2-5-保存点（SAVEPOINT）" class="headerlink" title="2.5 保存点（SAVEPOINT）"></a>2.5 保存点（SAVEPOINT）</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 开启事务</span></span><br><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 操作 1</span></span><br><span class="line"><span class="keyword">UPDATE</span> accounts <span class="keyword">SET</span> balance <span class="operator">=</span> balance <span class="operator">-</span> <span class="number">100</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 设置保存点</span></span><br><span class="line"><span class="keyword">SAVEPOINT</span> sp1;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 操作 2</span></span><br><span class="line"><span class="keyword">UPDATE</span> accounts <span class="keyword">SET</span> balance <span class="operator">=</span> balance <span class="operator">-</span> <span class="number">200</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 设置保存点</span></span><br><span class="line"><span class="keyword">SAVEPOINT</span> sp2;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 操作 3（假设出错了）</span></span><br><span class="line"><span class="keyword">UPDATE</span> accounts <span class="keyword">SET</span> balance <span class="operator">=</span> balance <span class="operator">-</span> <span class="number">300</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 回滚到保存点 sp2（撤销操作 3）</span></span><br><span class="line"><span class="keyword">ROLLBACK</span> <span class="keyword">TO</span> sp2;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 回滚到保存点 sp1（撤销操作 2 和 3）</span></span><br><span class="line"><span class="keyword">ROLLBACK</span> <span class="keyword">TO</span> sp1;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 提交事务（只有操作 1 生效）</span></span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 释放保存点</span></span><br><span class="line"><span class="keyword">RELEASE</span> <span class="keyword">SAVEPOINT</span> sp1;</span><br></pre></td></tr></table></figure>

<h3 id="2-6-自动提交控制"><a href="#2-6-自动提交控制" class="headerlink" title="2.6 自动提交控制"></a>2.6 自动提交控制</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查看自动提交状态</span></span><br><span class="line"><span class="keyword">SELECT</span> @<span class="variable">@autocommit</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 关闭自动提交（之后所有操作都在事务中）</span></span><br><span class="line"><span class="keyword">SET</span> autocommit <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 执行操作（不会自动提交）</span></span><br><span class="line"><span class="keyword">UPDATE</span> accounts <span class="keyword">SET</span> balance <span class="operator">=</span> balance <span class="operator">-</span> <span class="number">100</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 手动提交</span></span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 开启自动提交</span></span><br><span class="line"><span class="keyword">SET</span> autocommit <span class="operator">=</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<h2 id="三、事务的-ACID-特性"><a href="#三、事务的-ACID-特性" class="headerlink" title="三、事务的 ACID 特性"></a>三、事务的 ACID 特性</h2><h3 id="3-1-原子性（Atomicity）"><a href="#3-1-原子性（Atomicity）" class="headerlink" title="3.1 原子性（Atomicity）"></a>3.1 原子性（Atomicity）</h3><p><strong>原子性</strong> 指事务是一个不可分割的最小工作单位，事务中的操作要么全部成功，要么全部失败。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 原子性演示</span></span><br><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"></span><br><span class="line"><span class="keyword">UPDATE</span> accounts <span class="keyword">SET</span> balance <span class="operator">=</span> balance <span class="operator">-</span> <span class="number">100</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="comment">-- 假设这里发生错误（如除零、违反约束等）</span></span><br><span class="line"><span class="keyword">UPDATE</span> accounts <span class="keyword">SET</span> balance <span class="operator">=</span> balance <span class="operator">/</span> <span class="number">0</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">2</span>;  <span class="comment">-- 错误！</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 由于发生错误，整个事务会自动回滚</span></span><br><span class="line"><span class="comment">-- 操作 1 也会被撤销</span></span><br><span class="line"><span class="keyword">ROLLBACK</span>;  <span class="comment">-- 或者让 MySQL 自动回滚</span></span><br></pre></td></tr></table></figure>

<p><strong>原子性的实现</strong>：通过 undo log（回滚日志）实现。</p>
<h3 id="3-2-一致性（Consistency）"><a href="#3-2-一致性（Consistency）" class="headerlink" title="3.2 一致性（Consistency）"></a>3.2 一致性（Consistency）</h3><p><strong>一致性</strong> 指事务执行前后，数据必须保持一致状态，满足所有约束、触发器等规则。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 一致性演示</span></span><br><span class="line"><span class="comment">-- 假设有检查约束：balance &gt;= 0</span></span><br><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"></span><br><span class="line"><span class="keyword">UPDATE</span> accounts <span class="keyword">SET</span> balance <span class="operator">=</span> balance <span class="operator">-</span> <span class="number">20000</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="comment">-- 如果余额不足，违反约束，事务会回滚</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 一致性确保：</span></span><br><span class="line"><span class="comment">-- 1. 所有约束都被满足</span></span><br><span class="line"><span class="comment">-- 2. 所有触发器都被触发</span></span><br><span class="line"><span class="comment">-- 3. 外键约束被维护</span></span><br><span class="line"><span class="comment">-- 4. 数据逻辑一致</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br></pre></td></tr></table></figure>

<p><strong>一致性的实现</strong>：原子性和持久性保证数据不丢失，隔离性保证并发一致。</p>
<h3 id="3-3-隔离性（Isolation）"><a href="#3-3-隔离性（Isolation）" class="headerlink" title="3.3 隔离性（Isolation）"></a>3.3 隔离性（Isolation）</h3><p><strong>隔离性</strong> 指多个事务并发执行时，一个事务的执行不应影响其他事务。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 会话 A</span></span><br><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"><span class="keyword">SELECT</span> balance <span class="keyword">FROM</span> accounts <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;  <span class="comment">-- 10000</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 会话 B（同时）</span></span><br><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"><span class="keyword">UPDATE</span> accounts <span class="keyword">SET</span> balance <span class="operator">=</span> balance <span class="operator">-</span> <span class="number">100</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 会话 A（再次查询）</span></span><br><span class="line"><span class="keyword">SELECT</span> balance <span class="keyword">FROM</span> accounts <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="comment">-- 不同隔离级别下结果可能不同</span></span><br></pre></td></tr></table></figure>

<p><strong>隔离性的实现</strong>：通过锁机制和 MVCC（多版本并发控制）实现。</p>
<h3 id="3-4-持久性（Durability）"><a href="#3-4-持久性（Durability）" class="headerlink" title="3.4 持久性（Durability）"></a>3.4 持久性（Durability）</h3><p><strong>持久性</strong> 指事务一旦提交，对数据的修改是永久的，即使系统故障也不会丢失。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"><span class="keyword">UPDATE</span> accounts <span class="keyword">SET</span> balance <span class="operator">=</span> balance <span class="operator">-</span> <span class="number">100</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">COMMIT</span>;  <span class="comment">-- 提交后，即使立即断电，数据也不会丢失</span></span><br></pre></td></tr></table></figure>

<p><strong>持久性的实现</strong>：通过 redo log（重做日志）实现。</p>
<h2 id="四、并发事务问题"><a href="#四、并发事务问题" class="headerlink" title="四、并发事务问题"></a>四、并发事务问题</h2><h3 id="4-1-并发事务场景"><a href="#4-1-并发事务场景" class="headerlink" title="4.1 并发事务场景"></a>4.1 并发事务场景</h3><p>当多个事务同时访问同一数据时，可能产生以下问题：</p>
<table>
<thead>
<tr>
<th>问题</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>脏读（Dirty Read）</td>
<td>读到其他事务未提交的数据</td>
</tr>
<tr>
<td>不可重复读（Non-repeatable Read）</td>
<td>同一事务中多次读取结果不一致</td>
</tr>
<tr>
<td>幻读（Phantom Read）</td>
<td>同一事务中多次查询，记录数不一致</td>
</tr>
</tbody></table>
<h3 id="4-2-脏读（Dirty-Read）"><a href="#4-2-脏读（Dirty-Read）" class="headerlink" title="4.2 脏读（Dirty Read）"></a>4.2 脏读（Dirty Read）</h3><p><strong>脏读</strong> 是指一个事务读取了另一个事务未提交的修改。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 会话 A</span></span><br><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"><span class="keyword">UPDATE</span> accounts <span class="keyword">SET</span> balance <span class="operator">=</span> balance <span class="operator">-</span> <span class="number">100</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="comment">-- 尚未提交</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 会话 B</span></span><br><span class="line"><span class="keyword">SELECT</span> balance <span class="keyword">FROM</span> accounts <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="comment">-- 读到了 A 未提交的修改（脏读）</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 会话 A 回滚</span></span><br><span class="line"><span class="keyword">ROLLBACK</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 结果：会话 B 读到的数据是无效的</span></span><br></pre></td></tr></table></figure>

<h3 id="4-3-不可重复读（Non-repeatable-Read）"><a href="#4-3-不可重复读（Non-repeatable-Read）" class="headerlink" title="4.3 不可重复读（Non-repeatable Read）"></a>4.3 不可重复读（Non-repeatable Read）</h3><p><strong>不可重复读</strong> 是指在同一事务中，多次读取同一数据得到不同结果。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 会话 A</span></span><br><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"><span class="keyword">SELECT</span> balance <span class="keyword">FROM</span> accounts <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;  <span class="comment">-- 10000</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 会话 B</span></span><br><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"><span class="keyword">UPDATE</span> accounts <span class="keyword">SET</span> balance <span class="operator">=</span> <span class="number">9900</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 会话 A</span></span><br><span class="line"><span class="keyword">SELECT</span> balance <span class="keyword">FROM</span> accounts <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;  <span class="comment">-- 9900（与第一次不同）</span></span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 结果：同一事务中两次读取结果不同</span></span><br></pre></td></tr></table></figure>

<p><strong>与脏读的区别</strong>：不可重复读读到的是已提交的数据，但不是预期的结果。</p>
<h3 id="4-4-幻读（Phantom-Read）"><a href="#4-4-幻读（Phantom-Read）" class="headerlink" title="4.4 幻读（Phantom Read）"></a>4.4 幻读（Phantom Read）</h3><p><strong>幻读</strong> 是指在同一事务中，多次查询同一范围的数据，记录数不一致。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 会话 A</span></span><br><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> accounts <span class="keyword">WHERE</span> balance <span class="operator">&gt;</span> <span class="number">5000</span>;  <span class="comment">-- 返回 2 条</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 会话 B</span></span><br><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"><span class="keyword">INSERT INTO</span> accounts (account_name, balance) <span class="keyword">VALUES</span> (<span class="string">&#x27;王五&#x27;</span>, <span class="number">6000</span>);</span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 会话 A</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> accounts <span class="keyword">WHERE</span> balance <span class="operator">&gt;</span> <span class="number">5000</span>;  <span class="comment">-- 返回 3 条（多出 1 条）</span></span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 结果：同一事务中两次查询记录数不同</span></span><br></pre></td></tr></table></figure>

<h3 id="4-5-三种问题对比"><a href="#4-5-三种问题对比" class="headerlink" title="4.5 三种问题对比"></a>4.5 三种问题对比</h3><table>
<thead>
<tr>
<th>问题</th>
<th>原因</th>
<th>表现</th>
</tr>
</thead>
<tbody><tr>
<td>脏读</td>
<td>读到未提交数据</td>
<td>数据无效</td>
</tr>
<tr>
<td>不可重复读</td>
<td>读到已提交更新</td>
<td>值变化</td>
</tr>
<tr>
<td>幻读</td>
<td>读到已提交插入</td>
<td>记录数变化</td>
</tr>
</tbody></table>
<h2 id="五、并发事务演示及隔离级别"><a href="#五、并发事务演示及隔离级别" class="headerlink" title="五、并发事务演示及隔离级别"></a>五、并发事务演示及隔离级别</h2><h3 id="5-1-事务隔离级别"><a href="#5-1-事务隔离级别" class="headerlink" title="5.1 事务隔离级别"></a>5.1 事务隔离级别</h3><p>SQL 标准定义了四种隔离级别，从低到高：</p>
<table>
<thead>
<tr>
<th>隔离级别</th>
<th>脏读</th>
<th>不可重复读</th>
<th>幻读</th>
</tr>
</thead>
<tbody><tr>
<td>READ UNCOMMITTED（读未提交）</td>
<td>可能</td>
<td>可能</td>
<td>可能</td>
</tr>
<tr>
<td>READ COMMITTED（读已提交）</td>
<td>否</td>
<td>可能</td>
<td>可能</td>
</tr>
<tr>
<td>REPEATABLE READ（可重复读）</td>
<td>否</td>
<td>否</td>
<td>可能*</td>
</tr>
<tr>
<td>SERIALIZABLE（串行化）</td>
<td>否</td>
<td>否</td>
<td>否</td>
</tr>
</tbody></table>
<p>*MySQL InnoDB 通过 MVCC 在 REPEATABLE READ 级别避免了幻读</p>
<h3 id="5-2-查看和设置隔离级别"><a href="#5-2-查看和设置隔离级别" class="headerlink" title="5.2 查看和设置隔离级别"></a>5.2 查看和设置隔离级别</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查看当前会话隔离级别</span></span><br><span class="line"><span class="keyword">SELECT</span> @<span class="variable">@transaction_isolation</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看全局隔离级别</span></span><br><span class="line"><span class="keyword">SELECT</span> @<span class="variable">@global</span>.transaction_isolation;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 设置会话隔离级别（只影响当前会话）</span></span><br><span class="line"><span class="keyword">SET</span> SESSION TRANSACTION ISOLATION LEVEL READ UNCOMMITTED;</span><br><span class="line"><span class="keyword">SET</span> SESSION TRANSACTION ISOLATION LEVEL READ COMMITTED;</span><br><span class="line"><span class="keyword">SET</span> SESSION TRANSACTION ISOLATION LEVEL REPEATABLE READ;  <span class="comment">-- MySQL 默认</span></span><br><span class="line"><span class="keyword">SET</span> SESSION TRANSACTION ISOLATION LEVEL SERIALIZABLE;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 设置全局隔离级别（影响新会话）</span></span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span> TRANSACTION ISOLATION LEVEL READ COMMITTED;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 在事务开始前设置</span></span><br><span class="line"><span class="keyword">SET</span> TRANSACTION ISOLATION LEVEL SERIALIZABLE;</span><br><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br></pre></td></tr></table></figure>

<h3 id="5-3-READ-UNCOMMITTED-演示"><a href="#5-3-READ-UNCOMMITTED-演示" class="headerlink" title="5.3 READ UNCOMMITTED 演示"></a>5.3 READ UNCOMMITTED 演示</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 设置隔离级别为读未提交</span></span><br><span class="line"><span class="keyword">SET</span> SESSION TRANSACTION ISOLATION LEVEL READ UNCOMMITTED;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 会话 A</span></span><br><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"><span class="keyword">UPDATE</span> accounts <span class="keyword">SET</span> balance <span class="operator">=</span> balance <span class="operator">-</span> <span class="number">100</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="comment">-- 不提交</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 会话 B</span></span><br><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"><span class="keyword">SELECT</span> balance <span class="keyword">FROM</span> accounts <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;  <span class="comment">-- 读到未提交的值（脏读）</span></span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 会话 A 回滚</span></span><br><span class="line"><span class="keyword">ROLLBACK</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 结果：会话 B 读到的数据是无效的</span></span><br></pre></td></tr></table></figure>

<h3 id="5-4-READ-COMMITTED-演示"><a href="#5-4-READ-COMMITTED-演示" class="headerlink" title="5.4 READ COMMITTED 演示"></a>5.4 READ COMMITTED 演示</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 设置隔离级别为读已提交</span></span><br><span class="line"><span class="keyword">SET</span> SESSION TRANSACTION ISOLATION LEVEL READ COMMITTED;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 会话 A</span></span><br><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"><span class="keyword">SELECT</span> balance <span class="keyword">FROM</span> accounts <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;  <span class="comment">-- 10000</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 会话 B</span></span><br><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"><span class="keyword">UPDATE</span> accounts <span class="keyword">SET</span> balance <span class="operator">=</span> <span class="number">9900</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">COMMIT</span>;  <span class="comment">-- 提交</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 会话 A</span></span><br><span class="line"><span class="keyword">SELECT</span> balance <span class="keyword">FROM</span> accounts <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;  <span class="comment">-- 9900（不可重复读）</span></span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 结果：避免脏读，但出现不可重复读</span></span><br></pre></td></tr></table></figure>

<h3 id="5-5-REPEATABLE-READ-演示（MySQL-默认）"><a href="#5-5-REPEATABLE-READ-演示（MySQL-默认）" class="headerlink" title="5.5 REPEATABLE READ 演示（MySQL 默认）"></a>5.5 REPEATABLE READ 演示（MySQL 默认）</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 设置隔离级别为可重复读</span></span><br><span class="line"><span class="keyword">SET</span> SESSION TRANSACTION ISOLATION LEVEL REPEATABLE READ;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 会话 A</span></span><br><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"><span class="keyword">SELECT</span> balance <span class="keyword">FROM</span> accounts <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;  <span class="comment">-- 10000</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 会话 B</span></span><br><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"><span class="keyword">UPDATE</span> accounts <span class="keyword">SET</span> balance <span class="operator">=</span> <span class="number">9900</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 会话 A</span></span><br><span class="line"><span class="keyword">SELECT</span> balance <span class="keyword">FROM</span> accounts <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;  <span class="comment">-- 10000（仍然是原值）</span></span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 结果：避免脏读和不可重复读</span></span><br></pre></td></tr></table></figure>

<p><strong>InnoDB 的 MVCC</strong>：</p>
<ul>
<li>InnoDB 在 REPEATABLE READ 级别下使用 MVCC 避免幻读</li>
<li>通过读取历史版本实现可重复读</li>
</ul>
<h3 id="5-6-SERIALIZABLE-演示"><a href="#5-6-SERIALIZABLE-演示" class="headerlink" title="5.6 SERIALIZABLE 演示"></a>5.6 SERIALIZABLE 演示</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 设置隔离级别为串行化</span></span><br><span class="line"><span class="keyword">SET</span> SESSION TRANSACTION ISOLATION LEVEL SERIALIZABLE;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 会话 A</span></span><br><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> accounts <span class="keyword">WHERE</span> balance <span class="operator">&gt;</span> <span class="number">5000</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 会话 B（会被阻塞，直到 A 提交）</span></span><br><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"><span class="keyword">INSERT INTO</span> accounts (account_name, balance) <span class="keyword">VALUES</span> (<span class="string">&#x27;王五&#x27;</span>, <span class="number">6000</span>);</span><br><span class="line"><span class="comment">-- 等待...</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 会话 A</span></span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 会话 B 现在可以执行</span></span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 结果：完全串行执行，性能最差</span></span><br></pre></td></tr></table></figure>

<h3 id="5-7-隔离级别选择建议"><a href="#5-7-隔离级别选择建议" class="headerlink" title="5.7 隔离级别选择建议"></a>5.7 隔离级别选择建议</h3><table>
<thead>
<tr>
<th>隔离级别</th>
<th>适用场景</th>
<th>性能</th>
</tr>
</thead>
<tbody><tr>
<td>READ UNCOMMITTED</td>
<td>几乎不用，统计数据等对一致性要求低的场景</td>
<td>最高</td>
</tr>
<tr>
<td>READ COMMITTED</td>
<td>Oracle 默认，大多数场景足够</td>
<td>较高</td>
</tr>
<tr>
<td>REPEATABLE READ</td>
<td>MySQL 默认，适合需要可重复读的场景</td>
<td>中等</td>
</tr>
<tr>
<td>SERIALIZABLE</td>
<td>对一致性要求极高，并发低的场景</td>
<td>最低</td>
</tr>
</tbody></table>
<p><strong>推荐</strong>：</p>
<ul>
<li>一般应用：使用默认的 REPEATABLE READ</li>
<li>高并发场景：可以考虑 READ COMMITTED</li>
<li>特殊场景：根据需求调整</li>
</ul>
<h2 id="六、锁机制"><a href="#六、锁机制" class="headerlink" title="六、锁机制"></a>六、锁机制</h2><h3 id="6-1-锁的类型"><a href="#6-1-锁的类型" class="headerlink" title="6.1 锁的类型"></a>6.1 锁的类型</h3><table>
<thead>
<tr>
<th>锁类型</th>
<th>说明</th>
<th>特点</th>
</tr>
</thead>
<tbody><tr>
<td>共享锁（S 锁）</td>
<td>读锁</td>
<td>多个事务可同时持有</td>
</tr>
<tr>
<td>排他锁（X 锁）</td>
<td>写锁</td>
<td>只能有一个事务持有</td>
</tr>
<tr>
<td>意向锁</td>
<td>表级锁</td>
<td>表明事务要在某行上加锁</td>
</tr>
</tbody></table>
<h3 id="6-2-显式加锁"><a href="#6-2-显式加锁" class="headerlink" title="6.2 显式加锁"></a>6.2 显式加锁</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 共享锁（读锁）</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> accounts <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span> LOCK <span class="keyword">IN</span> SHARE MODE;</span><br><span class="line"><span class="comment">-- MySQL 8.0+ 语法</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> accounts <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span> <span class="keyword">FOR</span> SHARE;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 排他锁（写锁）</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> accounts <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span> <span class="keyword">FOR</span> <span class="keyword">UPDATE</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 跳过已锁定的行</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> accounts <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span> <span class="keyword">FOR</span> <span class="keyword">UPDATE</span> <span class="keyword">SKIP</span> LOCKED;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 不等待锁（立即返回错误）</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> accounts <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span> <span class="keyword">FOR</span> <span class="keyword">UPDATE</span> NOWAIT;</span><br></pre></td></tr></table></figure>

<h3 id="6-3-查看锁信息"><a href="#6-3-查看锁信息" class="headerlink" title="6.3 查看锁信息"></a>6.3 查看锁信息</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查看正在执行的事务</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> information_schema.innodb_trx;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看锁信息</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> information_schema.innodb_locks;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看锁等待情况</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> information_schema.innodb_lock_waits;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看进程列表</span></span><br><span class="line"><span class="keyword">SHOW</span> PROCESSLIST;</span><br></pre></td></tr></table></figure>

<h2 id="七、事务最佳实践"><a href="#七、事务最佳实践" class="headerlink" title="七、事务最佳实践"></a>七、事务最佳实践</h2><h3 id="7-1-事务使用建议"><a href="#7-1-事务使用建议" class="headerlink" title="7.1 事务使用建议"></a>7.1 事务使用建议</h3><ol>
<li><strong>保持事务简短</strong></li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 不好：事务太长，占用资源</span></span><br><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"><span class="keyword">SELECT</span> ...;</span><br><span class="line"><span class="keyword">UPDATE</span> ...;</span><br><span class="line"><span class="keyword">SELECT</span> ...;</span><br><span class="line"><span class="keyword">UPDATE</span> ...;</span><br><span class="line"><span class="comment">-- 很多操作...</span></span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 好：只包含必要的操作</span></span><br><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"><span class="keyword">UPDATE</span> ...;</span><br><span class="line"><span class="keyword">UPDATE</span> ...;</span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><strong>避免在事务中等待用户输入</strong></li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 不好</span></span><br><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"><span class="keyword">UPDATE</span> accounts <span class="keyword">SET</span> balance <span class="operator">=</span> balance <span class="operator">-</span> <span class="number">100</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="comment">-- 等待用户确认...（事务长时间不提交）</span></span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 好：快速提交，异步处理</span></span><br><span class="line"><span class="keyword">UPDATE</span> accounts <span class="keyword">SET</span> balance <span class="operator">=</span> balance <span class="operator">-</span> <span class="number">100</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="comment">-- 异步发送确认邮件等</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li><strong>处理死锁</strong></li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 应用层捕获死锁异常并重试</span></span><br><span class="line">try &#123;</span><br><span class="line">    <span class="operator">/</span><span class="operator">/</span> 执行事务</span><br><span class="line">&#125; catch (DeadlockException e) &#123;</span><br><span class="line">    <span class="operator">/</span><span class="operator">/</span> 重试逻辑</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="7-2-转账事务完整示例"><a href="#7-2-转账事务完整示例" class="headerlink" title="7.2 转账事务完整示例"></a>7.2 转账事务完整示例</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> transfer_money(</span><br><span class="line">    <span class="keyword">IN</span> from_id <span class="type">INT</span>,</span><br><span class="line">    <span class="keyword">IN</span> to_id <span class="type">INT</span>,</span><br><span class="line">    <span class="keyword">IN</span> amount <span class="type">DECIMAL</span>(<span class="number">12</span>, <span class="number">2</span>)</span><br><span class="line">)</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">DECLARE</span> from_balance <span class="type">DECIMAL</span>(<span class="number">12</span>, <span class="number">2</span>);</span><br><span class="line">    <span class="keyword">DECLARE</span> EXIT HANDLER <span class="keyword">FOR</span> <span class="keyword">SQLEXCEPTION</span></span><br><span class="line">    <span class="keyword">BEGIN</span></span><br><span class="line">        <span class="keyword">ROLLBACK</span>;</span><br><span class="line">        <span class="keyword">SELECT</span> <span class="string">&#x27;Transfer failed&#x27;</span> <span class="keyword">AS</span> <span class="keyword">result</span>;</span><br><span class="line">    <span class="keyword">END</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">START</span> TRANSACTION;</span><br><span class="line"></span><br><span class="line">    <span class="comment">-- 锁定账户（防止并发修改）</span></span><br><span class="line">    <span class="keyword">SELECT</span> balance <span class="keyword">INTO</span> from_balance</span><br><span class="line">    <span class="keyword">FROM</span> accounts <span class="keyword">WHERE</span> id <span class="operator">=</span> from_id</span><br><span class="line">    <span class="keyword">FOR</span> <span class="keyword">UPDATE</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">-- 检查余额</span></span><br><span class="line">    IF from_balance <span class="operator">&lt;</span> amount <span class="keyword">THEN</span></span><br><span class="line">        <span class="keyword">ROLLBACK</span>;</span><br><span class="line">        <span class="keyword">SELECT</span> <span class="string">&#x27;Insufficient balance&#x27;</span> <span class="keyword">AS</span> <span class="keyword">result</span>;</span><br><span class="line">    <span class="keyword">ELSE</span></span><br><span class="line">        <span class="comment">-- 扣款</span></span><br><span class="line">        <span class="keyword">UPDATE</span> accounts <span class="keyword">SET</span> balance <span class="operator">=</span> balance <span class="operator">-</span> amount</span><br><span class="line">        <span class="keyword">WHERE</span> id <span class="operator">=</span> from_id;</span><br><span class="line"></span><br><span class="line">        <span class="comment">-- 收款</span></span><br><span class="line">        <span class="keyword">UPDATE</span> accounts <span class="keyword">SET</span> balance <span class="operator">=</span> balance <span class="operator">+</span> amount</span><br><span class="line">        <span class="keyword">WHERE</span> id <span class="operator">=</span> to_id;</span><br><span class="line"></span><br><span class="line">        <span class="comment">-- 记录日志</span></span><br><span class="line">        <span class="keyword">INSERT INTO</span> transfer_logs (from_id, to_id, amount, create_time)</span><br><span class="line">        <span class="keyword">VALUES</span> (from_id, to_id, amount, NOW());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">COMMIT</span>;</span><br><span class="line">        <span class="keyword">SELECT</span> <span class="string">&#x27;Transfer success&#x27;</span> <span class="keyword">AS</span> <span class="keyword">result</span>;</span><br><span class="line">    <span class="keyword">END</span> IF;</span><br><span class="line"><span class="keyword">END</span> <span class="operator">/</span><span class="operator">/</span></span><br><span class="line">DELIMITER ;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 调用</span></span><br><span class="line"><span class="keyword">CALL</span> transfer_money(<span class="number">1</span>, <span class="number">2</span>, <span class="number">100</span>);</span><br></pre></td></tr></table></figure>

<h2 id="八、小结"><a href="#八、小结" class="headerlink" title="八、小结"></a>八、小结</h2><h3 id="事务知识点回顾"><a href="#事务知识点回顾" class="headerlink" title="事务知识点回顾"></a>事务知识点回顾</h3><ol>
<li><p><strong>事务控制语句</strong></p>
<ul>
<li>START TRANSACTION &#x2F; BEGIN：开启事务</li>
<li>COMMIT：提交事务</li>
<li>ROLLBACK：回滚事务</li>
<li>SAVEPOINT：设置保存点</li>
</ul>
</li>
<li><p><strong>ACID 特性</strong></p>
<ul>
<li>原子性：不可分割</li>
<li>一致性：数据一致</li>
<li>隔离性：互不干扰</li>
<li>持久性：永久保存</li>
</ul>
</li>
<li><p><strong>并发问题</strong></p>
<ul>
<li>脏读：读未提交数据</li>
<li>不可重复读：值变化</li>
<li>幻读：记录数变化</li>
</ul>
</li>
<li><p><strong>隔离级别</strong></p>
<ul>
<li>READ UNCOMMITTED</li>
<li>READ COMMITTED</li>
<li>REPEATABLE READ（MySQL 默认）</li>
<li>SERIALIZABLE</li>
</ul>
</li>
</ol>
<h3 id="隔离级别对比表"><a href="#隔离级别对比表" class="headerlink" title="隔离级别对比表"></a>隔离级别对比表</h3><table>
<thead>
<tr>
<th>隔离级别</th>
<th>脏读</th>
<th>不可重复读</th>
<th>幻读</th>
<th>性能</th>
</tr>
</thead>
<tbody><tr>
<td>READ UNCOMMITTED</td>
<td>✓</td>
<td>✓</td>
<td>✓</td>
<td>最高</td>
</tr>
<tr>
<td>READ COMMITTED</td>
<td>✗</td>
<td>✓</td>
<td>✓</td>
<td>较高</td>
</tr>
<tr>
<td>REPEATABLE READ</td>
<td>✗</td>
<td>✗</td>
<td>✗*</td>
<td>中等</td>
</tr>
<tr>
<td>SERIALIZABLE</td>
<td>✗</td>
<td>✗</td>
<td>✗</td>
<td>最低</td>
</tr>
</tbody></table>
<p>*MySQL InnoDB 通过 MVCC 避免幻读</p>
<h3 id="实际应用建议"><a href="#实际应用建议" class="headerlink" title="实际应用建议"></a>实际应用建议</h3><ol>
<li>使用默认的 REPEATABLE READ 隔离级别</li>
<li>保持事务简短，避免长时间持有锁</li>
<li>处理可能的死锁情况</li>
<li>对于高并发场景，可以考虑 READ COMMITTED</li>
<li>使用合适的索引减少锁竞争</li>
</ol>
<hr>
<p><strong>下一篇</strong>：[MySQL 进阶教程（五）：基础篇总结](&#x2F;2026&#x2F;02&#x2F;23&#x2F;MySQL 进阶教程（五）基础篇总结&#x2F;)</p>
<p><strong>上一篇</strong>：[MySQL 进阶教程（三）：多表查询详解](&#x2F;2026&#x2F;02&#x2F;23&#x2F;MySQL 进阶教程（三）多表查询详解&#x2F;)</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://brian-lin-c.github.io">过拟合的炸鱼薯条</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://brian-lin-c.github.io/2026/02/23/MySQL%20%E8%BF%9B%E9%98%B6%E6%95%99%E7%A8%8B%EF%BC%88%E5%9B%9B%EF%BC%89%E4%BA%8B%E5%8A%A1%E8%AF%A6%E8%A7%A3/">https://brian-lin-c.github.io/2026/02/23/MySQL%20%E8%BF%9B%E9%98%B6%E6%95%99%E7%A8%8B%EF%BC%88%E5%9B%9B%EF%BC%89%E4%BA%8B%E5%8A%A1%E8%AF%A6%E8%A7%A3/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://brian-lin-c.github.io" target="_blank">过拟合的炸鱼薯条</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/MySQL/">MySQL</a><a class="post-meta__tags" href="/tags/%E4%BA%8B%E5%8A%A1/">事务</a><a class="post-meta__tags" href="/tags/ACID/">ACID</a><a class="post-meta__tags" href="/tags/%E5%B9%B6%E5%8F%91%E6%8E%A7%E5%88%B6/">并发控制</a></div><div class="post-share"><div class="social-share" data-image="/img/%E5%A4%B4%E5%83%8F.jpg" data-sites="facebook,x,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2026/02/23/MySQL%20%E8%BF%9B%E9%98%B6%E6%95%99%E7%A8%8B%EF%BC%88%E4%BA%94%EF%BC%89%E5%9F%BA%E7%A1%80%E7%AF%87%E6%80%BB%E7%BB%93/" title="MySQL 进阶教程（五）基础篇总结"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">MySQL 进阶教程（五）基础篇总结</div></div><div class="info-2"><div class="info-item-1">MySQL 进阶教程（五）基础篇总结至此，MySQL 基础篇和进阶教程全部完成！本文将对整个系列进行系统总结，并提供学习路线建议。 一、系列文章回顾基础教程系列   篇目 主题 核心内容    基础（一） 数据库基础与环境搭建 数据库概念、MySQL 安装、数据模型、SQL 分类   基础（二） DDL 数据定义语言 数据库操作、表操作、数据类型、DataGrip   基础（三） DML 数据操作语言 INSERT、UPDATE、DELETE、事务基础   基础（四） DQL 数据查询语言 基础查询、条件查询、聚合函数、分组、排序、分页、连接查询、子查询   基础（五） DCL 数据控制语言 用户管理、权限控制、事务控制   进阶教程系列   篇目 主题 核心内容    进阶（一） 常用函数详解 字符串函数、数值函数、日期函数、流程函数   进阶（二） 数据库约束 主键、外键、唯一、非空、默认、检查约束   进阶（三） 多表查询 表关系、连接查询、联合查询、子查询   进阶（四） 事务 ACID 特性、并发问题、隔离级别、锁机制   二、知识体系思维导图2.1 SQL 语言分类1...</div></div></div></a><a class="pagination-related" href="/2026/02/23/MySQL%20%E8%BF%9B%E9%98%B6%E6%95%99%E7%A8%8B%EF%BC%88%E4%B8%89%EF%BC%89%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A2%E8%AF%A6%E8%A7%A3/" title="MySQL 进阶教程（三）多表查询详解"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">MySQL 进阶教程（三）多表查询详解</div></div><div class="info-2"><div class="info-item-1">MySQL 进阶教程（三）多表查询详解在实际应用中，数据通常分布在多个表中。多表查询是 SQL 中最重要、最实用的技能之一。本文将详细讲解多表关系、连接查询、联合查询和子查询。 一、多表关系介绍1.1 表与表之间的关系数据库中的表不是孤立的，它们之间通过各种关系相互关联。主要有三种关系：    关系类型 说明 示例    一对一（1:1） 一个表的一条记录对应另一个表的一条记录 用户和用户详情   一对多（1:N） 一个表的一条记录对应另一个表的多条记录 部门和员工   多对多（N:M） 一个表的多条记录对应另一个表的多条记录 学生和课程   1.2 一对一关系（1:1）特点：  表 A 的一条记录对应表 B 的一条记录 通常用于拆分大表，提高性能 外键可以放在任意一方  1234567891011121314151617181920-- 用户表CREATE TABLE users (    id INT PRIMARY KEY AUTO_INCREMENT,    username VARCHAR(50) NOT NULL,    password VARCHAR(255) N...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2026/02/23/MySQL%20%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B%EF%BC%88%E5%9B%9B%EF%BC%89DQL%20%E6%95%B0%E6%8D%AE%E6%9F%A5%E8%AF%A2%E8%AF%AD%E8%A8%80%E8%AF%A6%E8%A7%A3%EF%BC%88%E4%B8%8A%EF%BC%89/" title="MySQL 基础教程（四）DQL 数据查询语言详解（上）"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2026-02-23</div><div class="info-item-2">MySQL 基础教程（四）DQL 数据查询语言详解（上）</div></div><div class="info-2"><div class="info-item-1">MySQL 基础教程（四）DQL 数据查询语言详解（上）DQL（Data Query Language，数据查询语言）是 SQL 中使用频率最高的部分。本文将系统讲解 DQL 的各种查询技巧，由于内容较多，分为上下两部分。 上半部分：基础查询、条件查询、聚合函数、分组查询下半部分：排序查询、分页查询、综合案例、执行顺序 一、DQL 概述DQL 主要用于从数据库中查询数据，核心命令是 SELECT。 完整的 SELECT 语法结构： 1234567SELECT [DISTINCT] 列名 1 [AS 别名 1], 列名 2 [AS 别名 2], ...FROM 表名 1 [AS 别名 1][INNER | LEFT | RIGHT | FULL] JOIN 表名 2 ON 连接条件[WHERE 条件][GROUP BY 分组列 [HAVING 分组过滤]][ORDER BY 排序列 [ASC | DESC]][LIMIT 起始位置，返回条数];  二、基础查询2.1 准备测试数据1234567891011121314151617181920212223242526272829303...</div></div></div></a><a class="pagination-related" href="/2026/02/23/MySQL%20%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B%EF%BC%88%E4%B8%80%EF%BC%89%E6%95%B0%E6%8D%AE%E5%BA%93%E5%9F%BA%E7%A1%80%E4%B8%8E%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/" title="MySQL 基础教程（一）数据库基础与环境搭建"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2026-02-23</div><div class="info-item-2">MySQL 基础教程（一）数据库基础与环境搭建</div></div><div class="info-2"><div class="info-item-1">MySQL 基础教程（一）数据库基础与环境搭建欢迎来到 MySQL 基础教程系列的第一篇！在本篇文章中，我们将从零开始了解数据库的基本概念，完成 MySQL 的安装配置，并了解数据模型和 SQL 的分类。 一、数据库相关概念1.1 什么是数据库？数据库（Database） 是按照数据结构来组织、存储和管理数据的仓库。它可以持久化存储数据，并且支持高效的数据访问和管理。 简单来说，数据库就是一个电子化的文件柜，用于存储和管理数据。 1.2 什么是 DBMS？DBMS（Database Management System，数据库管理系统） 是用于创建、管理和维护数据库的软件。 常见的 DBMS 有：  MySQL：开源、轻量、流行，适合中小型项目 Oracle：功能强大、性能优异，适合大型企业 SQL Server：微软出品，与 Windows 生态集成良好 PostgreSQL：开源、功能丰富，支持复杂查询 SQLite：嵌入式数据库，适合移动端和小型应用  1.3 数据库的优势   对比项 文件系统 数据库系统    数据结构 松散，由应用程序定义 结构化，由 DBMS 统一管理...</div></div></div></a><a class="pagination-related" href="/2026/02/23/MySQL%20%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B%EF%BC%88%E4%BA%94%EF%BC%89DCL%20%E6%95%B0%E6%8D%AE%E6%8E%A7%E5%88%B6%E8%AF%AD%E8%A8%80%E8%AF%A6%E8%A7%A3/" title="MySQL 基础教程（五）DCL 数据控制语言详解"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2026-02-23</div><div class="info-item-2">MySQL 基础教程（五）DCL 数据控制语言详解</div></div><div class="info-2"><div class="info-item-1">MySQL 基础教程（五）DCL 数据控制语言详解DCL（Data Control Language，数据控制语言）用于管理数据库权限和事务控制。本文我们将学习如何创建用户、管理权限，以及事务控制的相关知识。 一、DCL 概述DCL 主要包含两类操作：  权限管理：GRANT（授权）、REVOKE（撤销权限） 事务控制：COMMIT（提交）、ROLLBACK（回滚）、SAVEPOINT（保存点）     命令 功能 分类    GRANT 授予用户权限 权限管理   REVOKE 撤销用户权限 权限管理   COMMIT 提交事务 事务控制   ROLLBACK 回滚事务 事务控制   SAVEPOINT 设置保存点 事务控制   二、用户管理2.1 用户表结构MySQL 的用户信息存储在 mysql.user 表中： 12345-- 查看所有用户SELECT user, host FROM mysql.user;-- 查看用户详细信息SELECT user, host, authentication_string, plugin FROM mysql.user;  用户名的组成...</div></div></div></a><a class="pagination-related" href="/2026/02/23/MySQL%20%E8%BF%9B%E9%98%B6%E6%95%99%E7%A8%8B%EF%BC%88%E4%B8%80%EF%BC%89%E5%B8%B8%E7%94%A8%E5%87%BD%E6%95%B0%E8%AF%A6%E8%A7%A3/" title="MySQL 进阶教程（一）常用函数详解"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2026-02-23</div><div class="info-item-2">MySQL 进阶教程（一）常用函数详解</div></div><div class="info-2"><div class="info-item-1">MySQL 进阶教程（一）常用函数详解在基础教程中，我们学习了 SQL 的基本查询和操作。本文将系统讲解 MySQL 提供的常用内置函数，包括字符串函数、数值函数、日期函数和流程函数。 一、函数概述MySQL 函数是对数据进行特定操作的预定义程序，可以简化 SQL 语句，提高开发效率。 函数的分类：  字符串函数：处理字符串数据 数值函数：处理数值数据 日期时间函数：处理日期和时间 流程函数：条件判断和流程控制 聚合函数：对一组数据进行计算（已在 DQL 章节讲解） 加密函数：数据加密和哈希 其他函数：信息函数、加锁函数等  二、字符串函数2.1 字符串连接与长度123456789101112131415-- CONCAT(s1, s2, ...)：连接字符串SELECT CONCAT(&#x27;Hello&#x27;, &#x27; &#x27;, &#x27;World&#x27;) AS result;  -- &#x27;Hello World&#x27;SELECT CONCAT(&#x27;姓名：&#x27;, name) FROM employees;-- CON...</div></div></div></a><a class="pagination-related" href="/2026/02/23/MySQL%20%E8%BF%9B%E9%98%B6%E6%95%99%E7%A8%8B%EF%BC%88%E4%BA%8C%EF%BC%89%E6%95%B0%E6%8D%AE%E5%BA%93%E7%BA%A6%E6%9D%9F%E8%AF%A6%E8%A7%A3/" title="MySQL 进阶教程（二）数据库约束详解"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2026-02-23</div><div class="info-item-2">MySQL 进阶教程（二）数据库约束详解</div></div><div class="info-2"><div class="info-item-1">MySQL 进阶教程（二）数据库约束详解数据库约束用于保证数据的完整性、一致性和有效性。本文将详细讲解 MySQL 中的各种约束类型及其使用方法。 一、约束概述1.1 什么是约束？约束（Constraint） 是施加在数据库表上的规则，用于限制可以存储在表中的数据，确保数据的准确性和可靠性。 1.2 约束的作用 保证数据完整性：防止无效或不一致的数据 维护数据一致性：确保相关表之间的数据关系正确 提高数据质量：强制执行业务规则 减少应用层验证：在数据库层面进行数据验证  1.3 约束的分类   约束类型 关键字 说明 列级&#x2F;表级    主键约束 PRIMARY KEY 唯一标识每条记录 两者   外键约束 FOREIGN KEY 建立表与表之间的关系 表级   唯一约束 UNIQUE 列值必须唯一 两者   非空约束 NOT NULL 列值不能为空 列级   默认约束 DEFAULT 列的默认值 列级   检查约束 CHECK 满足指定条件 表级   1.4 约束的定义时机 列级约束：在定义列时指定，直接跟在列名后面 表级约束：在所有列定义完成后，在表末尾指定  二、约...</div></div></div></a><a class="pagination-related" href="/2026/02/23/MySQL%20%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B%EF%BC%88%E5%9B%9B%EF%BC%89DQL%20%E6%95%B0%E6%8D%AE%E6%9F%A5%E8%AF%A2%E8%AF%AD%E8%A8%80%E8%AF%A6%E8%A7%A3%EF%BC%88%E4%B8%8B%EF%BC%89/" title="MySQL 基础教程（四）DQL 数据查询语言详解（下）"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2026-02-23</div><div class="info-item-2">MySQL 基础教程（四）DQL 数据查询语言详解（下）</div></div><div class="info-2"><div class="info-item-1">MySQL 基础教程（四）DQL 数据查询语言详解（下）承接上文，本文继续讲解 DQL 的排序查询、分页查询、综合案例以及 SQL 执行顺序。 七、排序查询（ORDER BY）ORDER BY 用于对查询结果进行排序。 7.1 基础排序1234567891011-- 升序排序（ASC，默认）SELECT name, salary FROM employeesORDER BY salary ASC;-- 降序排序（DESC）SELECT name, salary FROM employeesORDER BY salary DESC;-- 按字符串排序SELECT name FROM employeesORDER BY name ASC;  -- 按拼音排序  7.2 多列排序123456789-- 先按部门排序，部门相同按工资降序SELECT name, dept_id, salaryFROM employeesORDER BY dept_id ASC, salary DESC;-- 先按在职状态排序，再按工资降序SELECT name, status, salaryFROM em...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/%E5%A4%B4%E5%83%8F.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">过拟合的炸鱼薯条</div><div class="author-info-description">好好学习，天天向上</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">12</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">26</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">3</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/Brian-Lin-C"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/Brian-Lin-C" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">欢迎来到我的个人博客！</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#MySQL-%E8%BF%9B%E9%98%B6%E6%95%99%E7%A8%8B%EF%BC%88%E5%9B%9B%EF%BC%89%E4%BA%8B%E5%8A%A1%E8%AF%A6%E8%A7%A3"><span class="toc-number">1.</span> <span class="toc-text">MySQL 进阶教程（四）事务详解</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E4%BA%8B%E5%8A%A1%E7%AE%80%E4%BB%8B"><span class="toc-number">1.1.</span> <span class="toc-text">一、事务简介</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-%E4%BB%80%E4%B9%88%E6%98%AF%E4%BA%8B%E5%8A%A1%EF%BC%9F"><span class="toc-number">1.1.1.</span> <span class="toc-text">1.1 什么是事务？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-%E4%BA%8B%E5%8A%A1%E7%9A%84%E7%89%B9%E7%82%B9"><span class="toc-number">1.1.2.</span> <span class="toc-text">1.2 事务的特点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-%E4%BA%8B%E5%8A%A1%E7%9A%84%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">1.1.3.</span> <span class="toc-text">1.3 事务的使用场景</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-4-%E4%B8%8D%E4%BD%BF%E7%94%A8%E4%BA%8B%E5%8A%A1%E7%9A%84%E9%97%AE%E9%A2%98"><span class="toc-number">1.1.4.</span> <span class="toc-text">1.4 不使用事务的问题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E4%BA%8B%E5%8A%A1%E6%93%8D%E4%BD%9C%E6%BC%94%E7%A4%BA"><span class="toc-number">1.2.</span> <span class="toc-text">二、事务操作演示</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-%E4%BA%8B%E5%8A%A1%E6%8E%A7%E5%88%B6%E8%AF%AD%E5%8F%A5"><span class="toc-number">1.2.1.</span> <span class="toc-text">2.1 事务控制语句</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-%E5%87%86%E5%A4%87%E6%B5%8B%E8%AF%95%E6%95%B0%E6%8D%AE"><span class="toc-number">1.2.2.</span> <span class="toc-text">2.2 准备测试数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-%E5%9F%BA%E7%A1%80%E4%BA%8B%E5%8A%A1%E6%93%8D%E4%BD%9C"><span class="toc-number">1.2.3.</span> <span class="toc-text">2.3 基础事务操作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-%E4%BA%8B%E5%8A%A1%E5%9B%9E%E6%BB%9A"><span class="toc-number">1.2.4.</span> <span class="toc-text">2.4 事务回滚</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-5-%E4%BF%9D%E5%AD%98%E7%82%B9%EF%BC%88SAVEPOINT%EF%BC%89"><span class="toc-number">1.2.5.</span> <span class="toc-text">2.5 保存点（SAVEPOINT）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-6-%E8%87%AA%E5%8A%A8%E6%8F%90%E4%BA%A4%E6%8E%A7%E5%88%B6"><span class="toc-number">1.2.6.</span> <span class="toc-text">2.6 自动提交控制</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E4%BA%8B%E5%8A%A1%E7%9A%84-ACID-%E7%89%B9%E6%80%A7"><span class="toc-number">1.3.</span> <span class="toc-text">三、事务的 ACID 特性</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-%E5%8E%9F%E5%AD%90%E6%80%A7%EF%BC%88Atomicity%EF%BC%89"><span class="toc-number">1.3.1.</span> <span class="toc-text">3.1 原子性（Atomicity）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-%E4%B8%80%E8%87%B4%E6%80%A7%EF%BC%88Consistency%EF%BC%89"><span class="toc-number">1.3.2.</span> <span class="toc-text">3.2 一致性（Consistency）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-%E9%9A%94%E7%A6%BB%E6%80%A7%EF%BC%88Isolation%EF%BC%89"><span class="toc-number">1.3.3.</span> <span class="toc-text">3.3 隔离性（Isolation）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-%E6%8C%81%E4%B9%85%E6%80%A7%EF%BC%88Durability%EF%BC%89"><span class="toc-number">1.3.4.</span> <span class="toc-text">3.4 持久性（Durability）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E5%B9%B6%E5%8F%91%E4%BA%8B%E5%8A%A1%E9%97%AE%E9%A2%98"><span class="toc-number">1.4.</span> <span class="toc-text">四、并发事务问题</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-%E5%B9%B6%E5%8F%91%E4%BA%8B%E5%8A%A1%E5%9C%BA%E6%99%AF"><span class="toc-number">1.4.1.</span> <span class="toc-text">4.1 并发事务场景</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-%E8%84%8F%E8%AF%BB%EF%BC%88Dirty-Read%EF%BC%89"><span class="toc-number">1.4.2.</span> <span class="toc-text">4.2 脏读（Dirty Read）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-%E4%B8%8D%E5%8F%AF%E9%87%8D%E5%A4%8D%E8%AF%BB%EF%BC%88Non-repeatable-Read%EF%BC%89"><span class="toc-number">1.4.3.</span> <span class="toc-text">4.3 不可重复读（Non-repeatable Read）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-4-%E5%B9%BB%E8%AF%BB%EF%BC%88Phantom-Read%EF%BC%89"><span class="toc-number">1.4.4.</span> <span class="toc-text">4.4 幻读（Phantom Read）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-5-%E4%B8%89%E7%A7%8D%E9%97%AE%E9%A2%98%E5%AF%B9%E6%AF%94"><span class="toc-number">1.4.5.</span> <span class="toc-text">4.5 三种问题对比</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94%E3%80%81%E5%B9%B6%E5%8F%91%E4%BA%8B%E5%8A%A1%E6%BC%94%E7%A4%BA%E5%8F%8A%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB"><span class="toc-number">1.5.</span> <span class="toc-text">五、并发事务演示及隔离级别</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-%E4%BA%8B%E5%8A%A1%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB"><span class="toc-number">1.5.1.</span> <span class="toc-text">5.1 事务隔离级别</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-%E6%9F%A5%E7%9C%8B%E5%92%8C%E8%AE%BE%E7%BD%AE%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB"><span class="toc-number">1.5.2.</span> <span class="toc-text">5.2 查看和设置隔离级别</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-READ-UNCOMMITTED-%E6%BC%94%E7%A4%BA"><span class="toc-number">1.5.3.</span> <span class="toc-text">5.3 READ UNCOMMITTED 演示</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-4-READ-COMMITTED-%E6%BC%94%E7%A4%BA"><span class="toc-number">1.5.4.</span> <span class="toc-text">5.4 READ COMMITTED 演示</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-5-REPEATABLE-READ-%E6%BC%94%E7%A4%BA%EF%BC%88MySQL-%E9%BB%98%E8%AE%A4%EF%BC%89"><span class="toc-number">1.5.5.</span> <span class="toc-text">5.5 REPEATABLE READ 演示（MySQL 默认）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-6-SERIALIZABLE-%E6%BC%94%E7%A4%BA"><span class="toc-number">1.5.6.</span> <span class="toc-text">5.6 SERIALIZABLE 演示</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-7-%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB%E9%80%89%E6%8B%A9%E5%BB%BA%E8%AE%AE"><span class="toc-number">1.5.7.</span> <span class="toc-text">5.7 隔离级别选择建议</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AD%E3%80%81%E9%94%81%E6%9C%BA%E5%88%B6"><span class="toc-number">1.6.</span> <span class="toc-text">六、锁机制</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1-%E9%94%81%E7%9A%84%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.6.1.</span> <span class="toc-text">6.1 锁的类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-%E6%98%BE%E5%BC%8F%E5%8A%A0%E9%94%81"><span class="toc-number">1.6.2.</span> <span class="toc-text">6.2 显式加锁</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-3-%E6%9F%A5%E7%9C%8B%E9%94%81%E4%BF%A1%E6%81%AF"><span class="toc-number">1.6.3.</span> <span class="toc-text">6.3 查看锁信息</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%83%E3%80%81%E4%BA%8B%E5%8A%A1%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5"><span class="toc-number">1.7.</span> <span class="toc-text">七、事务最佳实践</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#7-1-%E4%BA%8B%E5%8A%A1%E4%BD%BF%E7%94%A8%E5%BB%BA%E8%AE%AE"><span class="toc-number">1.7.1.</span> <span class="toc-text">7.1 事务使用建议</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-2-%E8%BD%AC%E8%B4%A6%E4%BA%8B%E5%8A%A1%E5%AE%8C%E6%95%B4%E7%A4%BA%E4%BE%8B"><span class="toc-number">1.7.2.</span> <span class="toc-text">7.2 转账事务完整示例</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AB%E3%80%81%E5%B0%8F%E7%BB%93"><span class="toc-number">1.8.</span> <span class="toc-text">八、小结</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1%E7%9F%A5%E8%AF%86%E7%82%B9%E5%9B%9E%E9%A1%BE"><span class="toc-number">1.8.1.</span> <span class="toc-text">事务知识点回顾</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB%E5%AF%B9%E6%AF%94%E8%A1%A8"><span class="toc-number">1.8.2.</span> <span class="toc-text">隔离级别对比表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8%E5%BB%BA%E8%AE%AE"><span class="toc-number">1.8.3.</span> <span class="toc-text">实际应用建议</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2026/02/23/MySQL%20%E8%BF%9B%E9%98%B6%E6%95%99%E7%A8%8B%EF%BC%88%E4%BA%94%EF%BC%89%E5%9F%BA%E7%A1%80%E7%AF%87%E6%80%BB%E7%BB%93/" title="MySQL 进阶教程（五）基础篇总结">MySQL 进阶教程（五）基础篇总结</a><time datetime="2026-02-23T11:00:00.000Z" title="发表于 2026-02-23 19:00:00">2026-02-23</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2026/02/23/MySQL%20%E8%BF%9B%E9%98%B6%E6%95%99%E7%A8%8B%EF%BC%88%E5%9B%9B%EF%BC%89%E4%BA%8B%E5%8A%A1%E8%AF%A6%E8%A7%A3/" title="MySQL 进阶教程（四）事务详解">MySQL 进阶教程（四）事务详解</a><time datetime="2026-02-23T10:00:00.000Z" title="发表于 2026-02-23 18:00:00">2026-02-23</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2026/02/23/MySQL%20%E8%BF%9B%E9%98%B6%E6%95%99%E7%A8%8B%EF%BC%88%E4%B8%89%EF%BC%89%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A2%E8%AF%A6%E8%A7%A3/" title="MySQL 进阶教程（三）多表查询详解">MySQL 进阶教程（三）多表查询详解</a><time datetime="2026-02-23T09:00:00.000Z" title="发表于 2026-02-23 17:00:00">2026-02-23</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2026/02/23/MySQL%20%E8%BF%9B%E9%98%B6%E6%95%99%E7%A8%8B%EF%BC%88%E4%BA%8C%EF%BC%89%E6%95%B0%E6%8D%AE%E5%BA%93%E7%BA%A6%E6%9D%9F%E8%AF%A6%E8%A7%A3/" title="MySQL 进阶教程（二）数据库约束详解">MySQL 进阶教程（二）数据库约束详解</a><time datetime="2026-02-23T08:00:00.000Z" title="发表于 2026-02-23 16:00:00">2026-02-23</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2026/02/23/MySQL%20%E8%BF%9B%E9%98%B6%E6%95%99%E7%A8%8B%EF%BC%88%E4%B8%80%EF%BC%89%E5%B8%B8%E7%94%A8%E5%87%BD%E6%95%B0%E8%AF%A6%E8%A7%A3/" title="MySQL 进阶教程（一）常用函数详解">MySQL 进阶教程（一）常用函数详解</a><time datetime="2026-02-23T07:00:00.000Z" title="发表于 2026-02-23 15:00:00">2026-02-23</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2025 - 2026 By 过拟合的炸鱼薯条</span><span class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 8.1.1</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.5.4</a></span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=5.5.4"></script><script src="/js/main.js?v=5.5.4"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><i class="fas fa-spinner fa-pulse" id="loading-status" hidden="hidden"></i><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据加载中</span></div><div class="local-search-input"><input placeholder="搜索..." type="text"/></div><hr/><div id="local-search-results"></div><div class="ais-Pagination" id="local-search-pagination" style="display:none;"><ul class="ais-Pagination-list"></ul></div><div id="local-search-stats"></div></div><div id="search-mask"></div><script src="/js/search/local-search.js?v=5.5.4"></script></div></div></body></html>