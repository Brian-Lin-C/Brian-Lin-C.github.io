<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>MySQL 基础教程（一）数据库基础与环境搭建</title>
    <url>/2026/02/23/MySQL%20%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B%EF%BC%88%E4%B8%80%EF%BC%89%E6%95%B0%E6%8D%AE%E5%BA%93%E5%9F%BA%E7%A1%80%E4%B8%8E%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/</url>
    <content><![CDATA[<h1 id="MySQL-基础教程（一）数据库基础与环境搭建"><a href="#MySQL-基础教程（一）数据库基础与环境搭建" class="headerlink" title="MySQL 基础教程（一）数据库基础与环境搭建"></a>MySQL 基础教程（一）数据库基础与环境搭建</h1><p>欢迎来到 MySQL 基础教程系列的第一篇！在本篇文章中，我们将从零开始了解数据库的基本概念，完成 MySQL 的安装配置，并了解数据模型和 SQL 的分类。</p>
<h2 id="一、数据库相关概念"><a href="#一、数据库相关概念" class="headerlink" title="一、数据库相关概念"></a>一、数据库相关概念</h2><h3 id="1-1-什么是数据库？"><a href="#1-1-什么是数据库？" class="headerlink" title="1.1 什么是数据库？"></a>1.1 什么是数据库？</h3><p><strong>数据库（Database）</strong> 是按照数据结构来组织、存储和管理数据的仓库。它可以持久化存储数据，并且支持高效的数据访问和管理。</p>
<p>简单来说，数据库就是一个<strong>电子化的文件柜</strong>，用于存储和管理数据。</p>
<h3 id="1-2-什么是-DBMS？"><a href="#1-2-什么是-DBMS？" class="headerlink" title="1.2 什么是 DBMS？"></a>1.2 什么是 DBMS？</h3><p><strong>DBMS（Database Management System，数据库管理系统）</strong> 是用于创建、管理和维护数据库的软件。</p>
<p>常见的 DBMS 有：</p>
<ul>
<li><strong>MySQL</strong>：开源、轻量、流行，适合中小型项目</li>
<li><strong>Oracle</strong>：功能强大、性能优异，适合大型企业</li>
<li><strong>SQL Server</strong>：微软出品，与 Windows 生态集成良好</li>
<li><strong>PostgreSQL</strong>：开源、功能丰富，支持复杂查询</li>
<li><strong>SQLite</strong>：嵌入式数据库，适合移动端和小型应用</li>
</ul>
<h3 id="1-3-数据库的优势"><a href="#1-3-数据库的优势" class="headerlink" title="1.3 数据库的优势"></a>1.3 数据库的优势</h3><table>
<thead>
<tr>
<th>对比项</th>
<th>文件系统</th>
<th>数据库系统</th>
</tr>
</thead>
<tbody><tr>
<td>数据结构</td>
<td>松散，由应用程序定义</td>
<td>结构化，由 DBMS 统一管理</td>
</tr>
<tr>
<td>数据共享</td>
<td>差，数据孤立</td>
<td>好，多用户共享</td>
</tr>
<tr>
<td>数据冗余</td>
<td>高，容易重复</td>
<td>低，减少冗余</td>
</tr>
<tr>
<td>数据一致性</td>
<td>难保证</td>
<td>容易保证</td>
</tr>
<tr>
<td>数据独立性</td>
<td>差，依赖程序</td>
<td>好，独立于程序</td>
</tr>
<tr>
<td>并发访问</td>
<td>难处理</td>
<td>支持良好</td>
</tr>
</tbody></table>
<h3 id="1-4-什么是-SQL？"><a href="#1-4-什么是-SQL？" class="headerlink" title="1.4 什么是 SQL？"></a>1.4 什么是 SQL？</h3><p><strong>SQL（Structured Query Language，结构化查询语言）</strong> 是用于访问和处理数据库的标准计算机语言。</p>
<p>SQL 的主要功能：</p>
<ul>
<li>查询数据</li>
<li>插入、更新、删除数据</li>
<li>创建、修改、删除数据库对象</li>
<li>设置访问权限</li>
</ul>
<h2 id="二、MySQL-简介"><a href="#二、MySQL-简介" class="headerlink" title="二、MySQL 简介"></a>二、MySQL 简介</h2><h3 id="2-1-MySQL-的特点"><a href="#2-1-MySQL-的特点" class="headerlink" title="2.1 MySQL 的特点"></a>2.1 MySQL 的特点</h3><ul>
<li><strong>开源免费</strong>：社区版完全免费</li>
<li><strong>跨平台</strong>：支持 Windows、Linux、macOS 等</li>
<li><strong>高性能</strong>：查询速度快，支持大量并发</li>
<li><strong>易用性</strong>：安装简单，学习成本低</li>
<li><strong>生态完善</strong>：有丰富的图形化工具和驱动支持</li>
</ul>
<h3 id="2-2-MySQL-版本选择"><a href="#2-2-MySQL-版本选择" class="headerlink" title="2.2 MySQL 版本选择"></a>2.2 MySQL 版本选择</h3><ul>
<li><strong>MySQL Community Server</strong>：社区版，免费，适合学习和个人项目</li>
<li><strong>MySQL Enterprise Server</strong>：企业版，收费，提供高级功能和技术支持</li>
<li><strong>MySQL Cluster</strong>：集群版，适合高可用场景</li>
</ul>
<p><strong>建议初学者使用 MySQL 8.0 社区版</strong>。</p>
<h2 id="三、MySQL-安装与配置（Windows）"><a href="#三、MySQL-安装与配置（Windows）" class="headerlink" title="三、MySQL 安装与配置（Windows）"></a>三、MySQL 安装与配置（Windows）</h2><h3 id="3-1-下载安装包"><a href="#3-1-下载安装包" class="headerlink" title="3.1 下载安装包"></a>3.1 下载安装包</h3><ol>
<li>访问 MySQL 官网：<a href="https://dev.mysql.com/downloads/mysql/">https://dev.mysql.com/downloads/mysql/</a></li>
<li>选择对应操作系统的版本</li>
<li>下载 MySQL Installer（推荐）或 Zip Archive</li>
</ol>
<h3 id="3-2-使用-Installer-安装（推荐）"><a href="#3-2-使用-Installer-安装（推荐）" class="headerlink" title="3.2 使用 Installer 安装（推荐）"></a>3.2 使用 Installer 安装（推荐）</h3><ol>
<li>运行 <code>mysql-installer-community-8.0.x.msi</code></li>
<li>选择安装类型：<ul>
<li><strong>Developer Default</strong>：开发默认（推荐）</li>
<li><strong>Server only</strong>：仅服务器</li>
<li><strong>Client only</strong>：仅客户端</li>
<li><strong>Full</strong>：完全安装</li>
</ul>
</li>
<li>设置 root 密码（<strong>重要！请务必记住</strong>）</li>
<li>配置 MySQL 服务：<ul>
<li>服务名：<code>MySQL80</code></li>
<li>端口：<code>3306</code>（默认）</li>
</ul>
</li>
<li>完成安装</li>
</ol>
<h3 id="3-3-使用-Zip-Archive-手动安装"><a href="#3-3-使用-Zip-Archive-手动安装" class="headerlink" title="3.3 使用 Zip Archive 手动安装"></a>3.3 使用 Zip Archive 手动安装</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 1. 解压到指定目录，如 C:\mysql</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 创建配置文件 my.ini</span></span><br><span class="line">[mysqld]</span><br><span class="line">port=3306</span><br><span class="line">basedir=C:\mysql</span><br><span class="line">datadir=C:\mysql\data</span><br><span class="line">max_connections=200</span><br><span class="line">character-set-server=utf8mb4</span><br><span class="line">default-storage-engine=INNODB</span><br><span class="line"></span><br><span class="line">[mysql]</span><br><span class="line">default-character-set=utf8mb4</span><br><span class="line"></span><br><span class="line">[client]</span><br><span class="line">port=3306</span><br><span class="line">default-character-set=utf8mb4</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 初始化数据库（使用管理员权限运行 CMD）</span></span><br><span class="line"><span class="built_in">cd</span> C:\mysql\bin</span><br><span class="line">mysqld --initialize-insecure --console</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. 安装服务</span></span><br><span class="line">mysqld --install</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5. 启动服务</span></span><br><span class="line">net start mysql</span><br><span class="line"></span><br><span class="line"><span class="comment"># 6. 首次登录（无密码）</span></span><br><span class="line">mysql -u root -p</span><br><span class="line"><span class="comment"># 直接回车即可</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 7. 修改 root 密码</span></span><br><span class="line">ALTER USER <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> IDENTIFIED BY <span class="string">&#x27;你的密码&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h3 id="3-4-验证安装"><a href="#3-4-验证安装" class="headerlink" title="3.4 验证安装"></a>3.4 验证安装</h3><p>打开命令行，执行以下命令验证 MySQL 是否正常运行：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 查看 MySQL 服务状态</span></span><br><span class="line">net start | findstr MySQL</span><br><span class="line"></span><br><span class="line"><span class="comment"># 登录 MySQL</span></span><br><span class="line">mysql -u root -p</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看版本</span></span><br><span class="line">mysql --version</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在 MySQL 中查看数据库</span></span><br><span class="line">SHOW DATABASES;</span><br></pre></td></tr></table></figure>

<h3 id="3-5-常用服务命令"><a href="#3-5-常用服务命令" class="headerlink" title="3.5 常用服务命令"></a>3.5 常用服务命令</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Windows 服务命令</span></span><br><span class="line">net start mysql80      <span class="comment"># 启动服务</span></span><br><span class="line">net stop mysql80       <span class="comment"># 停止服务</span></span><br><span class="line">net restart mysql80    <span class="comment"># 重启服务</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Linux 服务命令</span></span><br><span class="line"><span class="built_in">sudo</span> systemctl start mysql</span><br><span class="line"><span class="built_in">sudo</span> systemctl stop mysql</span><br><span class="line"><span class="built_in">sudo</span> systemctl restart mysql</span><br><span class="line"><span class="built_in">sudo</span> systemctl status mysql</span><br></pre></td></tr></table></figure>

<h2 id="四、数据模型"><a href="#四、数据模型" class="headerlink" title="四、数据模型"></a>四、数据模型</h2><h3 id="4-1-什么是数据模型？"><a href="#4-1-什么是数据模型？" class="headerlink" title="4.1 什么是数据模型？"></a>4.1 什么是数据模型？</h3><p><strong>数据模型</strong> 是对现实世界数据的抽象描述，它定义了数据的结构、操作和约束。</p>
<h3 id="4-2-关系模型"><a href="#4-2-关系模型" class="headerlink" title="4.2 关系模型"></a>4.2 关系模型</h3><p>MySQL 使用的是<strong>关系模型</strong>，主要概念包括：</p>
<table>
<thead>
<tr>
<th>概念</th>
<th>说明</th>
<th>对应表结构</th>
</tr>
</thead>
<tbody><tr>
<td>表（Table）</td>
<td>数据的集合</td>
<td>一张二维表</td>
</tr>
<tr>
<td>行（Row）</td>
<td>一条记录</td>
<td>表中的一行数据</td>
</tr>
<tr>
<td>列（Column）</td>
<td>一个字段</td>
<td>表中的一列</td>
</tr>
<tr>
<td>主键（Primary Key）</td>
<td>唯一标识一条记录</td>
<td>不能重复，不能为空</td>
</tr>
<tr>
<td>外键（Foreign Key）</td>
<td>关联其他表的主键</td>
<td>建立表与表之间的关系</td>
</tr>
</tbody></table>
<h3 id="4-3-ER-图（实体-关系图）"><a href="#4-3-ER-图（实体-关系图）" class="headerlink" title="4.3 ER 图（实体 - 关系图）"></a>4.3 ER 图（实体 - 关系图）</h3><p>ER 图用于描述实体之间的关系，基本元素：</p>
<ul>
<li><strong>矩形</strong>：表示实体（如：学生、课程）</li>
<li><strong>椭圆</strong>：表示属性（如：姓名、学号）</li>
<li><strong>菱形</strong>：表示关系（如：选课）</li>
<li><strong>连线</strong>：连接各元素，标注关系类型</li>
</ul>
<h3 id="4-4-关系的类型"><a href="#4-4-关系的类型" class="headerlink" title="4.4 关系的类型"></a>4.4 关系的类型</h3><ol>
<li><strong>一对一（1:1）</strong>：一个学生对应一个身份证号码</li>
<li><strong>一对多（1:N）</strong>：一个部门有多名员工</li>
<li><strong>多对多（N:M）</strong>：学生可以选多门课，一门课可以被多个学生选</li>
</ol>
<h3 id="4-5-数据库范式"><a href="#4-5-数据库范式" class="headerlink" title="4.5 数据库范式"></a>4.5 数据库范式</h3><p>范式是设计数据库时遵循的规范，目的是减少数据冗余，提高数据一致性。</p>
<p><strong>第一范式（1NF）</strong>：每个列都不可再分</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">错误示例：</span><br><span class="line">| 姓名 | 联系方式          |</span><br><span class="line">|------|-------------------|</span><br><span class="line">| 张三 | 手机：138xxx; 固话：010xxx |</span><br><span class="line"></span><br><span class="line">正确示例：</span><br><span class="line">| 姓名 | 手机号  | 固话    |</span><br><span class="line">|------|--------|---------|</span><br><span class="line">| 张三 | 138xxx | 010xxx  |</span><br></pre></td></tr></table></figure>

<p><strong>第二范式（2NF）</strong>：在 1NF 基础上，非主键字段完全依赖于主键</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">错误示例（主键为学号 + 课程）：</span><br><span class="line">| 学号 | 课程 | 学生姓名 | 成绩 |</span><br><span class="line">|------|------|----------|------|</span><br><span class="line">| 001  | 数学 | 张三     | 90   |</span><br><span class="line"></span><br><span class="line">问题：学生姓名只依赖于学号，与课程无关</span><br><span class="line"></span><br><span class="line">正确示例（拆分为两张表）：</span><br><span class="line">学生表：| 学号 | 学生姓名 |</span><br><span class="line">成绩表：| 学号 | 课程 | 成绩 |</span><br></pre></td></tr></table></figure>

<p><strong>第三范式（3NF）</strong>：在 2NF 基础上，非主键字段之间不能相互依赖</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">错误示例：</span><br><span class="line">| 学号 | 姓名 | 系名 | 系主任 |</span><br><span class="line">|------|------|------|--------|</span><br><span class="line">| 001  | 张三 | 计算机系 | 李四 |</span><br><span class="line"></span><br><span class="line">问题：系主任依赖于系名，而不是学号</span><br><span class="line"></span><br><span class="line">正确示例（拆分）：</span><br><span class="line">学生表：| 学号 | 姓名 | 系名 |</span><br><span class="line">系表：  | 系名 | 系主任 |</span><br></pre></td></tr></table></figure>

<h2 id="五、SQL-语法及分类"><a href="#五、SQL-语法及分类" class="headerlink" title="五、SQL 语法及分类"></a>五、SQL 语法及分类</h2><h3 id="5-1-SQL-通用语法"><a href="#5-1-SQL-通用语法" class="headerlink" title="5.1 SQL 通用语法"></a>5.1 SQL 通用语法</h3><ol>
<li><strong>语句以分号结尾</strong></li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> students;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><strong>不区分大小写</strong>（推荐关键字大写，表名、列名小写）</li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> students;  <span class="comment">-- 合法</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> students;  <span class="comment">-- 推荐</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li><strong>注释</strong></li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 单行注释</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 多行注释 */</span></span><br><span class="line"></span><br><span class="line"># MySQL 特有的单行注释</span><br></pre></td></tr></table></figure>

<ol start="4">
<li><strong>字符串使用单引号或双引号</strong></li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="string">&#x27;Hello&#x27;</span>, &quot;World&quot;;</span><br></pre></td></tr></table></figure>

<h3 id="5-2-SQL-的分类"><a href="#5-2-SQL-的分类" class="headerlink" title="5.2 SQL 的分类"></a>5.2 SQL 的分类</h3><p>SQL 语言分为四大类：</p>
<h4 id="1-DDL（Data-Definition-Language，数据定义语言）"><a href="#1-DDL（Data-Definition-Language，数据定义语言）" class="headerlink" title="1. DDL（Data Definition Language，数据定义语言）"></a>1. DDL（Data Definition Language，数据定义语言）</h4><p>用于定义和管理数据库对象（库、表、索引等）。</p>
<table>
<thead>
<tr>
<th>命令</th>
<th>功能</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td>CREATE</td>
<td>创建对象</td>
<td><code>CREATE DATABASE db_name;</code></td>
</tr>
<tr>
<td>ALTER</td>
<td>修改对象</td>
<td><code>ALTER TABLE tb_name ADD COLUMN ...;</code></td>
</tr>
<tr>
<td>DROP</td>
<td>删除对象</td>
<td><code>DROP TABLE tb_name;</code></td>
</tr>
<tr>
<td>TRUNCATE</td>
<td>清空表</td>
<td><code>TRUNCATE TABLE tb_name;</code></td>
</tr>
<tr>
<td>RENAME</td>
<td>重命名</td>
<td><code>RENAME TABLE old TO new;</code></td>
</tr>
</tbody></table>
<h4 id="2-DML（Data-Manipulation-Language，数据操作语言）"><a href="#2-DML（Data-Manipulation-Language，数据操作语言）" class="headerlink" title="2. DML（Data Manipulation Language，数据操作语言）"></a>2. DML（Data Manipulation Language，数据操作语言）</h4><p>用于对表中数据进行增删改操作。</p>
<table>
<thead>
<tr>
<th>命令</th>
<th>功能</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td>INSERT</td>
<td>插入数据</td>
<td><code>INSERT INTO tb VALUES (...);</code></td>
</tr>
<tr>
<td>UPDATE</td>
<td>更新数据</td>
<td><code>UPDATE tb SET col=val WHERE ...;</code></td>
</tr>
<tr>
<td>DELETE</td>
<td>删除数据</td>
<td><code>DELETE FROM tb WHERE ...;</code></td>
</tr>
</tbody></table>
<h4 id="3-DQL（Data-Query-Language，数据查询语言）"><a href="#3-DQL（Data-Query-Language，数据查询语言）" class="headerlink" title="3. DQL（Data Query Language，数据查询语言）"></a>3. DQL（Data Query Language，数据查询语言）</h4><p>用于查询数据。</p>
<table>
<thead>
<tr>
<th>命令</th>
<th>功能</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td>SELECT</td>
<td>查询数据</td>
<td><code>SELECT * FROM tb;</code></td>
</tr>
</tbody></table>
<p>DQL 是 SQL 中使用频率最高的部分，包含：</p>
<ul>
<li>基础查询</li>
<li>条件查询</li>
<li>聚合函数</li>
<li>分组查询</li>
<li>排序查询</li>
<li>分页查询</li>
<li>多表连接查询</li>
</ul>
<h4 id="4-DCL（Data-Control-Language，数据控制语言）"><a href="#4-DCL（Data-Control-Language，数据控制语言）" class="headerlink" title="4. DCL（Data Control Language，数据控制语言）"></a>4. DCL（Data Control Language，数据控制语言）</h4><p>用于管理数据库权限和事务控制。</p>
<table>
<thead>
<tr>
<th>命令</th>
<th>功能</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td>GRANT</td>
<td>授权</td>
<td><code>GRANT SELECT ON db.* TO user;</code></td>
</tr>
<tr>
<td>REVOKE</td>
<td>撤销权限</td>
<td><code>REVOKE SELECT ON db.* FROM user;</code></td>
</tr>
<tr>
<td>COMMIT</td>
<td>提交事务</td>
<td><code>COMMIT;</code></td>
</tr>
<tr>
<td>ROLLBACK</td>
<td>回滚事务</td>
<td><code>ROLLBACK;</code></td>
</tr>
</tbody></table>
<h3 id="5-3-SQL-执行顺序概览"><a href="#5-3-SQL-执行顺序概览" class="headerlink" title="5.3 SQL 执行顺序概览"></a>5.3 SQL 执行顺序概览</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">FROM → WHERE → GROUP BY → HAVING → SELECT → ORDER BY → LIMIT</span><br></pre></td></tr></table></figure>

<p>这个执行顺序将在 DQL 章节详细讲解。</p>
<h2 id="六、第一个-SQL-示例"><a href="#六、第一个-SQL-示例" class="headerlink" title="六、第一个 SQL 示例"></a>六、第一个 SQL 示例</h2><p>登录 MySQL 后，尝试以下命令：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 查看所有数据库</span></span><br><span class="line"><span class="keyword">SHOW</span> DATABASES;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建数据库</span></span><br><span class="line"><span class="keyword">CREATE</span> DATABASE mydb;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 使用数据库</span></span><br><span class="line">USE mydb;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建表</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> students (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT,</span><br><span class="line">    name <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">    age <span class="type">INT</span>,</span><br><span class="line">    gender <span class="type">VARCHAR</span>(<span class="number">10</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看表结构</span></span><br><span class="line"><span class="keyword">DESC</span> students;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 插入数据</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> students (name, age, gender) <span class="keyword">VALUES</span> (<span class="string">&#x27;张三&#x27;</span>, <span class="number">18</span>, <span class="string">&#x27;男&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT INTO</span> students (name, age, gender) <span class="keyword">VALUES</span> (<span class="string">&#x27;李四&#x27;</span>, <span class="number">19</span>, <span class="string">&#x27;女&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询数据</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> students;</span><br></pre></td></tr></table></figure>

<h2 id="七、小结"><a href="#七、小结" class="headerlink" title="七、小结"></a>七、小结</h2><p>本文我们学习了：</p>
<ol>
<li><strong>数据库基础概念</strong>：数据库、DBMS、SQL 的定义和作用</li>
<li><strong>MySQL 简介</strong>：特点、版本选择</li>
<li><strong>MySQL 安装配置</strong>：Windows 下的安装步骤和服务管理</li>
<li><strong>数据模型</strong>：关系模型、ER 图、三大范式</li>
<li><strong>SQL 语法及分类</strong>：DDL、DML、DQL、DCL 四大类</li>
</ol>
<h2 id="八、练习与思考"><a href="#八、练习与思考" class="headerlink" title="八、练习与思考"></a>八、练习与思考</h2><ol>
<li>在本地成功安装 MySQL，并能够使用命令行登录</li>
<li>记住 root 用户的密码</li>
<li>了解 SQL 四大分类各自的作用和常用命令</li>
<li>思考：为什么数据库设计要遵循范式？</li>
</ol>
<hr>
<p><strong>下一篇</strong>：[MySQL 基础教程（二）：DDL 数据定义语言详解](&#x2F;2026&#x2F;02&#x2F;23&#x2F;MySQL 基础教程（二）DDL 数据定义语言详解&#x2F;)</p>
]]></content>
      <categories>
        <category>MySQL 基础教程</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
        <tag>数据库</tag>
        <tag>入门</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQL 基础教程（五）DCL 数据控制语言详解</title>
    <url>/2026/02/23/MySQL%20%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B%EF%BC%88%E4%BA%94%EF%BC%89DCL%20%E6%95%B0%E6%8D%AE%E6%8E%A7%E5%88%B6%E8%AF%AD%E8%A8%80%E8%AF%A6%E8%A7%A3/</url>
    <content><![CDATA[<h1 id="MySQL-基础教程（五）DCL-数据控制语言详解"><a href="#MySQL-基础教程（五）DCL-数据控制语言详解" class="headerlink" title="MySQL 基础教程（五）DCL 数据控制语言详解"></a>MySQL 基础教程（五）DCL 数据控制语言详解</h1><p>DCL（Data Control Language，数据控制语言）用于管理数据库权限和事务控制。本文我们将学习如何创建用户、管理权限，以及事务控制的相关知识。</p>
<h2 id="一、DCL-概述"><a href="#一、DCL-概述" class="headerlink" title="一、DCL 概述"></a>一、DCL 概述</h2><p>DCL 主要包含两类操作：</p>
<ol>
<li><strong>权限管理</strong>：GRANT（授权）、REVOKE（撤销权限）</li>
<li><strong>事务控制</strong>：COMMIT（提交）、ROLLBACK（回滚）、SAVEPOINT（保存点）</li>
</ol>
<table>
<thead>
<tr>
<th>命令</th>
<th>功能</th>
<th>分类</th>
</tr>
</thead>
<tbody><tr>
<td>GRANT</td>
<td>授予用户权限</td>
<td>权限管理</td>
</tr>
<tr>
<td>REVOKE</td>
<td>撤销用户权限</td>
<td>权限管理</td>
</tr>
<tr>
<td>COMMIT</td>
<td>提交事务</td>
<td>事务控制</td>
</tr>
<tr>
<td>ROLLBACK</td>
<td>回滚事务</td>
<td>事务控制</td>
</tr>
<tr>
<td>SAVEPOINT</td>
<td>设置保存点</td>
<td>事务控制</td>
</tr>
</tbody></table>
<h2 id="二、用户管理"><a href="#二、用户管理" class="headerlink" title="二、用户管理"></a>二、用户管理</h2><h3 id="2-1-用户表结构"><a href="#2-1-用户表结构" class="headerlink" title="2.1 用户表结构"></a>2.1 用户表结构</h3><p>MySQL 的用户信息存储在 <code>mysql.user</code> 表中：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 查看所有用户</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">user</span>, host <span class="keyword">FROM</span> mysql.user;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看用户详细信息</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">user</span>, host, authentication_string, plugin <span class="keyword">FROM</span> mysql.user;</span><br></pre></td></tr></table></figure>

<p><strong>用户名的组成</strong>：<code>&#39;username&#39;@&#39;host&#39;</code></p>
<ul>
<li><code>username</code>：用户名</li>
<li><code>host</code>：允许连接的主机<ul>
<li><code>localhost</code>：仅本地连接</li>
<li><code>%</code>：允许任何主机连接</li>
<li><code>192.168.1.%</code>：允许特定网段连接</li>
</ul>
</li>
</ul>
<h3 id="2-2-创建用户（CREATE-USER）"><a href="#2-2-创建用户（CREATE-USER）" class="headerlink" title="2.2 创建用户（CREATE USER）"></a>2.2 创建用户（CREATE USER）</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 基础语法</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> <span class="string">&#x27;用户名&#x27;</span>@<span class="string">&#x27;主机&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;密码&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建仅本地登录的用户</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> <span class="string">&#x27;local_user&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;password123&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建可远程登录的用户（任何主机）</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> <span class="string">&#x27;remote_user&#x27;</span>@<span class="string">&#x27;%&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;password123&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建允许特定网段登录的用户</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> <span class="string">&#x27;app_user&#x27;</span>@<span class="string">&#x27;192.168.1.%&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;password123&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建用户时不设置密码（不推荐）</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> <span class="string">&#x27;nopass_user&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建用户并指定密码过期策略</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> <span class="string">&#x27;temp_user&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span></span><br><span class="line">IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;password123&#x27;</span></span><br><span class="line">PASSWORD EXPIRE <span class="type">INTERVAL</span> <span class="number">90</span> <span class="keyword">DAY</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建用户并限制连接数</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> <span class="string">&#x27;limited_user&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span></span><br><span class="line">IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;password123&#x27;</span></span><br><span class="line"><span class="keyword">WITH</span> MAX_USER_CONNECTIONS <span class="number">10</span>;</span><br></pre></td></tr></table></figure>

<h3 id="2-3-修改用户（ALTER-USER）"><a href="#2-3-修改用户（ALTER-USER）" class="headerlink" title="2.3 修改用户（ALTER USER）"></a>2.3 修改用户（ALTER USER）</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 修改用户密码（MySQL 5.7.6+）</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">USER</span> <span class="string">&#x27;local_user&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;new_password&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 修改用户密码（MySQL 5.7.6 之前）</span></span><br><span class="line"><span class="keyword">SET</span> PASSWORD <span class="keyword">FOR</span> <span class="string">&#x27;local_user&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> <span class="operator">=</span> PASSWORD(<span class="string">&#x27;new_password&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 解锁用户</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">USER</span> <span class="string">&#x27;local_user&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> ACCOUNT UNLOCK;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 锁定用户</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">USER</span> <span class="string">&#x27;local_user&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> ACCOUNT LOCK;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 设置密码过期</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">USER</span> <span class="string">&#x27;local_user&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> PASSWORD EXPIRE;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 设置密码永不过期</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">USER</span> <span class="string">&#x27;local_user&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> PASSWORD EXPIRE NEVER;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 修改主机权限（先删除再创建）</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">USER</span> <span class="string">&#x27;local_user&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> <span class="string">&#x27;local_user&#x27;</span>@<span class="string">&#x27;%&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;password123&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h3 id="2-4-删除用户（DROP-USER）"><a href="#2-4-删除用户（DROP-USER）" class="headerlink" title="2.4 删除用户（DROP USER）"></a>2.4 删除用户（DROP USER）</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 删除用户</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">USER</span> <span class="string">&#x27;local_user&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 删除多个用户</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">USER</span> <span class="string">&#x27;user1&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span>, <span class="string">&#x27;user2&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 删除不存在的用户（MySQL 8.0+ 支持 IF EXISTS）</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">USER</span> IF <span class="keyword">EXISTS</span> <span class="string">&#x27;nonexistent&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h3 id="2-5-查看用户权限"><a href="#2-5-查看用户权限" class="headerlink" title="2.5 查看用户权限"></a>2.5 查看用户权限</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 查看当前用户</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">USER</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看当前登录用户的所有权限</span></span><br><span class="line"><span class="keyword">SHOW</span> GRANTS;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看指定用户的权限</span></span><br><span class="line"><span class="keyword">SHOW</span> GRANTS <span class="keyword">FOR</span> <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看用户表</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">user</span>, host, Select_priv, Insert_priv, Update_priv, Delete_priv</span><br><span class="line"><span class="keyword">FROM</span> mysql.user;</span><br></pre></td></tr></table></figure>

<h2 id="三、权限管理"><a href="#三、权限管理" class="headerlink" title="三、权限管理"></a>三、权限管理</h2><h3 id="3-1-权限类型"><a href="#3-1-权限类型" class="headerlink" title="3.1 权限类型"></a>3.1 权限类型</h3><p>MySQL 支持多种权限类型，按作用范围分为：</p>
<table>
<thead>
<tr>
<th>权限级别</th>
<th>说明</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td>全局权限</td>
<td>作用于所有数据库</td>
<td><code>GRANT SELECT ON *.*</code></td>
</tr>
<tr>
<td>数据库权限</td>
<td>作用于特定数据库</td>
<td><code>GRANT SELECT ON db.*</code></td>
</tr>
<tr>
<td>表权限</td>
<td>作用于特定表</td>
<td><code>GRANT SELECT ON db.table</code></td>
</tr>
<tr>
<td>列权限</td>
<td>作用于特定列</td>
<td><code>GRANT SELECT(id, name) ON db.table</code></td>
</tr>
<tr>
<td>存储过程权限</td>
<td>作用于存储过程</td>
<td><code>GRANT EXECUTE ON PROCEDURE db.proc</code></td>
</tr>
</tbody></table>
<p><strong>常用权限</strong>：</p>
<table>
<thead>
<tr>
<th>权限</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>SELECT</td>
<td>查询权限</td>
</tr>
<tr>
<td>INSERT</td>
<td>插入权限</td>
</tr>
<tr>
<td>UPDATE</td>
<td>更新权限</td>
</tr>
<tr>
<td>DELETE</td>
<td>删除权限</td>
</tr>
<tr>
<td>CREATE</td>
<td>创建数据库&#x2F;表权限</td>
</tr>
<tr>
<td>DROP</td>
<td>删除数据库&#x2F;表权限</td>
</tr>
<tr>
<td>ALTER</td>
<td>修改表结构权限</td>
</tr>
<tr>
<td>INDEX</td>
<td>创建&#x2F;删除索引权限</td>
</tr>
<tr>
<td>CREATE VIEW</td>
<td>创建视图权限</td>
</tr>
<tr>
<td>EXECUTE</td>
<td>执行存储过程权限</td>
</tr>
<tr>
<td>TRIGGER</td>
<td>触发器权限</td>
</tr>
<tr>
<td>ALL PRIVILEGES</td>
<td>所有权限</td>
</tr>
<tr>
<td>GRANT OPTION</td>
<td>授权权限</td>
</tr>
</tbody></table>
<h3 id="3-2-授予权限（GRANT）"><a href="#3-2-授予权限（GRANT）" class="headerlink" title="3.2 授予权限（GRANT）"></a>3.2 授予权限（GRANT）</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 基础语法</span></span><br><span class="line"><span class="keyword">GRANT</span> 权限列表 <span class="keyword">ON</span> 数据库。表 <span class="keyword">TO</span> <span class="string">&#x27;用户名&#x27;</span>@<span class="string">&#x27;主机&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 授予所有权限（慎用！）</span></span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">ALL</span> PRIVILEGES <span class="keyword">ON</span> <span class="operator">*</span>.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;admin&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 授予全局查询权限</span></span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">SELECT</span> <span class="keyword">ON</span> <span class="operator">*</span>.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;reader&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 授予特定数据库的所有权限</span></span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">ALL</span> PRIVILEGES <span class="keyword">ON</span> mydb.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;dbuser&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 授予特定表的部分权限</span></span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">SELECT</span>, <span class="keyword">INSERT</span>, <span class="keyword">UPDATE</span> <span class="keyword">ON</span> mydb.employees <span class="keyword">TO</span> <span class="string">&#x27;hr&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 授予特定列的权限</span></span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">SELECT</span>(id, name, salary) <span class="keyword">ON</span> mydb.employees <span class="keyword">TO</span> <span class="string">&#x27;manager&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 授予存储过程执行权限</span></span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">EXECUTE</span> <span class="keyword">ON</span> <span class="keyword">PROCEDURE</span> mydb.get_employee <span class="keyword">TO</span> <span class="string">&#x27;app&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 授予创建数据库权限</span></span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">CREATE</span> <span class="keyword">ON</span> <span class="operator">*</span>.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;developer&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 授予授权权限（允许该用户再授权给其他人）</span></span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">SELECT</span> <span class="keyword">ON</span> mydb.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;reader&#x27;</span>@<span class="string">&#x27;%&#x27;</span> <span class="keyword">WITH</span> <span class="keyword">GRANT</span> OPTION;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 授予文件权限（可读写服务器文件，危险！）</span></span><br><span class="line"><span class="keyword">GRANT</span> FILE <span class="keyword">ON</span> <span class="operator">*</span>.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;data_importer&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p><strong>权限范围语法</strong>：</p>
<ul>
<li><code>*.*</code>：所有数据库的所有表</li>
<li><code>db.*</code>：特定数据库的所有表</li>
<li><code>db.table</code>：特定数据库的特定表</li>
</ul>
<h3 id="3-3-撤销权限（REVOKE）"><a href="#3-3-撤销权限（REVOKE）" class="headerlink" title="3.3 撤销权限（REVOKE）"></a>3.3 撤销权限（REVOKE）</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 基础语法</span></span><br><span class="line"><span class="keyword">REVOKE</span> 权限列表 <span class="keyword">ON</span> 数据库。表 <span class="keyword">FROM</span> <span class="string">&#x27;用户名&#x27;</span>@<span class="string">&#x27;主机&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 撤销所有权限</span></span><br><span class="line"><span class="keyword">REVOKE</span> <span class="keyword">ALL</span> PRIVILEGES, <span class="keyword">GRANT</span> OPTION <span class="keyword">FROM</span> <span class="string">&#x27;user&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 撤销特定权限</span></span><br><span class="line"><span class="keyword">REVOKE</span> <span class="keyword">DELETE</span>, <span class="keyword">UPDATE</span> <span class="keyword">ON</span> mydb.employees <span class="keyword">FROM</span> <span class="string">&#x27;hr&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 撤销全局权限</span></span><br><span class="line"><span class="keyword">REVOKE</span> <span class="keyword">SELECT</span> <span class="keyword">ON</span> <span class="operator">*</span>.<span class="operator">*</span> <span class="keyword">FROM</span> <span class="string">&#x27;reader&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 撤销授权权限</span></span><br><span class="line"><span class="keyword">REVOKE</span> <span class="keyword">GRANT</span> OPTION <span class="keyword">ON</span> mydb.<span class="operator">*</span> <span class="keyword">FROM</span> <span class="string">&#x27;manager&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h3 id="3-4-权限刷新"><a href="#3-4-权限刷新" class="headerlink" title="3.4 权限刷新"></a>3.4 权限刷新</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 刷新权限（修改权限表后生效）</span></span><br><span class="line">FLUSH PRIVILEGES;</span><br></pre></td></tr></table></figure>

<p><strong>注意</strong>：使用 GRANT 和 REVOKE 修改权限后会自动生效，不需要 FLUSH PRIVILEGES。只有直接修改 <code>mysql.user</code> 表后才需要刷新。</p>
<h3 id="3-5-权限查看与继承"><a href="#3-5-权限查看与继承" class="headerlink" title="3.5 权限查看与继承"></a>3.5 权限查看与继承</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 查看当前用户权限</span></span><br><span class="line"><span class="keyword">SHOW</span> GRANTS;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看其他用户权限</span></span><br><span class="line"><span class="keyword">SHOW</span> GRANTS <span class="keyword">FOR</span> <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看具有全局 SELECT 权限的用户</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">user</span>, host <span class="keyword">FROM</span> mysql.user <span class="keyword">WHERE</span> Select_priv <span class="operator">=</span> <span class="string">&#x27;Y&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p><strong>权限继承规则</strong>：</p>
<ul>
<li>全局权限 &gt; 数据库权限 &gt; 表权限 &gt; 列权限</li>
<li>用户拥有多个权限时，取并集</li>
</ul>
<h2 id="四、角色管理（MySQL-8-0-）"><a href="#四、角色管理（MySQL-8-0-）" class="headerlink" title="四、角色管理（MySQL 8.0+）"></a>四、角色管理（MySQL 8.0+）</h2><p>角色是一组权限的集合，可以分配给用户。</p>
<h3 id="4-1-创建角色"><a href="#4-1-创建角色" class="headerlink" title="4.1 创建角色"></a>4.1 创建角色</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 创建角色</span></span><br><span class="line"><span class="keyword">CREATE</span> ROLE <span class="string">&#x27;read_only&#x27;</span>;</span><br><span class="line"><span class="keyword">CREATE</span> ROLE <span class="string">&#x27;app_read&#x27;</span>, <span class="string">&#x27;app_write&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看角色</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> mysql.default_roles;</span><br></pre></td></tr></table></figure>

<h3 id="4-2-给角色授权"><a href="#4-2-给角色授权" class="headerlink" title="4.2 给角色授权"></a>4.2 给角色授权</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 给角色授予权限</span></span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">SELECT</span> <span class="keyword">ON</span> mydb.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;read_only&#x27;</span>;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">SELECT</span>, <span class="keyword">INSERT</span> <span class="keyword">ON</span> mydb.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;app_read&#x27;</span>;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">INSERT</span>, <span class="keyword">UPDATE</span>, <span class="keyword">DELETE</span> <span class="keyword">ON</span> mydb.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;app_write&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h3 id="4-3-给用户分配角色"><a href="#4-3-给用户分配角色" class="headerlink" title="4.3 给用户分配角色"></a>4.3 给用户分配角色</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 给用户分配角色</span></span><br><span class="line"><span class="keyword">GRANT</span> <span class="string">&#x27;read_only&#x27;</span> <span class="keyword">TO</span> <span class="string">&#x27;user1&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span>;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="string">&#x27;app_read&#x27;</span>, <span class="string">&#x27;app_write&#x27;</span> <span class="keyword">TO</span> <span class="string">&#x27;app_user&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 设置默认角色</span></span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">DEFAULT</span> ROLE <span class="string">&#x27;read_only&#x27;</span> <span class="keyword">TO</span> <span class="string">&#x27;user1&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看用户的角色</span></span><br><span class="line"><span class="keyword">SHOW</span> GRANTS <span class="keyword">FOR</span> <span class="string">&#x27;user1&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h3 id="4-4-激活角色"><a href="#4-4-激活角色" class="headerlink" title="4.4 激活角色"></a>4.4 激活角色</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 激活所有角色</span></span><br><span class="line"><span class="keyword">SET</span> ROLE <span class="keyword">ALL</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 激活特定角色</span></span><br><span class="line"><span class="keyword">SET</span> ROLE <span class="string">&#x27;read_only&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 激活所有默认角色</span></span><br><span class="line"><span class="keyword">SET</span> ROLE <span class="keyword">DEFAULT</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看当前激活的角色</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">CURRENT_ROLE</span>();</span><br></pre></td></tr></table></figure>

<h3 id="4-5-撤销角色"><a href="#4-5-撤销角色" class="headerlink" title="4.5 撤销角色"></a>4.5 撤销角色</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 撤销用户的角色</span></span><br><span class="line"><span class="keyword">REVOKE</span> <span class="string">&#x27;read_only&#x27;</span> <span class="keyword">FROM</span> <span class="string">&#x27;user1&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 删除角色</span></span><br><span class="line"><span class="keyword">DROP</span> ROLE <span class="string">&#x27;read_only&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h2 id="五、事务控制"><a href="#五、事务控制" class="headerlink" title="五、事务控制"></a>五、事务控制</h2><h3 id="5-1-事务基础"><a href="#5-1-事务基础" class="headerlink" title="5.1 事务基础"></a>5.1 事务基础</h3><p>事务是一组原子性的 SQL 操作，要么全部成功，要么全部失败。</p>
<p><strong>事务的 ACID 特性</strong>：</p>
<table>
<thead>
<tr>
<th>特性</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>原子性（Atomicity）</td>
<td>事务是不可分割的最小单位</td>
</tr>
<tr>
<td>一致性（Consistency）</td>
<td>事务执行前后数据保持一致</td>
</tr>
<tr>
<td>隔离性（Isolation）</td>
<td>并发事务互不干扰</td>
</tr>
<tr>
<td>持久性（Durability）</td>
<td>事务提交后永久保存</td>
</tr>
</tbody></table>
<h3 id="5-2-事务操作"><a href="#5-2-事务操作" class="headerlink" title="5.2 事务操作"></a>5.2 事务操作</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 查看自动提交状态</span></span><br><span class="line"><span class="keyword">SELECT</span> @<span class="variable">@autocommit</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 关闭自动提交</span></span><br><span class="line"><span class="keyword">SET</span> autocommit <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 开启事务</span></span><br><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"><span class="comment">-- 或</span></span><br><span class="line"><span class="keyword">BEGIN</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 执行 DML 操作</span></span><br><span class="line"><span class="keyword">UPDATE</span> accounts <span class="keyword">SET</span> balance <span class="operator">=</span> balance <span class="operator">-</span> <span class="number">100</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">UPDATE</span> accounts <span class="keyword">SET</span> balance <span class="operator">=</span> balance <span class="operator">+</span> <span class="number">100</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 提交事务</span></span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 回滚事务</span></span><br><span class="line"><span class="keyword">ROLLBACK</span>;</span><br></pre></td></tr></table></figure>

<h3 id="5-3-保存点（SAVEPOINT）"><a href="#5-3-保存点（SAVEPOINT）" class="headerlink" title="5.3 保存点（SAVEPOINT）"></a>5.3 保存点（SAVEPOINT）</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 开始事务</span></span><br><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 第一条操作</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> orders (order_no, amount) <span class="keyword">VALUES</span> (<span class="string">&#x27;ORD001&#x27;</span>, <span class="number">100</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 设置保存点</span></span><br><span class="line"><span class="keyword">SAVEPOINT</span> sp1;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 第二条操作</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> orders (order_no, amount) <span class="keyword">VALUES</span> (<span class="string">&#x27;ORD002&#x27;</span>, <span class="number">200</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 设置保存点</span></span><br><span class="line"><span class="keyword">SAVEPOINT</span> sp2;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 第三条操作（假设出错了）</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> orders (order_no, amount) <span class="keyword">VALUES</span> (<span class="string">&#x27;ORD003&#x27;</span>, <span class="number">300</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 回滚到保存点 sp2</span></span><br><span class="line"><span class="keyword">ROLLBACK</span> <span class="keyword">TO</span> sp2;  <span class="comment">-- ORD003 被撤销</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 提交事务（ORD001 和 ORD002 保留）</span></span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 释放保存点</span></span><br><span class="line"><span class="keyword">RELEASE</span> <span class="keyword">SAVEPOINT</span> sp1;</span><br></pre></td></tr></table></figure>

<h3 id="5-4-事务隔离级别"><a href="#5-4-事务隔离级别" class="headerlink" title="5.4 事务隔离级别"></a>5.4 事务隔离级别</h3><p>MySQL 支持四种事务隔离级别：</p>
<table>
<thead>
<tr>
<th>隔离级别</th>
<th>脏读</th>
<th>不可重复读</th>
<th>幻读</th>
</tr>
</thead>
<tbody><tr>
<td>READ UNCOMMITTED</td>
<td>可能</td>
<td>可能</td>
<td>可能</td>
</tr>
<tr>
<td>READ COMMITTED</td>
<td>否</td>
<td>可能</td>
<td>可能</td>
</tr>
<tr>
<td>REPEATABLE READ（默认）</td>
<td>否</td>
<td>否</td>
<td>可能</td>
</tr>
<tr>
<td>SERIALIZABLE</td>
<td>否</td>
<td>否</td>
<td>否</td>
</tr>
</tbody></table>
<p><strong>并发读问题</strong>：</p>
<ul>
<li><strong>脏读</strong>：读到其他事务未提交的数据</li>
<li><strong>不可重复读</strong>：同一事务中多次读取结果不一致</li>
<li><strong>幻读</strong>：同一事务中多次查询，记录数不一致</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 查看当前隔离级别</span></span><br><span class="line"><span class="keyword">SELECT</span> @<span class="variable">@transaction_isolation</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 设置隔离级别（会话级）</span></span><br><span class="line"><span class="keyword">SET</span> SESSION TRANSACTION ISOLATION LEVEL READ COMMITTED;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 设置隔离级别（全局级）</span></span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span> TRANSACTION ISOLATION LEVEL READ COMMITTED;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 设置隔离级别（在事务开始前）</span></span><br><span class="line"><span class="keyword">SET</span> TRANSACTION ISOLATION LEVEL SERIALIZABLE;</span><br><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br></pre></td></tr></table></figure>

<p><strong>MySQL InnoDB 的隔离级别特点</strong>：</p>
<ul>
<li>默认使用 <code>REPEATABLE READ</code></li>
<li>通过 MVCC（多版本并发控制）避免了幻读</li>
<li><code>READ COMMITTED</code> 下会使用不同的锁定策略</li>
</ul>
<h3 id="5-5-锁机制"><a href="#5-5-锁机制" class="headerlink" title="5.5 锁机制"></a>5.5 锁机制</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 查看锁信息</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> information_schema.innodb_locks;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> information_schema.innodb_lock_waits;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看正在执行的事务</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> information_schema.innodb_trx;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 表锁</span></span><br><span class="line">LOCK TABLES employees READ;   <span class="comment">-- 读锁</span></span><br><span class="line">LOCK TABLES employees WRITE;  <span class="comment">-- 写锁</span></span><br><span class="line">UNLOCK TABLES;                <span class="comment">-- 解锁</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 行锁（InnoDB 自动加锁，无需手动）</span></span><br><span class="line"><span class="comment">-- 在 SELECT 时加锁</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span> <span class="keyword">FOR</span> <span class="keyword">UPDATE</span>;  <span class="comment">-- 排他锁</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span> LOCK <span class="keyword">IN</span> SHARE MODE;  <span class="comment">-- 共享锁（8.0 语法已变更）</span></span><br></pre></td></tr></table></figure>

<p><strong>MySQL 8.0 新的锁语法</strong>：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 共享锁</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span> <span class="keyword">FOR</span> SHARE;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 排他锁</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span> <span class="keyword">FOR</span> <span class="keyword">UPDATE</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 跳过锁定的行</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span> <span class="keyword">FOR</span> <span class="keyword">UPDATE</span> <span class="keyword">SKIP</span> LOCKED;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 等待锁超时</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span> <span class="keyword">FOR</span> <span class="keyword">UPDATE</span> NOWAIT;</span><br></pre></td></tr></table></figure>

<h2 id="六、实战案例"><a href="#六、实战案例" class="headerlink" title="六、实战案例"></a>六、实战案例</h2><h3 id="6-1-创建应用数据库和用户"><a href="#6-1-创建应用数据库和用户" class="headerlink" title="6.1 创建应用数据库和用户"></a>6.1 创建应用数据库和用户</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 1. 创建数据库</span></span><br><span class="line"><span class="keyword">CREATE</span> DATABASE IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> webapp</span><br><span class="line"><span class="keyword">CHARACTER SET</span> utf8mb4</span><br><span class="line"><span class="keyword">COLLATE</span> utf8mb4_unicode_ci;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 2. 创建只读用户（用于报表查询）</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> <span class="string">&#x27;readonly&#x27;</span>@<span class="string">&#x27;%&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;readonly_pwd&#x27;</span>;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">SELECT</span> <span class="keyword">ON</span> webapp.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;readonly&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 3. 创建应用用户（用于日常操作）</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> <span class="string">&#x27;appuser&#x27;</span>@<span class="string">&#x27;%&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;app_pwd&#x27;</span>;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">SELECT</span>, <span class="keyword">INSERT</span>, <span class="keyword">UPDATE</span>, <span class="keyword">DELETE</span> <span class="keyword">ON</span> webapp.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;appuser&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 4. 创建管理员用户（拥有所有权限）</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> <span class="string">&#x27;admin&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;admin_pwd&#x27;</span>;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">ALL</span> PRIVILEGES <span class="keyword">ON</span> webapp.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;admin&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> <span class="keyword">WITH</span> <span class="keyword">GRANT</span> OPTION;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 5. 刷新权限</span></span><br><span class="line">FLUSH PRIVILEGES;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 6. 验证权限</span></span><br><span class="line"><span class="keyword">SHOW</span> GRANTS <span class="keyword">FOR</span> <span class="string">&#x27;readonly&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br><span class="line"><span class="keyword">SHOW</span> GRANTS <span class="keyword">FOR</span> <span class="string">&#x27;appuser&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br><span class="line"><span class="keyword">SHOW</span> GRANTS <span class="keyword">FOR</span> <span class="string">&#x27;admin&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h3 id="6-2-银行转账事务"><a href="#6-2-银行转账事务" class="headerlink" title="6.2 银行转账事务"></a>6.2 银行转账事务</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 创建账户表</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> accounts (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT,</span><br><span class="line">    account_no <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">UNIQUE</span> <span class="keyword">NOT NULL</span>,</span><br><span class="line">    balance <span class="type">DECIMAL</span>(<span class="number">12</span>, <span class="number">2</span>) <span class="keyword">DEFAULT</span> <span class="number">0</span>,</span><br><span class="line">    version <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>  <span class="comment">-- 乐观锁版本号</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT INTO</span> accounts (account_no, balance) <span class="keyword">VALUES</span></span><br><span class="line">(<span class="string">&#x27;ACC001&#x27;</span>, <span class="number">10000</span>),</span><br><span class="line">(<span class="string">&#x27;ACC002&#x27;</span>, <span class="number">5000</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 转账存储过程（带事务）</span></span><br><span class="line">DELIMITER <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> transfer_money(</span><br><span class="line">    <span class="keyword">IN</span> from_acc <span class="type">VARCHAR</span>(<span class="number">50</span>),</span><br><span class="line">    <span class="keyword">IN</span> to_acc <span class="type">VARCHAR</span>(<span class="number">50</span>),</span><br><span class="line">    <span class="keyword">IN</span> amount <span class="type">DECIMAL</span>(<span class="number">12</span>, <span class="number">2</span>)</span><br><span class="line">)</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">DECLARE</span> EXIT HANDLER <span class="keyword">FOR</span> <span class="keyword">SQLEXCEPTION</span></span><br><span class="line">    <span class="keyword">BEGIN</span></span><br><span class="line">        <span class="keyword">ROLLBACK</span>;  <span class="comment">-- 出错回滚</span></span><br><span class="line">        <span class="keyword">SELECT</span> <span class="string">&#x27;Transfer failed&#x27;</span> <span class="keyword">AS</span> <span class="keyword">result</span>;</span><br><span class="line">    <span class="keyword">END</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">START</span> TRANSACTION;</span><br><span class="line"></span><br><span class="line">    <span class="comment">-- 检查余额</span></span><br><span class="line">    IF (<span class="keyword">SELECT</span> balance <span class="keyword">FROM</span> accounts <span class="keyword">WHERE</span> account_no <span class="operator">=</span> from_acc) <span class="operator">&gt;=</span> amount <span class="keyword">THEN</span></span><br><span class="line">        <span class="comment">-- 扣款</span></span><br><span class="line">        <span class="keyword">UPDATE</span> accounts <span class="keyword">SET</span> balance <span class="operator">=</span> balance <span class="operator">-</span> amount</span><br><span class="line">        <span class="keyword">WHERE</span> account_no <span class="operator">=</span> from_acc;</span><br><span class="line"></span><br><span class="line">        <span class="comment">-- 收款</span></span><br><span class="line">        <span class="keyword">UPDATE</span> accounts <span class="keyword">SET</span> balance <span class="operator">=</span> balance <span class="operator">+</span> amount</span><br><span class="line">        <span class="keyword">WHERE</span> account_no <span class="operator">=</span> to_acc;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">COMMIT</span>;</span><br><span class="line">        <span class="keyword">SELECT</span> <span class="string">&#x27;Transfer success&#x27;</span> <span class="keyword">AS</span> <span class="keyword">result</span>;</span><br><span class="line">    <span class="keyword">ELSE</span></span><br><span class="line">        <span class="keyword">ROLLBACK</span>;</span><br><span class="line">        <span class="keyword">SELECT</span> <span class="string">&#x27;Insufficient balance&#x27;</span> <span class="keyword">AS</span> <span class="keyword">result</span>;</span><br><span class="line">    <span class="keyword">END</span> IF;</span><br><span class="line"><span class="keyword">END</span> <span class="operator">/</span><span class="operator">/</span></span><br><span class="line">DELIMITER ;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 调用转账</span></span><br><span class="line"><span class="keyword">CALL</span> transfer_money(<span class="string">&#x27;ACC001&#x27;</span>, <span class="string">&#x27;ACC002&#x27;</span>, <span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看结果</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> accounts;</span><br></pre></td></tr></table></figure>

<h3 id="6-3-使用乐观锁"><a href="#6-3-使用乐观锁" class="headerlink" title="6.3 使用乐观锁"></a>6.3 使用乐观锁</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 使用版本号实现乐观锁</span></span><br><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 读取当前版本</span></span><br><span class="line"><span class="keyword">SELECT</span> balance, version <span class="keyword">FROM</span> accounts <span class="keyword">WHERE</span> account_no <span class="operator">=</span> <span class="string">&#x27;ACC001&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 更新时检查版本号</span></span><br><span class="line"><span class="keyword">UPDATE</span> accounts</span><br><span class="line"><span class="keyword">SET</span> balance <span class="operator">=</span> balance <span class="operator">-</span> <span class="number">1000</span>, version <span class="operator">=</span> version <span class="operator">+</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">WHERE</span> account_no <span class="operator">=</span> <span class="string">&#x27;ACC001&#x27;</span> <span class="keyword">AND</span> version <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 检查影响行数，如果为 0 说明被其他事务修改过</span></span><br><span class="line"><span class="comment">-- 需要回滚重试</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br></pre></td></tr></table></figure>

<h2 id="七、安全管理最佳实践"><a href="#七、安全管理最佳实践" class="headerlink" title="七、安全管理最佳实践"></a>七、安全管理最佳实践</h2><h3 id="7-1-密码安全"><a href="#7-1-密码安全" class="headerlink" title="7.1 密码安全"></a>7.1 密码安全</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 设置密码复杂度验证插件</span></span><br><span class="line">INSTALL PLUGIN validate_password SONAME <span class="string">&#x27;validate_password.so&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看密码策略</span></span><br><span class="line"><span class="keyword">SHOW</span> VARIABLES <span class="keyword">LIKE</span> <span class="string">&#x27;validate_password%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 设置密码策略级别</span></span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span> validate_password.policy <span class="operator">=</span> MEDIUM;</span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span> validate_password.length <span class="operator">=</span> <span class="number">8</span>;</span><br></pre></td></tr></table></figure>

<h3 id="7-2-最小权限原则"><a href="#7-2-最小权限原则" class="headerlink" title="7.2 最小权限原则"></a>7.2 最小权限原则</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 错误：给应用用户授予过多权限</span></span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">ALL</span> PRIVILEGES <span class="keyword">ON</span> <span class="operator">*</span>.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;app&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 正确：只授予必要权限</span></span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">SELECT</span>, <span class="keyword">INSERT</span>, <span class="keyword">UPDATE</span>, <span class="keyword">DELETE</span> <span class="keyword">ON</span> mydb.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;app&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h3 id="7-3-限制主机访问"><a href="#7-3-限制主机访问" class="headerlink" title="7.3 限制主机访问"></a>7.3 限制主机访问</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 错误：允许任何主机连接</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> <span class="string">&#x27;app&#x27;</span>@<span class="string">&#x27;%&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;pwd&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 正确：限制特定主机或网段</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> <span class="string">&#x27;app&#x27;</span>@<span class="string">&#x27;192.168.1.%&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;pwd&#x27;</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> <span class="string">&#x27;app&#x27;</span>@<span class="string">&#x27;10.0.0.100&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;pwd&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h3 id="7-4-定期清理无用用户"><a href="#7-4-定期清理无用用户" class="headerlink" title="7.4 定期清理无用用户"></a>7.4 定期清理无用用户</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 查看长期未登录的用户</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">user</span>, host, password_last_changed</span><br><span class="line"><span class="keyword">FROM</span> mysql.user</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> password_last_changed;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 删除无用用户</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">USER</span> <span class="string">&#x27;old_user&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h3 id="7-5-审计和监控"><a href="#7-5-审计和监控" class="headerlink" title="7.5 审计和监控"></a>7.5 审计和监控</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 开启通用查询日志（生产环境慎用）</span></span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span> general_log <span class="operator">=</span> <span class="string">&#x27;ON&#x27;</span>;</span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span> general_log_file <span class="operator">=</span> <span class="string">&#x27;/var/log/mysql/general.log&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看当前连接</span></span><br><span class="line"><span class="keyword">SHOW</span> PROCESSLIST;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看慢查询日志</span></span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span> slow_query_log <span class="operator">=</span> <span class="string">&#x27;ON&#x27;</span>;</span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span> long_query_time <span class="operator">=</span> <span class="number">2</span>;  <span class="comment">-- 超过 2 秒的查询记入日志</span></span><br></pre></td></tr></table></figure>

<h2 id="八、小结"><a href="#八、小结" class="headerlink" title="八、小结"></a>八、小结</h2><h3 id="知识点回顾"><a href="#知识点回顾" class="headerlink" title="知识点回顾"></a>知识点回顾</h3><ol>
<li><p><strong>用户管理</strong></p>
<ul>
<li>CREATE USER、ALTER USER、DROP USER</li>
<li>用户名格式：‘user‘@’host’</li>
</ul>
</li>
<li><p><strong>权限管理</strong></p>
<ul>
<li>GRANT 授权、REVOKE 撤销</li>
<li>权限级别：全局、数据库、表、列</li>
<li>常用权限：SELECT、INSERT、UPDATE、DELETE、ALL PRIVILEGES</li>
</ul>
</li>
<li><p><strong>角色管理（MySQL 8.0+）</strong></p>
<ul>
<li>CREATE ROLE 创建角色</li>
<li>角色是一组权限的集合</li>
</ul>
</li>
<li><p><strong>事务控制</strong></p>
<ul>
<li>START TRANSACTION、COMMIT、ROLLBACK</li>
<li>SAVEPOINT 保存点</li>
<li>隔离级别：READ UNCOMMITTED、READ COMMITTED、REPEATABLE READ、SERIALIZABLE</li>
</ul>
</li>
</ol>
<h3 id="DCL-命令速查表"><a href="#DCL-命令速查表" class="headerlink" title="DCL 命令速查表"></a>DCL 命令速查表</h3><table>
<thead>
<tr>
<th>命令</th>
<th>语法</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>CREATE USER</td>
<td><code>CREATE USER &#39;u&#39;@&#39;h&#39; IDENTIFIED BY &#39;pwd&#39;</code></td>
<td>创建用户</td>
</tr>
<tr>
<td>DROP USER</td>
<td><code>DROP USER &#39;u&#39;@&#39;h&#39;</code></td>
<td>删除用户</td>
</tr>
<tr>
<td>GRANT</td>
<td><code>GRANT 权限 ON 库。表 TO &#39;u&#39;@&#39;h&#39;</code></td>
<td>授权</td>
</tr>
<tr>
<td>REVOKE</td>
<td><code>REVOKE 权限 ON 库。表 FROM &#39;u&#39;@&#39;h&#39;</code></td>
<td>撤销权限</td>
</tr>
<tr>
<td>SHOW GRANTS</td>
<td><code>SHOW GRANTS FOR &#39;u&#39;@&#39;h&#39;</code></td>
<td>查看权限</td>
</tr>
<tr>
<td>START TRANSACTION</td>
<td><code>START TRANSACTION</code></td>
<td>开启事务</td>
</tr>
<tr>
<td>COMMIT</td>
<td><code>COMMIT</code></td>
<td>提交事务</td>
</tr>
<tr>
<td>ROLLBACK</td>
<td><code>ROLLBACK</code></td>
<td>回滚事务</td>
</tr>
<tr>
<td>SAVEPOINT</td>
<td><code>SAVEPOINT sp_name</code></td>
<td>设置保存点</td>
</tr>
</tbody></table>
<h3 id="安全建议"><a href="#安全建议" class="headerlink" title="安全建议"></a>安全建议</h3><ol>
<li><strong>最小权限原则</strong>：只授予必要的权限</li>
<li><strong>限制主机</strong>：避免使用 <code>&#39;user&#39;@&#39;%&#39;</code></li>
<li><strong>强密码策略</strong>：使用密码复杂度验证</li>
<li><strong>定期审计</strong>：清理无用用户，检查权限分配</li>
<li><strong>生产环境</strong>：避免使用 root 用户连接应用</li>
</ol>
<hr>
<p><strong>上一篇</strong>：[MySQL 基础教程（四）DQL 数据查询语言详解（下）](&#x2F;2026&#x2F;02&#x2F;23&#x2F;MySQL 基础教程（四）DQL 数据查询语言详解（下）&#x2F;)</p>
<h2 id="MySQL-基础教程系列总结"><a href="#MySQL-基础教程系列总结" class="headerlink" title="MySQL 基础教程系列总结"></a>MySQL 基础教程系列总结</h2><p>至此，MySQL 基础教程系列全部完成！让我们回顾一下整个系列的内容：</p>
<h3 id="系列文章回顾"><a href="#系列文章回顾" class="headerlink" title="系列文章回顾"></a>系列文章回顾</h3><ol>
<li><p><strong>（一）数据库基础与环境搭建</strong></p>
<ul>
<li>数据库概念、MySQL 安装、数据模型、SQL 分类</li>
</ul>
</li>
<li><p><strong>（二）DDL 数据定义语言详解</strong></p>
<ul>
<li>数据库操作、表操作、数据类型、DataGrip 工具</li>
</ul>
</li>
<li><p><strong>（三）DML 数据操作语言详解</strong></p>
<ul>
<li>INSERT 插入、UPDATE 更新、DELETE 删除、事务基础</li>
</ul>
</li>
<li><p><strong>（四）DQL 数据查询语言详解</strong></p>
<ul>
<li>基础查询、条件查询、聚合函数、分组、排序、分页、连接查询、子查询</li>
</ul>
</li>
<li><p><strong>（五）DCL 数据控制语言详解</strong></p>
<ul>
<li>用户管理、权限控制、事务控制、安全管理</li>
</ul>
</li>
</ol>
<h3 id="学习建议"><a href="#学习建议" class="headerlink" title="学习建议"></a>学习建议</h3><ol>
<li><strong>多动手实践</strong>：SQL 是一门实践性很强的语言，建议边学边练</li>
<li><strong>理解原理</strong>：不仅要会写 SQL，还要理解执行顺序和原理</li>
<li><strong>注意性能</strong>：养成写高效 SQL 的习惯，避免全表扫描</li>
<li><strong>善用工具</strong>：使用 DataGrip 等工具提高开发效率</li>
<li><strong>持续学习</strong>：数据库知识博大精深，保持学习的热情</li>
</ol>
<p>希望本系列教程能帮助你系统地掌握 MySQL 基础！如有问题，欢迎留言讨论。</p>
]]></content>
      <categories>
        <category>MySQL 基础教程</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
        <tag>DCL</tag>
        <tag>权限管理</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQL 基础教程（二）DDL 数据定义语言详解</title>
    <url>/2026/02/23/MySQL%20%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B%EF%BC%88%E4%BA%8C%EF%BC%89DDL%20%E6%95%B0%E6%8D%AE%E5%AE%9A%E4%B9%89%E8%AF%AD%E8%A8%80%E8%AF%A6%E8%A7%A3/</url>
    <content><![CDATA[<h1 id="MySQL-基础教程（二）DDL-数据定义语言详解"><a href="#MySQL-基础教程（二）DDL-数据定义语言详解" class="headerlink" title="MySQL 基础教程（二）DDL 数据定义语言详解"></a>MySQL 基础教程（二）DDL 数据定义语言详解</h1><p>在上一篇中，我们完成了 MySQL 的安装并了解了 SQL 的分类。本文我们将深入学习 <strong>DDL（Data Definition Language）数据定义语言</strong>，掌握如何创建和管理数据库与表。</p>
<h2 id="一、DDL-概述"><a href="#一、DDL-概述" class="headerlink" title="一、DDL 概述"></a>一、DDL 概述</h2><p>DDL 用于定义和管理数据库对象，包括：</p>
<ul>
<li><strong>数据库操作</strong>：CREATE DATABASE、DROP DATABASE、ALTER DATABASE、USE</li>
<li><strong>表操作</strong>：CREATE TABLE、ALTER TABLE、DROP TABLE、TRUNCATE、RENAME</li>
<li><strong>索引操作</strong>：CREATE INDEX、DROP INDEX</li>
<li><strong>视图操作</strong>：CREATE VIEW、DROP VIEW</li>
</ul>
<p><strong>DDL 的特点</strong>：</p>
<ul>
<li>操作会自动提交，无法回滚</li>
<li>操作的是数据库结构，而非数据内容</li>
</ul>
<h2 id="二、数据库操作"><a href="#二、数据库操作" class="headerlink" title="二、数据库操作"></a>二、数据库操作</h2><h3 id="2-1-创建数据库"><a href="#2-1-创建数据库" class="headerlink" title="2.1 创建数据库"></a>2.1 创建数据库</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 创建数据库（如果不存在）</span></span><br><span class="line"><span class="keyword">CREATE</span> DATABASE IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> mydb;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建数据库并指定字符集</span></span><br><span class="line"><span class="keyword">CREATE</span> DATABASE IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> mydb</span><br><span class="line"><span class="keyword">CHARACTER SET</span> utf8mb4</span><br><span class="line"><span class="keyword">COLLATE</span> utf8mb4_unicode_ci;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看所有数据库</span></span><br><span class="line"><span class="keyword">SHOW</span> DATABASES;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看创建数据库的语句</span></span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">CREATE</span> DATABASE mydb;</span><br></pre></td></tr></table></figure>

<p><strong>参数说明</strong>：</p>
<ul>
<li><code>IF NOT EXISTS</code>：如果数据库已存在则不创建，避免报错</li>
<li><code>CHARACTER SET</code>：指定字符集，推荐 <code>utf8mb4</code>（支持 emoji 等特殊字符）</li>
<li><code>COLLATE</code>：指定排序规则</li>
</ul>
<p><strong>常用字符集</strong>：</p>
<table>
<thead>
<tr>
<th>字符集</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>utf8mb4</td>
<td>UTF-8 完整实现，支持 emoji（推荐）</td>
</tr>
<tr>
<td>utf8</td>
<td>MySQL 中的 utf8 是阉割版，最多 3 字节</td>
</tr>
<tr>
<td>gbk</td>
<td>中文字符集，2 字节</td>
</tr>
<tr>
<td>latin1</td>
<td>单字节字符集，西文字符</td>
</tr>
</tbody></table>
<h3 id="2-2-查看和选择数据库"><a href="#2-2-查看和选择数据库" class="headerlink" title="2.2 查看和选择数据库"></a>2.2 查看和选择数据库</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 查看当前使用的数据库</span></span><br><span class="line"><span class="keyword">SELECT</span> DATABASE();</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 使用/切换数据库</span></span><br><span class="line">USE mydb;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看当前数据库中的所有表</span></span><br><span class="line"><span class="keyword">SHOW</span> TABLES;</span><br></pre></td></tr></table></figure>

<h3 id="2-3-修改数据库"><a href="#2-3-修改数据库" class="headerlink" title="2.3 修改数据库"></a>2.3 修改数据库</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 修改数据库字符集</span></span><br><span class="line"><span class="keyword">ALTER</span> DATABASE mydb</span><br><span class="line"><span class="keyword">CHARACTER SET</span> utf8mb4</span><br><span class="line"><span class="keyword">COLLATE</span> utf8mb4_general_ci;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看数据库定义</span></span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">CREATE</span> DATABASE mydb;</span><br></pre></td></tr></table></figure>

<h3 id="2-4-删除数据库"><a href="#2-4-删除数据库" class="headerlink" title="2.4 删除数据库"></a>2.4 删除数据库</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 删除数据库（如果存在）</span></span><br><span class="line"><span class="keyword">DROP</span> DATABASE IF <span class="keyword">EXISTS</span> mydb;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 删除数据库（不存在则报错）</span></span><br><span class="line"><span class="keyword">DROP</span> DATABASE mydb;</span><br></pre></td></tr></table></figure>

<p><strong>注意</strong>：<code>DROP</code> 操作会永久删除数据库及其所有数据，请谨慎操作！</p>
<h2 id="三、表操作-创建与查询"><a href="#三、表操作-创建与查询" class="headerlink" title="三、表操作 - 创建与查询"></a>三、表操作 - 创建与查询</h2><h3 id="3-1-创建表的基本语法"><a href="#3-1-创建表的基本语法" class="headerlink" title="3.1 创建表的基本语法"></a>3.1 创建表的基本语法</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> [IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span>] 表名 (</span><br><span class="line">    列名 <span class="number">1</span> 数据类型 [约束条件],</span><br><span class="line">    列名 <span class="number">2</span> 数据类型 [约束条件],</span><br><span class="line">    ...</span><br><span class="line">    列名 n 数据类型 [约束条件]</span><br><span class="line">) [表选项];</span><br></pre></td></tr></table></figure>

<h3 id="3-2-创建表示例"><a href="#3-2-创建表示例" class="headerlink" title="3.2 创建表示例"></a>3.2 创建表示例</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 创建学生表</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> students (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;学生 ID&#x27;</span>,</span><br><span class="line">    name <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">NOT NULL</span> COMMENT <span class="string">&#x27;姓名&#x27;</span>,</span><br><span class="line">    age <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">18</span> COMMENT <span class="string">&#x27;年龄&#x27;</span>,</span><br><span class="line">    gender ENUM(<span class="string">&#x27;男&#x27;</span>, <span class="string">&#x27;女&#x27;</span>) <span class="keyword">DEFAULT</span> <span class="string">&#x27;男&#x27;</span> COMMENT <span class="string">&#x27;性别&#x27;</span>,</span><br><span class="line">    email <span class="type">VARCHAR</span>(<span class="number">100</span>) COMMENT <span class="string">&#x27;邮箱&#x27;</span>,</span><br><span class="line">    phone <span class="type">VARCHAR</span>(<span class="number">20</span>) COMMENT <span class="string">&#x27;电话&#x27;</span>,</span><br><span class="line">    create_time DATETIME <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="string">&#x27;创建时间&#x27;</span></span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4 COMMENT<span class="operator">=</span><span class="string">&#x27;学生信息表&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h3 id="3-3-常用约束条件"><a href="#3-3-常用约束条件" class="headerlink" title="3.3 常用约束条件"></a>3.3 常用约束条件</h3><table>
<thead>
<tr>
<th>约束</th>
<th>说明</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td>PRIMARY KEY</td>
<td>主键，唯一且非空</td>
<td><code>id INT PRIMARY KEY</code></td>
</tr>
<tr>
<td>AUTO_INCREMENT</td>
<td>自增</td>
<td><code>id INT AUTO_INCREMENT</code></td>
</tr>
<tr>
<td>NOT NULL</td>
<td>非空</td>
<td><code>name VARCHAR(50) NOT NULL</code></td>
</tr>
<tr>
<td>UNIQUE</td>
<td>唯一</td>
<td><code>email VARCHAR(100) UNIQUE</code></td>
</tr>
<tr>
<td>DEFAULT</td>
<td>默认值</td>
<td><code>age INT DEFAULT 18</code></td>
</tr>
<tr>
<td>FOREIGN KEY</td>
<td>外键</td>
<td><code>FOREIGN KEY (dept_id) REFERENCES departments(id)</code></td>
</tr>
<tr>
<td>CHECK</td>
<td>检查条件（MySQL 8.0.16+ 支持）</td>
<td><code>age INT CHECK (age &gt;= 0)</code></td>
</tr>
</tbody></table>
<h3 id="3-4-表选项"><a href="#3-4-表选项" class="headerlink" title="3.4 表选项"></a>3.4 表选项</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 常用表选项</span></span><br><span class="line">ENGINE<span class="operator">=</span>InnoDB           <span class="comment">-- 存储引擎，默认 InnoDB</span></span><br><span class="line"><span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4 <span class="comment">-- 字符集</span></span><br><span class="line">AUTO_INCREMENT<span class="operator">=</span><span class="number">1</span>        <span class="comment">-- 自增起始值</span></span><br><span class="line">COMMENT<span class="operator">=</span><span class="string">&#x27;表注释&#x27;</span>         <span class="comment">-- 表注释</span></span><br></pre></td></tr></table></figure>

<h3 id="3-5-查询表信息"><a href="#3-5-查询表信息" class="headerlink" title="3.5 查询表信息"></a>3.5 查询表信息</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 查看当前数据库的所有表</span></span><br><span class="line"><span class="keyword">SHOW</span> TABLES;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看表结构</span></span><br><span class="line"><span class="keyword">DESC</span> students;</span><br><span class="line"><span class="keyword">DESCRIBE</span> students;  <span class="comment">-- 等价</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看详细表结构（包含更多信息）</span></span><br><span class="line"><span class="keyword">DESC</span> formatted students;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看创建表的语句</span></span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">CREATE TABLE</span> students;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看表的状态信息</span></span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">TABLE</span> STATUS <span class="keyword">LIKE</span> <span class="string">&#x27;students&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看表的索引信息</span></span><br><span class="line"><span class="keyword">SHOW</span> INDEX <span class="keyword">FROM</span> students;</span><br></pre></td></tr></table></figure>

<h3 id="3-6-创建表实战案例"><a href="#3-6-创建表实战案例" class="headerlink" title="3.6 创建表实战案例"></a>3.6 创建表实战案例</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 创建部门表</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> departments (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;部门 ID&#x27;</span>,</span><br><span class="line">    dept_name <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">NOT NULL</span> <span class="keyword">UNIQUE</span> COMMENT <span class="string">&#x27;部门名称&#x27;</span>,</span><br><span class="line">    dept_location <span class="type">VARCHAR</span>(<span class="number">100</span>) COMMENT <span class="string">&#x27;部门位置&#x27;</span>,</span><br><span class="line">    create_time DATETIME <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="string">&#x27;创建时间&#x27;</span></span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4 COMMENT<span class="operator">=</span><span class="string">&#x27;部门表&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建员工表（带外键）</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> employees (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;员工 ID&#x27;</span>,</span><br><span class="line">    emp_name <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">NOT NULL</span> COMMENT <span class="string">&#x27;姓名&#x27;</span>,</span><br><span class="line">    emp_no <span class="type">VARCHAR</span>(<span class="number">20</span>) <span class="keyword">NOT NULL</span> <span class="keyword">UNIQUE</span> COMMENT <span class="string">&#x27;员工编号&#x27;</span>,</span><br><span class="line">    gender ENUM(<span class="string">&#x27;男&#x27;</span>, <span class="string">&#x27;女&#x27;</span>) <span class="keyword">DEFAULT</span> <span class="string">&#x27;男&#x27;</span> COMMENT <span class="string">&#x27;性别&#x27;</span>,</span><br><span class="line">    salary <span class="type">DECIMAL</span>(<span class="number">10</span>, <span class="number">2</span>) <span class="keyword">DEFAULT</span> <span class="number">0</span> COMMENT <span class="string">&#x27;工资&#x27;</span>,</span><br><span class="line">    dept_id <span class="type">INT</span> COMMENT <span class="string">&#x27;部门 ID&#x27;</span>,</span><br><span class="line">    hire_date <span class="type">DATE</span> COMMENT <span class="string">&#x27;入职日期&#x27;</span>,</span><br><span class="line">    create_time DATETIME <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="string">&#x27;创建时间&#x27;</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment">-- 外键约束</span></span><br><span class="line">    <span class="keyword">CONSTRAINT</span> fk_emp_dept</span><br><span class="line">        <span class="keyword">FOREIGN KEY</span> (dept_id) <span class="keyword">REFERENCES</span> departments(id)</span><br><span class="line">        <span class="keyword">ON</span> <span class="keyword">DELETE</span> <span class="keyword">SET</span> <span class="keyword">NULL</span></span><br><span class="line">        <span class="keyword">ON</span> <span class="keyword">UPDATE</span> CASCADE</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4 COMMENT<span class="operator">=</span><span class="string">&#x27;员工表&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p><strong>外键选项说明</strong>：</p>
<ul>
<li><code>ON DELETE SET NULL</code>：删除父表记录时，子表外键设为 NULL</li>
<li><code>ON DELETE CASCADE</code>：删除父表记录时，级联删除子表记录</li>
<li><code>ON UPDATE CASCADE</code>：更新父表主键时，级联更新子表外键</li>
</ul>
<h2 id="四、MySQL-数据类型"><a href="#四、MySQL-数据类型" class="headerlink" title="四、MySQL 数据类型"></a>四、MySQL 数据类型</h2><p>MySQL 的数据类型分为三大类：<strong>数值类型</strong>、<strong>字符串类型</strong>、<strong>日期时间类型</strong>。</p>
<h3 id="4-1-数值类型"><a href="#4-1-数值类型" class="headerlink" title="4.1 数值类型"></a>4.1 数值类型</h3><h4 id="整数类型"><a href="#整数类型" class="headerlink" title="整数类型"></a>整数类型</h4><table>
<thead>
<tr>
<th>类型</th>
<th>字节</th>
<th>有符号范围</th>
<th>无符号范围</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>TINYINT</td>
<td>1</td>
<td>-128 ~ 127</td>
<td>0 ~ 255</td>
<td>适合状态、布尔值</td>
</tr>
<tr>
<td>SMALLINT</td>
<td>2</td>
<td>-32768 ~ 32767</td>
<td>0 ~ 65535</td>
<td>小整数</td>
</tr>
<tr>
<td>MEDIUMINT</td>
<td>3</td>
<td>-8388608 ~ 8388607</td>
<td>0 ~ 16777215</td>
<td>中等整数</td>
</tr>
<tr>
<td>INT&#x2F;INTEGER</td>
<td>4</td>
<td>-2³¹ ~ 2³¹-1</td>
<td>0 ~ 2³²-1</td>
<td>常用整数</td>
</tr>
<tr>
<td>BIGINT</td>
<td>8</td>
<td>-2⁶³ ~ 2⁶³-1</td>
<td>0 ~ 2⁶⁴-1</td>
<td>大整数，如金额</td>
</tr>
</tbody></table>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 整数示例</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> num_test (</span><br><span class="line">    tiny_int TINYINT COMMENT <span class="string">&#x27;微小整数&#x27;</span>,</span><br><span class="line">    small_int <span class="type">SMALLINT</span> COMMENT <span class="string">&#x27;小整数&#x27;</span>,</span><br><span class="line">    medium_int MEDIUMINT COMMENT <span class="string">&#x27;中等整数&#x27;</span>,</span><br><span class="line">    big_int <span class="type">BIGINT</span> COMMENT <span class="string">&#x27;大整数&#x27;</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment">-- 无符号整数（不能为负数）</span></span><br><span class="line">    unsigned_int <span class="type">INT</span> UNSIGNED COMMENT <span class="string">&#x27;无符号整数&#x27;</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 插入测试数据</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> num_test <span class="keyword">VALUES</span> (<span class="number">100</span>, <span class="number">30000</span>, <span class="number">5000000</span>, <span class="number">9000000000</span>, <span class="number">4000000000</span>);</span><br></pre></td></tr></table></figure>

<p><strong>Zerofill 属性</strong>（自动添加前导零）：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 创建 zerofill 列</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> zerofill_test (</span><br><span class="line">    id <span class="type">INT</span>(<span class="number">5</span>) ZEROFILL</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT INTO</span> zerofill_test <span class="keyword">VALUES</span> (<span class="number">1</span>), (<span class="number">23</span>), (<span class="number">456</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> zerofill_test;</span><br><span class="line"><span class="comment">-- 结果：00001, 00023, 00456</span></span><br></pre></td></tr></table></figure>

<h4 id="浮点类型"><a href="#浮点类型" class="headerlink" title="浮点类型"></a>浮点类型</h4><table>
<thead>
<tr>
<th>类型</th>
<th>字节</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>FLOAT</td>
<td>4</td>
<td>单精度浮点数</td>
</tr>
<tr>
<td>DOUBLE</td>
<td>8</td>
<td>双精度浮点数</td>
</tr>
<tr>
<td>DECIMAL(M,D)</td>
<td>可变</td>
<td>精确小数，适合金额</td>
</tr>
</tbody></table>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 浮点数示例</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> float_test (</span><br><span class="line">    f <span class="type">FLOAT</span>,</span><br><span class="line">    d <span class="keyword">DOUBLE</span>,</span><br><span class="line">    m <span class="type">DECIMAL</span>(<span class="number">10</span>, <span class="number">2</span>)  <span class="comment">-- 总共 10 位，小数 2 位</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- DECIMAL 更适合金额计算（精确）</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> float_test <span class="keyword">VALUES</span> (<span class="number">3.14</span>, <span class="number">3.1415926</span>, <span class="number">12345678.90</span>);</span><br></pre></td></tr></table></figure>

<p><strong>DECIMAL vs FLOAT&#x2F;DOUBLE</strong>：</p>
<ul>
<li><code>FLOAT/DOUBLE</code>：有精度损失，适合科学计算</li>
<li><code>DECIMAL</code>：精确无损失，<strong>适合金融、金额计算</strong></li>
</ul>
<h3 id="4-2-字符串类型"><a href="#4-2-字符串类型" class="headerlink" title="4.2 字符串类型"></a>4.2 字符串类型</h3><table>
<thead>
<tr>
<th>类型</th>
<th>说明</th>
<th>最大长度</th>
<th>特点</th>
</tr>
</thead>
<tbody><tr>
<td>CHAR(n)</td>
<td>固定长度</td>
<td>255 字符</td>
<td>不足补空格，查询快</td>
</tr>
<tr>
<td>VARCHAR(n)</td>
<td>可变长度</td>
<td>65535 字节</td>
<td>节省空间</td>
</tr>
<tr>
<td>TEXT</td>
<td>长文本</td>
<td>65535 字节</td>
<td>存储大文本</td>
</tr>
<tr>
<td>MEDIUMTEXT</td>
<td>大文本</td>
<td>16MB</td>
<td>更大文本</td>
</tr>
<tr>
<td>LONGTEXT</td>
<td>超长文本</td>
<td>4GB</td>
<td>极大文本</td>
</tr>
<tr>
<td>BLOB</td>
<td>二进制数据</td>
<td>65535 字节</td>
<td>图片、文件等</td>
</tr>
</tbody></table>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 字符串类型示例</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> string_test (</span><br><span class="line">    char_col <span class="type">CHAR</span>(<span class="number">10</span>) COMMENT <span class="string">&#x27;固定长度&#x27;</span>,</span><br><span class="line">    varchar_col <span class="type">VARCHAR</span>(<span class="number">10</span>) COMMENT <span class="string">&#x27;可变长度&#x27;</span>,</span><br><span class="line">    text_col TEXT COMMENT <span class="string">&#x27;长文本&#x27;</span>,</span><br><span class="line">    blob_col <span class="type">BLOB</span> COMMENT <span class="string">&#x27;二进制数据&#x27;</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 插入测试</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> string_test <span class="keyword">VALUES</span> (<span class="string">&#x27;abc&#x27;</span>, <span class="string">&#x27;abc&#x27;</span>, <span class="string">&#x27;这是一段较长的文本...&#x27;</span>, X<span class="string">&#x27;48454C4C4F&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- CHAR 会补足空格</span></span><br><span class="line"><span class="keyword">SELECT</span> char_col, LENGTH(char_col) <span class="keyword">FROM</span> string_test;  <span class="comment">-- &#x27;abc       &#x27;, 10</span></span><br></pre></td></tr></table></figure>

<p><strong>CHAR vs VARCHAR 选择</strong>：</p>
<ul>
<li><code>CHAR</code>：长度固定或差异小（如手机号、身份证号、MD5）</li>
<li><code>VARCHAR</code>：长度差异大（如姓名、地址）</li>
</ul>
<h3 id="4-3-日期时间类型"><a href="#4-3-日期时间类型" class="headerlink" title="4.3 日期时间类型"></a>4.3 日期时间类型</h3><table>
<thead>
<tr>
<th>类型</th>
<th>格式</th>
<th>范围</th>
<th>字节</th>
</tr>
</thead>
<tbody><tr>
<td>DATE</td>
<td>YYYY-MM-DD</td>
<td>1000-01-01 ~ 9999-12-31</td>
<td>3</td>
</tr>
<tr>
<td>TIME</td>
<td>HH:MM:SS</td>
<td>-838:59:59 ~ 838:59:59</td>
<td>3</td>
</tr>
<tr>
<td>DATETIME</td>
<td>YYYY-MM-DD HH:MM:SS</td>
<td>1000-01-01 00:00:00 ~ 9999-12-31 23:59:59</td>
<td>8</td>
</tr>
<tr>
<td>TIMESTAMP</td>
<td>YYYY-MM-DD HH:MM:SS</td>
<td>1970-01-01 00:00:00 ~ 2038-01-19 03:14:07</td>
<td>4</td>
</tr>
<tr>
<td>YEAR</td>
<td>YYYY</td>
<td>1901 ~ 2155</td>
<td>1</td>
</tr>
</tbody></table>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 日期时间类型示例</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> date_test (</span><br><span class="line">    d <span class="type">DATE</span> COMMENT <span class="string">&#x27;日期&#x27;</span>,</span><br><span class="line">    t <span class="type">TIME</span> COMMENT <span class="string">&#x27;时间&#x27;</span>,</span><br><span class="line">    dt DATETIME COMMENT <span class="string">&#x27;日期时间&#x27;</span>,</span><br><span class="line">    ts <span class="type">TIMESTAMP</span> COMMENT <span class="string">&#x27;时间戳&#x27;</span>,</span><br><span class="line">    y <span class="keyword">YEAR</span> COMMENT <span class="string">&#x27;年份&#x27;</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 插入当前时间</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> date_test <span class="keyword">VALUES</span> (</span><br><span class="line">    CURDATE(),      <span class="comment">-- 当前日期</span></span><br><span class="line">    CURTIME(),      <span class="comment">-- 当前时间</span></span><br><span class="line">    NOW(),          <span class="comment">-- 当前日期时间</span></span><br><span class="line">    <span class="built_in">CURRENT_TIMESTAMP</span>,  <span class="comment">-- 当前时间戳</span></span><br><span class="line">    <span class="keyword">YEAR</span>(NOW())     <span class="comment">-- 当前年份</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p><strong>DATETIME vs TIMESTAMP</strong>：</p>
<table>
<thead>
<tr>
<th>对比项</th>
<th>DATETIME</th>
<th>TIMESTAMP</th>
</tr>
</thead>
<tbody><tr>
<td>时区</td>
<td>无关</td>
<td>与时区相关</td>
</tr>
<tr>
<td>范围</td>
<td>1000~9999 年</td>
<td>1970~2038 年</td>
</tr>
<tr>
<td>空间</td>
<td>8 字节</td>
<td>4 字节</td>
</tr>
<tr>
<td>自动更新</td>
<td>不支持</td>
<td>支持 <code>ON UPDATE CURRENT_TIMESTAMP</code></td>
</tr>
</tbody></table>
<h3 id="4-4-数据类型选择建议"><a href="#4-4-数据类型选择建议" class="headerlink" title="4.4 数据类型选择建议"></a>4.4 数据类型选择建议</h3><ol>
<li><strong>整数优先于浮点数</strong>：能用整数就不用浮点数</li>
<li><strong>金额用 DECIMAL</strong>：避免精度损失</li>
<li><strong>字符串根据长度选择</strong>：固定长度用 CHAR，可变用 VARCHAR</li>
<li><strong>日期时间根据需求</strong>：需要时区用 TIMESTAMP，否则用 DATETIME</li>
<li><strong>预留适当空间</strong>：但不要过度浪费</li>
</ol>
<h2 id="五、表操作-修改与删除"><a href="#五、表操作-修改与删除" class="headerlink" title="五、表操作 - 修改与删除"></a>五、表操作 - 修改与删除</h2><h3 id="5-1-修改表结构（ALTER-TABLE）"><a href="#5-1-修改表结构（ALTER-TABLE）" class="headerlink" title="5.1 修改表结构（ALTER TABLE）"></a>5.1 修改表结构（ALTER TABLE）</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 添加列</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> students <span class="keyword">ADD</span> <span class="keyword">COLUMN</span> address <span class="type">VARCHAR</span>(<span class="number">200</span>) COMMENT <span class="string">&#x27;地址&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 添加列到指定位置</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> students <span class="keyword">ADD</span> <span class="keyword">COLUMN</span> birthday <span class="type">DATE</span> COMMENT <span class="string">&#x27;生日&#x27;</span> AFTER age;</span><br><span class="line"><span class="keyword">ALTER TABLE</span> students <span class="keyword">ADD</span> <span class="keyword">COLUMN</span> remark <span class="type">VARCHAR</span>(<span class="number">500</span>) COMMENT <span class="string">&#x27;备注&#x27;</span> <span class="keyword">LAST</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 修改列类型</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> students MODIFY <span class="keyword">COLUMN</span> age TINYINT COMMENT <span class="string">&#x27;年龄&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 修改列名和类型</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> students CHANGE <span class="keyword">COLUMN</span> remark comments TEXT COMMENT <span class="string">&#x27;备注&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 删除列</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> students <span class="keyword">DROP</span> <span class="keyword">COLUMN</span> address;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 添加约束</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> students <span class="keyword">ADD</span> <span class="keyword">UNIQUE</span> (email);</span><br><span class="line"><span class="keyword">ALTER TABLE</span> students <span class="keyword">ADD</span> INDEX idx_name (name);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 删除约束</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> students <span class="keyword">DROP</span> INDEX email;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 修改表名</span></span><br><span class="line">RENAME <span class="keyword">TABLE</span> students <span class="keyword">TO</span> student_info;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 修改表选项</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> student_info ENGINE<span class="operator">=</span>MyISAM;</span><br><span class="line"><span class="keyword">ALTER TABLE</span> student_info CHARSET<span class="operator">=</span>gbk;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 添加外键</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> employees</span><br><span class="line"><span class="keyword">ADD CONSTRAINT</span> fk_emp_dept</span><br><span class="line"><span class="keyword">FOREIGN KEY</span> (dept_id) <span class="keyword">REFERENCES</span> departments(id);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 删除外键</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> employees <span class="keyword">DROP</span> <span class="keyword">FOREIGN KEY</span> fk_emp_dept;</span><br></pre></td></tr></table></figure>

<h3 id="5-2-删除表"><a href="#5-2-删除表" class="headerlink" title="5.2 删除表"></a>5.2 删除表</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 删除表（如果存在）</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> students;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 删除多个表</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> students, departments;</span><br></pre></td></tr></table></figure>

<h3 id="5-3-清空表数据"><a href="#5-3-清空表数据" class="headerlink" title="5.3 清空表数据"></a>5.3 清空表数据</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- DELETE 方式（可回滚，可带 WHERE）</span></span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> students;</span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> students <span class="keyword">WHERE</span> age <span class="operator">&gt;</span> <span class="number">25</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- TRUNCATE 方式（不可回滚，清空全部）</span></span><br><span class="line"><span class="keyword">TRUNCATE</span> <span class="keyword">TABLE</span> students;</span><br></pre></td></tr></table></figure>

<p><strong>DELETE vs TRUNCATE</strong>：</p>
<table>
<thead>
<tr>
<th>对比项</th>
<th>DELETE</th>
<th>TRUNCATE</th>
</tr>
</thead>
<tbody><tr>
<td>类型</td>
<td>DML</td>
<td>DDL</td>
</tr>
<tr>
<td>WHERE 条件</td>
<td>支持</td>
<td>不支持</td>
</tr>
<tr>
<td>返回值</td>
<td>删除行数</td>
<td>无</td>
</tr>
<tr>
<td>自增重置</td>
<td>否</td>
<td>是</td>
</tr>
<tr>
<td>事务回滚</td>
<td>支持</td>
<td>不支持</td>
</tr>
<tr>
<td>速度</td>
<td>慢</td>
<td>快</td>
</tr>
<tr>
<td>触发器</td>
<td>触发</td>
<td>不触发</td>
</tr>
</tbody></table>
<h2 id="六、图形化工具-DataGrip"><a href="#六、图形化工具-DataGrip" class="headerlink" title="六、图形化工具 DataGrip"></a>六、图形化工具 DataGrip</h2><h3 id="6-1-DataGrip-简介"><a href="#6-1-DataGrip-简介" class="headerlink" title="6.1 DataGrip 简介"></a>6.1 DataGrip 简介</h3><p>DataGrip 是 JetBrains 出品的专业数据库管理工具，支持多种数据库：</p>
<ul>
<li>MySQL、PostgreSQL、Oracle</li>
<li>SQL Server、SQLite</li>
<li>Redis、MongoDB（部分支持）</li>
</ul>
<h3 id="6-2-DataGrip-安装"><a href="#6-2-DataGrip-安装" class="headerlink" title="6.2 DataGrip 安装"></a>6.2 DataGrip 安装</h3><ol>
<li>下载地址：<a href="https://www.jetbrains.com/datagrip/">https://www.jetbrains.com/datagrip/</a></li>
<li>选择操作系统版本下载</li>
<li>安装并启动（支持 30 天试用）</li>
<li>学生可使用教育许可免费使用</li>
</ol>
<h3 id="6-3-连接-MySQL-数据库"><a href="#6-3-连接-MySQL-数据库" class="headerlink" title="6.3 连接 MySQL 数据库"></a>6.3 连接 MySQL 数据库</h3><ol>
<li>点击 <strong>File → New → Data Source → MySQL</strong></li>
<li>填写连接信息：<ul>
<li>Host: <code>localhost</code></li>
<li>Port: <code>3306</code></li>
<li>User: <code>root</code></li>
<li>Password: 你的密码</li>
</ul>
</li>
<li>点击 <strong>Test Connection</strong> 测试</li>
<li>点击 <strong>OK</strong> 保存</li>
</ol>
<h3 id="6-4-DataGrip-主要功能"><a href="#6-4-DataGrip-主要功能" class="headerlink" title="6.4 DataGrip 主要功能"></a>6.4 DataGrip 主要功能</h3><h4 id="数据库浏览"><a href="#数据库浏览" class="headerlink" title="数据库浏览"></a>数据库浏览</h4><ul>
<li>左侧 Database 面板查看所有数据库、表、视图</li>
<li>双击表名查看数据</li>
<li>右键表名查看结构、索引、外键</li>
</ul>
<h4 id="SQL-编辑"><a href="#SQL-编辑" class="headerlink" title="SQL 编辑"></a>SQL 编辑</h4><ul>
<li>新建 SQL 文件：右键 → New → SQL File</li>
<li>智能代码补全（Ctrl+Space）</li>
<li>语法高亮和错误提示</li>
<li>格式化代码（Ctrl+Alt+L）</li>
</ul>
<h4 id="执行查询"><a href="#执行查询" class="headerlink" title="执行查询"></a>执行查询</h4><ul>
<li>执行 SQL：Ctrl+Enter 或点击绿色三角</li>
<li>查看执行计划：Ctrl+X</li>
<li>导出查询结果：右键 → Export Data</li>
</ul>
<h4 id="数据编辑"><a href="#数据编辑" class="headerlink" title="数据编辑"></a>数据编辑</h4><ul>
<li>直接在表格中增删改数据</li>
<li>点击 Commit 提交更改</li>
</ul>
<h4 id="版本控制"><a href="#版本控制" class="headerlink" title="版本控制"></a>版本控制</h4><ul>
<li>支持 Git 集成</li>
<li>SQL 文件可版本管理</li>
</ul>
<h3 id="6-5-DataGrip-实用技巧"><a href="#6-5-DataGrip-实用技巧" class="headerlink" title="6.5 DataGrip 实用技巧"></a>6.5 DataGrip 实用技巧</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">-- 常用快捷键</span><br><span class="line">Ctrl+Space      代码补全</span><br><span class="line">Ctrl+Enter      执行 SQL</span><br><span class="line">Alt+Enter       快速修复</span><br><span class="line">Ctrl+/          单行注释</span><br><span class="line">Ctrl+Shift+/    块注释</span><br><span class="line">Ctrl+Alt+L      格式化代码</span><br><span class="line">双击 Shift      搜索任意内容</span><br><span class="line">Ctrl+N          搜索表/视图</span><br></pre></td></tr></table></figure>

<h2 id="七、DDL-综合案例"><a href="#七、DDL-综合案例" class="headerlink" title="七、DDL 综合案例"></a>七、DDL 综合案例</h2><h3 id="7-1-电商数据库设计"><a href="#7-1-电商数据库设计" class="headerlink" title="7.1 电商数据库设计"></a>7.1 电商数据库设计</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 1. 创建数据库</span></span><br><span class="line"><span class="keyword">CREATE</span> DATABASE IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> ecommerce</span><br><span class="line"><span class="keyword">CHARACTER SET</span> utf8mb4</span><br><span class="line"><span class="keyword">COLLATE</span> utf8mb4_unicode_ci;</span><br><span class="line"></span><br><span class="line">USE ecommerce;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 2. 创建用户表</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> users (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT,</span><br><span class="line">    username <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">NOT NULL</span> <span class="keyword">UNIQUE</span> COMMENT <span class="string">&#x27;用户名&#x27;</span>,</span><br><span class="line">    password <span class="type">VARCHAR</span>(<span class="number">255</span>) <span class="keyword">NOT NULL</span> COMMENT <span class="string">&#x27;密码（加密存储）&#x27;</span>,</span><br><span class="line">    email <span class="type">VARCHAR</span>(<span class="number">100</span>) <span class="keyword">UNIQUE</span> COMMENT <span class="string">&#x27;邮箱&#x27;</span>,</span><br><span class="line">    phone <span class="type">VARCHAR</span>(<span class="number">20</span>) COMMENT <span class="string">&#x27;手机号&#x27;</span>,</span><br><span class="line">    avatar <span class="type">VARCHAR</span>(<span class="number">255</span>) COMMENT <span class="string">&#x27;头像 URL&#x27;</span>,</span><br><span class="line">    status TINYINT <span class="keyword">DEFAULT</span> <span class="number">1</span> COMMENT <span class="string">&#x27;状态：1 正常 0 禁用&#x27;</span>,</span><br><span class="line">    create_time DATETIME <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span>,</span><br><span class="line">    update_time DATETIME <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> <span class="keyword">ON</span> <span class="keyword">UPDATE</span> <span class="built_in">CURRENT_TIMESTAMP</span></span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4 COMMENT<span class="operator">=</span><span class="string">&#x27;用户表&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 3. 创建商品分类表</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> categories (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT,</span><br><span class="line">    name <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">NOT NULL</span> COMMENT <span class="string">&#x27;分类名称&#x27;</span>,</span><br><span class="line">    parent_id <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span> COMMENT <span class="string">&#x27;父分类 ID&#x27;</span>,</span><br><span class="line">    sort_order <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span> COMMENT <span class="string">&#x27;排序&#x27;</span>,</span><br><span class="line">    create_time DATETIME <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span>,</span><br><span class="line">    INDEX idx_parent (parent_id)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4 COMMENT<span class="operator">=</span><span class="string">&#x27;商品分类表&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 4. 创建商品表</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> products (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT,</span><br><span class="line">    name <span class="type">VARCHAR</span>(<span class="number">200</span>) <span class="keyword">NOT NULL</span> COMMENT <span class="string">&#x27;商品名称&#x27;</span>,</span><br><span class="line">    description TEXT COMMENT <span class="string">&#x27;商品描述&#x27;</span>,</span><br><span class="line">    category_id <span class="type">INT</span> COMMENT <span class="string">&#x27;分类 ID&#x27;</span>,</span><br><span class="line">    price <span class="type">DECIMAL</span>(<span class="number">10</span>, <span class="number">2</span>) <span class="keyword">NOT NULL</span> COMMENT <span class="string">&#x27;价格&#x27;</span>,</span><br><span class="line">    stock <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span> COMMENT <span class="string">&#x27;库存&#x27;</span>,</span><br><span class="line">    status TINYINT <span class="keyword">DEFAULT</span> <span class="number">1</span> COMMENT <span class="string">&#x27;状态：1 上架 0 下架&#x27;</span>,</span><br><span class="line">    main_image <span class="type">VARCHAR</span>(<span class="number">255</span>) COMMENT <span class="string">&#x27;主图&#x27;</span>,</span><br><span class="line">    create_time DATETIME <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span>,</span><br><span class="line">    update_time DATETIME <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> <span class="keyword">ON</span> <span class="keyword">UPDATE</span> <span class="built_in">CURRENT_TIMESTAMP</span>,</span><br><span class="line"></span><br><span class="line">    <span class="keyword">FOREIGN KEY</span> (category_id) <span class="keyword">REFERENCES</span> categories(id) <span class="keyword">ON</span> <span class="keyword">DELETE</span> <span class="keyword">SET</span> <span class="keyword">NULL</span>,</span><br><span class="line">    INDEX idx_category (category_id),</span><br><span class="line">    INDEX idx_status (status)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4 COMMENT<span class="operator">=</span><span class="string">&#x27;商品表&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 5. 创建订单表</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> orders (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT,</span><br><span class="line">    order_no <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">NOT NULL</span> <span class="keyword">UNIQUE</span> COMMENT <span class="string">&#x27;订单号&#x27;</span>,</span><br><span class="line">    user_id <span class="type">INT</span> <span class="keyword">NOT NULL</span> COMMENT <span class="string">&#x27;用户 ID&#x27;</span>,</span><br><span class="line">    total_amount <span class="type">DECIMAL</span>(<span class="number">10</span>, <span class="number">2</span>) <span class="keyword">NOT NULL</span> COMMENT <span class="string">&#x27;订单金额&#x27;</span>,</span><br><span class="line">    status TINYINT <span class="keyword">DEFAULT</span> <span class="number">0</span> COMMENT <span class="string">&#x27;状态：0 待支付 1 已支付 2 发货 3 完成 4 取消&#x27;</span>,</span><br><span class="line">    shipping_address TEXT COMMENT <span class="string">&#x27;收货地址&#x27;</span>,</span><br><span class="line">    create_time DATETIME <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span>,</span><br><span class="line">    update_time DATETIME <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> <span class="keyword">ON</span> <span class="keyword">UPDATE</span> <span class="built_in">CURRENT_TIMESTAMP</span>,</span><br><span class="line"></span><br><span class="line">    <span class="keyword">FOREIGN KEY</span> (user_id) <span class="keyword">REFERENCES</span> users(id),</span><br><span class="line">    INDEX idx_user (user_id),</span><br><span class="line">    INDEX idx_status (status)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4 COMMENT<span class="operator">=</span><span class="string">&#x27;订单表&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 6. 创建订单明细表</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> order_items (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT,</span><br><span class="line">    order_id <span class="type">INT</span> <span class="keyword">NOT NULL</span> COMMENT <span class="string">&#x27;订单 ID&#x27;</span>,</span><br><span class="line">    product_id <span class="type">INT</span> <span class="keyword">NOT NULL</span> COMMENT <span class="string">&#x27;商品 ID&#x27;</span>,</span><br><span class="line">    product_name <span class="type">VARCHAR</span>(<span class="number">200</span>) <span class="keyword">NOT NULL</span> COMMENT <span class="string">&#x27;商品名称（冗余）&#x27;</span>,</span><br><span class="line">    price <span class="type">DECIMAL</span>(<span class="number">10</span>, <span class="number">2</span>) <span class="keyword">NOT NULL</span> COMMENT <span class="string">&#x27;单价&#x27;</span>,</span><br><span class="line">    quantity <span class="type">INT</span> <span class="keyword">NOT NULL</span> <span class="keyword">DEFAULT</span> <span class="number">1</span> COMMENT <span class="string">&#x27;数量&#x27;</span>,</span><br><span class="line">    subtotal <span class="type">DECIMAL</span>(<span class="number">10</span>, <span class="number">2</span>) <span class="keyword">NOT NULL</span> COMMENT <span class="string">&#x27;小计&#x27;</span>,</span><br><span class="line"></span><br><span class="line">    <span class="keyword">FOREIGN KEY</span> (order_id) <span class="keyword">REFERENCES</span> orders(id) <span class="keyword">ON</span> <span class="keyword">DELETE</span> CASCADE,</span><br><span class="line">    <span class="keyword">FOREIGN KEY</span> (product_id) <span class="keyword">REFERENCES</span> products(id),</span><br><span class="line">    INDEX idx_order (order_id)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4 COMMENT<span class="operator">=</span><span class="string">&#x27;订单明细表&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h2 id="八、小结"><a href="#八、小结" class="headerlink" title="八、小结"></a>八、小结</h2><p>本文我们系统学习了 DDL 的各个方面：</p>
<h3 id="知识点回顾"><a href="#知识点回顾" class="headerlink" title="知识点回顾"></a>知识点回顾</h3><ol>
<li><p><strong>数据库操作</strong></p>
<ul>
<li>CREATE DATABASE &#x2F; DROP DATABASE &#x2F; ALTER DATABASE &#x2F; USE</li>
</ul>
</li>
<li><p><strong>表操作</strong></p>
<ul>
<li>CREATE TABLE &#x2F; ALTER TABLE &#x2F; DROP TABLE &#x2F; TRUNCATE &#x2F; RENAME</li>
</ul>
</li>
<li><p><strong>数据类型</strong></p>
<ul>
<li>数值类型：TINYINT、INT、BIGINT、DECIMAL、FLOAT、DOUBLE</li>
<li>字符串类型：CHAR、VARCHAR、TEXT、BLOB</li>
<li>日期时间类型：DATE、TIME、DATETIME、TIMESTAMP、YEAR</li>
</ul>
</li>
<li><p><strong>约束条件</strong></p>
<ul>
<li>PRIMARY KEY、AUTO_INCREMENT、NOT NULL、UNIQUE、DEFAULT、FOREIGN KEY</li>
</ul>
</li>
<li><p><strong>图形化工具</strong></p>
<ul>
<li>DataGrip 的安装、连接、主要功能和快捷键</li>
</ul>
</li>
</ol>
<h3 id="DDL-命令速查"><a href="#DDL-命令速查" class="headerlink" title="DDL 命令速查"></a>DDL 命令速查</h3><table>
<thead>
<tr>
<th>操作类型</th>
<th>命令</th>
</tr>
</thead>
<tbody><tr>
<td>数据库</td>
<td>CREATE DATABASE、DROP DATABASE、ALTER DATABASE、USE</td>
</tr>
<tr>
<td>表</td>
<td>CREATE TABLE、DROP TABLE、ALTER TABLE、RENAME TABLE、TRUNCATE TABLE</td>
</tr>
<tr>
<td>列</td>
<td>ADD COLUMN、MODIFY COLUMN、CHANGE COLUMN、DROP COLUMN</td>
</tr>
<tr>
<td>约束</td>
<td>ADD PRIMARY KEY、ADD UNIQUE、ADD FOREIGN KEY、DROP INDEX</td>
</tr>
</tbody></table>
<hr>
<p><strong>下一篇</strong>：[MySQL 基础教程（三）：DML 数据操作语言详解](&#x2F;2026&#x2F;02&#x2F;23&#x2F;MySQL 基础教程（三）DML 数据操作语言详解&#x2F;)</p>
<p><strong>上一篇</strong>：[MySQL 基础教程（一）：数据库基础与环境搭建](&#x2F;2026&#x2F;02&#x2F;23&#x2F;MySQL 基础教程（一）数据库基础与环境搭建&#x2F;)</p>
]]></content>
      <categories>
        <category>MySQL 基础教程</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
        <tag>DDL</tag>
        <tag>数据库操作</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQL 基础教程（四）DQL 数据查询语言详解（下）</title>
    <url>/2026/02/23/MySQL%20%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B%EF%BC%88%E5%9B%9B%EF%BC%89DQL%20%E6%95%B0%E6%8D%AE%E6%9F%A5%E8%AF%A2%E8%AF%AD%E8%A8%80%E8%AF%A6%E8%A7%A3%EF%BC%88%E4%B8%8B%EF%BC%89/</url>
    <content><![CDATA[<h1 id="MySQL-基础教程（四）DQL-数据查询语言详解（下）"><a href="#MySQL-基础教程（四）DQL-数据查询语言详解（下）" class="headerlink" title="MySQL 基础教程（四）DQL 数据查询语言详解（下）"></a>MySQL 基础教程（四）DQL 数据查询语言详解（下）</h1><p>承接上文，本文继续讲解 DQL 的排序查询、分页查询、综合案例以及 SQL 执行顺序。</p>
<h2 id="七、排序查询（ORDER-BY）"><a href="#七、排序查询（ORDER-BY）" class="headerlink" title="七、排序查询（ORDER BY）"></a>七、排序查询（ORDER BY）</h2><p>ORDER BY 用于对查询结果进行排序。</p>
<h3 id="7-1-基础排序"><a href="#7-1-基础排序" class="headerlink" title="7.1 基础排序"></a>7.1 基础排序</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 升序排序（ASC，默认）</span></span><br><span class="line"><span class="keyword">SELECT</span> name, salary <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> salary <span class="keyword">ASC</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 降序排序（DESC）</span></span><br><span class="line"><span class="keyword">SELECT</span> name, salary <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> salary <span class="keyword">DESC</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 按字符串排序</span></span><br><span class="line"><span class="keyword">SELECT</span> name <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> name <span class="keyword">ASC</span>;  <span class="comment">-- 按拼音排序</span></span><br></pre></td></tr></table></figure>

<h3 id="7-2-多列排序"><a href="#7-2-多列排序" class="headerlink" title="7.2 多列排序"></a>7.2 多列排序</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 先按部门排序，部门相同按工资降序</span></span><br><span class="line"><span class="keyword">SELECT</span> name, dept_id, salary</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> dept_id <span class="keyword">ASC</span>, salary <span class="keyword">DESC</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 先按在职状态排序，再按工资降序</span></span><br><span class="line"><span class="keyword">SELECT</span> name, status, salary</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> status <span class="keyword">DESC</span>, salary <span class="keyword">DESC</span>;</span><br></pre></td></tr></table></figure>

<h3 id="7-3-使用列别名排序"><a href="#7-3-使用列别名排序" class="headerlink" title="7.3 使用列别名排序"></a>7.3 使用列别名排序</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 使用别名排序</span></span><br><span class="line"><span class="keyword">SELECT</span> name, salary <span class="keyword">AS</span> monthly_salary</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> monthly_salary <span class="keyword">DESC</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 使用列位置排序（不推荐，易出错）</span></span><br><span class="line"><span class="keyword">SELECT</span> name, salary <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="number">2</span> <span class="keyword">DESC</span>;  <span class="comment">-- 2 表示第 2 列</span></span><br></pre></td></tr></table></figure>

<h3 id="7-4-使用表达式排序"><a href="#7-4-使用表达式排序" class="headerlink" title="7.4 使用表达式排序"></a>7.4 使用表达式排序</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 按年薪排序</span></span><br><span class="line"><span class="keyword">SELECT</span> name, salary, salary <span class="operator">*</span> <span class="number">12</span> <span class="keyword">AS</span> annual_salary</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> annual_salary <span class="keyword">DESC</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 按工龄排序（假设现在是 2026 年）</span></span><br><span class="line"><span class="keyword">SELECT</span> name, hire_date, <span class="number">2026</span> <span class="operator">-</span> <span class="keyword">YEAR</span>(hire_date) <span class="keyword">AS</span> work_years</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> work_years <span class="keyword">DESC</span>;</span><br></pre></td></tr></table></figure>

<h3 id="7-5-NULL-值排序"><a href="#7-5-NULL-值排序" class="headerlink" title="7.5 NULL 值排序"></a>7.5 NULL 值排序</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- NULL 值默认排在最前（升序）或最后（降序）</span></span><br><span class="line"><span class="keyword">SELECT</span> name, dept_id <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> dept_id <span class="keyword">ASC</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- MySQL 8.0.13+ 支持 NULLS FIRST/LAST</span></span><br><span class="line"><span class="keyword">SELECT</span> name, dept_id <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> dept_id <span class="keyword">ASC</span> <span class="keyword">NULLS LAST</span>;</span><br></pre></td></tr></table></figure>

<h3 id="7-6-自定义排序顺序"><a href="#7-6-自定义排序顺序" class="headerlink" title="7.6 自定义排序顺序"></a>7.6 自定义排序顺序</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 按指定顺序排序（FIELD 函数）</span></span><br><span class="line"><span class="keyword">SELECT</span> name, dept_id <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> FIELD(dept_id, <span class="number">2</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">4</span>);  <span class="comment">-- 按 2→1→3→4 的顺序</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 按特定顺序排序（CASE 表达式）</span></span><br><span class="line"><span class="keyword">SELECT</span> name, dept_id <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span></span><br><span class="line">    <span class="keyword">CASE</span> dept_id</span><br><span class="line">        <span class="keyword">WHEN</span> <span class="number">2</span> <span class="keyword">THEN</span> <span class="number">1</span></span><br><span class="line">        <span class="keyword">WHEN</span> <span class="number">1</span> <span class="keyword">THEN</span> <span class="number">2</span></span><br><span class="line">        <span class="keyword">WHEN</span> <span class="number">3</span> <span class="keyword">THEN</span> <span class="number">3</span></span><br><span class="line">        <span class="keyword">ELSE</span> <span class="number">4</span></span><br><span class="line">    <span class="keyword">END</span>;</span><br></pre></td></tr></table></figure>

<h2 id="八、分页查询（LIMIT）"><a href="#八、分页查询（LIMIT）" class="headerlink" title="八、分页查询（LIMIT）"></a>八、分页查询（LIMIT）</h2><p>LIMIT 用于限制返回的记录数，常用于分页场景。</p>
<h3 id="8-1-基础分页"><a href="#8-1-基础分页" class="headerlink" title="8.1 基础分页"></a>8.1 基础分页</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 返回前 5 条记录</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees LIMIT <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 从第 3 条开始，返回 5 条记录</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees LIMIT <span class="number">2</span>, <span class="number">5</span>;  <span class="comment">-- 从偏移量 2 开始（第 3 条）</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 等价写法：LIMIT offset, count</span></span><br><span class="line"><span class="comment">-- 偏移量从 0 开始</span></span><br></pre></td></tr></table></figure>

<h3 id="8-2-分页公式"><a href="#8-2-分页公式" class="headerlink" title="8.2 分页公式"></a>8.2 分页公式</h3><p>分页查询的通用公式：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">LIMIT (页码 <span class="operator">-</span> <span class="number">1</span>) <span class="operator">*</span> 每页条数，每页条数</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 第 1 页，每页 5 条</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees LIMIT <span class="number">0</span>, <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 第 2 页，每页 5 条</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees LIMIT <span class="number">5</span>, <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 第 3 页，每页 5 条</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees LIMIT <span class="number">10</span>, <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 第 n 页，每页 5 条</span></span><br><span class="line"><span class="comment">-- LIMIT (n-1)*5, 5</span></span><br></pre></td></tr></table></figure>

<h3 id="8-3-分页实战"><a href="#8-3-分页实战" class="headerlink" title="8.3 分页实战"></a>8.3 分页实战</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 按工资降序，分页显示员工</span></span><br><span class="line"><span class="comment">-- 第 1 页：工资最高的 5 人</span></span><br><span class="line"><span class="keyword">SELECT</span> name, salary <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> salary <span class="keyword">DESC</span></span><br><span class="line">LIMIT <span class="number">0</span>, <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 第 2 页：工资第 6-10 的人</span></span><br><span class="line"><span class="keyword">SELECT</span> name, salary <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> salary <span class="keyword">DESC</span></span><br><span class="line">LIMIT <span class="number">5</span>, <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 带条件的分页：查询技术部员工，分页显示</span></span><br><span class="line"><span class="keyword">SELECT</span> name, dept_id, salary <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> dept_id <span class="operator">=</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> salary <span class="keyword">DESC</span></span><br><span class="line">LIMIT <span class="number">0</span>, <span class="number">5</span>;</span><br></pre></td></tr></table></figure>

<h3 id="8-4-LIMIT-的另一种写法"><a href="#8-4-LIMIT-的另一种写法" class="headerlink" title="8.4 LIMIT 的另一种写法"></a>8.4 LIMIT 的另一种写法</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- LIMIT offset, count</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees LIMIT <span class="number">0</span>, <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 等价于 LIMIT count OFFSET offset</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees LIMIT <span class="number">5</span> <span class="keyword">OFFSET</span> <span class="number">0</span>;</span><br></pre></td></tr></table></figure>

<h3 id="8-5-大数据量分页优化"><a href="#8-5-大数据量分页优化" class="headerlink" title="8.5 大数据量分页优化"></a>8.5 大数据量分页优化</h3><p>当数据量很大时，传统的 <code>LIMIT 1000000, 10</code> 会很慢，因为 MySQL 需要扫描前 1000000 条记录。</p>
<p><strong>优化方案 1：延迟关联</strong></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 原始查询（慢）</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> id</span><br><span class="line">LIMIT <span class="number">1000000</span>, <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 优化后（快）</span></span><br><span class="line"><span class="keyword">SELECT</span> e.<span class="operator">*</span> <span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> id <span class="keyword">FROM</span> employees <span class="keyword">ORDER</span> <span class="keyword">BY</span> id LIMIT <span class="number">1000000</span>, <span class="number">10</span></span><br><span class="line">) tmp <span class="keyword">ON</span> e.id <span class="operator">=</span> tmp.id;</span><br></pre></td></tr></table></figure>

<p><strong>优化方案 2：利用覆盖索引</strong></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 如果只需查询 id 和 name</span></span><br><span class="line"><span class="keyword">SELECT</span> id, name <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> id <span class="operator">&gt;</span> <span class="number">1000000</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> id</span><br><span class="line">LIMIT <span class="number">10</span>;</span><br></pre></td></tr></table></figure>

<p><strong>优化方案 3：记录上次查询的最大 ID</strong></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 首次查询</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees <span class="keyword">ORDER</span> <span class="keyword">BY</span> id LIMIT <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 记录最后一条的 id = 10</span></span><br><span class="line"><span class="comment">-- 下次查询</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> id <span class="operator">&gt;</span> <span class="number">10</span> <span class="keyword">ORDER</span> <span class="keyword">BY</span> id LIMIT <span class="number">10</span>;</span><br></pre></td></tr></table></figure>

<h2 id="九、多表连接查询"><a href="#九、多表连接查询" class="headerlink" title="九、多表连接查询"></a>九、多表连接查询</h2><h3 id="9-1-内连接（INNER-JOIN）"><a href="#9-1-内连接（INNER-JOIN）" class="headerlink" title="9.1 内连接（INNER JOIN）"></a>9.1 内连接（INNER JOIN）</h3><p>内连接返回两个表中匹配的行。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 查询员工及其所属部门</span></span><br><span class="line"><span class="keyword">SELECT</span> e.name, e.salary, d.dept_name</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> departments d <span class="keyword">ON</span> e.dept_id <span class="operator">=</span> d.id;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 等价写法（INNER 可以省略）</span></span><br><span class="line"><span class="keyword">SELECT</span> e.name, d.dept_name</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">JOIN</span> departments d <span class="keyword">ON</span> e.dept_id <span class="operator">=</span> d.id;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 多表连接</span></span><br><span class="line"><span class="keyword">SELECT</span> e.name, d.dept_name, d.dept_location</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">JOIN</span> departments d <span class="keyword">ON</span> e.dept_id <span class="operator">=</span> d.id</span><br><span class="line"><span class="keyword">WHERE</span> e.salary <span class="operator">&gt;</span> <span class="number">8000</span>;</span><br></pre></td></tr></table></figure>

<h3 id="9-2-左连接（LEFT-JOIN）"><a href="#9-2-左连接（LEFT-JOIN）" class="headerlink" title="9.2 左连接（LEFT JOIN）"></a>9.2 左连接（LEFT JOIN）</h3><p>左连接返回左表的所有行，右表没有匹配的填充 NULL。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 查询所有部门及其员工（包括没有员工的部门）</span></span><br><span class="line"><span class="keyword">SELECT</span> d.dept_name, e.name, e.salary</span><br><span class="line"><span class="keyword">FROM</span> departments d</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> employees e <span class="keyword">ON</span> d.id <span class="operator">=</span> e.dept_id;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询没有员工的部门</span></span><br><span class="line"><span class="keyword">SELECT</span> d.dept_name</span><br><span class="line"><span class="keyword">FROM</span> departments d</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> employees e <span class="keyword">ON</span> d.id <span class="operator">=</span> e.dept_id</span><br><span class="line"><span class="keyword">WHERE</span> e.id <span class="keyword">IS</span> <span class="keyword">NULL</span>;</span><br></pre></td></tr></table></figure>

<h3 id="9-3-右连接（RIGHT-JOIN）"><a href="#9-3-右连接（RIGHT-JOIN）" class="headerlink" title="9.3 右连接（RIGHT JOIN）"></a>9.3 右连接（RIGHT JOIN）</h3><p>右连接返回右表的所有行，左表没有匹配的填充 NULL。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 查询所有员工及其部门（包括没有员工的部门）</span></span><br><span class="line"><span class="keyword">SELECT</span> e.name, d.dept_name</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">RIGHT</span> <span class="keyword">JOIN</span> departments d <span class="keyword">ON</span> e.dept_id <span class="operator">=</span> d.id;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 等价于</span></span><br><span class="line"><span class="keyword">SELECT</span> e.name, d.dept_name</span><br><span class="line"><span class="keyword">FROM</span> departments d</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> employees e <span class="keyword">ON</span> e.dept_id <span class="operator">=</span> d.id;</span><br></pre></td></tr></table></figure>

<h3 id="9-4-交叉连接（CROSS-JOIN）"><a href="#9-4-交叉连接（CROSS-JOIN）" class="headerlink" title="9.4 交叉连接（CROSS JOIN）"></a>9.4 交叉连接（CROSS JOIN）</h3><p>交叉连接返回两个表的笛卡尔积。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 交叉连接</span></span><br><span class="line"><span class="keyword">SELECT</span> e.name, d.dept_name</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">CROSS</span> <span class="keyword">JOIN</span> departments d;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 等价于（不写条件）</span></span><br><span class="line"><span class="keyword">SELECT</span> e.name, d.dept_name</span><br><span class="line"><span class="keyword">FROM</span> employees e, departments d;</span><br></pre></td></tr></table></figure>

<h3 id="9-5-自连接（SELF-JOIN）"><a href="#9-5-自连接（SELF-JOIN）" class="headerlink" title="9.5 自连接（SELF JOIN）"></a>9.5 自连接（SELF JOIN）</h3><p>表自己连接自己，常用于层级数据。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 创建带上级领导的员工表</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> employees_with_manager;</span><br><span class="line"><span class="keyword">CREATE TABLE</span> employees_with_manager (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span>,</span><br><span class="line">    name <span class="type">VARCHAR</span>(<span class="number">50</span>),</span><br><span class="line">    manager_id <span class="type">INT</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT INTO</span> employees_with_manager <span class="keyword">VALUES</span></span><br><span class="line">(<span class="number">1</span>, <span class="string">&#x27;张三&#x27;</span>, <span class="keyword">NULL</span>),</span><br><span class="line">(<span class="number">2</span>, <span class="string">&#x27;李四&#x27;</span>, <span class="number">1</span>),</span><br><span class="line">(<span class="number">3</span>, <span class="string">&#x27;王五&#x27;</span>, <span class="number">1</span>),</span><br><span class="line">(<span class="number">4</span>, <span class="string">&#x27;赵六&#x27;</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询员工及其上级领导</span></span><br><span class="line"><span class="keyword">SELECT</span> e.name <span class="keyword">AS</span> 员工，m.name <span class="keyword">AS</span> 上级领导</span><br><span class="line"><span class="keyword">FROM</span> employees_with_manager e</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> employees_with_manager m <span class="keyword">ON</span> e.manager_id <span class="operator">=</span> m.id;</span><br></pre></td></tr></table></figure>

<h2 id="十、子查询"><a href="#十、子查询" class="headerlink" title="十、子查询"></a>十、子查询</h2><p>子查询是嵌套在其他 SQL 语句中的查询。</p>
<h3 id="10-1-WHERE-子句中的子查询"><a href="#10-1-WHERE-子句中的子查询" class="headerlink" title="10.1 WHERE 子句中的子查询"></a>10.1 WHERE 子句中的子查询</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 查询工资高于平均工资的员工</span></span><br><span class="line"><span class="keyword">SELECT</span> name, salary <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> salary <span class="operator">&gt;</span> (<span class="keyword">SELECT</span> <span class="built_in">AVG</span>(salary) <span class="keyword">FROM</span> employees);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询工资最高的员工</span></span><br><span class="line"><span class="keyword">SELECT</span> name, salary <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> salary <span class="operator">=</span> (<span class="keyword">SELECT</span> <span class="built_in">MAX</span>(salary) <span class="keyword">FROM</span> employees);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询不在职的员工</span></span><br><span class="line"><span class="keyword">SELECT</span> name <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> id <span class="keyword">NOT</span> <span class="keyword">IN</span> (<span class="keyword">SELECT</span> id <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> status <span class="operator">=</span> <span class="number">1</span>);</span><br></pre></td></tr></table></figure>

<h3 id="10-2-FROM-子句中的子查询"><a href="#10-2-FROM-子句中的子查询" class="headerlink" title="10.2 FROM 子句中的子查询"></a>10.2 FROM 子句中的子查询</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 查询各部门平均工资及高于平均工资的员工</span></span><br><span class="line"><span class="keyword">SELECT</span> e.name, e.salary, d.avg_salary</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">JOIN</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> dept_id, <span class="built_in">AVG</span>(salary) <span class="keyword">AS</span> avg_salary</span><br><span class="line">    <span class="keyword">FROM</span> employees</span><br><span class="line">    <span class="keyword">GROUP</span> <span class="keyword">BY</span> dept_id</span><br><span class="line">) d <span class="keyword">ON</span> e.dept_id <span class="operator">=</span> d.dept_id</span><br><span class="line"><span class="keyword">WHERE</span> e.salary <span class="operator">&gt;</span> d.avg_salary;</span><br></pre></td></tr></table></figure>

<h3 id="10-3-SELECT-子句中的子查询"><a href="#10-3-SELECT-子句中的子查询" class="headerlink" title="10.3 SELECT 子句中的子查询"></a>10.3 SELECT 子句中的子查询</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 查询员工信息及公司平均工资</span></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    name,</span><br><span class="line">    salary,</span><br><span class="line">    (<span class="keyword">SELECT</span> <span class="built_in">AVG</span>(salary) <span class="keyword">FROM</span> employees) <span class="keyword">AS</span> 公司平均工资,</span><br><span class="line">    salary <span class="operator">-</span> (<span class="keyword">SELECT</span> <span class="built_in">AVG</span>(salary) <span class="keyword">FROM</span> employees) <span class="keyword">AS</span> 差异</span><br><span class="line"><span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>

<h3 id="10-4-EXISTS-子查询"><a href="#10-4-EXISTS-子查询" class="headerlink" title="10.4 EXISTS 子查询"></a>10.4 EXISTS 子查询</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 查询有员工的部门</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> departments d</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">EXISTS</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> <span class="number">1</span> <span class="keyword">FROM</span> employees e <span class="keyword">WHERE</span> e.dept_id <span class="operator">=</span> d.id</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 等价于</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> departments d</span><br><span class="line"><span class="keyword">WHERE</span> d.id <span class="keyword">IN</span> (<span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> dept_id <span class="keyword">FROM</span> employees);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询没有员工的部门</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> departments d</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> <span class="number">1</span> <span class="keyword">FROM</span> employees e <span class="keyword">WHERE</span> e.dept_id <span class="operator">=</span> d.id</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h2 id="十一、综合案例练习"><a href="#十一、综合案例练习" class="headerlink" title="十一、综合案例练习"></a>十一、综合案例练习</h2><h3 id="11-1-准备数据"><a href="#11-1-准备数据" class="headerlink" title="11.1 准备数据"></a>11.1 准备数据</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 学生表</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> students;</span><br><span class="line"><span class="keyword">CREATE TABLE</span> students (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT,</span><br><span class="line">    name <span class="type">VARCHAR</span>(<span class="number">50</span>),</span><br><span class="line">    gender ENUM(<span class="string">&#x27;男&#x27;</span>, <span class="string">&#x27;女&#x27;</span>),</span><br><span class="line">    class_id <span class="type">INT</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 课程表</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> courses;</span><br><span class="line"><span class="keyword">CREATE TABLE</span> courses (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT,</span><br><span class="line">    course_name <span class="type">VARCHAR</span>(<span class="number">50</span>),</span><br><span class="line">    credit <span class="type">INT</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 成绩表</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> scores;</span><br><span class="line"><span class="keyword">CREATE TABLE</span> scores (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT,</span><br><span class="line">    student_id <span class="type">INT</span>,</span><br><span class="line">    course_id <span class="type">INT</span>,</span><br><span class="line">    score <span class="type">DECIMAL</span>(<span class="number">5</span>, <span class="number">2</span>),</span><br><span class="line">    <span class="keyword">FOREIGN KEY</span> (student_id) <span class="keyword">REFERENCES</span> students(id),</span><br><span class="line">    <span class="keyword">FOREIGN KEY</span> (course_id) <span class="keyword">REFERENCES</span> courses(id)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 插入数据</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> students (name, gender, class_id) <span class="keyword">VALUES</span></span><br><span class="line">(<span class="string">&#x27;张三&#x27;</span>, <span class="string">&#x27;男&#x27;</span>, <span class="number">1</span>), (<span class="string">&#x27;李四&#x27;</span>, <span class="string">&#x27;女&#x27;</span>, <span class="number">1</span>), (<span class="string">&#x27;王五&#x27;</span>, <span class="string">&#x27;男&#x27;</span>, <span class="number">2</span>),</span><br><span class="line">(<span class="string">&#x27;赵六&#x27;</span>, <span class="string">&#x27;女&#x27;</span>, <span class="number">2</span>), (<span class="string">&#x27;孙七&#x27;</span>, <span class="string">&#x27;男&#x27;</span>, <span class="number">1</span>), (<span class="string">&#x27;周八&#x27;</span>, <span class="string">&#x27;女&#x27;</span>, <span class="number">3</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT INTO</span> courses (course_name, credit) <span class="keyword">VALUES</span></span><br><span class="line">(<span class="string">&#x27;MySQL 基础&#x27;</span>, <span class="number">3</span>), (<span class="string">&#x27;Java 编程&#x27;</span>, <span class="number">4</span>), (<span class="string">&#x27;数据结构&#x27;</span>, <span class="number">4</span>), (<span class="string">&#x27;操作系统&#x27;</span>, <span class="number">3</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT INTO</span> scores (student_id, course_id, score) <span class="keyword">VALUES</span></span><br><span class="line">(<span class="number">1</span>, <span class="number">1</span>, <span class="number">85</span>), (<span class="number">1</span>, <span class="number">2</span>, <span class="number">90</span>), (<span class="number">1</span>, <span class="number">3</span>, <span class="number">78</span>),</span><br><span class="line">(<span class="number">2</span>, <span class="number">1</span>, <span class="number">92</span>), (<span class="number">2</span>, <span class="number">2</span>, <span class="number">88</span>), (<span class="number">2</span>, <span class="number">4</span>, <span class="number">95</span>),</span><br><span class="line">(<span class="number">3</span>, <span class="number">1</span>, <span class="number">75</span>), (<span class="number">3</span>, <span class="number">3</span>, <span class="number">82</span>),</span><br><span class="line">(<span class="number">4</span>, <span class="number">2</span>, <span class="number">88</span>), (<span class="number">4</span>, <span class="number">4</span>, <span class="number">91</span>),</span><br><span class="line">(<span class="number">5</span>, <span class="number">1</span>, <span class="number">60</span>), (<span class="number">5</span>, <span class="number">2</span>, <span class="number">65</span>), (<span class="number">5</span>, <span class="number">3</span>, <span class="number">70</span>);</span><br></pre></td></tr></table></figure>

<h3 id="11-2-案例练习"><a href="#11-2-案例练习" class="headerlink" title="11.2 案例练习"></a>11.2 案例练习</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 练习 1：查询所有学生的姓名、性别、班级 ID</span></span><br><span class="line"><span class="keyword">SELECT</span> name, gender, class_id <span class="keyword">FROM</span> students;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 练习 2：查询女生名单</span></span><br><span class="line"><span class="keyword">SELECT</span> name <span class="keyword">FROM</span> students <span class="keyword">WHERE</span> gender <span class="operator">=</span> <span class="string">&#x27;女&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 练习 3：查询成绩大于 80 分的学生姓名和课程名</span></span><br><span class="line"><span class="keyword">SELECT</span> s.name, c.course_name, sc.score</span><br><span class="line"><span class="keyword">FROM</span> students s</span><br><span class="line"><span class="keyword">JOIN</span> scores sc <span class="keyword">ON</span> s.id <span class="operator">=</span> sc.student_id</span><br><span class="line"><span class="keyword">JOIN</span> courses c <span class="keyword">ON</span> sc.course_id <span class="operator">=</span> c.id</span><br><span class="line"><span class="keyword">WHERE</span> sc.score <span class="operator">&gt;</span> <span class="number">80</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 练习 4：查询每个学生的平均分</span></span><br><span class="line"><span class="keyword">SELECT</span> s.name, ROUND(<span class="built_in">AVG</span>(sc.score), <span class="number">2</span>) <span class="keyword">AS</span> 平均分</span><br><span class="line"><span class="keyword">FROM</span> students s</span><br><span class="line"><span class="keyword">JOIN</span> scores sc <span class="keyword">ON</span> s.id <span class="operator">=</span> sc.student_id</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> s.id, s.name;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 练习 5：查询平均分大于 80 的学生</span></span><br><span class="line"><span class="keyword">SELECT</span> s.name, ROUND(<span class="built_in">AVG</span>(sc.score), <span class="number">2</span>) <span class="keyword">AS</span> 平均分</span><br><span class="line"><span class="keyword">FROM</span> students s</span><br><span class="line"><span class="keyword">JOIN</span> scores sc <span class="keyword">ON</span> s.id <span class="operator">=</span> sc.student_id</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> s.id, s.name</span><br><span class="line"><span class="keyword">HAVING</span> <span class="built_in">AVG</span>(sc.score) <span class="operator">&gt;</span> <span class="number">80</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 练习 6：查询每门课程的平均分</span></span><br><span class="line"><span class="keyword">SELECT</span> c.course_name, ROUND(<span class="built_in">AVG</span>(sc.score), <span class="number">2</span>) <span class="keyword">AS</span> 平均分</span><br><span class="line"><span class="keyword">FROM</span> courses c</span><br><span class="line"><span class="keyword">JOIN</span> scores sc <span class="keyword">ON</span> c.id <span class="operator">=</span> sc.course_id</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> c.id, c.course_name;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 练习 7：查询成绩最高的学生姓名、课程名和分数</span></span><br><span class="line"><span class="keyword">SELECT</span> s.name, c.course_name, sc.score</span><br><span class="line"><span class="keyword">FROM</span> students s</span><br><span class="line"><span class="keyword">JOIN</span> scores sc <span class="keyword">ON</span> s.id <span class="operator">=</span> sc.student_id</span><br><span class="line"><span class="keyword">JOIN</span> courses c <span class="keyword">ON</span> sc.course_id <span class="operator">=</span> c.id</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> sc.score <span class="keyword">DESC</span></span><br><span class="line">LIMIT <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 练习 8：查询至少选修了 2 门课程的学生</span></span><br><span class="line"><span class="keyword">SELECT</span> s.name, <span class="built_in">COUNT</span>(sc.course_id) <span class="keyword">AS</span> 选课数</span><br><span class="line"><span class="keyword">FROM</span> students s</span><br><span class="line"><span class="keyword">JOIN</span> scores sc <span class="keyword">ON</span> s.id <span class="operator">=</span> sc.student_id</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> s.id, s.name</span><br><span class="line"><span class="keyword">HAVING</span> <span class="built_in">COUNT</span>(sc.course_id) <span class="operator">&gt;=</span> <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 练习 9：查询没有选课的学生</span></span><br><span class="line"><span class="keyword">SELECT</span> name <span class="keyword">FROM</span> students</span><br><span class="line"><span class="keyword">WHERE</span> id <span class="keyword">NOT</span> <span class="keyword">IN</span> (<span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> student_id <span class="keyword">FROM</span> scores);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 练习 10：查询每个班级的学生人数</span></span><br><span class="line"><span class="keyword">SELECT</span> class_id, <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">AS</span> 人数</span><br><span class="line"><span class="keyword">FROM</span> students</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> class_id;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 练习 11：查询班级平均成绩</span></span><br><span class="line"><span class="keyword">SELECT</span> s.class_id, ROUND(<span class="built_in">AVG</span>(sc.score), <span class="number">2</span>) <span class="keyword">AS</span> 班级平均分</span><br><span class="line"><span class="keyword">FROM</span> students s</span><br><span class="line"><span class="keyword">JOIN</span> scores sc <span class="keyword">ON</span> s.id <span class="operator">=</span> sc.student_id</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> s.class_id;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 练习 12：综合查询（分页）</span></span><br><span class="line"><span class="keyword">SELECT</span> s.name, c.course_name, sc.score</span><br><span class="line"><span class="keyword">FROM</span> students s</span><br><span class="line"><span class="keyword">JOIN</span> scores sc <span class="keyword">ON</span> s.id <span class="operator">=</span> sc.student_id</span><br><span class="line"><span class="keyword">JOIN</span> courses c <span class="keyword">ON</span> sc.course_id <span class="operator">=</span> c.id</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> sc.score <span class="keyword">DESC</span></span><br><span class="line">LIMIT <span class="number">0</span>, <span class="number">10</span>;</span><br></pre></td></tr></table></figure>

<h2 id="十二、DQL-执行顺序"><a href="#十二、DQL-执行顺序" class="headerlink" title="十二、DQL 执行顺序"></a>十二、DQL 执行顺序</h2><p>理解 SQL 的执行顺序对于编写高效查询至关重要。</p>
<h3 id="12-1-完整执行顺序"><a href="#12-1-完整执行顺序" class="headerlink" title="12.1 完整执行顺序"></a>12.1 完整执行顺序</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">FROM → JOIN → WHERE → GROUP BY → HAVING → SELECT → DISTINCT → ORDER BY → LIMIT</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">(1) FROM 表名</span><br><span class="line">(2) [JOIN 表名 ON 连接条件]</span><br><span class="line">(3) WHERE 条件</span><br><span class="line">(4) GROUP BY 分组列</span><br><span class="line">(5) HAVING 分组过滤</span><br><span class="line">(6) SELECT 列名</span><br><span class="line">(7) DISTINCT 去重</span><br><span class="line">(8) ORDER BY 排序</span><br><span class="line">(9) LIMIT 分页</span><br></pre></td></tr></table></figure>

<h3 id="12-2-执行顺序详解"><a href="#12-2-执行顺序详解" class="headerlink" title="12.2 执行顺序详解"></a>12.2 执行顺序详解</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 示例 SQL</span></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    d.dept_name,</span><br><span class="line">    <span class="built_in">COUNT</span>(e.id) <span class="keyword">AS</span> emp_count,</span><br><span class="line">    <span class="built_in">AVG</span>(e.salary) <span class="keyword">AS</span> avg_salary</span><br><span class="line"><span class="keyword">FROM</span> departments d</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> employees e <span class="keyword">ON</span> d.id <span class="operator">=</span> e.dept_id</span><br><span class="line"><span class="keyword">WHERE</span> e.status <span class="operator">=</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> d.id, d.dept_name</span><br><span class="line"><span class="keyword">HAVING</span> <span class="built_in">COUNT</span>(e.id) <span class="operator">&gt;</span> <span class="number">2</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> avg_salary <span class="keyword">DESC</span></span><br><span class="line">LIMIT <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 执行步骤：</span></span><br><span class="line"><span class="comment">-- 1. FROM departments: 读取部门表</span></span><br><span class="line"><span class="comment">-- 2. LEFT JOIN employees: 连接员工表</span></span><br><span class="line"><span class="comment">-- 3. WHERE e.status = 1: 过滤在职员工</span></span><br><span class="line"><span class="comment">-- 4. GROUP BY d.id, d.dept_name: 按部门分组</span></span><br><span class="line"><span class="comment">-- 5. HAVING COUNT(e.id) &gt; 2: 过滤人数大于 2 的部门</span></span><br><span class="line"><span class="comment">-- 6. SELECT: 计算 dept_name, emp_count, avg_salary</span></span><br><span class="line"><span class="comment">-- 7. ORDER BY avg_salary DESC: 按平均工资降序排序</span></span><br><span class="line"><span class="comment">-- 8. LIMIT 5: 只返回前 5 条</span></span><br></pre></td></tr></table></figure>

<h3 id="12-3-常见错误"><a href="#12-3-常见错误" class="headerlink" title="12.3 常见错误"></a>12.3 常见错误</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 错误 1：WHERE 中使用列别名</span></span><br><span class="line"><span class="keyword">SELECT</span> salary <span class="keyword">AS</span> monthly_salary <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> monthly_salary <span class="operator">&gt;</span> <span class="number">8000</span>;  <span class="comment">-- 错误！WHERE 在 SELECT 之前执行</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 正确写法</span></span><br><span class="line"><span class="keyword">SELECT</span> salary <span class="keyword">AS</span> monthly_salary <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> salary <span class="operator">&gt;</span> <span class="number">8000</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 错误 2：HAVING 中使用列位置</span></span><br><span class="line"><span class="keyword">SELECT</span> dept_id, <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> dept_id</span><br><span class="line"><span class="keyword">HAVING</span> <span class="number">2</span> <span class="operator">&gt;</span> <span class="number">2</span>;  <span class="comment">-- 某些数据库支持，但不推荐</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 正确写法</span></span><br><span class="line"><span class="keyword">SELECT</span> dept_id, <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">AS</span> cnt <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> dept_id</span><br><span class="line"><span class="keyword">HAVING</span> cnt <span class="operator">&gt;</span> <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 错误 3：WHERE 中使用聚合函数</span></span><br><span class="line"><span class="keyword">SELECT</span> dept_id <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="operator">&gt;</span> <span class="number">2</span>  <span class="comment">-- 错误！</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> dept_id;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 正确写法</span></span><br><span class="line"><span class="keyword">SELECT</span> dept_id <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> dept_id</span><br><span class="line"><span class="keyword">HAVING</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="operator">&gt;</span> <span class="number">2</span>;</span><br></pre></td></tr></table></figure>

<h3 id="12-4-性能优化建议"><a href="#12-4-性能优化建议" class="headerlink" title="12.4 性能优化建议"></a>12.4 性能优化建议</h3><p>基于执行顺序的优化：</p>
<ol>
<li><strong>WHERE 条件尽可能早地过滤数据</strong></li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 好：先过滤再连接</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">JOIN</span> departments d <span class="keyword">ON</span> e.dept_id <span class="operator">=</span> d.id</span><br><span class="line"><span class="keyword">WHERE</span> e.salary <span class="operator">&gt;</span> <span class="number">8000</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 差：连接后再过滤（某些情况下）</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> e.<span class="operator">*</span>, d.dept_name <span class="keyword">FROM</span> employees e</span><br><span class="line">    <span class="keyword">JOIN</span> departments d <span class="keyword">ON</span> e.dept_id <span class="operator">=</span> d.id</span><br><span class="line">) temp</span><br><span class="line"><span class="keyword">WHERE</span> salary <span class="operator">&gt;</span> <span class="number">8000</span>;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><strong>使用索引列进行连接和过滤</strong></li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 确保连接列和 WHERE 列有索引</span></span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_dept_id <span class="keyword">ON</span> employees(dept_id);</span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_salary <span class="keyword">ON</span> employees(salary);</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>**避免 SELECT ***</li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 只选择需要的列</span></span><br><span class="line"><span class="keyword">SELECT</span> name, salary <span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>

<h2 id="十三、小结（下）"><a href="#十三、小结（下）" class="headerlink" title="十三、小结（下）"></a>十三、小结（下）</h2><h3 id="知识点回顾"><a href="#知识点回顾" class="headerlink" title="知识点回顾"></a>知识点回顾</h3><ol>
<li><p><strong>排序查询（ORDER BY）</strong></p>
<ul>
<li>ASC&#x2F;DESC 升序降序</li>
<li>多列排序</li>
<li>自定义排序顺序</li>
</ul>
</li>
<li><p><strong>分页查询（LIMIT）</strong></p>
<ul>
<li>LIMIT offset, count</li>
<li>分页公式：(页码 -1) * 每页条数</li>
<li>大数据量分页优化</li>
</ul>
</li>
<li><p><strong>连接查询</strong></p>
<ul>
<li>INNER JOIN 内连接</li>
<li>LEFT JOIN 左连接</li>
<li>RIGHT JOIN 右连接</li>
<li>CROSS JOIN 交叉连接</li>
<li>自连接</li>
</ul>
</li>
<li><p><strong>子查询</strong></p>
<ul>
<li>WHERE 子查询</li>
<li>FROM 子查询</li>
<li>SELECT 子查询</li>
<li>EXISTS 子查询</li>
</ul>
</li>
<li><p><strong>执行顺序</strong></p>
<ul>
<li>FROM → JOIN → WHERE → GROUP BY → HAVING → SELECT → ORDER BY → LIMIT</li>
</ul>
</li>
</ol>
<h3 id="DQL-完整语法结构"><a href="#DQL-完整语法结构" class="headerlink" title="DQL 完整语法结构"></a>DQL 完整语法结构</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> [<span class="keyword">DISTINCT</span>] 列名 [<span class="keyword">AS</span> 别名], ...</span><br><span class="line"><span class="keyword">FROM</span> 表名 [<span class="keyword">AS</span> 别名]</span><br><span class="line">[<span class="keyword">INNER</span> <span class="operator">|</span> <span class="keyword">LEFT</span> <span class="operator">|</span> <span class="keyword">RIGHT</span> <span class="operator">|</span> <span class="keyword">FULL</span>] <span class="keyword">JOIN</span> 表名 <span class="keyword">ON</span> 连接条件</span><br><span class="line">[<span class="keyword">WHERE</span> 条件]</span><br><span class="line">[<span class="keyword">GROUP</span> <span class="keyword">BY</span> 分组列 [<span class="keyword">HAVING</span> 分组过滤条件]]</span><br><span class="line">[<span class="keyword">ORDER</span> <span class="keyword">BY</span> 排序列 [<span class="keyword">ASC</span> <span class="operator">|</span> <span class="keyword">DESC</span>]]</span><br><span class="line">[LIMIT [<span class="keyword">offset</span>,] count];</span><br></pre></td></tr></table></figure>

<hr>
<p><strong>下一篇</strong>：[MySQL 基础教程（五）：DCL 数据控制语言详解](&#x2F;2026&#x2F;02&#x2F;23&#x2F;MySQL 基础教程（五）DCL 数据控制语言详解&#x2F;)</p>
<p><strong>上一篇</strong>：[MySQL 基础教程（四）DQL 数据查询语言详解（上）](&#x2F;2026&#x2F;02&#x2F;23&#x2F;MySQL 基础教程（四）DQL 数据查询语言详解（上）&#x2F;)</p>
]]></content>
      <categories>
        <category>MySQL 基础教程</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
        <tag>DQL</tag>
        <tag>数据查询</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQL 进阶教程（四）事务详解</title>
    <url>/2026/02/23/MySQL%20%E8%BF%9B%E9%98%B6%E6%95%99%E7%A8%8B%EF%BC%88%E5%9B%9B%EF%BC%89%E4%BA%8B%E5%8A%A1%E8%AF%A6%E8%A7%A3/</url>
    <content><![CDATA[<h1 id="MySQL-进阶教程（四）事务详解"><a href="#MySQL-进阶教程（四）事务详解" class="headerlink" title="MySQL 进阶教程（四）事务详解"></a>MySQL 进阶教程（四）事务详解</h1><p>事务是数据库管理的核心技术之一，用于保证数据的完整性和一致性。本文将详细讲解事务的概念、ACID 特性、并发问题以及隔离级别。</p>
<h2 id="一、事务简介"><a href="#一、事务简介" class="headerlink" title="一、事务简介"></a>一、事务简介</h2><h3 id="1-1-什么是事务？"><a href="#1-1-什么是事务？" class="headerlink" title="1.1 什么是事务？"></a>1.1 什么是事务？</h3><p><strong>事务（Transaction）</strong> 是数据库管理系统执行过程中的一个逻辑单位，由一个有限的数据库操作序列构成。这些操作要么全部成功执行，要么全部不执行，是一个不可分割的工作单位。</p>
<h3 id="1-2-事务的特点"><a href="#1-2-事务的特点" class="headerlink" title="1.2 事务的特点"></a>1.2 事务的特点</h3><ol>
<li><strong>原子性</strong>：事务是一个不可分割的操作序列</li>
<li><strong>一致性</strong>：事务执行前后，数据保持一致</li>
<li><strong>独立性</strong>：多个事务并发执行时互不干扰</li>
<li><strong>持久性</strong>：事务一旦提交，修改永久保存</li>
</ol>
<h3 id="1-3-事务的使用场景"><a href="#1-3-事务的使用场景" class="headerlink" title="1.3 事务的使用场景"></a>1.3 事务的使用场景</h3><table>
<thead>
<tr>
<th>场景</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>银行转账</td>
<td>A 转给 B 钱，A 扣款和 B 收款必须同时成功或失败</td>
</tr>
<tr>
<td>订单创建</td>
<td>创建订单、扣减库存、生成物流单必须同时成功</td>
</tr>
<tr>
<td>批量操作</td>
<td>批量导入数据，要么全部导入成功，要么全部回滚</td>
</tr>
<tr>
<td>数据一致性</td>
<td>更新多个关联表时保持一致性</td>
</tr>
</tbody></table>
<h3 id="1-4-不使用事务的问题"><a href="#1-4-不使用事务的问题" class="headerlink" title="1.4 不使用事务的问题"></a>1.4 不使用事务的问题</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 不使用事务的转账操作</span></span><br><span class="line"><span class="comment">-- 步骤 1：A 账户扣款</span></span><br><span class="line"><span class="keyword">UPDATE</span> accounts <span class="keyword">SET</span> balance <span class="operator">=</span> balance <span class="operator">-</span> <span class="number">100</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 假设这里系统故障或断电...</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 步骤 2：B 账户收款（可能永远不会执行）</span></span><br><span class="line"><span class="keyword">UPDATE</span> accounts <span class="keyword">SET</span> balance <span class="operator">=</span> balance <span class="operator">+</span> <span class="number">100</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 结果：A 的钱扣了，但 B 没收到，数据不一致！</span></span><br></pre></td></tr></table></figure>

<h2 id="二、事务操作演示"><a href="#二、事务操作演示" class="headerlink" title="二、事务操作演示"></a>二、事务操作演示</h2><h3 id="2-1-事务控制语句"><a href="#2-1-事务控制语句" class="headerlink" title="2.1 事务控制语句"></a>2.1 事务控制语句</h3><table>
<thead>
<tr>
<th>语句</th>
<th>功能</th>
</tr>
</thead>
<tbody><tr>
<td>START TRANSACTION &#x2F; BEGIN</td>
<td>开启事务</td>
</tr>
<tr>
<td>COMMIT</td>
<td>提交事务</td>
</tr>
<tr>
<td>ROLLBACK</td>
<td>回滚事务</td>
</tr>
<tr>
<td>SAVEPOINT</td>
<td>设置保存点</td>
</tr>
<tr>
<td>ROLLBACK TO SAVEPOINT</td>
<td>回滚到保存点</td>
</tr>
<tr>
<td>SET autocommit &#x3D; 0&#x2F;1</td>
<td>设置自动提交</td>
</tr>
</tbody></table>
<h3 id="2-2-准备测试数据"><a href="#2-2-准备测试数据" class="headerlink" title="2.2 准备测试数据"></a>2.2 准备测试数据</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 创建账户表</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> accounts;</span><br><span class="line"><span class="keyword">CREATE TABLE</span> accounts (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT,</span><br><span class="line">    account_name <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">    balance <span class="type">DECIMAL</span>(<span class="number">12</span>, <span class="number">2</span>) <span class="keyword">DEFAULT</span> <span class="number">0</span></span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 插入测试数据</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> accounts (account_name, balance) <span class="keyword">VALUES</span></span><br><span class="line">(<span class="string">&#x27;张三&#x27;</span>, <span class="number">10000</span>),</span><br><span class="line">(<span class="string">&#x27;李四&#x27;</span>, <span class="number">5000</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看初始数据</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> accounts;</span><br></pre></td></tr></table></figure>

<h3 id="2-3-基础事务操作"><a href="#2-3-基础事务操作" class="headerlink" title="2.3 基础事务操作"></a>2.3 基础事务操作</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 查看自动提交状态</span></span><br><span class="line"><span class="keyword">SELECT</span> @<span class="variable">@autocommit</span>;  <span class="comment">-- 1 表示开启，0 表示关闭</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 开启事务</span></span><br><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"><span class="comment">-- 或</span></span><br><span class="line"><span class="keyword">BEGIN</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 执行 DML 操作</span></span><br><span class="line"><span class="keyword">UPDATE</span> accounts <span class="keyword">SET</span> balance <span class="operator">=</span> balance <span class="operator">-</span> <span class="number">100</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">UPDATE</span> accounts <span class="keyword">SET</span> balance <span class="operator">=</span> balance <span class="operator">+</span> <span class="number">100</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看临时结果（当前会话可见）</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> accounts;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 提交事务（使更改永久生效）</span></span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 再次查看（其他会话也可见）</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> accounts;</span><br></pre></td></tr></table></figure>

<h3 id="2-4-事务回滚"><a href="#2-4-事务回滚" class="headerlink" title="2.4 事务回滚"></a>2.4 事务回滚</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 开启事务</span></span><br><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 执行操作</span></span><br><span class="line"><span class="keyword">UPDATE</span> accounts <span class="keyword">SET</span> balance <span class="operator">=</span> balance <span class="operator">-</span> <span class="number">1000</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">UPDATE</span> accounts <span class="keyword">SET</span> balance <span class="operator">=</span> balance <span class="operator">+</span> <span class="number">1000</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 发现问题，回滚事务</span></span><br><span class="line"><span class="keyword">ROLLBACK</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 数据恢复原状</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> accounts;</span><br></pre></td></tr></table></figure>

<h3 id="2-5-保存点（SAVEPOINT）"><a href="#2-5-保存点（SAVEPOINT）" class="headerlink" title="2.5 保存点（SAVEPOINT）"></a>2.5 保存点（SAVEPOINT）</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 开启事务</span></span><br><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 操作 1</span></span><br><span class="line"><span class="keyword">UPDATE</span> accounts <span class="keyword">SET</span> balance <span class="operator">=</span> balance <span class="operator">-</span> <span class="number">100</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 设置保存点</span></span><br><span class="line"><span class="keyword">SAVEPOINT</span> sp1;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 操作 2</span></span><br><span class="line"><span class="keyword">UPDATE</span> accounts <span class="keyword">SET</span> balance <span class="operator">=</span> balance <span class="operator">-</span> <span class="number">200</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 设置保存点</span></span><br><span class="line"><span class="keyword">SAVEPOINT</span> sp2;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 操作 3（假设出错了）</span></span><br><span class="line"><span class="keyword">UPDATE</span> accounts <span class="keyword">SET</span> balance <span class="operator">=</span> balance <span class="operator">-</span> <span class="number">300</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 回滚到保存点 sp2（撤销操作 3）</span></span><br><span class="line"><span class="keyword">ROLLBACK</span> <span class="keyword">TO</span> sp2;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 回滚到保存点 sp1（撤销操作 2 和 3）</span></span><br><span class="line"><span class="keyword">ROLLBACK</span> <span class="keyword">TO</span> sp1;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 提交事务（只有操作 1 生效）</span></span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 释放保存点</span></span><br><span class="line"><span class="keyword">RELEASE</span> <span class="keyword">SAVEPOINT</span> sp1;</span><br></pre></td></tr></table></figure>

<h3 id="2-6-自动提交控制"><a href="#2-6-自动提交控制" class="headerlink" title="2.6 自动提交控制"></a>2.6 自动提交控制</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 查看自动提交状态</span></span><br><span class="line"><span class="keyword">SELECT</span> @<span class="variable">@autocommit</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 关闭自动提交（之后所有操作都在事务中）</span></span><br><span class="line"><span class="keyword">SET</span> autocommit <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 执行操作（不会自动提交）</span></span><br><span class="line"><span class="keyword">UPDATE</span> accounts <span class="keyword">SET</span> balance <span class="operator">=</span> balance <span class="operator">-</span> <span class="number">100</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 手动提交</span></span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 开启自动提交</span></span><br><span class="line"><span class="keyword">SET</span> autocommit <span class="operator">=</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<h2 id="三、事务的-ACID-特性"><a href="#三、事务的-ACID-特性" class="headerlink" title="三、事务的 ACID 特性"></a>三、事务的 ACID 特性</h2><h3 id="3-1-原子性（Atomicity）"><a href="#3-1-原子性（Atomicity）" class="headerlink" title="3.1 原子性（Atomicity）"></a>3.1 原子性（Atomicity）</h3><p><strong>原子性</strong> 指事务是一个不可分割的最小工作单位，事务中的操作要么全部成功，要么全部失败。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 原子性演示</span></span><br><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"></span><br><span class="line"><span class="keyword">UPDATE</span> accounts <span class="keyword">SET</span> balance <span class="operator">=</span> balance <span class="operator">-</span> <span class="number">100</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="comment">-- 假设这里发生错误（如除零、违反约束等）</span></span><br><span class="line"><span class="keyword">UPDATE</span> accounts <span class="keyword">SET</span> balance <span class="operator">=</span> balance <span class="operator">/</span> <span class="number">0</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">2</span>;  <span class="comment">-- 错误！</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 由于发生错误，整个事务会自动回滚</span></span><br><span class="line"><span class="comment">-- 操作 1 也会被撤销</span></span><br><span class="line"><span class="keyword">ROLLBACK</span>;  <span class="comment">-- 或者让 MySQL 自动回滚</span></span><br></pre></td></tr></table></figure>

<p><strong>原子性的实现</strong>：通过 undo log（回滚日志）实现。</p>
<h3 id="3-2-一致性（Consistency）"><a href="#3-2-一致性（Consistency）" class="headerlink" title="3.2 一致性（Consistency）"></a>3.2 一致性（Consistency）</h3><p><strong>一致性</strong> 指事务执行前后，数据必须保持一致状态，满足所有约束、触发器等规则。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 一致性演示</span></span><br><span class="line"><span class="comment">-- 假设有检查约束：balance &gt;= 0</span></span><br><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"></span><br><span class="line"><span class="keyword">UPDATE</span> accounts <span class="keyword">SET</span> balance <span class="operator">=</span> balance <span class="operator">-</span> <span class="number">20000</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="comment">-- 如果余额不足，违反约束，事务会回滚</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 一致性确保：</span></span><br><span class="line"><span class="comment">-- 1. 所有约束都被满足</span></span><br><span class="line"><span class="comment">-- 2. 所有触发器都被触发</span></span><br><span class="line"><span class="comment">-- 3. 外键约束被维护</span></span><br><span class="line"><span class="comment">-- 4. 数据逻辑一致</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br></pre></td></tr></table></figure>

<p><strong>一致性的实现</strong>：原子性和持久性保证数据不丢失，隔离性保证并发一致。</p>
<h3 id="3-3-隔离性（Isolation）"><a href="#3-3-隔离性（Isolation）" class="headerlink" title="3.3 隔离性（Isolation）"></a>3.3 隔离性（Isolation）</h3><p><strong>隔离性</strong> 指多个事务并发执行时，一个事务的执行不应影响其他事务。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 会话 A</span></span><br><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"><span class="keyword">SELECT</span> balance <span class="keyword">FROM</span> accounts <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;  <span class="comment">-- 10000</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 会话 B（同时）</span></span><br><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"><span class="keyword">UPDATE</span> accounts <span class="keyword">SET</span> balance <span class="operator">=</span> balance <span class="operator">-</span> <span class="number">100</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 会话 A（再次查询）</span></span><br><span class="line"><span class="keyword">SELECT</span> balance <span class="keyword">FROM</span> accounts <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="comment">-- 不同隔离级别下结果可能不同</span></span><br></pre></td></tr></table></figure>

<p><strong>隔离性的实现</strong>：通过锁机制和 MVCC（多版本并发控制）实现。</p>
<h3 id="3-4-持久性（Durability）"><a href="#3-4-持久性（Durability）" class="headerlink" title="3.4 持久性（Durability）"></a>3.4 持久性（Durability）</h3><p><strong>持久性</strong> 指事务一旦提交，对数据的修改是永久的，即使系统故障也不会丢失。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"><span class="keyword">UPDATE</span> accounts <span class="keyword">SET</span> balance <span class="operator">=</span> balance <span class="operator">-</span> <span class="number">100</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">COMMIT</span>;  <span class="comment">-- 提交后，即使立即断电，数据也不会丢失</span></span><br></pre></td></tr></table></figure>

<p><strong>持久性的实现</strong>：通过 redo log（重做日志）实现。</p>
<h2 id="四、并发事务问题"><a href="#四、并发事务问题" class="headerlink" title="四、并发事务问题"></a>四、并发事务问题</h2><h3 id="4-1-并发事务场景"><a href="#4-1-并发事务场景" class="headerlink" title="4.1 并发事务场景"></a>4.1 并发事务场景</h3><p>当多个事务同时访问同一数据时，可能产生以下问题：</p>
<table>
<thead>
<tr>
<th>问题</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>脏读（Dirty Read）</td>
<td>读到其他事务未提交的数据</td>
</tr>
<tr>
<td>不可重复读（Non-repeatable Read）</td>
<td>同一事务中多次读取结果不一致</td>
</tr>
<tr>
<td>幻读（Phantom Read）</td>
<td>同一事务中多次查询，记录数不一致</td>
</tr>
</tbody></table>
<h3 id="4-2-脏读（Dirty-Read）"><a href="#4-2-脏读（Dirty-Read）" class="headerlink" title="4.2 脏读（Dirty Read）"></a>4.2 脏读（Dirty Read）</h3><p><strong>脏读</strong> 是指一个事务读取了另一个事务未提交的修改。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 会话 A</span></span><br><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"><span class="keyword">UPDATE</span> accounts <span class="keyword">SET</span> balance <span class="operator">=</span> balance <span class="operator">-</span> <span class="number">100</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="comment">-- 尚未提交</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 会话 B</span></span><br><span class="line"><span class="keyword">SELECT</span> balance <span class="keyword">FROM</span> accounts <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="comment">-- 读到了 A 未提交的修改（脏读）</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 会话 A 回滚</span></span><br><span class="line"><span class="keyword">ROLLBACK</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 结果：会话 B 读到的数据是无效的</span></span><br></pre></td></tr></table></figure>

<h3 id="4-3-不可重复读（Non-repeatable-Read）"><a href="#4-3-不可重复读（Non-repeatable-Read）" class="headerlink" title="4.3 不可重复读（Non-repeatable Read）"></a>4.3 不可重复读（Non-repeatable Read）</h3><p><strong>不可重复读</strong> 是指在同一事务中，多次读取同一数据得到不同结果。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 会话 A</span></span><br><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"><span class="keyword">SELECT</span> balance <span class="keyword">FROM</span> accounts <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;  <span class="comment">-- 10000</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 会话 B</span></span><br><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"><span class="keyword">UPDATE</span> accounts <span class="keyword">SET</span> balance <span class="operator">=</span> <span class="number">9900</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 会话 A</span></span><br><span class="line"><span class="keyword">SELECT</span> balance <span class="keyword">FROM</span> accounts <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;  <span class="comment">-- 9900（与第一次不同）</span></span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 结果：同一事务中两次读取结果不同</span></span><br></pre></td></tr></table></figure>

<p><strong>与脏读的区别</strong>：不可重复读读到的是已提交的数据，但不是预期的结果。</p>
<h3 id="4-4-幻读（Phantom-Read）"><a href="#4-4-幻读（Phantom-Read）" class="headerlink" title="4.4 幻读（Phantom Read）"></a>4.4 幻读（Phantom Read）</h3><p><strong>幻读</strong> 是指在同一事务中，多次查询同一范围的数据，记录数不一致。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 会话 A</span></span><br><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> accounts <span class="keyword">WHERE</span> balance <span class="operator">&gt;</span> <span class="number">5000</span>;  <span class="comment">-- 返回 2 条</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 会话 B</span></span><br><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"><span class="keyword">INSERT INTO</span> accounts (account_name, balance) <span class="keyword">VALUES</span> (<span class="string">&#x27;王五&#x27;</span>, <span class="number">6000</span>);</span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 会话 A</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> accounts <span class="keyword">WHERE</span> balance <span class="operator">&gt;</span> <span class="number">5000</span>;  <span class="comment">-- 返回 3 条（多出 1 条）</span></span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 结果：同一事务中两次查询记录数不同</span></span><br></pre></td></tr></table></figure>

<h3 id="4-5-三种问题对比"><a href="#4-5-三种问题对比" class="headerlink" title="4.5 三种问题对比"></a>4.5 三种问题对比</h3><table>
<thead>
<tr>
<th>问题</th>
<th>原因</th>
<th>表现</th>
</tr>
</thead>
<tbody><tr>
<td>脏读</td>
<td>读到未提交数据</td>
<td>数据无效</td>
</tr>
<tr>
<td>不可重复读</td>
<td>读到已提交更新</td>
<td>值变化</td>
</tr>
<tr>
<td>幻读</td>
<td>读到已提交插入</td>
<td>记录数变化</td>
</tr>
</tbody></table>
<h2 id="五、并发事务演示及隔离级别"><a href="#五、并发事务演示及隔离级别" class="headerlink" title="五、并发事务演示及隔离级别"></a>五、并发事务演示及隔离级别</h2><h3 id="5-1-事务隔离级别"><a href="#5-1-事务隔离级别" class="headerlink" title="5.1 事务隔离级别"></a>5.1 事务隔离级别</h3><p>SQL 标准定义了四种隔离级别，从低到高：</p>
<table>
<thead>
<tr>
<th>隔离级别</th>
<th>脏读</th>
<th>不可重复读</th>
<th>幻读</th>
</tr>
</thead>
<tbody><tr>
<td>READ UNCOMMITTED（读未提交）</td>
<td>可能</td>
<td>可能</td>
<td>可能</td>
</tr>
<tr>
<td>READ COMMITTED（读已提交）</td>
<td>否</td>
<td>可能</td>
<td>可能</td>
</tr>
<tr>
<td>REPEATABLE READ（可重复读）</td>
<td>否</td>
<td>否</td>
<td>可能*</td>
</tr>
<tr>
<td>SERIALIZABLE（串行化）</td>
<td>否</td>
<td>否</td>
<td>否</td>
</tr>
</tbody></table>
<p>*MySQL InnoDB 通过 MVCC 在 REPEATABLE READ 级别避免了幻读</p>
<h3 id="5-2-查看和设置隔离级别"><a href="#5-2-查看和设置隔离级别" class="headerlink" title="5.2 查看和设置隔离级别"></a>5.2 查看和设置隔离级别</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 查看当前会话隔离级别</span></span><br><span class="line"><span class="keyword">SELECT</span> @<span class="variable">@transaction_isolation</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看全局隔离级别</span></span><br><span class="line"><span class="keyword">SELECT</span> @<span class="variable">@global</span>.transaction_isolation;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 设置会话隔离级别（只影响当前会话）</span></span><br><span class="line"><span class="keyword">SET</span> SESSION TRANSACTION ISOLATION LEVEL READ UNCOMMITTED;</span><br><span class="line"><span class="keyword">SET</span> SESSION TRANSACTION ISOLATION LEVEL READ COMMITTED;</span><br><span class="line"><span class="keyword">SET</span> SESSION TRANSACTION ISOLATION LEVEL REPEATABLE READ;  <span class="comment">-- MySQL 默认</span></span><br><span class="line"><span class="keyword">SET</span> SESSION TRANSACTION ISOLATION LEVEL SERIALIZABLE;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 设置全局隔离级别（影响新会话）</span></span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span> TRANSACTION ISOLATION LEVEL READ COMMITTED;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 在事务开始前设置</span></span><br><span class="line"><span class="keyword">SET</span> TRANSACTION ISOLATION LEVEL SERIALIZABLE;</span><br><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br></pre></td></tr></table></figure>

<h3 id="5-3-READ-UNCOMMITTED-演示"><a href="#5-3-READ-UNCOMMITTED-演示" class="headerlink" title="5.3 READ UNCOMMITTED 演示"></a>5.3 READ UNCOMMITTED 演示</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 设置隔离级别为读未提交</span></span><br><span class="line"><span class="keyword">SET</span> SESSION TRANSACTION ISOLATION LEVEL READ UNCOMMITTED;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 会话 A</span></span><br><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"><span class="keyword">UPDATE</span> accounts <span class="keyword">SET</span> balance <span class="operator">=</span> balance <span class="operator">-</span> <span class="number">100</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="comment">-- 不提交</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 会话 B</span></span><br><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"><span class="keyword">SELECT</span> balance <span class="keyword">FROM</span> accounts <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;  <span class="comment">-- 读到未提交的值（脏读）</span></span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 会话 A 回滚</span></span><br><span class="line"><span class="keyword">ROLLBACK</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 结果：会话 B 读到的数据是无效的</span></span><br></pre></td></tr></table></figure>

<h3 id="5-4-READ-COMMITTED-演示"><a href="#5-4-READ-COMMITTED-演示" class="headerlink" title="5.4 READ COMMITTED 演示"></a>5.4 READ COMMITTED 演示</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 设置隔离级别为读已提交</span></span><br><span class="line"><span class="keyword">SET</span> SESSION TRANSACTION ISOLATION LEVEL READ COMMITTED;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 会话 A</span></span><br><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"><span class="keyword">SELECT</span> balance <span class="keyword">FROM</span> accounts <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;  <span class="comment">-- 10000</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 会话 B</span></span><br><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"><span class="keyword">UPDATE</span> accounts <span class="keyword">SET</span> balance <span class="operator">=</span> <span class="number">9900</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">COMMIT</span>;  <span class="comment">-- 提交</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 会话 A</span></span><br><span class="line"><span class="keyword">SELECT</span> balance <span class="keyword">FROM</span> accounts <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;  <span class="comment">-- 9900（不可重复读）</span></span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 结果：避免脏读，但出现不可重复读</span></span><br></pre></td></tr></table></figure>

<h3 id="5-5-REPEATABLE-READ-演示（MySQL-默认）"><a href="#5-5-REPEATABLE-READ-演示（MySQL-默认）" class="headerlink" title="5.5 REPEATABLE READ 演示（MySQL 默认）"></a>5.5 REPEATABLE READ 演示（MySQL 默认）</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 设置隔离级别为可重复读</span></span><br><span class="line"><span class="keyword">SET</span> SESSION TRANSACTION ISOLATION LEVEL REPEATABLE READ;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 会话 A</span></span><br><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"><span class="keyword">SELECT</span> balance <span class="keyword">FROM</span> accounts <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;  <span class="comment">-- 10000</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 会话 B</span></span><br><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"><span class="keyword">UPDATE</span> accounts <span class="keyword">SET</span> balance <span class="operator">=</span> <span class="number">9900</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 会话 A</span></span><br><span class="line"><span class="keyword">SELECT</span> balance <span class="keyword">FROM</span> accounts <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;  <span class="comment">-- 10000（仍然是原值）</span></span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 结果：避免脏读和不可重复读</span></span><br></pre></td></tr></table></figure>

<p><strong>InnoDB 的 MVCC</strong>：</p>
<ul>
<li>InnoDB 在 REPEATABLE READ 级别下使用 MVCC 避免幻读</li>
<li>通过读取历史版本实现可重复读</li>
</ul>
<h3 id="5-6-SERIALIZABLE-演示"><a href="#5-6-SERIALIZABLE-演示" class="headerlink" title="5.6 SERIALIZABLE 演示"></a>5.6 SERIALIZABLE 演示</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 设置隔离级别为串行化</span></span><br><span class="line"><span class="keyword">SET</span> SESSION TRANSACTION ISOLATION LEVEL SERIALIZABLE;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 会话 A</span></span><br><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> accounts <span class="keyword">WHERE</span> balance <span class="operator">&gt;</span> <span class="number">5000</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 会话 B（会被阻塞，直到 A 提交）</span></span><br><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"><span class="keyword">INSERT INTO</span> accounts (account_name, balance) <span class="keyword">VALUES</span> (<span class="string">&#x27;王五&#x27;</span>, <span class="number">6000</span>);</span><br><span class="line"><span class="comment">-- 等待...</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 会话 A</span></span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 会话 B 现在可以执行</span></span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 结果：完全串行执行，性能最差</span></span><br></pre></td></tr></table></figure>

<h3 id="5-7-隔离级别选择建议"><a href="#5-7-隔离级别选择建议" class="headerlink" title="5.7 隔离级别选择建议"></a>5.7 隔离级别选择建议</h3><table>
<thead>
<tr>
<th>隔离级别</th>
<th>适用场景</th>
<th>性能</th>
</tr>
</thead>
<tbody><tr>
<td>READ UNCOMMITTED</td>
<td>几乎不用，统计数据等对一致性要求低的场景</td>
<td>最高</td>
</tr>
<tr>
<td>READ COMMITTED</td>
<td>Oracle 默认，大多数场景足够</td>
<td>较高</td>
</tr>
<tr>
<td>REPEATABLE READ</td>
<td>MySQL 默认，适合需要可重复读的场景</td>
<td>中等</td>
</tr>
<tr>
<td>SERIALIZABLE</td>
<td>对一致性要求极高，并发低的场景</td>
<td>最低</td>
</tr>
</tbody></table>
<p><strong>推荐</strong>：</p>
<ul>
<li>一般应用：使用默认的 REPEATABLE READ</li>
<li>高并发场景：可以考虑 READ COMMITTED</li>
<li>特殊场景：根据需求调整</li>
</ul>
<h2 id="六、锁机制"><a href="#六、锁机制" class="headerlink" title="六、锁机制"></a>六、锁机制</h2><h3 id="6-1-锁的类型"><a href="#6-1-锁的类型" class="headerlink" title="6.1 锁的类型"></a>6.1 锁的类型</h3><table>
<thead>
<tr>
<th>锁类型</th>
<th>说明</th>
<th>特点</th>
</tr>
</thead>
<tbody><tr>
<td>共享锁（S 锁）</td>
<td>读锁</td>
<td>多个事务可同时持有</td>
</tr>
<tr>
<td>排他锁（X 锁）</td>
<td>写锁</td>
<td>只能有一个事务持有</td>
</tr>
<tr>
<td>意向锁</td>
<td>表级锁</td>
<td>表明事务要在某行上加锁</td>
</tr>
</tbody></table>
<h3 id="6-2-显式加锁"><a href="#6-2-显式加锁" class="headerlink" title="6.2 显式加锁"></a>6.2 显式加锁</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 共享锁（读锁）</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> accounts <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span> LOCK <span class="keyword">IN</span> SHARE MODE;</span><br><span class="line"><span class="comment">-- MySQL 8.0+ 语法</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> accounts <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span> <span class="keyword">FOR</span> SHARE;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 排他锁（写锁）</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> accounts <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span> <span class="keyword">FOR</span> <span class="keyword">UPDATE</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 跳过已锁定的行</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> accounts <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span> <span class="keyword">FOR</span> <span class="keyword">UPDATE</span> <span class="keyword">SKIP</span> LOCKED;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 不等待锁（立即返回错误）</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> accounts <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span> <span class="keyword">FOR</span> <span class="keyword">UPDATE</span> NOWAIT;</span><br></pre></td></tr></table></figure>

<h3 id="6-3-查看锁信息"><a href="#6-3-查看锁信息" class="headerlink" title="6.3 查看锁信息"></a>6.3 查看锁信息</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 查看正在执行的事务</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> information_schema.innodb_trx;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看锁信息</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> information_schema.innodb_locks;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看锁等待情况</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> information_schema.innodb_lock_waits;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看进程列表</span></span><br><span class="line"><span class="keyword">SHOW</span> PROCESSLIST;</span><br></pre></td></tr></table></figure>

<h2 id="七、事务最佳实践"><a href="#七、事务最佳实践" class="headerlink" title="七、事务最佳实践"></a>七、事务最佳实践</h2><h3 id="7-1-事务使用建议"><a href="#7-1-事务使用建议" class="headerlink" title="7.1 事务使用建议"></a>7.1 事务使用建议</h3><ol>
<li><strong>保持事务简短</strong></li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 不好：事务太长，占用资源</span></span><br><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"><span class="keyword">SELECT</span> ...;</span><br><span class="line"><span class="keyword">UPDATE</span> ...;</span><br><span class="line"><span class="keyword">SELECT</span> ...;</span><br><span class="line"><span class="keyword">UPDATE</span> ...;</span><br><span class="line"><span class="comment">-- 很多操作...</span></span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 好：只包含必要的操作</span></span><br><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"><span class="keyword">UPDATE</span> ...;</span><br><span class="line"><span class="keyword">UPDATE</span> ...;</span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><strong>避免在事务中等待用户输入</strong></li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 不好</span></span><br><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"><span class="keyword">UPDATE</span> accounts <span class="keyword">SET</span> balance <span class="operator">=</span> balance <span class="operator">-</span> <span class="number">100</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="comment">-- 等待用户确认...（事务长时间不提交）</span></span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 好：快速提交，异步处理</span></span><br><span class="line"><span class="keyword">UPDATE</span> accounts <span class="keyword">SET</span> balance <span class="operator">=</span> balance <span class="operator">-</span> <span class="number">100</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="comment">-- 异步发送确认邮件等</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li><strong>处理死锁</strong></li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 应用层捕获死锁异常并重试</span></span><br><span class="line">try &#123;</span><br><span class="line">    <span class="operator">/</span><span class="operator">/</span> 执行事务</span><br><span class="line">&#125; catch (DeadlockException e) &#123;</span><br><span class="line">    <span class="operator">/</span><span class="operator">/</span> 重试逻辑</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="7-2-转账事务完整示例"><a href="#7-2-转账事务完整示例" class="headerlink" title="7.2 转账事务完整示例"></a>7.2 转账事务完整示例</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">DELIMITER <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> transfer_money(</span><br><span class="line">    <span class="keyword">IN</span> from_id <span class="type">INT</span>,</span><br><span class="line">    <span class="keyword">IN</span> to_id <span class="type">INT</span>,</span><br><span class="line">    <span class="keyword">IN</span> amount <span class="type">DECIMAL</span>(<span class="number">12</span>, <span class="number">2</span>)</span><br><span class="line">)</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">DECLARE</span> from_balance <span class="type">DECIMAL</span>(<span class="number">12</span>, <span class="number">2</span>);</span><br><span class="line">    <span class="keyword">DECLARE</span> EXIT HANDLER <span class="keyword">FOR</span> <span class="keyword">SQLEXCEPTION</span></span><br><span class="line">    <span class="keyword">BEGIN</span></span><br><span class="line">        <span class="keyword">ROLLBACK</span>;</span><br><span class="line">        <span class="keyword">SELECT</span> <span class="string">&#x27;Transfer failed&#x27;</span> <span class="keyword">AS</span> <span class="keyword">result</span>;</span><br><span class="line">    <span class="keyword">END</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">START</span> TRANSACTION;</span><br><span class="line"></span><br><span class="line">    <span class="comment">-- 锁定账户（防止并发修改）</span></span><br><span class="line">    <span class="keyword">SELECT</span> balance <span class="keyword">INTO</span> from_balance</span><br><span class="line">    <span class="keyword">FROM</span> accounts <span class="keyword">WHERE</span> id <span class="operator">=</span> from_id</span><br><span class="line">    <span class="keyword">FOR</span> <span class="keyword">UPDATE</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">-- 检查余额</span></span><br><span class="line">    IF from_balance <span class="operator">&lt;</span> amount <span class="keyword">THEN</span></span><br><span class="line">        <span class="keyword">ROLLBACK</span>;</span><br><span class="line">        <span class="keyword">SELECT</span> <span class="string">&#x27;Insufficient balance&#x27;</span> <span class="keyword">AS</span> <span class="keyword">result</span>;</span><br><span class="line">    <span class="keyword">ELSE</span></span><br><span class="line">        <span class="comment">-- 扣款</span></span><br><span class="line">        <span class="keyword">UPDATE</span> accounts <span class="keyword">SET</span> balance <span class="operator">=</span> balance <span class="operator">-</span> amount</span><br><span class="line">        <span class="keyword">WHERE</span> id <span class="operator">=</span> from_id;</span><br><span class="line"></span><br><span class="line">        <span class="comment">-- 收款</span></span><br><span class="line">        <span class="keyword">UPDATE</span> accounts <span class="keyword">SET</span> balance <span class="operator">=</span> balance <span class="operator">+</span> amount</span><br><span class="line">        <span class="keyword">WHERE</span> id <span class="operator">=</span> to_id;</span><br><span class="line"></span><br><span class="line">        <span class="comment">-- 记录日志</span></span><br><span class="line">        <span class="keyword">INSERT INTO</span> transfer_logs (from_id, to_id, amount, create_time)</span><br><span class="line">        <span class="keyword">VALUES</span> (from_id, to_id, amount, NOW());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">COMMIT</span>;</span><br><span class="line">        <span class="keyword">SELECT</span> <span class="string">&#x27;Transfer success&#x27;</span> <span class="keyword">AS</span> <span class="keyword">result</span>;</span><br><span class="line">    <span class="keyword">END</span> IF;</span><br><span class="line"><span class="keyword">END</span> <span class="operator">/</span><span class="operator">/</span></span><br><span class="line">DELIMITER ;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 调用</span></span><br><span class="line"><span class="keyword">CALL</span> transfer_money(<span class="number">1</span>, <span class="number">2</span>, <span class="number">100</span>);</span><br></pre></td></tr></table></figure>

<h2 id="八、小结"><a href="#八、小结" class="headerlink" title="八、小结"></a>八、小结</h2><h3 id="事务知识点回顾"><a href="#事务知识点回顾" class="headerlink" title="事务知识点回顾"></a>事务知识点回顾</h3><ol>
<li><p><strong>事务控制语句</strong></p>
<ul>
<li>START TRANSACTION &#x2F; BEGIN：开启事务</li>
<li>COMMIT：提交事务</li>
<li>ROLLBACK：回滚事务</li>
<li>SAVEPOINT：设置保存点</li>
</ul>
</li>
<li><p><strong>ACID 特性</strong></p>
<ul>
<li>原子性：不可分割</li>
<li>一致性：数据一致</li>
<li>隔离性：互不干扰</li>
<li>持久性：永久保存</li>
</ul>
</li>
<li><p><strong>并发问题</strong></p>
<ul>
<li>脏读：读未提交数据</li>
<li>不可重复读：值变化</li>
<li>幻读：记录数变化</li>
</ul>
</li>
<li><p><strong>隔离级别</strong></p>
<ul>
<li>READ UNCOMMITTED</li>
<li>READ COMMITTED</li>
<li>REPEATABLE READ（MySQL 默认）</li>
<li>SERIALIZABLE</li>
</ul>
</li>
</ol>
<h3 id="隔离级别对比表"><a href="#隔离级别对比表" class="headerlink" title="隔离级别对比表"></a>隔离级别对比表</h3><table>
<thead>
<tr>
<th>隔离级别</th>
<th>脏读</th>
<th>不可重复读</th>
<th>幻读</th>
<th>性能</th>
</tr>
</thead>
<tbody><tr>
<td>READ UNCOMMITTED</td>
<td>✓</td>
<td>✓</td>
<td>✓</td>
<td>最高</td>
</tr>
<tr>
<td>READ COMMITTED</td>
<td>✗</td>
<td>✓</td>
<td>✓</td>
<td>较高</td>
</tr>
<tr>
<td>REPEATABLE READ</td>
<td>✗</td>
<td>✗</td>
<td>✗*</td>
<td>中等</td>
</tr>
<tr>
<td>SERIALIZABLE</td>
<td>✗</td>
<td>✗</td>
<td>✗</td>
<td>最低</td>
</tr>
</tbody></table>
<p>*MySQL InnoDB 通过 MVCC 避免幻读</p>
<h3 id="实际应用建议"><a href="#实际应用建议" class="headerlink" title="实际应用建议"></a>实际应用建议</h3><ol>
<li>使用默认的 REPEATABLE READ 隔离级别</li>
<li>保持事务简短，避免长时间持有锁</li>
<li>处理可能的死锁情况</li>
<li>对于高并发场景，可以考虑 READ COMMITTED</li>
<li>使用合适的索引减少锁竞争</li>
</ol>
<hr>
<p><strong>下一篇</strong>：[MySQL 进阶教程（五）：基础篇总结](&#x2F;2026&#x2F;02&#x2F;23&#x2F;MySQL 进阶教程（五）基础篇总结&#x2F;)</p>
<p><strong>上一篇</strong>：[MySQL 进阶教程（三）：多表查询详解](&#x2F;2026&#x2F;02&#x2F;23&#x2F;MySQL 进阶教程（三）多表查询详解&#x2F;)</p>
]]></content>
      <categories>
        <category>MySQL 进阶教程</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
        <tag>事务</tag>
        <tag>ACID</tag>
        <tag>并发控制</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQL 基础教程（四）DQL 数据查询语言详解（上）</title>
    <url>/2026/02/23/MySQL%20%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B%EF%BC%88%E5%9B%9B%EF%BC%89DQL%20%E6%95%B0%E6%8D%AE%E6%9F%A5%E8%AF%A2%E8%AF%AD%E8%A8%80%E8%AF%A6%E8%A7%A3%EF%BC%88%E4%B8%8A%EF%BC%89/</url>
    <content><![CDATA[<h1 id="MySQL-基础教程（四）DQL-数据查询语言详解（上）"><a href="#MySQL-基础教程（四）DQL-数据查询语言详解（上）" class="headerlink" title="MySQL 基础教程（四）DQL 数据查询语言详解（上）"></a>MySQL 基础教程（四）DQL 数据查询语言详解（上）</h1><p>DQL（Data Query Language，数据查询语言）是 SQL 中使用频率最高的部分。本文将系统讲解 DQL 的各种查询技巧，由于内容较多，分为上下两部分。</p>
<p><strong>上半部分</strong>：基础查询、条件查询、聚合函数、分组查询<br><strong>下半部分</strong>：排序查询、分页查询、综合案例、执行顺序</p>
<h2 id="一、DQL-概述"><a href="#一、DQL-概述" class="headerlink" title="一、DQL 概述"></a>一、DQL 概述</h2><p>DQL 主要用于从数据库中查询数据，核心命令是 <code>SELECT</code>。</p>
<p>完整的 SELECT 语法结构：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> [<span class="keyword">DISTINCT</span>] 列名 <span class="number">1</span> [<span class="keyword">AS</span> 别名 <span class="number">1</span>], 列名 <span class="number">2</span> [<span class="keyword">AS</span> 别名 <span class="number">2</span>], ...</span><br><span class="line"><span class="keyword">FROM</span> 表名 <span class="number">1</span> [<span class="keyword">AS</span> 别名 <span class="number">1</span>]</span><br><span class="line">[<span class="keyword">INNER</span> <span class="operator">|</span> <span class="keyword">LEFT</span> <span class="operator">|</span> <span class="keyword">RIGHT</span> <span class="operator">|</span> <span class="keyword">FULL</span>] <span class="keyword">JOIN</span> 表名 <span class="number">2</span> <span class="keyword">ON</span> 连接条件</span><br><span class="line">[<span class="keyword">WHERE</span> 条件]</span><br><span class="line">[<span class="keyword">GROUP</span> <span class="keyword">BY</span> 分组列 [<span class="keyword">HAVING</span> 分组过滤]]</span><br><span class="line">[<span class="keyword">ORDER</span> <span class="keyword">BY</span> 排序列 [<span class="keyword">ASC</span> <span class="operator">|</span> <span class="keyword">DESC</span>]]</span><br><span class="line">[LIMIT 起始位置，返回条数];</span><br></pre></td></tr></table></figure>

<h2 id="二、基础查询"><a href="#二、基础查询" class="headerlink" title="二、基础查询"></a>二、基础查询</h2><h3 id="2-1-准备测试数据"><a href="#2-1-准备测试数据" class="headerlink" title="2.1 准备测试数据"></a>2.1 准备测试数据</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 创建数据库</span></span><br><span class="line"><span class="keyword">CREATE</span> DATABASE IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> sql_learning;</span><br><span class="line">USE sql_learning;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建员工表</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> employees;</span><br><span class="line"><span class="keyword">CREATE TABLE</span> employees (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;员工 ID&#x27;</span>,</span><br><span class="line">    emp_no <span class="type">VARCHAR</span>(<span class="number">20</span>) <span class="keyword">NOT NULL</span> <span class="keyword">UNIQUE</span> COMMENT <span class="string">&#x27;员工编号&#x27;</span>,</span><br><span class="line">    name <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">NOT NULL</span> COMMENT <span class="string">&#x27;姓名&#x27;</span>,</span><br><span class="line">    gender ENUM(<span class="string">&#x27;男&#x27;</span>, <span class="string">&#x27;女&#x27;</span>) <span class="keyword">DEFAULT</span> <span class="string">&#x27;男&#x27;</span> COMMENT <span class="string">&#x27;性别&#x27;</span>,</span><br><span class="line">    age TINYINT COMMENT <span class="string">&#x27;年龄&#x27;</span>,</span><br><span class="line">    dept_id <span class="type">INT</span> COMMENT <span class="string">&#x27;部门 ID&#x27;</span>,</span><br><span class="line">    salary <span class="type">DECIMAL</span>(<span class="number">10</span>, <span class="number">2</span>) COMMENT <span class="string">&#x27;工资&#x27;</span>,</span><br><span class="line">    hire_date <span class="type">DATE</span> COMMENT <span class="string">&#x27;入职日期&#x27;</span>,</span><br><span class="line">    status TINYINT <span class="keyword">DEFAULT</span> <span class="number">1</span> COMMENT <span class="string">&#x27;状态：1 在职 0 离职&#x27;</span></span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4 COMMENT<span class="operator">=</span><span class="string">&#x27;员工表&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建部门表</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> departments;</span><br><span class="line"><span class="keyword">CREATE TABLE</span> departments (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;部门 ID&#x27;</span>,</span><br><span class="line">    dept_name <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">NOT NULL</span> COMMENT <span class="string">&#x27;部门名称&#x27;</span>,</span><br><span class="line">    dept_location <span class="type">VARCHAR</span>(<span class="number">100</span>) COMMENT <span class="string">&#x27;部门位置&#x27;</span></span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4 COMMENT<span class="operator">=</span><span class="string">&#x27;部门表&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 插入部门数据</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> departments (dept_name, dept_location) <span class="keyword">VALUES</span></span><br><span class="line">(<span class="string">&#x27;技术部&#x27;</span>, <span class="string">&#x27;北京&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;市场部&#x27;</span>, <span class="string">&#x27;上海&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;财务部&#x27;</span>, <span class="string">&#x27;北京&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;人事部&#x27;</span>, <span class="string">&#x27;广州&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 插入员工数据</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> employees (emp_no, name, gender, age, dept_id, salary, hire_date, status) <span class="keyword">VALUES</span></span><br><span class="line">(<span class="string">&#x27;E001&#x27;</span>, <span class="string">&#x27;张三&#x27;</span>, <span class="string">&#x27;男&#x27;</span>, <span class="number">28</span>, <span class="number">1</span>, <span class="number">8000.00</span>, <span class="string">&#x27;2022-03-15&#x27;</span>, <span class="number">1</span>),</span><br><span class="line">(<span class="string">&#x27;E002&#x27;</span>, <span class="string">&#x27;李四&#x27;</span>, <span class="string">&#x27;女&#x27;</span>, <span class="number">32</span>, <span class="number">1</span>, <span class="number">9500.00</span>, <span class="string">&#x27;2021-06-01&#x27;</span>, <span class="number">1</span>),</span><br><span class="line">(<span class="string">&#x27;E003&#x27;</span>, <span class="string">&#x27;王五&#x27;</span>, <span class="string">&#x27;男&#x27;</span>, <span class="number">25</span>, <span class="number">1</span>, <span class="number">7000.00</span>, <span class="string">&#x27;2023-01-10&#x27;</span>, <span class="number">1</span>),</span><br><span class="line">(<span class="string">&#x27;E004&#x27;</span>, <span class="string">&#x27;赵六&#x27;</span>, <span class="string">&#x27;女&#x27;</span>, <span class="number">29</span>, <span class="number">2</span>, <span class="number">8500.00</span>, <span class="string">&#x27;2022-08-20&#x27;</span>, <span class="number">1</span>),</span><br><span class="line">(<span class="string">&#x27;E005&#x27;</span>, <span class="string">&#x27;孙七&#x27;</span>, <span class="string">&#x27;男&#x27;</span>, <span class="number">35</span>, <span class="number">2</span>, <span class="number">10000.00</span>, <span class="string">&#x27;2020-05-15&#x27;</span>, <span class="number">1</span>),</span><br><span class="line">(<span class="string">&#x27;E006&#x27;</span>, <span class="string">&#x27;周八&#x27;</span>, <span class="string">&#x27;女&#x27;</span>, <span class="number">27</span>, <span class="number">3</span>, <span class="number">7500.00</span>, <span class="string">&#x27;2022-11-01&#x27;</span>, <span class="number">1</span>),</span><br><span class="line">(<span class="string">&#x27;E007&#x27;</span>, <span class="string">&#x27;吴九&#x27;</span>, <span class="string">&#x27;男&#x27;</span>, <span class="number">31</span>, <span class="number">3</span>, <span class="number">9000.00</span>, <span class="string">&#x27;2021-09-10&#x27;</span>, <span class="number">1</span>),</span><br><span class="line">(<span class="string">&#x27;E008&#x27;</span>, <span class="string">&#x27;郑十&#x27;</span>, <span class="string">&#x27;女&#x27;</span>, <span class="number">24</span>, <span class="number">4</span>, <span class="number">6000.00</span>, <span class="string">&#x27;2023-06-01&#x27;</span>, <span class="number">1</span>),</span><br><span class="line">(<span class="string">&#x27;E009&#x27;</span>, <span class="string">&#x27;刘十一&#x27;</span>, <span class="string">&#x27;男&#x27;</span>, <span class="number">30</span>, <span class="number">1</span>, <span class="number">8800.00</span>, <span class="string">&#x27;2022-01-15&#x27;</span>, <span class="number">1</span>),</span><br><span class="line">(<span class="string">&#x27;E010&#x27;</span>, <span class="string">&#x27;陈十二&#x27;</span>, <span class="string">&#x27;女&#x27;</span>, <span class="number">26</span>, <span class="number">2</span>, <span class="number">7200.00</span>, <span class="string">&#x27;2023-03-20&#x27;</span>, <span class="number">0</span>);</span><br></pre></td></tr></table></figure>

<h3 id="2-2-查询所有列"><a href="#2-2-查询所有列" class="headerlink" title="2.2 查询所有列"></a>2.2 查询所有列</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 查询所有列（不推荐在生产环境使用 *）</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 推荐：明确指定需要的列</span></span><br><span class="line"><span class="keyword">SELECT</span> id, emp_no, name, salary <span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>

<h3 id="2-3-查询指定列"><a href="#2-3-查询指定列" class="headerlink" title="2.3 查询指定列"></a>2.3 查询指定列</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 查询部分列</span></span><br><span class="line"><span class="keyword">SELECT</span> name, salary, dept_id <span class="keyword">FROM</span> employees;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询单列</span></span><br><span class="line"><span class="keyword">SELECT</span> name <span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>

<h3 id="2-4-去除重复（DISTINCT）"><a href="#2-4-去除重复（DISTINCT）" class="headerlink" title="2.4 去除重复（DISTINCT）"></a>2.4 去除重复（DISTINCT）</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 查询有哪些部门（去重）</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> dept_id <span class="keyword">FROM</span> employees;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 多列去重（多列组合必须完全相同才算重复）</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> dept_id, gender <span class="keyword">FROM</span> employees;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- DISTINCT 必须放在所有列之前</span></span><br><span class="line"><span class="comment">-- 错误写法：SELECT dept_id, DISTINCT salary FROM employees;</span></span><br></pre></td></tr></table></figure>

<h3 id="2-5-列别名（AS）"><a href="#2-5-列别名（AS）" class="headerlink" title="2.5 列别名（AS）"></a>2.5 列别名（AS）</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 使用 AS 指定别名</span></span><br><span class="line"><span class="keyword">SELECT</span> name <span class="keyword">AS</span> 姓名，salary <span class="keyword">AS</span> 工资，hire_date <span class="keyword">AS</span> 入职日期</span><br><span class="line"><span class="keyword">FROM</span> employees;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- AS 可以省略</span></span><br><span class="line"><span class="keyword">SELECT</span> name 姓名，salary 工资 <span class="keyword">FROM</span> employees;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 别名可以包含空格（用引号包裹）</span></span><br><span class="line"><span class="keyword">SELECT</span> salary <span class="keyword">AS</span> <span class="string">&#x27;月工资 (元)&#x27;</span> <span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>

<h3 id="2-6-表别名"><a href="#2-6-表别名" class="headerlink" title="2.6 表别名"></a>2.6 表别名</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 给表指定别名</span></span><br><span class="line"><span class="keyword">SELECT</span> e.name, e.salary, d.dept_name</span><br><span class="line"><span class="keyword">FROM</span> employees <span class="keyword">AS</span> e</span><br><span class="line"><span class="keyword">JOIN</span> departments <span class="keyword">AS</span> d <span class="keyword">ON</span> e.dept_id <span class="operator">=</span> d.id;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- AS 可以省略</span></span><br><span class="line"><span class="keyword">SELECT</span> e.name, d.dept_name</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">JOIN</span> departments d <span class="keyword">ON</span> e.dept_id <span class="operator">=</span> d.id;</span><br></pre></td></tr></table></figure>

<h3 id="2-7-表达式查询"><a href="#2-7-表达式查询" class="headerlink" title="2.7 表达式查询"></a>2.7 表达式查询</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 算术表达式</span></span><br><span class="line"><span class="keyword">SELECT</span> name, salary, salary <span class="operator">*</span> <span class="number">12</span> <span class="keyword">AS</span> 年薪 <span class="keyword">FROM</span> employees;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 字符串拼接</span></span><br><span class="line"><span class="keyword">SELECT</span> CONCAT(name, <span class="string">&#x27; - &#x27;</span>, emp_no) <span class="keyword">AS</span> 员工信息 <span class="keyword">FROM</span> employees;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 函数计算</span></span><br><span class="line"><span class="keyword">SELECT</span> name, <span class="built_in">UPPER</span>(name) <span class="keyword">AS</span> 大写姓名，LENGTH(name) <span class="keyword">AS</span> 名字长度</span><br><span class="line"><span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>

<h3 id="2-8-NULL-值处理"><a href="#2-8-NULL-值处理" class="headerlink" title="2.8 NULL 值处理"></a>2.8 NULL 值处理</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- IFNULL 函数：如果为 NULL 则返回指定值</span></span><br><span class="line"><span class="keyword">SELECT</span> name, IFNULL(salary, <span class="number">0</span>) <span class="keyword">AS</span> 工资 <span class="keyword">FROM</span> employees;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- IF 函数：条件判断</span></span><br><span class="line"><span class="keyword">SELECT</span> name, salary, IF(salary <span class="operator">&gt;</span> <span class="number">8000</span>, <span class="string">&#x27;高薪&#x27;</span>, <span class="string">&#x27;普通&#x27;</span>) <span class="keyword">AS</span> 薪资水平</span><br><span class="line"><span class="keyword">FROM</span> employees;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- CASE 表达式</span></span><br><span class="line"><span class="keyword">SELECT</span> name, salary,</span><br><span class="line">    <span class="keyword">CASE</span></span><br><span class="line">        <span class="keyword">WHEN</span> salary <span class="operator">&gt;=</span> <span class="number">10000</span> <span class="keyword">THEN</span> <span class="string">&#x27;高收入&#x27;</span></span><br><span class="line">        <span class="keyword">WHEN</span> salary <span class="operator">&gt;=</span> <span class="number">8000</span> <span class="keyword">THEN</span> <span class="string">&#x27;中等收入&#x27;</span></span><br><span class="line">        <span class="keyword">ELSE</span> <span class="string">&#x27;低收入&#x27;</span></span><br><span class="line">    <span class="keyword">END</span> <span class="keyword">AS</span> 收入等级</span><br><span class="line"><span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>

<h2 id="三、条件查询（WHERE）"><a href="#三、条件查询（WHERE）" class="headerlink" title="三、条件查询（WHERE）"></a>三、条件查询（WHERE）</h2><p>WHERE 子句用于过滤记录，只返回满足条件的行。</p>
<h3 id="3-1-比较运算符"><a href="#3-1-比较运算符" class="headerlink" title="3.1 比较运算符"></a>3.1 比较运算符</h3><table>
<thead>
<tr>
<th>运算符</th>
<th>说明</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td>&#x3D;</td>
<td>等于</td>
<td><code>salary = 8000</code></td>
</tr>
<tr>
<td>!&#x3D; 或 &lt;&gt;</td>
<td>不等于</td>
<td><code>dept_id != 1</code></td>
</tr>
<tr>
<td>&gt;</td>
<td>大于</td>
<td><code>age &gt; 30</code></td>
</tr>
<tr>
<td>&lt;</td>
<td>小于</td>
<td><code>age &lt; 30</code></td>
</tr>
<tr>
<td>&gt;&#x3D;</td>
<td>大于等于</td>
<td><code>salary &gt;= 8000</code></td>
</tr>
<tr>
<td>&lt;&#x3D;</td>
<td>小于等于</td>
<td><code>salary &lt;= 10000</code></td>
</tr>
<tr>
<td>&lt;&#x3D;&gt;</td>
<td>安全等于（可比较 NULL）</td>
<td><code>dept_id &lt;=&gt; NULL</code></td>
</tr>
</tbody></table>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 等于</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> salary <span class="operator">=</span> <span class="number">8000</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 不等于</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> dept_id <span class="operator">!=</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 大于/小于</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> age <span class="operator">&gt;</span> <span class="number">30</span>;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> salary <span class="operator">&lt;</span> <span class="number">8000</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 大于等于/小于等于</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> salary <span class="operator">&gt;=</span> <span class="number">9000</span>;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> salary <span class="operator">&lt;=</span> <span class="number">7000</span>;</span><br></pre></td></tr></table></figure>

<h3 id="3-2-逻辑运算符"><a href="#3-2-逻辑运算符" class="headerlink" title="3.2 逻辑运算符"></a>3.2 逻辑运算符</h3><table>
<thead>
<tr>
<th>运算符</th>
<th>说明</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td>AND 或 &amp;&amp;</td>
<td>与</td>
<td><code>age &gt; 25 AND salary &gt; 8000</code></td>
</tr>
<tr>
<td>OR 或 ||</td>
<td>或</td>
<td><code>dept_id = 1 OR dept_id = 2</code></td>
</tr>
<tr>
<td>NOT 或 !</td>
<td>非</td>
<td><code>NOT gender = &#39;男&#39;</code></td>
</tr>
</tbody></table>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- AND：同时满足多个条件</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> dept_id <span class="operator">=</span> <span class="number">1</span> <span class="keyword">AND</span> salary <span class="operator">&gt;</span> <span class="number">8000</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- OR：满足任一条件</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> dept_id <span class="operator">=</span> <span class="number">1</span> <span class="keyword">OR</span> dept_id <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- NOT：取反</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">NOT</span> gender <span class="operator">=</span> <span class="string">&#x27;男&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 混合使用（注意优先级：NOT &gt; AND &gt; OR）</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> (dept_id <span class="operator">=</span> <span class="number">1</span> <span class="keyword">OR</span> dept_id <span class="operator">=</span> <span class="number">2</span>) <span class="keyword">AND</span> salary <span class="operator">&gt;</span> <span class="number">8000</span>;</span><br></pre></td></tr></table></figure>

<h3 id="3-3-范围查询"><a href="#3-3-范围查询" class="headerlink" title="3.3 范围查询"></a>3.3 范围查询</h3><h4 id="BETWEEN…AND"><a href="#BETWEEN…AND" class="headerlink" title="BETWEEN…AND"></a>BETWEEN…AND</h4><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 查询工资在 7000 到 9000 之间的员工（包含边界）</span></span><br><span class="line"><span class="keyword">SELECT</span> name, salary <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> salary <span class="keyword">BETWEEN</span> <span class="number">7000</span> <span class="keyword">AND</span> <span class="number">9000</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 等价于</span></span><br><span class="line"><span class="keyword">SELECT</span> name, salary <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> salary <span class="operator">&gt;=</span> <span class="number">7000</span> <span class="keyword">AND</span> salary <span class="operator">&lt;=</span> <span class="number">9000</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- NOT BETWEEN：不在范围内</span></span><br><span class="line"><span class="keyword">SELECT</span> name, salary <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> salary <span class="keyword">NOT</span> <span class="keyword">BETWEEN</span> <span class="number">7000</span> <span class="keyword">AND</span> <span class="number">9000</span>;</span><br></pre></td></tr></table></figure>

<h4 id="IN-NOT-IN"><a href="#IN-NOT-IN" class="headerlink" title="IN &#x2F; NOT IN"></a>IN &#x2F; NOT IN</h4><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 查询部门 ID 为 1、2、3 的员工</span></span><br><span class="line"><span class="keyword">SELECT</span> name, dept_id <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> dept_id <span class="keyword">IN</span> (<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 等价于</span></span><br><span class="line"><span class="keyword">SELECT</span> name, dept_id <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> dept_id <span class="operator">=</span> <span class="number">1</span> <span class="keyword">OR</span> dept_id <span class="operator">=</span> <span class="number">2</span> <span class="keyword">OR</span> dept_id <span class="operator">=</span> <span class="number">3</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- NOT IN：不在指定集合中</span></span><br><span class="line"><span class="keyword">SELECT</span> name, dept_id <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> dept_id <span class="keyword">NOT</span> <span class="keyword">IN</span> (<span class="number">1</span>, <span class="number">3</span>);</span><br></pre></td></tr></table></figure>

<h3 id="3-4-模糊查询（LIKE）"><a href="#3-4-模糊查询（LIKE）" class="headerlink" title="3.4 模糊查询（LIKE）"></a>3.4 模糊查询（LIKE）</h3><p>LIKE 用于字符串匹配，支持通配符：</p>
<ul>
<li><code>%</code>：匹配任意数量的字符（包括 0 个）</li>
<li><code>_</code>：匹配单个字符</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 以&#x27;张&#x27;开头的名字</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> name <span class="keyword">LIKE</span> <span class="string">&#x27;张%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 以&#x27;四&#x27;结尾的名字</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> name <span class="keyword">LIKE</span> <span class="string">&#x27;%四&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 包含&#x27;十&#x27;的名字</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> name <span class="keyword">LIKE</span> <span class="string">&#x27;%十%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 第二个字是&#x27;十&#x27;的名字（_匹配一个字符）</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> name <span class="keyword">LIKE</span> <span class="string">&#x27;_十%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 正好两个字的姓</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> name <span class="keyword">LIKE</span> <span class="string">&#x27;__&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 不以&#x27;张&#x27;开头的名字</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> name <span class="keyword">NOT</span> <span class="keyword">LIKE</span> <span class="string">&#x27;张%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 匹配特殊字符（使用转义）</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> name <span class="keyword">LIKE</span> <span class="string">&#x27;张\_%&#x27;</span>;  <span class="comment">-- 匹配&#x27;张_&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="3-5-NULL-值查询"><a href="#3-5-NULL-值查询" class="headerlink" title="3.5 NULL 值查询"></a>3.5 NULL 值查询</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 查询 dept_id 为 NULL 的员工</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> dept_id <span class="keyword">IS</span> <span class="keyword">NULL</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询 dept_id 不为 NULL 的员工</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> dept_id <span class="keyword">IS</span> <span class="keyword">NOT NULL</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 错误写法：不能用 = 判断 NULL</span></span><br><span class="line"><span class="comment">-- SELECT * FROM employees WHERE dept_id = NULL;  -- 不会返回任何结果</span></span><br></pre></td></tr></table></figure>

<h3 id="3-6-正则表达式（REGEXP）"><a href="#3-6-正则表达式（REGEXP）" class="headerlink" title="3.6 正则表达式（REGEXP）"></a>3.6 正则表达式（REGEXP）</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 以张或李开头</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> name REGEXP <span class="string">&#x27;^张 | ^李&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 包含数字</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> emp_no REGEXP <span class="string">&#x27;[0-9]&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 三个字的姓名</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> name REGEXP <span class="string">&#x27;^.&#123;3&#125;$&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h2 id="四、聚合函数"><a href="#四、聚合函数" class="headerlink" title="四、聚合函数"></a>四、聚合函数</h2><p>聚合函数对一组数据进行计算，返回单个值。</p>
<h3 id="4-1-常用聚合函数"><a href="#4-1-常用聚合函数" class="headerlink" title="4.1 常用聚合函数"></a>4.1 常用聚合函数</h3><table>
<thead>
<tr>
<th>函数</th>
<th>功能</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>COUNT()</td>
<td>计数</td>
<td>统计行数</td>
</tr>
<tr>
<td>SUM()</td>
<td>求和</td>
<td>计算总和</td>
</tr>
<tr>
<td>AVG()</td>
<td>平均值</td>
<td>计算平均数</td>
</tr>
<tr>
<td>MAX()</td>
<td>最大值</td>
<td>找出最大值</td>
</tr>
<tr>
<td>MIN()</td>
<td>最小值</td>
<td>找出最小值</td>
</tr>
</tbody></table>
<h3 id="4-2-COUNT-计数"><a href="#4-2-COUNT-计数" class="headerlink" title="4.2 COUNT 计数"></a>4.2 COUNT 计数</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 统计员工总数</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">FROM</span> employees;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 统计在职员工数</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> status <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- COUNT(列名) 忽略 NULL 值</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(salary) <span class="keyword">FROM</span> employees;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- COUNT(*) 包含 NULL 值</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">FROM</span> employees;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 统计不同部门数量</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="keyword">DISTINCT</span> dept_id) <span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>

<p><strong>COUNT(*) vs COUNT(列) vs COUNT(1)</strong>：</p>
<ul>
<li><code>COUNT(*)</code>：统计所有行（包括 NULL），推荐用于计数</li>
<li><code>COUNT(列)</code>：统计该列非 NULL 的行数</li>
<li><code>COUNT(1)</code>：效果同 COUNT(*)，但某些场景略慢</li>
</ul>
<h3 id="4-3-SUM-求和"><a href="#4-3-SUM-求和" class="headerlink" title="4.3 SUM 求和"></a>4.3 SUM 求和</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 计算工资总和</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">SUM</span>(salary) <span class="keyword">AS</span> 工资总额 <span class="keyword">FROM</span> employees;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 计算在职员工工资总和</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">SUM</span>(salary) <span class="keyword">AS</span> 在职员工工资总额</span><br><span class="line"><span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> status <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 计算各部门工资总和（配合 GROUP BY）</span></span><br><span class="line"><span class="keyword">SELECT</span> dept_id, <span class="built_in">SUM</span>(salary) <span class="keyword">AS</span> 部门工资总额</span><br><span class="line"><span class="keyword">FROM</span> employees <span class="keyword">GROUP</span> <span class="keyword">BY</span> dept_id;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- SUM 忽略 NULL 值</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">SUM</span>(salary) <span class="keyword">FROM</span> employees;  <span class="comment">-- NULL 值不参与计算</span></span><br></pre></td></tr></table></figure>

<h3 id="4-4-AVG-平均值"><a href="#4-4-AVG-平均值" class="headerlink" title="4.4 AVG 平均值"></a>4.4 AVG 平均值</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 计算平均工资</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">AVG</span>(salary) <span class="keyword">AS</span> 平均工资 <span class="keyword">FROM</span> employees;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 保留 2 位小数</span></span><br><span class="line"><span class="keyword">SELECT</span> ROUND(<span class="built_in">AVG</span>(salary), <span class="number">2</span>) <span class="keyword">AS</span> 平均工资 <span class="keyword">FROM</span> employees;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 计算在职员工平均工资</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">AVG</span>(salary) <span class="keyword">AS</span> 在职平均工资</span><br><span class="line"><span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> status <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- AVG 忽略 NULL 值</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">AVG</span>(salary) <span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>

<h3 id="4-5-MAX-MIN-最值"><a href="#4-5-MAX-MIN-最值" class="headerlink" title="4.5 MAX&#x2F;MIN 最值"></a>4.5 MAX&#x2F;MIN 最值</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 最高工资</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">MAX</span>(salary) <span class="keyword">AS</span> 最高工资 <span class="keyword">FROM</span> employees;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 最低工资</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">MIN</span>(salary) <span class="keyword">AS</span> 最低工资 <span class="keyword">FROM</span> employees;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 最大/最小年龄</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">MAX</span>(age) <span class="keyword">AS</span> 最大年龄，<span class="built_in">MIN</span>(age) <span class="keyword">AS</span> 最小年龄 <span class="keyword">FROM</span> employees;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 最早/最晚入职日期</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">MIN</span>(hire_date) <span class="keyword">AS</span> 最早入职，<span class="built_in">MAX</span>(hire_date) <span class="keyword">AS</span> 最晚入职</span><br><span class="line"><span class="keyword">FROM</span> employees;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 获取最高工资的员工信息（子查询）</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> salary <span class="operator">=</span> (<span class="keyword">SELECT</span> <span class="built_in">MAX</span>(salary) <span class="keyword">FROM</span> employees);</span><br></pre></td></tr></table></figure>

<h3 id="4-6-聚合函数组合使用"><a href="#4-6-聚合函数组合使用" class="headerlink" title="4.6 聚合函数组合使用"></a>4.6 聚合函数组合使用</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 同时查询多个聚合值</span></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">AS</span> 员工总数，</span><br><span class="line">    <span class="built_in">SUM</span>(salary) <span class="keyword">AS</span> 工资总额，</span><br><span class="line">    ROUND(<span class="built_in">AVG</span>(salary), <span class="number">2</span>) <span class="keyword">AS</span> 平均工资，</span><br><span class="line">    <span class="built_in">MAX</span>(salary) <span class="keyword">AS</span> 最高工资，</span><br><span class="line">    <span class="built_in">MIN</span>(salary) <span class="keyword">AS</span> 最低工资</span><br><span class="line"><span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>

<h2 id="五、分组查询（GROUP-BY）"><a href="#五、分组查询（GROUP-BY）" class="headerlink" title="五、分组查询（GROUP BY）"></a>五、分组查询（GROUP BY）</h2><p>GROUP BY 将数据按指定列分组，通常与聚合函数配合使用。</p>
<h3 id="5-1-基础分组"><a href="#5-1-基础分组" class="headerlink" title="5.1 基础分组"></a>5.1 基础分组</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 按部门分组，统计每组人数</span></span><br><span class="line"><span class="keyword">SELECT</span> dept_id, <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">AS</span> 人数</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> dept_id;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 按部门分组，统计工资总和</span></span><br><span class="line"><span class="keyword">SELECT</span> dept_id, <span class="built_in">SUM</span>(salary) <span class="keyword">AS</span> 工资总额</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> dept_id;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 按性别分组</span></span><br><span class="line"><span class="keyword">SELECT</span> gender, <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">AS</span> 人数，<span class="built_in">AVG</span>(salary) <span class="keyword">AS</span> 平均工资</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> gender;</span><br></pre></td></tr></table></figure>

<h3 id="5-2-多列分组"><a href="#5-2-多列分组" class="headerlink" title="5.2 多列分组"></a>5.2 多列分组</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 按部门和性别分组</span></span><br><span class="line"><span class="keyword">SELECT</span> dept_id, gender, <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">AS</span> 人数，<span class="built_in">AVG</span>(salary) <span class="keyword">AS</span> 平均工资</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> dept_id, gender</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> dept_id, gender;</span><br></pre></td></tr></table></figure>

<h3 id="5-3-分组与连接查询"><a href="#5-3-分组与连接查询" class="headerlink" title="5.3 分组与连接查询"></a>5.3 分组与连接查询</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 显示部门名称的分组统计</span></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    d.dept_name,</span><br><span class="line">    <span class="built_in">COUNT</span>(e.id) <span class="keyword">AS</span> 人数，</span><br><span class="line">    <span class="built_in">SUM</span>(e.salary) <span class="keyword">AS</span> 工资总额，</span><br><span class="line">    ROUND(<span class="built_in">AVG</span>(e.salary), <span class="number">2</span>) <span class="keyword">AS</span> 平均工资</span><br><span class="line"><span class="keyword">FROM</span> departments d</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> employees e <span class="keyword">ON</span> d.id <span class="operator">=</span> e.dept_id</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> d.id, d.dept_name;</span><br></pre></td></tr></table></figure>

<h3 id="5-4-HAVING-子句"><a href="#5-4-HAVING-子句" class="headerlink" title="5.4 HAVING 子句"></a>5.4 HAVING 子句</h3><p>HAVING 用于过滤分组后的结果，WHERE 过滤分组前的数据。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 查询人数大于 2 的部门</span></span><br><span class="line"><span class="keyword">SELECT</span> dept_id, <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">AS</span> 人数</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> dept_id</span><br><span class="line"><span class="keyword">HAVING</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="operator">&gt;</span> <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询平均工资大于 8000 的部门</span></span><br><span class="line"><span class="keyword">SELECT</span> dept_id, <span class="built_in">AVG</span>(salary) <span class="keyword">AS</span> 平均工资</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> dept_id</span><br><span class="line"><span class="keyword">HAVING</span> <span class="built_in">AVG</span>(salary) <span class="operator">&gt;</span> <span class="number">8000</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- WHERE 与 HAVING 的区别</span></span><br><span class="line"><span class="keyword">SELECT</span> dept_id, <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">AS</span> 人数</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> status <span class="operator">=</span> <span class="number">1</span>              <span class="comment">-- 过滤原始数据</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> dept_id</span><br><span class="line"><span class="keyword">HAVING</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="operator">&gt;</span> <span class="number">1</span>;          <span class="comment">-- 过滤分组结果</span></span><br></pre></td></tr></table></figure>

<p><strong>WHERE vs HAVING 对比</strong>：</p>
<table>
<thead>
<tr>
<th>对比项</th>
<th>WHERE</th>
<th>HAVING</th>
</tr>
</thead>
<tbody><tr>
<td>作用时机</td>
<td>分组前</td>
<td>分组后</td>
</tr>
<tr>
<td>可用位置</td>
<td>所有查询</td>
<td>GROUP BY 后</td>
</tr>
<tr>
<td>聚合函数</td>
<td>不支持</td>
<td>支持</td>
</tr>
<tr>
<td>执行顺序</td>
<td>先执行</td>
<td>后执行</td>
</tr>
</tbody></table>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 错误：WHERE 中不能使用聚合函数</span></span><br><span class="line"><span class="comment">-- SELECT dept_id FROM employees WHERE COUNT(*) &gt; 2 GROUP BY dept_id;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 正确：使用 HAVING</span></span><br><span class="line"><span class="keyword">SELECT</span> dept_id <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> dept_id</span><br><span class="line"><span class="keyword">HAVING</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="operator">&gt;</span> <span class="number">2</span>;</span><br></pre></td></tr></table></figure>

<h3 id="5-5-综合分组练习"><a href="#5-5-综合分组练习" class="headerlink" title="5.5 综合分组练习"></a>5.5 综合分组练习</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 练习 1：统计各部门在职员工的人数、平均工资</span></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    d.dept_name,</span><br><span class="line">    <span class="built_in">COUNT</span>(e.id) <span class="keyword">AS</span> 在职人数，</span><br><span class="line">    ROUND(<span class="built_in">AVG</span>(e.salary), <span class="number">2</span>) <span class="keyword">AS</span> 平均工资</span><br><span class="line"><span class="keyword">FROM</span> departments d</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> employees e <span class="keyword">ON</span> d.id <span class="operator">=</span> e.dept_id <span class="keyword">AND</span> e.status <span class="operator">=</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> d.id, d.dept_name;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 练习 2：统计各部门工资最高的员工</span></span><br><span class="line"><span class="keyword">SELECT</span> e.dept_id, e.name, e.salary</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> dept_id, <span class="built_in">MAX</span>(salary) <span class="keyword">AS</span> max_salary</span><br><span class="line">    <span class="keyword">FROM</span> employees</span><br><span class="line">    <span class="keyword">GROUP</span> <span class="keyword">BY</span> dept_id</span><br><span class="line">) m <span class="keyword">ON</span> e.dept_id <span class="operator">=</span> m.dept_id <span class="keyword">AND</span> e.salary <span class="operator">=</span> m.max_salary;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 练习 3：统计员工入职年份及人数</span></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    <span class="keyword">YEAR</span>(hire_date) <span class="keyword">AS</span> 入职年份，</span><br><span class="line">    <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">AS</span> 人数</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> <span class="keyword">YEAR</span>(hire_date)</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> 入职年份;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 练习 4：统计不同年龄段的员工数</span></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    <span class="keyword">CASE</span></span><br><span class="line">        <span class="keyword">WHEN</span> age <span class="operator">&lt;</span> <span class="number">25</span> <span class="keyword">THEN</span> <span class="string">&#x27;25 岁以下&#x27;</span></span><br><span class="line">        <span class="keyword">WHEN</span> age <span class="keyword">BETWEEN</span> <span class="number">25</span> <span class="keyword">AND</span> <span class="number">30</span> <span class="keyword">THEN</span> <span class="string">&#x27;25-30 岁&#x27;</span></span><br><span class="line">        <span class="keyword">WHEN</span> age <span class="keyword">BETWEEN</span> <span class="number">31</span> <span class="keyword">AND</span> <span class="number">35</span> <span class="keyword">THEN</span> <span class="string">&#x27;31-35 岁&#x27;</span></span><br><span class="line">        <span class="keyword">ELSE</span> <span class="string">&#x27;35 岁以上&#x27;</span></span><br><span class="line">    <span class="keyword">END</span> <span class="keyword">AS</span> 年龄段，</span><br><span class="line">    <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">AS</span> 人数</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> 年龄段</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> 年龄段;</span><br></pre></td></tr></table></figure>

<h2 id="六、小结（上）"><a href="#六、小结（上）" class="headerlink" title="六、小结（上）"></a>六、小结（上）</h2><p>本文上半部分讲解了：</p>
<ol>
<li><strong>基础查询</strong>：SELECT *、指定列、DISTINCT、别名、表达式</li>
<li><strong>条件查询</strong>：比较运算符、逻辑运算符、BETWEEN、IN、LIKE、NULL 判断</li>
<li><strong>聚合函数</strong>：COUNT、SUM、AVG、MAX、MIN</li>
<li><strong>分组查询</strong>：GROUP BY、HAVING</li>
</ol>
<p>下半部分将继续讲解：</p>
<ul>
<li>排序查询（ORDER BY）</li>
<li>分页查询（LIMIT）</li>
<li>综合案例练习</li>
<li>SQL 执行顺序</li>
</ul>
<hr>
<p><strong>下一篇</strong>：[MySQL 基础教程（四）DQL 数据查询语言详解（下）](&#x2F;2026&#x2F;02&#x2F;23&#x2F;MySQL 基础教程（四）DQL 数据查询语言详解（下）&#x2F;)</p>
<p><strong>上一篇</strong>：[MySQL 基础教程（三）：DML 数据操作语言详解](&#x2F;2026&#x2F;02&#x2F;23&#x2F;MySQL 基础教程（三）DML 数据操作语言详解&#x2F;)</p>
]]></content>
      <categories>
        <category>MySQL 基础教程</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
        <tag>DQL</tag>
        <tag>数据查询</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQL 基础教程（三）DML 数据操作语言详解</title>
    <url>/2026/02/23/MySQL%20%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B%EF%BC%88%E4%B8%89%EF%BC%89DML%20%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C%E8%AF%AD%E8%A8%80%E8%AF%A6%E8%A7%A3/</url>
    <content><![CDATA[<h1 id="MySQL-基础教程（三）DML-数据操作语言详解"><a href="#MySQL-基础教程（三）DML-数据操作语言详解" class="headerlink" title="MySQL 基础教程（三）DML 数据操作语言详解"></a>MySQL 基础教程（三）DML 数据操作语言详解</h1><p>在上一篇文章中，我们学习了如何使用 DDL 创建和管理数据库表结构。本文我们将学习 <strong>DML（Data Manipulation Language）数据操作语言</strong>，掌握如何对表中的数据进行插入、更新和删除操作。</p>
<h2 id="一、DML-概述"><a href="#一、DML-概述" class="headerlink" title="一、DML 概述"></a>一、DML 概述</h2><p>DML 用于对数据库表中的数据进行操作，主要包括：</p>
<table>
<thead>
<tr>
<th>命令</th>
<th>功能</th>
<th>特点</th>
</tr>
</thead>
<tbody><tr>
<td>INSERT</td>
<td>插入数据</td>
<td>添加新记录</td>
</tr>
<tr>
<td>UPDATE</td>
<td>更新数据</td>
<td>修改现有记录</td>
</tr>
<tr>
<td>DELETE</td>
<td>删除数据</td>
<td>删除符合条件的记录</td>
</tr>
<tr>
<td>TRUNCATE</td>
<td>清空表</td>
<td>删除全部记录并重置自增</td>
</tr>
</tbody></table>
<p><strong>DML 的特点</strong>：</p>
<ul>
<li>操作的是数据内容，不影响表结构</li>
<li>在事务中可回滚（需要关闭自动提交）</li>
<li>可以配合 WHERE 子句进行条件操作</li>
</ul>
<h2 id="二、插入数据（INSERT）"><a href="#二、插入数据（INSERT）" class="headerlink" title="二、插入数据（INSERT）"></a>二、插入数据（INSERT）</h2><h3 id="2-1-基础插入语法"><a href="#2-1-基础插入语法" class="headerlink" title="2.1 基础插入语法"></a>2.1 基础插入语法</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 语法</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> 表名 (列 <span class="number">1</span>, 列 <span class="number">2</span>, ..., 列 n)</span><br><span class="line"><span class="keyword">VALUES</span> (值 <span class="number">1</span>, 值 <span class="number">2</span>, ..., 值 n);</span><br></pre></td></tr></table></figure>

<h3 id="2-2-插入单条记录"><a href="#2-2-插入单条记录" class="headerlink" title="2.2 插入单条记录"></a>2.2 插入单条记录</h3><p>首先创建测试表：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 创建测试表</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> employees (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT,</span><br><span class="line">    name <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">    dept <span class="type">VARCHAR</span>(<span class="number">50</span>),</span><br><span class="line">    salary <span class="type">DECIMAL</span>(<span class="number">10</span>, <span class="number">2</span>),</span><br><span class="line">    hire_date <span class="type">DATE</span>,</span><br><span class="line">    status TINYINT <span class="keyword">DEFAULT</span> <span class="number">1</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 方式一：指定列名插入（推荐）</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> employees (name, dept, salary, hire_date)</span><br><span class="line"><span class="keyword">VALUES</span> (<span class="string">&#x27;张三&#x27;</span>, <span class="string">&#x27;技术部&#x27;</span>, <span class="number">8000.00</span>, <span class="string">&#x27;2024-01-15&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 方式二：不指定列名（必须为所有列提供值）</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> employees <span class="keyword">VALUES</span></span><br><span class="line">(<span class="number">2</span>, <span class="string">&#x27;李四&#x27;</span>, <span class="string">&#x27;市场部&#x27;</span>, <span class="number">7500.00</span>, <span class="string">&#x27;2024-02-01&#x27;</span>, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 方式三：利用默认值</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> employees (name, dept, salary)</span><br><span class="line"><span class="keyword">VALUES</span> (<span class="string">&#x27;王五&#x27;</span>, <span class="string">&#x27;人事部&#x27;</span>, <span class="number">6500.00</span>);</span><br><span class="line"><span class="comment">-- hire_date 为 NULL，status 为默认值 1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 方式四：设置 NULL 值</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> employees (name, dept, salary, hire_date, status)</span><br><span class="line"><span class="keyword">VALUES</span> (<span class="string">&#x27;赵六&#x27;</span>, <span class="keyword">NULL</span>, <span class="number">5000.00</span>, <span class="keyword">NULL</span>, <span class="number">1</span>);</span><br></pre></td></tr></table></figure>

<p><strong>注意事项</strong>：</p>
<ol>
<li>字符串和日期类型需要用引号包裹</li>
<li>插入的值必须与列的数据类型兼容</li>
<li>NOT NULL 约束的列必须提供值（除非有 DEFAULT）</li>
<li>主键列如果是自增，可以传入 NULL 或 DEFAULT 让系统自动生成</li>
</ol>
<h3 id="2-3-批量插入"><a href="#2-3-批量插入" class="headerlink" title="2.3 批量插入"></a>2.3 批量插入</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 一次插入多条记录（推荐，效率高）</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> employees (name, dept, salary, hire_date) <span class="keyword">VALUES</span></span><br><span class="line">(<span class="string">&#x27;孙七&#x27;</span>, <span class="string">&#x27;技术部&#x27;</span>, <span class="number">9000.00</span>, <span class="string">&#x27;2023-06-01&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;周八&#x27;</span>, <span class="string">&#x27;技术部&#x27;</span>, <span class="number">9500.00</span>, <span class="string">&#x27;2023-03-15&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;吴九&#x27;</span>, <span class="string">&#x27;市场部&#x27;</span>, <span class="number">7000.00</span>, <span class="string">&#x27;2024-01-10&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;郑十&#x27;</span>, <span class="string">&#x27;财务部&#x27;</span>, <span class="number">8500.00</span>, <span class="string">&#x27;2023-09-01&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;王十一&#x27;</span>, <span class="string">&#x27;市场部&#x27;</span>, <span class="number">7200.00</span>, <span class="string">&#x27;2023-12-01&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 验证插入结果</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>

<h3 id="2-4-插入时处理重复"><a href="#2-4-插入时处理重复" class="headerlink" title="2.4 插入时处理重复"></a>2.4 插入时处理重复</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 创建带唯一约束的表</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> users (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT,</span><br><span class="line">    username <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">UNIQUE</span> <span class="keyword">NOT NULL</span>,</span><br><span class="line">    email <span class="type">VARCHAR</span>(<span class="number">100</span>),</span><br><span class="line">    password <span class="type">VARCHAR</span>(<span class="number">255</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT INTO</span> users (username, email, password) <span class="keyword">VALUES</span></span><br><span class="line">(<span class="string">&#x27;user1&#x27;</span>, <span class="string">&#x27;user1@example.com&#x27;</span>, <span class="string">&#x27;pwd123&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;user2&#x27;</span>, <span class="string">&#x27;user2@example.com&#x27;</span>, <span class="string">&#x27;pwd456&#x27;</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 方式一：INSERT IGNORE（忽略重复）</span></span><br><span class="line"><span class="keyword">INSERT</span> IGNORE <span class="keyword">INTO</span> users (username, email, password)</span><br><span class="line"><span class="keyword">VALUES</span> (<span class="string">&#x27;user1&#x27;</span>, <span class="string">&#x27;new@example.com&#x27;</span>, <span class="string">&#x27;newpwd&#x27;</span>);</span><br><span class="line"><span class="comment">-- user1 已存在，该条语句被忽略，不会报错</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 方式二：ON DUPLICATE KEY UPDATE（重复则更新）</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> users (username, email, password)</span><br><span class="line"><span class="keyword">VALUES</span> (<span class="string">&#x27;user1&#x27;</span>, <span class="string">&#x27;updated@example.com&#x27;</span>, <span class="string">&#x27;newpwd123&#x27;</span>)</span><br><span class="line"><span class="keyword">ON</span> DUPLICATE KEY <span class="keyword">UPDATE</span></span><br><span class="line">    email <span class="operator">=</span> <span class="keyword">VALUES</span>(email),</span><br><span class="line">    password <span class="operator">=</span> <span class="keyword">VALUES</span>(password);</span><br><span class="line"><span class="comment">-- 如果 user1 存在，则更新 email 和 password</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 方式三：REPLACE INTO（删除后重新插入）</span></span><br><span class="line">REPLACE <span class="keyword">INTO</span> users (username, email, password)</span><br><span class="line"><span class="keyword">VALUES</span> (<span class="string">&#x27;user1&#x27;</span>, <span class="string">&#x27;replaced@example.com&#x27;</span>, <span class="string">&#x27;replacepwd&#x27;</span>);</span><br><span class="line"><span class="comment">-- 如果存在则先删除再插入，id 会变化</span></span><br></pre></td></tr></table></figure>

<h3 id="2-5-从其他表插入数据"><a href="#2-5-从其他表插入数据" class="headerlink" title="2.5 从其他表插入数据"></a>2.5 从其他表插入数据</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 创建员工备份表</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> employees_backup <span class="keyword">LIKE</span> employees;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 方式一：INSERT ... SELECT</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> employees_backup (id, name, dept, salary, hire_date, status)</span><br><span class="line"><span class="keyword">SELECT</span> id, name, dept, salary, hire_date, status <span class="keyword">FROM</span> employees;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 方式二：CREATE TABLE ... AS SELECT（创建并插入）</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> employees_copy <span class="keyword">AS</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> dept <span class="operator">=</span> <span class="string">&#x27;技术部&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h3 id="2-6-INSERT-性能优化技巧"><a href="#2-6-INSERT-性能优化技巧" class="headerlink" title="2.6 INSERT 性能优化技巧"></a>2.6 INSERT 性能优化技巧</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 技巧 1：使用批量插入（比单条插入快得多）</span></span><br><span class="line"><span class="comment">-- 慢：</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> employees (name, dept) <span class="keyword">VALUES</span> (<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;技术部&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT INTO</span> employees (name, dept) <span class="keyword">VALUES</span> (<span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;技术部&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT INTO</span> employees (name, dept) <span class="keyword">VALUES</span> (<span class="string">&#x27;C&#x27;</span>, <span class="string">&#x27;技术部&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 快：</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> employees (name, dept) <span class="keyword">VALUES</span></span><br><span class="line">(<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;技术部&#x27;</span>), (<span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;技术部&#x27;</span>), (<span class="string">&#x27;C&#x27;</span>, <span class="string">&#x27;技术部&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 技巧 2：对于大量数据，可以先禁用索引再插入</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> employees DISABLE KEYS;</span><br><span class="line"><span class="comment">-- 执行批量插入</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> employees ENABLE KEYS;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 技巧 3：使用事务包装（减少自动提交）</span></span><br><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"><span class="comment">-- 多条 INSERT 语句</span></span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br></pre></td></tr></table></figure>

<h2 id="三、更新数据（UPDATE）"><a href="#三、更新数据（UPDATE）" class="headerlink" title="三、更新数据（UPDATE）"></a>三、更新数据（UPDATE）</h2><h3 id="3-1-基础更新语法"><a href="#3-1-基础更新语法" class="headerlink" title="3.1 基础更新语法"></a>3.1 基础更新语法</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 语法</span></span><br><span class="line"><span class="keyword">UPDATE</span> 表名</span><br><span class="line"><span class="keyword">SET</span> 列 <span class="number">1</span> <span class="operator">=</span> 值 <span class="number">1</span>, 列 <span class="number">2</span> <span class="operator">=</span> 值 <span class="number">2</span>, ...</span><br><span class="line">[<span class="keyword">WHERE</span> 条件];</span><br></pre></td></tr></table></figure>

<h3 id="3-2-更新指定记录"><a href="#3-2-更新指定记录" class="headerlink" title="3.2 更新指定记录"></a>3.2 更新指定记录</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 更新单条记录</span></span><br><span class="line"><span class="keyword">UPDATE</span> employees</span><br><span class="line"><span class="keyword">SET</span> salary <span class="operator">=</span> <span class="number">8500.00</span></span><br><span class="line"><span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 更新多列</span></span><br><span class="line"><span class="keyword">UPDATE</span> employees</span><br><span class="line"><span class="keyword">SET</span> salary <span class="operator">=</span> <span class="number">9000.00</span>, dept <span class="operator">=</span> <span class="string">&#x27;研发部&#x27;</span></span><br><span class="line"><span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 基于现有值更新</span></span><br><span class="line"><span class="keyword">UPDATE</span> employees</span><br><span class="line"><span class="keyword">SET</span> salary <span class="operator">=</span> salary <span class="operator">*</span> <span class="number">1.1</span>  <span class="comment">-- 加薪 10%</span></span><br><span class="line"><span class="keyword">WHERE</span> dept <span class="operator">=</span> <span class="string">&#x27;技术部&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 更新满足条件的多条记录</span></span><br><span class="line"><span class="keyword">UPDATE</span> employees</span><br><span class="line"><span class="keyword">SET</span> status <span class="operator">=</span> <span class="number">0</span>  <span class="comment">-- 设为离职状态</span></span><br><span class="line"><span class="keyword">WHERE</span> hire_date <span class="operator">&lt;</span> <span class="string">&#x27;2023-01-01&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p><strong>重要提醒</strong>：</p>
<blockquote>
<p>⚠️ <strong>UPDATE 语句一定要加 WHERE 子句！</strong> 否则整张表的所有记录都会被更新！</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 危险操作！会更新所有记录！</span></span><br><span class="line"><span class="keyword">UPDATE</span> employees <span class="keyword">SET</span> salary <span class="operator">=</span> <span class="number">5000</span>;  <span class="comment">-- 所有人的工资都变成 5000！</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 补救措施（如果开启了事务）</span></span><br><span class="line"><span class="keyword">ROLLBACK</span>;</span><br></pre></td></tr></table></figure>

<h3 id="3-3-更新时使用表达式"><a href="#3-3-更新时使用表达式" class="headerlink" title="3.3 更新时使用表达式"></a>3.3 更新时使用表达式</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 使用计算表达式</span></span><br><span class="line"><span class="keyword">UPDATE</span> employees</span><br><span class="line"><span class="keyword">SET</span> salary <span class="operator">=</span> salary <span class="operator">+</span> <span class="number">500</span>  <span class="comment">-- 每人加薪 500</span></span><br><span class="line"><span class="keyword">WHERE</span> status <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 使用函数</span></span><br><span class="line"><span class="keyword">UPDATE</span> employees</span><br><span class="line"><span class="keyword">SET</span> name <span class="operator">=</span> <span class="built_in">UPPER</span>(name)  <span class="comment">-- 姓名转大写</span></span><br><span class="line"><span class="keyword">WHERE</span> dept <span class="operator">=</span> <span class="string">&#x27;市场部&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 使用日期函数</span></span><br><span class="line"><span class="keyword">UPDATE</span> employees</span><br><span class="line"><span class="keyword">SET</span> hire_date <span class="operator">=</span> DATE_SUB(hire_date, <span class="type">INTERVAL</span> <span class="number">1</span> <span class="keyword">YEAR</span>)</span><br><span class="line"><span class="keyword">WHERE</span> id <span class="keyword">BETWEEN</span> <span class="number">1</span> <span class="keyword">AND</span> <span class="number">5</span>;</span><br></pre></td></tr></table></figure>

<h3 id="3-4-多表更新"><a href="#3-4-多表更新" class="headerlink" title="3.4 多表更新"></a>3.4 多表更新</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 创建部门表</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> departments (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT,</span><br><span class="line">    dept_name <span class="type">VARCHAR</span>(<span class="number">50</span>),</span><br><span class="line">    budget <span class="type">DECIMAL</span>(<span class="number">12</span>, <span class="number">2</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT INTO</span> departments (dept_name, budget) <span class="keyword">VALUES</span></span><br><span class="line">(<span class="string">&#x27;技术部&#x27;</span>, <span class="number">1000000</span>),</span><br><span class="line">(<span class="string">&#x27;市场部&#x27;</span>, <span class="number">500000</span>),</span><br><span class="line">(<span class="string">&#x27;财务部&#x27;</span>, <span class="number">300000</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 修改 employees 表，添加 dept_id</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> employees <span class="keyword">ADD</span> <span class="keyword">COLUMN</span> dept_id <span class="type">INT</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 多表关联更新</span></span><br><span class="line"><span class="keyword">UPDATE</span> employees e</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> departments d <span class="keyword">ON</span> e.dept <span class="operator">=</span> d.dept_name</span><br><span class="line"><span class="keyword">SET</span> e.dept_id <span class="operator">=</span> d.id;</span><br></pre></td></tr></table></figure>

<h3 id="3-5-更新-LIMIT"><a href="#3-5-更新-LIMIT" class="headerlink" title="3.5 更新 LIMIT"></a>3.5 更新 LIMIT</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 只更新前 N 条记录</span></span><br><span class="line"><span class="keyword">UPDATE</span> employees</span><br><span class="line"><span class="keyword">SET</span> salary <span class="operator">=</span> salary <span class="operator">+</span> <span class="number">100</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> salary <span class="keyword">ASC</span></span><br><span class="line">LIMIT <span class="number">5</span>;  <span class="comment">-- 工资最低的 5 个人加薪 100</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 结合 WHERE 和 LIMIT</span></span><br><span class="line"><span class="keyword">UPDATE</span> employees</span><br><span class="line"><span class="keyword">SET</span> status <span class="operator">=</span> <span class="number">0</span></span><br><span class="line"><span class="keyword">WHERE</span> dept <span class="operator">=</span> <span class="string">&#x27;市场部&#x27;</span></span><br><span class="line">LIMIT <span class="number">1</span>;  <span class="comment">-- 只更新 1 条市场部员工</span></span><br></pre></td></tr></table></figure>

<h2 id="四、删除数据（DELETE）"><a href="#四、删除数据（DELETE）" class="headerlink" title="四、删除数据（DELETE）"></a>四、删除数据（DELETE）</h2><h3 id="4-1-基础删除语法"><a href="#4-1-基础删除语法" class="headerlink" title="4.1 基础删除语法"></a>4.1 基础删除语法</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 语法</span></span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> 表名 [<span class="keyword">WHERE</span> 条件];</span><br></pre></td></tr></table></figure>

<h3 id="4-2-删除指定记录"><a href="#4-2-删除指定记录" class="headerlink" title="4.2 删除指定记录"></a>4.2 删除指定记录</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 删除单条记录</span></span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 删除多条记录</span></span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> dept <span class="operator">=</span> <span class="string">&#x27;市场部&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 使用 IN 删除</span></span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> id <span class="keyword">IN</span> (<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 使用条件删除</span></span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> salary <span class="operator">&lt;</span> <span class="number">6000</span> <span class="keyword">AND</span> status <span class="operator">=</span> <span class="number">0</span>;</span><br></pre></td></tr></table></figure>

<p><strong>重要提醒</strong>：</p>
<blockquote>
<p>⚠️ <strong>DELETE 语句一定要加 WHERE 子句！</strong> 否则会删除整张表的所有数据！</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 危险操作！会删除所有记录！</span></span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> employees;  <span class="comment">-- 表清空！</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 如果误操作且开启了事务</span></span><br><span class="line"><span class="keyword">ROLLBACK</span>;</span><br></pre></td></tr></table></figure>

<h3 id="4-3-删除-LIMIT"><a href="#4-3-删除-LIMIT" class="headerlink" title="4.3 删除 LIMIT"></a>4.3 删除 LIMIT</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 删除前 N 条符合条件的记录</span></span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> status <span class="operator">=</span> <span class="number">0</span></span><br><span class="line">LIMIT <span class="number">3</span>;  <span class="comment">-- 只删除 3 条离职员工</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 配合 ORDER BY</span></span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> dept <span class="operator">=</span> <span class="string">&#x27;市场部&#x27;</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> salary <span class="keyword">DESC</span></span><br><span class="line">LIMIT <span class="number">1</span>;  <span class="comment">-- 删除市场部工资最高的 1 人</span></span><br></pre></td></tr></table></figure>

<h3 id="4-4-多表删除"><a href="#4-4-多表删除" class="headerlink" title="4.4 多表删除"></a>4.4 多表删除</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 删除主表记录时级联删除子表</span></span><br><span class="line"><span class="keyword">DELETE</span> e <span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> departments d <span class="keyword">ON</span> e.dept_id <span class="operator">=</span> d.id</span><br><span class="line"><span class="keyword">WHERE</span> d.dept_name <span class="operator">=</span> <span class="string">&#x27;财务部&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 删除不存在的关联记录（左连接删除）</span></span><br><span class="line"><span class="keyword">DELETE</span> e <span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> departments d <span class="keyword">ON</span> e.dept_id <span class="operator">=</span> d.id</span><br><span class="line"><span class="keyword">WHERE</span> d.id <span class="keyword">IS</span> <span class="keyword">NULL</span>;  <span class="comment">-- 删除没有对应部门的员工</span></span><br></pre></td></tr></table></figure>

<h2 id="五、DELETE-vs-TRUNCATE-vs-DROP"><a href="#五、DELETE-vs-TRUNCATE-vs-DROP" class="headerlink" title="五、DELETE vs TRUNCATE vs DROP"></a>五、DELETE vs TRUNCATE vs DROP</h2><p>这三个命令都可以删除数据，但有本质区别：</p>
<table>
<thead>
<tr>
<th>对比项</th>
<th>DELETE</th>
<th>TRUNCATE</th>
<th>DROP</th>
</tr>
</thead>
<tbody><tr>
<td><strong>类型</strong></td>
<td>DML</td>
<td>DDL</td>
<td>DDL</td>
</tr>
<tr>
<td><strong>功能</strong></td>
<td>删除符合条件的行</td>
<td>清空整张表</td>
<td>删除整个表（结构和数据）</td>
</tr>
<tr>
<td><strong>WHERE 条件</strong></td>
<td>支持</td>
<td>不支持</td>
<td>不适用</td>
</tr>
<tr>
<td><strong>返回值</strong></td>
<td>删除的行数</td>
<td>无</td>
<td>无</td>
</tr>
<tr>
<td><strong>自增列重置</strong></td>
<td>否</td>
<td>是</td>
<td>不适用</td>
</tr>
<tr>
<td><strong>事务回滚</strong></td>
<td>支持</td>
<td>不支持</td>
<td>不支持</td>
</tr>
<tr>
<td><strong>触发器</strong></td>
<td>触发</td>
<td>不触发</td>
<td>不适用</td>
</tr>
<tr>
<td><strong>外键约束</strong></td>
<td>检查</td>
<td>检查</td>
<td>检查</td>
</tr>
<tr>
<td><strong>执行速度</strong></td>
<td>慢</td>
<td>快</td>
<td>快</td>
</tr>
<tr>
<td><strong>空间释放</strong></td>
<td>不释放</td>
<td>释放</td>
<td>释放</td>
</tr>
</tbody></table>
<h3 id="使用示例对比"><a href="#使用示例对比" class="headerlink" title="使用示例对比"></a>使用示例对比</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- DELETE：删除工资低于 7000 的员工</span></span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> salary <span class="operator">&lt;</span> <span class="number">7000</span>;</span><br><span class="line"><span class="comment">-- 自增 id 不会重置，下一个 id 继续递增</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- TRUNCATE：清空所有员工</span></span><br><span class="line"><span class="keyword">TRUNCATE</span> <span class="keyword">TABLE</span> employees;</span><br><span class="line"><span class="comment">-- 自增 id 重置为 1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- DROP：删除整个员工表（表结构也没了）</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> employees;</span><br><span class="line"><span class="comment">-- 再次查询会报错：Table doesn&#x27;t exist</span></span><br></pre></td></tr></table></figure>

<h2 id="六、DML-与事务"><a href="#六、DML-与事务" class="headerlink" title="六、DML 与事务"></a>六、DML 与事务</h2><h3 id="6-1-事务基础"><a href="#6-1-事务基础" class="headerlink" title="6.1 事务基础"></a>6.1 事务基础</h3><p>事务是一组原子性的 SQL 操作，要么全部成功，要么全部失败。</p>
<p><strong>事务的 ACID 特性</strong>：</p>
<ul>
<li><strong>原子性（Atomicity）</strong>：事务是不可分割的最小单位</li>
<li><strong>一致性（Consistency）</strong>：事务执行前后数据保持一致</li>
<li><strong>隔离性（Isolation）</strong>：并发事务互不干扰</li>
<li><strong>持久性（Durability）</strong>：事务提交后永久保存</li>
</ul>
<h3 id="6-2-事务操作"><a href="#6-2-事务操作" class="headerlink" title="6.2 事务操作"></a>6.2 事务操作</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 查看自动提交状态</span></span><br><span class="line"><span class="keyword">SELECT</span> @<span class="variable">@autocommit</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 关闭自动提交</span></span><br><span class="line"><span class="keyword">SET</span> autocommit <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 开始事务</span></span><br><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"><span class="comment">-- 或</span></span><br><span class="line"><span class="keyword">BEGIN</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 执行 DML 操作</span></span><br><span class="line"><span class="keyword">UPDATE</span> employees <span class="keyword">SET</span> salary <span class="operator">=</span> salary <span class="operator">+</span> <span class="number">500</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">UPDATE</span> employees <span class="keyword">SET</span> salary <span class="operator">=</span> salary <span class="operator">-</span> <span class="number">500</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 提交事务（使更改永久生效）</span></span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 回滚事务（撤销所有更改）</span></span><br><span class="line"><span class="keyword">ROLLBACK</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 设置保存点</span></span><br><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"><span class="keyword">UPDATE</span> employees <span class="keyword">SET</span> salary <span class="operator">=</span> <span class="number">8000</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">SAVEPOINT</span> sp1;</span><br><span class="line"><span class="keyword">UPDATE</span> employees <span class="keyword">SET</span> salary <span class="operator">=</span> <span class="number">9000</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line"><span class="comment">-- 回滚到保存点</span></span><br><span class="line"><span class="keyword">ROLLBACK</span> <span class="keyword">TO</span> sp1;  <span class="comment">-- id=2 的更新被撤销，id=1 的更新保留</span></span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br></pre></td></tr></table></figure>

<h3 id="6-3-实战案例：转账操作"><a href="#6-3-实战案例：转账操作" class="headerlink" title="6.3 实战案例：转账操作"></a>6.3 实战案例：转账操作</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 创建账户表</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> accounts (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT,</span><br><span class="line">    account_name <span class="type">VARCHAR</span>(<span class="number">50</span>),</span><br><span class="line">    balance <span class="type">DECIMAL</span>(<span class="number">12</span>, <span class="number">2</span>) <span class="keyword">DEFAULT</span> <span class="number">0</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT INTO</span> accounts (account_name, balance) <span class="keyword">VALUES</span></span><br><span class="line">(<span class="string">&#x27;张三&#x27;</span>, <span class="number">10000</span>),</span><br><span class="line">(<span class="string">&#x27;李四&#x27;</span>, <span class="number">5000</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 张三给李四转账 1000 元（使用事务保证原子性）</span></span><br><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 张三账户减 1000</span></span><br><span class="line"><span class="keyword">UPDATE</span> accounts <span class="keyword">SET</span> balance <span class="operator">=</span> balance <span class="operator">-</span> <span class="number">1000</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 李四账户加 1000</span></span><br><span class="line"><span class="keyword">UPDATE</span> accounts <span class="keyword">SET</span> balance <span class="operator">=</span> balance <span class="operator">+</span> <span class="number">1000</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 检查是否有异常（实际应用中的业务逻辑）</span></span><br><span class="line"><span class="comment">-- 这里可以添加余额检查等逻辑</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 提交事务</span></span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 如果中间出现错误</span></span><br><span class="line"><span class="comment">-- ROLLBACK;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看结果</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> accounts;</span><br></pre></td></tr></table></figure>

<h2 id="七、DML-实战练习"><a href="#七、DML-实战练习" class="headerlink" title="七、DML 实战练习"></a>七、DML 实战练习</h2><h3 id="7-1-员工管理系统练习"><a href="#7-1-员工管理系统练习" class="headerlink" title="7.1 员工管理系统练习"></a>7.1 员工管理系统练习</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 1. 初始化数据</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> employees (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT,</span><br><span class="line">    name <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">    dept <span class="type">VARCHAR</span>(<span class="number">50</span>),</span><br><span class="line">    salary <span class="type">DECIMAL</span>(<span class="number">10</span>, <span class="number">2</span>),</span><br><span class="line">    hire_date <span class="type">DATE</span>,</span><br><span class="line">    status TINYINT <span class="keyword">DEFAULT</span> <span class="number">1</span> COMMENT <span class="string">&#x27;1 在职 0 离职&#x27;</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT INTO</span> employees (name, dept, salary, hire_date, status) <span class="keyword">VALUES</span></span><br><span class="line">(<span class="string">&#x27;张三&#x27;</span>, <span class="string">&#x27;技术部&#x27;</span>, <span class="number">8000</span>, <span class="string">&#x27;2023-01-15&#x27;</span>, <span class="number">1</span>),</span><br><span class="line">(<span class="string">&#x27;李四&#x27;</span>, <span class="string">&#x27;技术部&#x27;</span>, <span class="number">9000</span>, <span class="string">&#x27;2022-06-01&#x27;</span>, <span class="number">1</span>),</span><br><span class="line">(<span class="string">&#x27;王五&#x27;</span>, <span class="string">&#x27;市场部&#x27;</span>, <span class="number">7500</span>, <span class="string">&#x27;2023-03-20&#x27;</span>, <span class="number">1</span>),</span><br><span class="line">(<span class="string">&#x27;赵六&#x27;</span>, <span class="string">&#x27;市场部&#x27;</span>, <span class="number">7000</span>, <span class="string">&#x27;2023-06-10&#x27;</span>, <span class="number">1</span>),</span><br><span class="line">(<span class="string">&#x27;孙七&#x27;</span>, <span class="string">&#x27;财务部&#x27;</span>, <span class="number">8500</span>, <span class="string">&#x27;2022-09-01&#x27;</span>, <span class="number">1</span>),</span><br><span class="line">(<span class="string">&#x27;周八&#x27;</span>, <span class="string">&#x27;技术部&#x27;</span>, <span class="number">9500</span>, <span class="string">&#x27;2021-12-01&#x27;</span>, <span class="number">1</span>),</span><br><span class="line">(<span class="string">&#x27;吴九&#x27;</span>, <span class="string">&#x27;人事部&#x27;</span>, <span class="number">6500</span>, <span class="string">&#x27;2023-07-01&#x27;</span>, <span class="number">1</span>),</span><br><span class="line">(<span class="string">&#x27;郑十&#x27;</span>, <span class="string">&#x27;财务部&#x27;</span>, <span class="number">8000</span>, <span class="string">&#x27;2023-02-15&#x27;</span>, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 练习 1：技术部所有员工加薪 500 元</span></span><br><span class="line"><span class="keyword">UPDATE</span> employees <span class="keyword">SET</span> salary <span class="operator">=</span> salary <span class="operator">+</span> <span class="number">500</span> <span class="keyword">WHERE</span> dept <span class="operator">=</span> <span class="string">&#x27;技术部&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 练习 2：插入一批新员工</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> employees (name, dept, salary, hire_date) <span class="keyword">VALUES</span></span><br><span class="line">(<span class="string">&#x27;刘备&#x27;</span>, <span class="string">&#x27;市场部&#x27;</span>, <span class="number">12000</span>, <span class="string">&#x27;2024-01-02&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;关羽&#x27;</span>, <span class="string">&#x27;技术部&#x27;</span>, <span class="number">11000</span>, <span class="string">&#x27;2024-01-02&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;张飞&#x27;</span>, <span class="string">&#x27;技术部&#x27;</span>, <span class="number">10000</span>, <span class="string">&#x27;2024-01-02&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 练习 3：删除所有离职员工（status=0）</span></span><br><span class="line"><span class="comment">-- 先模拟一些离职员工</span></span><br><span class="line"><span class="keyword">UPDATE</span> employees <span class="keyword">SET</span> status <span class="operator">=</span> <span class="number">0</span> <span class="keyword">WHERE</span> name <span class="keyword">IN</span> (<span class="string">&#x27;吴九&#x27;</span>, <span class="string">&#x27;郑十&#x27;</span>);</span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> status <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 练习 4：将市场部和财务部的工资统一上调 8%</span></span><br><span class="line"><span class="keyword">UPDATE</span> employees</span><br><span class="line"><span class="keyword">SET</span> salary <span class="operator">=</span> salary <span class="operator">*</span> <span class="number">1.08</span></span><br><span class="line"><span class="keyword">WHERE</span> dept <span class="keyword">IN</span> (<span class="string">&#x27;市场部&#x27;</span>, <span class="string">&#x27;财务部&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 练习 5：查询最终结果</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees <span class="keyword">ORDER</span> <span class="keyword">BY</span> dept, salary <span class="keyword">DESC</span>;</span><br></pre></td></tr></table></figure>

<h3 id="7-2-订单系统练习"><a href="#7-2-订单系统练习" class="headerlink" title="7.2 订单系统练习"></a>7.2 订单系统练习</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 创建订单表</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> orders (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT,</span><br><span class="line">    order_no <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">UNIQUE</span>,</span><br><span class="line">    customer_name <span class="type">VARCHAR</span>(<span class="number">50</span>),</span><br><span class="line">    amount <span class="type">DECIMAL</span>(<span class="number">10</span>, <span class="number">2</span>),</span><br><span class="line">    status <span class="type">VARCHAR</span>(<span class="number">20</span>) <span class="keyword">DEFAULT</span> <span class="string">&#x27;PENDING&#x27;</span>,</span><br><span class="line">    create_time DATETIME <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 插入订单数据</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> orders (order_no, customer_name, amount, status) <span class="keyword">VALUES</span></span><br><span class="line">(<span class="string">&#x27;ORD001&#x27;</span>, <span class="string">&#x27;张三&#x27;</span>, <span class="number">199.00</span>, <span class="string">&#x27;PENDING&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;ORD002&#x27;</span>, <span class="string">&#x27;李四&#x27;</span>, <span class="number">299.00</span>, <span class="string">&#x27;PAID&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;ORD003&#x27;</span>, <span class="string">&#x27;王五&#x27;</span>, <span class="number">399.00</span>, <span class="string">&#x27;PENDING&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;ORD004&#x27;</span>, <span class="string">&#x27;赵六&#x27;</span>, <span class="number">499.00</span>, <span class="string">&#x27;SHIPPED&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;ORD005&#x27;</span>, <span class="string">&#x27;孙七&#x27;</span>, <span class="number">599.00</span>, <span class="string">&#x27;PENDING&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 练习 1：将所有 PENDING 状态的订单改为 PAID</span></span><br><span class="line"><span class="keyword">UPDATE</span> orders <span class="keyword">SET</span> status <span class="operator">=</span> <span class="string">&#x27;PAID&#x27;</span> <span class="keyword">WHERE</span> status <span class="operator">=</span> <span class="string">&#x27;PENDING&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 练习 2：删除金额低于 300 的订单</span></span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> orders <span class="keyword">WHERE</span> amount <span class="operator">&lt;</span> <span class="number">300</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 练习 3：批量插入新订单</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> orders (order_no, customer_name, amount) <span class="keyword">VALUES</span></span><br><span class="line">(<span class="string">&#x27;ORD006&#x27;</span>, <span class="string">&#x27;周八&#x27;</span>, <span class="number">699.00</span>),</span><br><span class="line">(<span class="string">&#x27;ORD007&#x27;</span>, <span class="string">&#x27;吴九&#x27;</span>, <span class="number">799.00</span>),</span><br><span class="line">(<span class="string">&#x27;ORD008&#x27;</span>, <span class="string">&#x27;郑十&#x27;</span>, <span class="number">899.00</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 练习 4：给所有订单打 9 折促销</span></span><br><span class="line"><span class="keyword">UPDATE</span> orders <span class="keyword">SET</span> amount <span class="operator">=</span> amount <span class="operator">*</span> <span class="number">0.9</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看结果</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> orders;</span><br></pre></td></tr></table></figure>

<h2 id="八、DML-性能优化建议"><a href="#八、DML-性能优化建议" class="headerlink" title="八、DML 性能优化建议"></a>八、DML 性能优化建议</h2><h3 id="8-1-INSERT-优化"><a href="#8-1-INSERT-优化" class="headerlink" title="8.1 INSERT 优化"></a>8.1 INSERT 优化</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 1. 批量插入优于单条插入</span></span><br><span class="line"><span class="comment">-- 慢</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> employees (name, dept) <span class="keyword">VALUES</span> (<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;技术部&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT INTO</span> employees (name, dept) <span class="keyword">VALUES</span> (<span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;技术部&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 快</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> employees (name, dept) <span class="keyword">VALUES</span></span><br><span class="line">(<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;技术部&#x27;</span>), (<span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;技术部&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 2. 对于大量数据，禁用索引后插入再重建</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> employees DISABLE KEYS;</span><br><span class="line"><span class="comment">-- 批量插入...</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> employees ENABLE KEYS;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 3. 使用 LOAD DATA 导入文本文件（最快）</span></span><br><span class="line">LOAD DATA <span class="keyword">LOCAL</span> INFILE <span class="string">&#x27;/path/to/data.csv&#x27;</span></span><br><span class="line"><span class="keyword">INTO</span> <span class="keyword">TABLE</span> employees</span><br><span class="line">FIELDS TERMINATED <span class="keyword">BY</span> <span class="string">&#x27;,&#x27;</span></span><br><span class="line">LINES TERMINATED <span class="keyword">BY</span> <span class="string">&#x27;\n&#x27;</span></span><br><span class="line">(name, dept, salary);</span><br></pre></td></tr></table></figure>

<h3 id="8-2-UPDATE-优化"><a href="#8-2-UPDATE-优化" class="headerlink" title="8.2 UPDATE 优化"></a>8.2 UPDATE 优化</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 1. WHERE 条件使用索引列</span></span><br><span class="line"><span class="keyword">UPDATE</span> employees <span class="keyword">SET</span> salary <span class="operator">=</span> <span class="number">8000</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;  <span class="comment">-- id 是主键，有索引</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 2. 避免更新不必要的列</span></span><br><span class="line"><span class="keyword">UPDATE</span> employees <span class="keyword">SET</span> name <span class="operator">=</span> <span class="string">&#x27;新名字&#x27;</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;  <span class="comment">-- 只更新需要的列</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 3. 分批更新大表</span></span><br><span class="line"><span class="keyword">UPDATE</span> employees <span class="keyword">SET</span> status <span class="operator">=</span> <span class="number">0</span> <span class="keyword">WHERE</span> create_time <span class="operator">&lt;</span> <span class="string">&#x27;2023-01-01&#x27;</span> LIMIT <span class="number">1000</span>;</span><br><span class="line"><span class="comment">-- 多次执行直到影响行数为 0</span></span><br></pre></td></tr></table></figure>

<h3 id="8-3-DELETE-优化"><a href="#8-3-DELETE-优化" class="headerlink" title="8.3 DELETE 优化"></a>8.3 DELETE 优化</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 1. 分批删除大表</span></span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> logs <span class="keyword">WHERE</span> create_time <span class="operator">&lt;</span> <span class="string">&#x27;2023-01-01&#x27;</span> LIMIT <span class="number">1000</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 2. 对于清空表，使用 TRUNCATE 代替 DELETE</span></span><br><span class="line"><span class="keyword">TRUNCATE</span> <span class="keyword">TABLE</span> logs;  <span class="comment">-- 比 DELETE 快得多</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 3. 删除前备份重要数据</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> employees_backup <span class="keyword">AS</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> status <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> status <span class="operator">=</span> <span class="number">0</span>;</span><br></pre></td></tr></table></figure>

<h2 id="九、小结"><a href="#九、小结" class="headerlink" title="九、小结"></a>九、小结</h2><h3 id="知识点回顾"><a href="#知识点回顾" class="headerlink" title="知识点回顾"></a>知识点回顾</h3><ol>
<li><p><strong>INSERT 插入</strong></p>
<ul>
<li>单条插入、批量插入</li>
<li>INSERT IGNORE、ON DUPLICATE KEY UPDATE、REPLACE INTO</li>
<li>INSERT INTO … SELECT</li>
</ul>
</li>
<li><p><strong>UPDATE 更新</strong></p>
<ul>
<li>基础更新、表达式更新、多表更新</li>
<li>必须使用 WHERE 条件避免误更新</li>
</ul>
</li>
<li><p><strong>DELETE 删除</strong></p>
<ul>
<li>条件删除、LIMIT 删除、多表删除</li>
<li>DELETE vs TRUNCATE vs DROP 的区别</li>
</ul>
</li>
<li><p><strong>事务控制</strong></p>
<ul>
<li>START TRANSACTION、COMMIT、ROLLBACK</li>
<li>保存点 SAVEPOINT</li>
</ul>
</li>
</ol>
<h3 id="DML-命令速查表"><a href="#DML-命令速查表" class="headerlink" title="DML 命令速查表"></a>DML 命令速查表</h3><table>
<thead>
<tr>
<th>命令</th>
<th>语法</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>INSERT</td>
<td><code>INSERT INTO 表 (列) VALUES (值)</code></td>
<td>插入数据</td>
</tr>
<tr>
<td>UPDATE</td>
<td><code>UPDATE 表 SET 列=值 WHERE 条件</code></td>
<td>更新数据</td>
</tr>
<tr>
<td>DELETE</td>
<td><code>DELETE FROM 表 WHERE 条件</code></td>
<td>删除数据</td>
</tr>
<tr>
<td>TRUNCATE</td>
<td><code>TRUNCATE TABLE 表</code></td>
<td>清空表</td>
</tr>
</tbody></table>
<h3 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h3><p>⚠️ <strong>执行 DML 操作前务必</strong>：</p>
<ol>
<li>开启事务或确保可以回滚</li>
<li>先用 SELECT 验证 WHERE 条件是否正确</li>
<li>对重要数据进行备份</li>
<li>谨慎执行不带 WHERE 的 UPDATE&#x2F;DELETE</li>
</ol>
<hr>
<p><strong>下一篇</strong>：[MySQL 基础教程（四）：DQL 数据查询语言详解](&#x2F;2026&#x2F;02&#x2F;23&#x2F;MySQL 基础教程（四）DQL 数据查询语言详解&#x2F;)</p>
<p><strong>上一篇</strong>：[MySQL 基础教程（二）：DDL 数据定义语言详解](&#x2F;2026&#x2F;02&#x2F;23&#x2F;MySQL 基础教程（二）DDL 数据定义语言详解&#x2F;)</p>
]]></content>
      <categories>
        <category>MySQL 基础教程</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
        <tag>DML</tag>
        <tag>数据操作</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQL 进阶教程（五）基础篇总结</title>
    <url>/2026/02/23/MySQL%20%E8%BF%9B%E9%98%B6%E6%95%99%E7%A8%8B%EF%BC%88%E4%BA%94%EF%BC%89%E5%9F%BA%E7%A1%80%E7%AF%87%E6%80%BB%E7%BB%93/</url>
    <content><![CDATA[<h1 id="MySQL-进阶教程（五）基础篇总结"><a href="#MySQL-进阶教程（五）基础篇总结" class="headerlink" title="MySQL 进阶教程（五）基础篇总结"></a>MySQL 进阶教程（五）基础篇总结</h1><p>至此，MySQL 基础篇和进阶教程全部完成！本文将对整个系列进行系统总结，并提供学习路线建议。</p>
<h2 id="一、系列文章回顾"><a href="#一、系列文章回顾" class="headerlink" title="一、系列文章回顾"></a>一、系列文章回顾</h2><h3 id="基础教程系列"><a href="#基础教程系列" class="headerlink" title="基础教程系列"></a>基础教程系列</h3><table>
<thead>
<tr>
<th>篇目</th>
<th>主题</th>
<th>核心内容</th>
</tr>
</thead>
<tbody><tr>
<td>基础（一）</td>
<td>数据库基础与环境搭建</td>
<td>数据库概念、MySQL 安装、数据模型、SQL 分类</td>
</tr>
<tr>
<td>基础（二）</td>
<td>DDL 数据定义语言</td>
<td>数据库操作、表操作、数据类型、DataGrip</td>
</tr>
<tr>
<td>基础（三）</td>
<td>DML 数据操作语言</td>
<td>INSERT、UPDATE、DELETE、事务基础</td>
</tr>
<tr>
<td>基础（四）</td>
<td>DQL 数据查询语言</td>
<td>基础查询、条件查询、聚合函数、分组、排序、分页、连接查询、子查询</td>
</tr>
<tr>
<td>基础（五）</td>
<td>DCL 数据控制语言</td>
<td>用户管理、权限控制、事务控制</td>
</tr>
</tbody></table>
<h3 id="进阶教程系列"><a href="#进阶教程系列" class="headerlink" title="进阶教程系列"></a>进阶教程系列</h3><table>
<thead>
<tr>
<th>篇目</th>
<th>主题</th>
<th>核心内容</th>
</tr>
</thead>
<tbody><tr>
<td>进阶（一）</td>
<td>常用函数详解</td>
<td>字符串函数、数值函数、日期函数、流程函数</td>
</tr>
<tr>
<td>进阶（二）</td>
<td>数据库约束</td>
<td>主键、外键、唯一、非空、默认、检查约束</td>
</tr>
<tr>
<td>进阶（三）</td>
<td>多表查询</td>
<td>表关系、连接查询、联合查询、子查询</td>
</tr>
<tr>
<td>进阶（四）</td>
<td>事务</td>
<td>ACID 特性、并发问题、隔离级别、锁机制</td>
</tr>
</tbody></table>
<h2 id="二、知识体系思维导图"><a href="#二、知识体系思维导图" class="headerlink" title="二、知识体系思维导图"></a>二、知识体系思维导图</h2><h3 id="2-1-SQL-语言分类"><a href="#2-1-SQL-语言分类" class="headerlink" title="2.1 SQL 语言分类"></a>2.1 SQL 语言分类</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">SQL</span><br><span class="line">├── DDL（数据定义语言）</span><br><span class="line">│   ├── CREATE DATABASE/TABLE</span><br><span class="line">│   ├── ALTER DATABASE/TABLE</span><br><span class="line">│   ├── DROP DATABASE/TABLE</span><br><span class="line">│   └── TRUNCATE TABLE</span><br><span class="line">│</span><br><span class="line">├── DML（数据操作语言）</span><br><span class="line">│   ├── INSERT INTO ... VALUES</span><br><span class="line">│   ├── UPDATE ... SET ... WHERE</span><br><span class="line">│   └── DELETE FROM ... WHERE</span><br><span class="line">│</span><br><span class="line">├── DQL（数据查询语言）</span><br><span class="line">│   ├── SELECT ... FROM ... WHERE</span><br><span class="line">│   ├── GROUP BY ... HAVING</span><br><span class="line">│   ├── ORDER BY ... LIMIT</span><br><span class="line">│   └── JOIN / UNION / 子查询</span><br><span class="line">│</span><br><span class="line">└── DCL（数据控制语言）</span><br><span class="line">    ├── CREATE USER / DROP USER</span><br><span class="line">    ├── GRANT / REVOKE</span><br><span class="line">    ├── START TRANSACTION / COMMIT / ROLLBACK</span><br><span class="line">    └── SAVEPOINT</span><br></pre></td></tr></table></figure>

<h3 id="2-2-核心知识点"><a href="#2-2-核心知识点" class="headerlink" title="2.2 核心知识点"></a>2.2 核心知识点</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">MySQL</span><br><span class="line">├── 基础概念</span><br><span class="line">│   ├── 数据库、DBMS、SQL</span><br><span class="line">│   ├── 数据模型（关系模型、ER 图）</span><br><span class="line">│   └── 三大范式</span><br><span class="line">│</span><br><span class="line">├── 数据类型</span><br><span class="line">│   ├── 数值类型（INT、DECIMAL、FLOAT）</span><br><span class="line">│   ├── 字符串类型（CHAR、VARCHAR、TEXT）</span><br><span class="line">│   └── 日期时间类型（DATE、DATETIME、TIMESTAMP）</span><br><span class="line">│</span><br><span class="line">├── 函数</span><br><span class="line">│   ├── 字符串函数（CONCAT、SUBSTRING、REPLACE）</span><br><span class="line">│   ├── 数值函数（ABS、ROUND、CEIL、FLOOR）</span><br><span class="line">│   ├── 日期函数（NOW、DATE_FORMAT、DATEDIFF）</span><br><span class="line">│   └── 流程函数（IF、CASE、IFNULL）</span><br><span class="line">│</span><br><span class="line">├── 约束</span><br><span class="line">│   ├── PRIMARY KEY（主键）</span><br><span class="line">│   ├── FOREIGN KEY（外键）</span><br><span class="line">│   ├── UNIQUE（唯一）</span><br><span class="line">│   ├── NOT NULL（非空）</span><br><span class="line">│   ├── DEFAULT（默认）</span><br><span class="line">│   └── CHECK（检查）</span><br><span class="line">│</span><br><span class="line">├── 查询</span><br><span class="line">│   ├── 单表查询</span><br><span class="line">│   ├── 多表连接（INNER/LEFT/RIGHT JOIN）</span><br><span class="line">│   ├── 自连接</span><br><span class="line">│   ├── UNION 联合</span><br><span class="line">│   └── 子查询（标量/列/行/表）</span><br><span class="line">│</span><br><span class="line">└── 事务</span><br><span class="line">    ├── ACID 特性</span><br><span class="line">    ├── 隔离级别</span><br><span class="line">    ├── 并发问题（脏读/不可重复读/幻读）</span><br><span class="line">    └── 锁机制</span><br></pre></td></tr></table></figure>

<h2 id="三、SQL-语法速查"><a href="#三、SQL-语法速查" class="headerlink" title="三、SQL 语法速查"></a>三、SQL 语法速查</h2><h3 id="3-1-完整-SELECT-语法"><a href="#3-1-完整-SELECT-语法" class="headerlink" title="3.1 完整 SELECT 语法"></a>3.1 完整 SELECT 语法</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> [<span class="keyword">DISTINCT</span>] 列名 [<span class="keyword">AS</span> 别名], ...</span><br><span class="line"><span class="keyword">FROM</span> 表名 [<span class="keyword">AS</span> 别名]</span><br><span class="line">[<span class="keyword">INNER</span> <span class="operator">|</span> <span class="keyword">LEFT</span> <span class="operator">|</span> <span class="keyword">RIGHT</span>] <span class="keyword">JOIN</span> 表名 <span class="keyword">ON</span> 连接条件</span><br><span class="line">[<span class="keyword">WHERE</span> 条件]</span><br><span class="line">[<span class="keyword">GROUP</span> <span class="keyword">BY</span> 分组列 [<span class="keyword">HAVING</span> 分组过滤]]</span><br><span class="line">[<span class="keyword">ORDER</span> <span class="keyword">BY</span> 排序列 [<span class="keyword">ASC</span> <span class="operator">|</span> <span class="keyword">DESC</span>]]</span><br><span class="line">[LIMIT [<span class="keyword">offset</span>,] count];</span><br></pre></td></tr></table></figure>

<h3 id="3-2-SQL-执行顺序"><a href="#3-2-SQL-执行顺序" class="headerlink" title="3.2 SQL 执行顺序"></a>3.2 SQL 执行顺序</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">FROM → JOIN → WHERE → GROUP BY → HAVING → SELECT → DISTINCT → ORDER BY → LIMIT</span><br></pre></td></tr></table></figure>

<p><strong>记忆要点</strong>：</p>
<ul>
<li>WHERE 在 SELECT 之前执行（不能使用别名）</li>
<li>HAVING 在 GROUP BY 之后执行（可以使用聚合函数）</li>
<li>ORDER BY 在 HAVING 之后执行</li>
<li>LIMIT 最后执行</li>
</ul>
<h3 id="3-3-常用命令速查"><a href="#3-3-常用命令速查" class="headerlink" title="3.3 常用命令速查"></a>3.3 常用命令速查</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 数据库操作</span></span><br><span class="line"><span class="keyword">SHOW</span> DATABASES;</span><br><span class="line"><span class="keyword">CREATE</span> DATABASE db_name;</span><br><span class="line">USE db_name;</span><br><span class="line"><span class="keyword">DROP</span> DATABASE db_name;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 表操作</span></span><br><span class="line"><span class="keyword">SHOW</span> TABLES;</span><br><span class="line"><span class="keyword">DESC</span> table_name;</span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">CREATE TABLE</span> table_name;</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> table_name;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 数据操作</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> <span class="keyword">table</span> (col1, col2) <span class="keyword">VALUES</span> (val1, val2);</span><br><span class="line"><span class="keyword">UPDATE</span> <span class="keyword">table</span> <span class="keyword">SET</span> col1 <span class="operator">=</span> val1 <span class="keyword">WHERE</span> <span class="keyword">condition</span>;</span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> <span class="keyword">table</span> <span class="keyword">WHERE</span> <span class="keyword">condition</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询操作</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> <span class="keyword">table</span> <span class="keyword">WHERE</span> <span class="keyword">condition</span>;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">FROM</span> <span class="keyword">table</span>;</span><br><span class="line"><span class="keyword">SELECT</span> col, <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">FROM</span> <span class="keyword">table</span> <span class="keyword">GROUP</span> <span class="keyword">BY</span> col;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 事务操作</span></span><br><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br><span class="line"><span class="keyword">ROLLBACK</span>;</span><br><span class="line"><span class="keyword">SAVEPOINT</span> sp_name;</span><br><span class="line"><span class="keyword">ROLLBACK</span> <span class="keyword">TO</span> sp_name;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 用户权限</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> <span class="string">&#x27;user&#x27;</span>@<span class="string">&#x27;host&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;pwd&#x27;</span>;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">SELECT</span> <span class="keyword">ON</span> db.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;user&#x27;</span>@<span class="string">&#x27;host&#x27;</span>;</span><br><span class="line"><span class="keyword">REVOKE</span> <span class="keyword">SELECT</span> <span class="keyword">ON</span> db.<span class="operator">*</span> <span class="keyword">FROM</span> <span class="string">&#x27;user&#x27;</span>@<span class="string">&#x27;host&#x27;</span>;</span><br><span class="line"><span class="keyword">SHOW</span> GRANTS <span class="keyword">FOR</span> <span class="string">&#x27;user&#x27;</span>@<span class="string">&#x27;host&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h2 id="四、常用函数速查"><a href="#四、常用函数速查" class="headerlink" title="四、常用函数速查"></a>四、常用函数速查</h2><h3 id="4-1-字符串函数"><a href="#4-1-字符串函数" class="headerlink" title="4.1 字符串函数"></a>4.1 字符串函数</h3><table>
<thead>
<tr>
<th>函数</th>
<th>说明</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td>CONCAT(s1, s2, …)</td>
<td>连接字符串</td>
<td><code>CONCAT(&#39;Hello&#39;, &#39;World&#39;)</code></td>
</tr>
<tr>
<td>LENGTH(s)</td>
<td>字节长度</td>
<td><code>LENGTH(&#39;hello&#39;)</code></td>
</tr>
<tr>
<td>CHAR_LENGTH(s)</td>
<td>字符数</td>
<td><code>CHAR_LENGTH(&#39;你好&#39;)</code></td>
</tr>
<tr>
<td>UPPER(s)</td>
<td>转大写</td>
<td><code>UPPER(&#39;hello&#39;)</code></td>
</tr>
<tr>
<td>LOWER(s)</td>
<td>转小写</td>
<td><code>LOWER(&#39;HELLO&#39;)</code></td>
</tr>
<tr>
<td>SUBSTRING(s, pos, len)</td>
<td>截取字符串</td>
<td><code>SUBSTRING(&#39;hello&#39;, 1, 3)</code></td>
</tr>
<tr>
<td>REPLACE(s, from, to)</td>
<td>替换</td>
<td><code>REPLACE(&#39;hello&#39;, &#39;l&#39;, &#39;x&#39;)</code></td>
</tr>
<tr>
<td>TRIM(s)</td>
<td>去空格</td>
<td><code>TRIM(&#39; hello &#39;)</code></td>
</tr>
<tr>
<td>LPAD&#x2F;RPAD</td>
<td>左右填充</td>
<td><code>LPAD(&#39;123&#39;, 6, &#39;0&#39;)</code></td>
</tr>
</tbody></table>
<h3 id="4-2-数值函数"><a href="#4-2-数值函数" class="headerlink" title="4.2 数值函数"></a>4.2 数值函数</h3><table>
<thead>
<tr>
<th>函数</th>
<th>说明</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td>ABS(n)</td>
<td>绝对值</td>
<td><code>ABS(-10)</code></td>
</tr>
<tr>
<td>ROUND(n, d)</td>
<td>四舍五入</td>
<td><code>ROUND(3.14159, 2)</code></td>
</tr>
<tr>
<td>CEIL(n)</td>
<td>向上取整</td>
<td><code>CEIL(3.14)</code></td>
</tr>
<tr>
<td>FLOOR(n)</td>
<td>向下取整</td>
<td><code>FLOOR(3.99)</code></td>
</tr>
<tr>
<td>MOD(n, m)</td>
<td>取模</td>
<td><code>MOD(10, 3)</code></td>
</tr>
<tr>
<td>RAND()</td>
<td>随机数</td>
<td><code>RAND()</code></td>
</tr>
<tr>
<td>SQRT(n)</td>
<td>平方根</td>
<td><code>SQRT(16)</code></td>
</tr>
</tbody></table>
<h3 id="4-3-日期函数"><a href="#4-3-日期函数" class="headerlink" title="4.3 日期函数"></a>4.3 日期函数</h3><table>
<thead>
<tr>
<th>函数</th>
<th>说明</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td>NOW()</td>
<td>当前日期时间</td>
<td><code>NOW()</code></td>
</tr>
<tr>
<td>CURDATE()</td>
<td>当前日期</td>
<td><code>CURDATE()</code></td>
</tr>
<tr>
<td>YEAR(d)</td>
<td>年份</td>
<td><code>YEAR(NOW())</code></td>
</tr>
<tr>
<td>MONTH(d)</td>
<td>月份</td>
<td><code>MONTH(NOW())</code></td>
</tr>
<tr>
<td>DAY(d)</td>
<td>日期</td>
<td><code>DAY(NOW())</code></td>
</tr>
<tr>
<td>DATE_FORMAT(d, fmt)</td>
<td>格式化</td>
<td><code>DATE_FORMAT(NOW(), &#39;%Y-%m-%d&#39;)</code></td>
</tr>
<tr>
<td>DATE_ADD(d, INTERVAL n UNIT)</td>
<td>日期增加</td>
<td><code>DATE_ADD(NOW(), INTERVAL 1 DAY)</code></td>
</tr>
<tr>
<td>DATEDIFF(d1, d2)</td>
<td>日期差</td>
<td><code>DATEDIFF(d1, d2)</code></td>
</tr>
</tbody></table>
<h3 id="4-4-流程函数"><a href="#4-4-流程函数" class="headerlink" title="4.4 流程函数"></a>4.4 流程函数</h3><table>
<thead>
<tr>
<th>函数</th>
<th>说明</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td>IF(expr, v1, v2)</td>
<td>条件判断</td>
<td><code>IF(1&gt;2, &#39;Y&#39;, &#39;N&#39;)</code></td>
</tr>
<tr>
<td>IFNULL(v1, v2)</td>
<td>NULL 处理</td>
<td><code>IFNULL(val, 0)</code></td>
</tr>
<tr>
<td>NULLIF(v1, v2)</td>
<td>相等返回 NULL</td>
<td><code>NULLIF(a, 0)</code></td>
</tr>
<tr>
<td>CASE WHEN … THEN … END</td>
<td>条件表达式</td>
<td><code>CASE WHEN x&gt;0 THEN &#39;正&#39; ELSE &#39;非正&#39; END</code></td>
</tr>
</tbody></table>
<h2 id="五、常见场景-SQL-模板"><a href="#五、常见场景-SQL-模板" class="headerlink" title="五、常见场景 SQL 模板"></a>五、常见场景 SQL 模板</h2><h3 id="5-1-分页查询"><a href="#5-1-分页查询" class="headerlink" title="5.1 分页查询"></a>5.1 分页查询</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 第 n 页，每页 size 条</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> <span class="keyword">table</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> id</span><br><span class="line">LIMIT (n<span class="number">-1</span>)<span class="operator">*</span>size, size;</span><br></pre></td></tr></table></figure>

<h3 id="5-2-分组统计"><a href="#5-2-分组统计" class="headerlink" title="5.2 分组统计"></a>5.2 分组统计</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 按部门统计人数和平均工资</span></span><br><span class="line"><span class="keyword">SELECT</span> dept_id,</span><br><span class="line">       <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">AS</span> emp_count,</span><br><span class="line">       <span class="built_in">AVG</span>(salary) <span class="keyword">AS</span> avg_salary</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> dept_id</span><br><span class="line"><span class="keyword">HAVING</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="operator">&gt;</span> <span class="number">5</span>;</span><br></pre></td></tr></table></figure>

<h3 id="5-3-排名查询"><a href="#5-3-排名查询" class="headerlink" title="5.3 排名查询"></a>5.3 排名查询</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 按工资降序排名</span></span><br><span class="line"><span class="keyword">SELECT</span> name, salary,</span><br><span class="line">       <span class="built_in">ROW_NUMBER</span>() <span class="keyword">OVER</span> (<span class="keyword">ORDER</span> <span class="keyword">BY</span> salary <span class="keyword">DESC</span>) <span class="keyword">AS</span> rank</span><br><span class="line"><span class="keyword">FROM</span> employees;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- MySQL 8.0 之前使用变量</span></span><br><span class="line"><span class="keyword">SELECT</span> name, salary,</span><br><span class="line">       <span class="variable">@rank</span> :<span class="operator">=</span> <span class="variable">@rank</span> <span class="operator">+</span> <span class="number">1</span> <span class="keyword">AS</span> rank</span><br><span class="line"><span class="keyword">FROM</span> employees, (<span class="keyword">SELECT</span> <span class="variable">@rank</span> :<span class="operator">=</span> <span class="number">0</span>) r</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> salary <span class="keyword">DESC</span>;</span><br></pre></td></tr></table></figure>

<h3 id="5-4-去重查询"><a href="#5-4-去重查询" class="headerlink" title="5.4 去重查询"></a>5.4 去重查询</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 删除重复记录，保留 ID 最小的</span></span><br><span class="line"><span class="keyword">DELETE</span> t1 <span class="keyword">FROM</span> <span class="keyword">table</span> t1</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> <span class="keyword">table</span> t2</span><br><span class="line"><span class="keyword">WHERE</span> t1.id <span class="operator">&gt;</span> t2.id <span class="keyword">AND</span> t1.name <span class="operator">=</span> t2.name;</span><br></pre></td></tr></table></figure>

<h3 id="5-5-行列转换"><a href="#5-5-行列转换" class="headerlink" title="5.5 行列转换"></a>5.5 行列转换</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 行转列（使用 CASE）</span></span><br><span class="line"><span class="keyword">SELECT</span> name,</span><br><span class="line">       <span class="built_in">MAX</span>(<span class="keyword">CASE</span> <span class="keyword">WHEN</span> subject <span class="operator">=</span> <span class="string">&#x27;数学&#x27;</span> <span class="keyword">THEN</span> score <span class="keyword">END</span>) <span class="keyword">AS</span> 数学，</span><br><span class="line">       <span class="built_in">MAX</span>(<span class="keyword">CASE</span> <span class="keyword">WHEN</span> subject <span class="operator">=</span> <span class="string">&#x27;语文&#x27;</span> <span class="keyword">THEN</span> score <span class="keyword">END</span>) <span class="keyword">AS</span> 语文，</span><br><span class="line">       <span class="built_in">MAX</span>(<span class="keyword">CASE</span> <span class="keyword">WHEN</span> subject <span class="operator">=</span> <span class="string">&#x27;英语&#x27;</span> <span class="keyword">THEN</span> score <span class="keyword">END</span>) <span class="keyword">AS</span> 英语</span><br><span class="line"><span class="keyword">FROM</span> scores</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> name;</span><br></pre></td></tr></table></figure>

<h3 id="5-6-连续日期查询"><a href="#5-6-连续日期查询" class="headerlink" title="5.6 连续日期查询"></a>5.6 连续日期查询</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 查询连续登录 3 天以上的用户</span></span><br><span class="line"><span class="keyword">SELECT</span> user_id, <span class="built_in">MIN</span>(<span class="type">date</span>) <span class="keyword">AS</span> start_date, <span class="built_in">MAX</span>(<span class="type">date</span>) <span class="keyword">AS</span> end_date, <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">AS</span> days</span><br><span class="line"><span class="keyword">FROM</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> user_id, <span class="type">date</span>,</span><br><span class="line">           DATE_SUB(<span class="type">date</span>, <span class="type">INTERVAL</span> <span class="built_in">ROW_NUMBER</span>() <span class="keyword">OVER</span> (<span class="keyword">PARTITION</span> <span class="keyword">BY</span> user_id <span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="type">date</span>) <span class="keyword">DAY</span>) <span class="keyword">AS</span> grp</span><br><span class="line">    <span class="keyword">FROM</span> logins</span><br><span class="line">) t</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> user_id, grp</span><br><span class="line"><span class="keyword">HAVING</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="operator">&gt;=</span> <span class="number">3</span>;</span><br></pre></td></tr></table></figure>

<h2 id="六、性能优化建议"><a href="#六、性能优化建议" class="headerlink" title="六、性能优化建议"></a>六、性能优化建议</h2><h3 id="6-1-索引优化"><a href="#6-1-索引优化" class="headerlink" title="6.1 索引优化"></a>6.1 索引优化</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 创建索引</span></span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_name <span class="keyword">ON</span> <span class="keyword">table</span>(<span class="keyword">column</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 联合索引</span></span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_dept_salary <span class="keyword">ON</span> employees(dept_id, salary);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看索引</span></span><br><span class="line"><span class="keyword">SHOW</span> INDEX <span class="keyword">FROM</span> table_name;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 分析查询</span></span><br><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> dept_id <span class="operator">=</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<p><strong>索引使用原则</strong>：</p>
<ol>
<li>在 WHERE 和 JOIN 的列上创建索引</li>
<li>使用联合索引时注意最左前缀原则</li>
<li>避免在索引列上使用函数</li>
<li>避免 SELECT *</li>
</ol>
<h3 id="6-2-查询优化"><a href="#6-2-查询优化" class="headerlink" title="6.2 查询优化"></a>6.2 查询优化</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 优化前：全表扫描</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> <span class="keyword">YEAR</span>(hire_date) <span class="operator">=</span> <span class="number">2024</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 优化后：使用索引</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> hire_date <span class="operator">&gt;=</span> <span class="string">&#x27;2024-01-01&#x27;</span></span><br><span class="line"><span class="keyword">AND</span> hire_date <span class="operator">&lt;</span> <span class="string">&#x27;2025-01-01&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 优化前：OR 条件可能不使用索引</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> dept_id <span class="operator">=</span> <span class="number">1</span> <span class="keyword">OR</span> dept_id <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 优化后：使用 UNION</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> dept_id <span class="operator">=</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">UNION</span> <span class="keyword">ALL</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> dept_id <span class="operator">=</span> <span class="number">2</span>;</span><br></pre></td></tr></table></figure>

<h3 id="6-3-表结构优化"><a href="#6-3-表结构优化" class="headerlink" title="6.3 表结构优化"></a>6.3 表结构优化</h3><ol>
<li><p><strong>选择合适的数据类型</strong></p>
<ul>
<li>能用 TINYINT 就不用 INT</li>
<li>金额使用 DECIMAL</li>
<li>字符串长度合理</li>
</ul>
</li>
<li><p><strong>范式与反范式</strong></p>
<ul>
<li>遵循三大范式减少冗余</li>
<li>适当冗余提高查询性能</li>
</ul>
</li>
<li><p><strong>分区表</strong></p>
<ul>
<li>大表按时间或范围分区</li>
<li>提高查询和管理效率</li>
</ul>
</li>
</ol>
<h2 id="七、学习路线建议"><a href="#七、学习路线建议" class="headerlink" title="七、学习路线建议"></a>七、学习路线建议</h2><h3 id="7-1-入门阶段（已完成）"><a href="#7-1-入门阶段（已完成）" class="headerlink" title="7.1 入门阶段（已完成）"></a>7.1 入门阶段（已完成）</h3><ul>
<li><input checked="" disabled="" type="checkbox"> 数据库基础概念</li>
<li><input checked="" disabled="" type="checkbox"> MySQL 安装配置</li>
<li><input checked="" disabled="" type="checkbox"> 基本 SQL 语法（DDL、DML、DQL、DCL）</li>
<li><input checked="" disabled="" type="checkbox"> 常用函数</li>
<li><input checked="" disabled="" type="checkbox"> 约束和多表查询</li>
<li><input checked="" disabled="" type="checkbox"> 事务基础</li>
</ul>
<h3 id="7-2-进阶阶段"><a href="#7-2-进阶阶段" class="headerlink" title="7.2 进阶阶段"></a>7.2 进阶阶段</h3><ul>
<li><input disabled="" type="checkbox"> 索引原理与优化</li>
<li><input disabled="" type="checkbox"> 执行计划分析（EXPLAIN）</li>
<li><input disabled="" type="checkbox"> 锁机制深入</li>
<li><input disabled="" type="checkbox"> 存储引擎（InnoDB vs MyISAM）</li>
<li><input disabled="" type="checkbox"> 日志系统（redo log、undo log、binlog）</li>
<li><input disabled="" type="checkbox"> 主从复制</li>
<li><input disabled="" type="checkbox"> 备份恢复</li>
</ul>
<h3 id="7-3-高级阶段"><a href="#7-3-高级阶段" class="headerlink" title="7.3 高级阶段"></a>7.3 高级阶段</h3><ul>
<li><input disabled="" type="checkbox"> 性能调优</li>
<li><input disabled="" type="checkbox"> 分库分表</li>
<li><input disabled="" type="checkbox"> 读写分离</li>
<li><input disabled="" type="checkbox"> 高可用架构</li>
<li><input disabled="" type="checkbox"> MySQL 8.0 新特性</li>
<li><input disabled="" type="checkbox"> 与其他数据库对比（PostgreSQL、MongoDB）</li>
</ul>
<h3 id="7-4-实战建议"><a href="#7-4-实战建议" class="headerlink" title="7.4 实战建议"></a>7.4 实战建议</h3><ol>
<li><strong>搭建个人博客&#x2F;项目</strong>：实践数据库设计</li>
<li><strong>LeetCode 刷题</strong>：练习 SQL 查询</li>
<li><strong>阅读优秀项目</strong>：学习实际数据库设计</li>
<li><strong>性能测试</strong>：了解不同查询的性能差异</li>
<li><strong>参与开源</strong>：贡献或学习数据库相关项目</li>
</ol>
<h2 id="八、常见问题-FAQ"><a href="#八、常见问题-FAQ" class="headerlink" title="八、常见问题 FAQ"></a>八、常见问题 FAQ</h2><h3 id="Q1-COUNT-、COUNT-1-、COUNT-列-的区别？"><a href="#Q1-COUNT-、COUNT-1-、COUNT-列-的区别？" class="headerlink" title="Q1: COUNT(*)、COUNT(1)、COUNT(列) 的区别？"></a>Q1: COUNT(*)、COUNT(1)、COUNT(列) 的区别？</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="built_in">COUNT</span>(<span class="operator">*</span>)   <span class="comment">-- 统计所有行（包括 NULL），推荐</span></span><br><span class="line"><span class="built_in">COUNT</span>(<span class="number">1</span>)   <span class="comment">-- 同 COUNT(*)</span></span><br><span class="line"><span class="built_in">COUNT</span>(col) <span class="comment">-- 只统计非 NULL 的行</span></span><br></pre></td></tr></table></figure>

<h3 id="Q2-DELETE、TRUNCATE、DROP-的区别？"><a href="#Q2-DELETE、TRUNCATE、DROP-的区别？" class="headerlink" title="Q2: DELETE、TRUNCATE、DROP 的区别？"></a>Q2: DELETE、TRUNCATE、DROP 的区别？</h3><table>
<thead>
<tr>
<th>命令</th>
<th>类型</th>
<th>作用</th>
<th>可回滚</th>
</tr>
</thead>
<tbody><tr>
<td>DELETE</td>
<td>DML</td>
<td>删除符合条件的行</td>
<td>是</td>
</tr>
<tr>
<td>TRUNCATE</td>
<td>DDL</td>
<td>清空整张表</td>
<td>否</td>
</tr>
<tr>
<td>DROP</td>
<td>DDL</td>
<td>删除整个表</td>
<td>否</td>
</tr>
</tbody></table>
<h3 id="Q3-WHERE-和-HAVING-的区别？"><a href="#Q3-WHERE-和-HAVING-的区别？" class="headerlink" title="Q3: WHERE 和 HAVING 的区别？"></a>Q3: WHERE 和 HAVING 的区别？</h3><ul>
<li>WHERE：在分组前过滤，不能使用聚合函数</li>
<li>HAVING：在分组后过滤，可以使用聚合函数</li>
</ul>
<h3 id="Q4-INNER-JOIN-和-LEFT-JOIN-的选择？"><a href="#Q4-INNER-JOIN-和-LEFT-JOIN-的选择？" class="headerlink" title="Q4: INNER JOIN 和 LEFT JOIN 的选择？"></a>Q4: INNER JOIN 和 LEFT JOIN 的选择？</h3><ul>
<li>只返回匹配记录：INNER JOIN</li>
<li>需要保留左表全部记录：LEFT JOIN</li>
</ul>
<h3 id="Q5-如何避免-SQL-注入？"><a href="#Q5-如何避免-SQL-注入？" class="headerlink" title="Q5: 如何避免 SQL 注入？"></a>Q5: 如何避免 SQL 注入？</h3><ol>
<li>使用预编译语句（Prepare Statement）</li>
<li>使用 ORM 框架</li>
<li>验证用户输入</li>
<li>最小权限原则</li>
</ol>
<h2 id="九、推荐资源"><a href="#九、推荐资源" class="headerlink" title="九、推荐资源"></a>九、推荐资源</h2><h3 id="官方文档"><a href="#官方文档" class="headerlink" title="官方文档"></a>官方文档</h3><ul>
<li><a href="https://dev.mysql.com/doc/">MySQL 官方文档</a></li>
<li><a href="https://dev.mysql.com/doc/refman/8.0/en/tutorial.html">MySQL 教程</a></li>
</ul>
<h3 id="在线练习"><a href="#在线练习" class="headerlink" title="在线练习"></a>在线练习</h3><ul>
<li><a href="https://leetcode.com/problemset/database/">LeetCode 数据库题</a></li>
<li>[牛客网 SQL 练习](<a href="https://www.nowcoder.com/exam/oj?tab=SQL">https://www.nowcoder.com/exam/oj?tab=SQL</a> 篇)</li>
<li><a href="https://sqlzoo.net/">SQLZOO</a></li>
</ul>
<h3 id="书籍推荐"><a href="#书籍推荐" class="headerlink" title="书籍推荐"></a>书籍推荐</h3><ul>
<li>《MySQL 必知必会》- 入门经典</li>
<li>《高性能 MySQL》- 进阶必读</li>
<li>《MySQL 技术内幕：InnoDB 存储引擎》- 深入理解</li>
</ul>
<h2 id="十、结语"><a href="#十、结语" class="headerlink" title="十、结语"></a>十、结语</h2><p>恭喜完成 MySQL 基础篇和进阶教程的学习！</p>
<p><strong>学习建议</strong>：</p>
<ol>
<li>理论结合实践，多动手写 SQL</li>
<li>理解原理，不只是死记语法</li>
<li>关注性能，养成写高效 SQL 的习惯</li>
<li>持续学习，数据库技术不断更新</li>
</ol>
<p><strong>下一步</strong>：</p>
<ul>
<li>开始进阶阶段的学习</li>
<li>在项目中实践所学知识</li>
<li>深入学习 InnoDB 存储引擎</li>
<li>了解数据库性能优化</li>
</ul>
<p>祝你在数据库学习的道路上越走越远！</p>
<hr>
<p><strong>上一篇</strong>：[MySQL 进阶教程（四）：事务详解](&#x2F;2026&#x2F;02&#x2F;23&#x2F;MySQL 进阶教程（四）事务详解&#x2F;)</p>
<p><strong>基础教程系列</strong>：</p>
<ul>
<li>[（一）数据库基础与环境搭建](&#x2F;2026&#x2F;02&#x2F;23&#x2F;MySQL 基础教程（一）数据库基础与环境搭建&#x2F;)</li>
<li>[（二）DDL 数据定义语言详解](&#x2F;2026&#x2F;02&#x2F;23&#x2F;MySQL 基础教程（二）DDL 数据定义语言详解&#x2F;)</li>
<li>[（三）DML 数据操作语言详解](&#x2F;2026&#x2F;02&#x2F;23&#x2F;MySQL 基础教程（三）DML 数据操作语言详解&#x2F;)</li>
<li>[（四）DQL 数据查询语言详解](&#x2F;2026&#x2F;02&#x2F;23&#x2F;MySQL 基础教程（四）DQL 数据查询语言详解（上）&#x2F;)</li>
<li>[（五）DCL 数据控制语言详解](&#x2F;2026&#x2F;02&#x2F;23&#x2F;MySQL 基础教程（五）DCL 数据控制语言详解&#x2F;)</li>
</ul>
<p><strong>进阶教程系列</strong>：</p>
<ul>
<li>[（一）常用函数详解](&#x2F;2026&#x2F;02&#x2F;23&#x2F;MySQL 进阶教程（一）常用函数详解&#x2F;)</li>
<li>[（二）数据库约束详解](&#x2F;2026&#x2F;02&#x2F;23&#x2F;MySQL 进阶教程（二）数据库约束详解&#x2F;)</li>
<li>[（三）多表查询详解](&#x2F;2026&#x2F;02&#x2F;23&#x2F;MySQL 进阶教程（三）多表查询详解&#x2F;)</li>
<li>[（四）事务详解](&#x2F;2026&#x2F;02&#x2F;23&#x2F;MySQL 进阶教程（四）事务详解&#x2F;)</li>
</ul>
]]></content>
      <categories>
        <category>MySQL 进阶教程</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
        <tag>总结</tag>
        <tag>学习路线</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQL 进阶教程（一）常用函数详解</title>
    <url>/2026/02/23/MySQL%20%E8%BF%9B%E9%98%B6%E6%95%99%E7%A8%8B%EF%BC%88%E4%B8%80%EF%BC%89%E5%B8%B8%E7%94%A8%E5%87%BD%E6%95%B0%E8%AF%A6%E8%A7%A3/</url>
    <content><![CDATA[<h1 id="MySQL-进阶教程（一）常用函数详解"><a href="#MySQL-进阶教程（一）常用函数详解" class="headerlink" title="MySQL 进阶教程（一）常用函数详解"></a>MySQL 进阶教程（一）常用函数详解</h1><p>在基础教程中，我们学习了 SQL 的基本查询和操作。本文将系统讲解 MySQL 提供的常用内置函数，包括字符串函数、数值函数、日期函数和流程函数。</p>
<h2 id="一、函数概述"><a href="#一、函数概述" class="headerlink" title="一、函数概述"></a>一、函数概述</h2><p>MySQL 函数是对数据进行特定操作的预定义程序，可以简化 SQL 语句，提高开发效率。</p>
<p><strong>函数的分类</strong>：</p>
<ul>
<li><strong>字符串函数</strong>：处理字符串数据</li>
<li><strong>数值函数</strong>：处理数值数据</li>
<li><strong>日期时间函数</strong>：处理日期和时间</li>
<li><strong>流程函数</strong>：条件判断和流程控制</li>
<li><strong>聚合函数</strong>：对一组数据进行计算（已在 DQL 章节讲解）</li>
<li><strong>加密函数</strong>：数据加密和哈希</li>
<li><strong>其他函数</strong>：信息函数、加锁函数等</li>
</ul>
<h2 id="二、字符串函数"><a href="#二、字符串函数" class="headerlink" title="二、字符串函数"></a>二、字符串函数</h2><h3 id="2-1-字符串连接与长度"><a href="#2-1-字符串连接与长度" class="headerlink" title="2.1 字符串连接与长度"></a>2.1 字符串连接与长度</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- CONCAT(s1, s2, ...)：连接字符串</span></span><br><span class="line"><span class="keyword">SELECT</span> CONCAT(<span class="string">&#x27;Hello&#x27;</span>, <span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;World&#x27;</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- &#x27;Hello World&#x27;</span></span><br><span class="line"><span class="keyword">SELECT</span> CONCAT(<span class="string">&#x27;姓名：&#x27;</span>, name) <span class="keyword">FROM</span> employees;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- CONCAT_WS(separator, s1, s2, ...)：用分隔符连接</span></span><br><span class="line"><span class="keyword">SELECT</span> CONCAT_WS(<span class="string">&#x27;-&#x27;</span>, <span class="string">&#x27;2024&#x27;</span>, <span class="string">&#x27;02&#x27;</span>, <span class="string">&#x27;20&#x27;</span>) <span class="keyword">AS</span> <span class="type">date</span>;  <span class="comment">-- &#x27;2024-02-20&#x27;</span></span><br><span class="line"><span class="keyword">SELECT</span> CONCAT_WS(<span class="string">&#x27; &#x27;</span>, first_name, last_name) <span class="keyword">AS</span> full_name <span class="keyword">FROM</span> users;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- LENGTH(s)：返回字符串长度（字节）</span></span><br><span class="line"><span class="keyword">SELECT</span> LENGTH(<span class="string">&#x27;hello&#x27;</span>) <span class="keyword">AS</span> len;  <span class="comment">-- 5</span></span><br><span class="line"><span class="keyword">SELECT</span> LENGTH(<span class="string">&#x27;你好&#x27;</span>) <span class="keyword">AS</span> len;   <span class="comment">-- 6（UTF-8 中一个汉字 3 字节）</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- CHAR_LENGTH(s)：返回字符数</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">CHAR_LENGTH</span>(<span class="string">&#x27;hello&#x27;</span>) <span class="keyword">AS</span> len;  <span class="comment">-- 5</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">CHAR_LENGTH</span>(<span class="string">&#x27;你好&#x27;</span>) <span class="keyword">AS</span> len;    <span class="comment">-- 2</span></span><br></pre></td></tr></table></figure>

<h3 id="2-2-大小写转换"><a href="#2-2-大小写转换" class="headerlink" title="2.2 大小写转换"></a>2.2 大小写转换</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- UPPER(s) 或 UCASE(s)：转大写</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">UPPER</span>(<span class="string">&#x27;hello&#x27;</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- &#x27;HELLO&#x27;</span></span><br><span class="line"><span class="keyword">SELECT</span> name, <span class="built_in">UPPER</span>(name) <span class="keyword">AS</span> upper_name <span class="keyword">FROM</span> employees;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- LOWER(s) 或 LCASE(s)：转小写</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">LOWER</span>(<span class="string">&#x27;HELLO&#x27;</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- &#x27;hello&#x27;</span></span><br><span class="line"><span class="keyword">SELECT</span> email, <span class="built_in">LOWER</span>(email) <span class="keyword">AS</span> lower_email <span class="keyword">FROM</span> users;</span><br></pre></td></tr></table></figure>

<h3 id="2-3-字符串截取"><a href="#2-3-字符串截取" class="headerlink" title="2.3 字符串截取"></a>2.3 字符串截取</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- LEFT(s, n)：返回左边 n 个字符</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">LEFT</span>(<span class="string">&#x27;Hello World&#x27;</span>, <span class="number">5</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- &#x27;Hello&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- RIGHT(s, n)：返回右边 n 个字符</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">RIGHT</span>(<span class="string">&#x27;Hello World&#x27;</span>, <span class="number">5</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- &#x27;World&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- SUBSTRING(s, pos, len)：从位置 pos 开始截取 len 个字符</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">SUBSTRING</span>(<span class="string">&#x27;Hello World&#x27;</span>, <span class="number">1</span>, <span class="number">5</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- &#x27;Hello&#x27;</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">SUBSTRING</span>(<span class="string">&#x27;Hello World&#x27;</span>, <span class="number">7</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;     <span class="comment">-- &#x27;World&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- SUBSTRING(s, pos FROM len)：另一种语法</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">SUBSTRING</span>(<span class="string">&#x27;Hello World&#x27;</span> <span class="keyword">FROM</span> <span class="number">1</span> <span class="keyword">FOR</span> <span class="number">5</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- &#x27;Hello&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- MID(s, pos, len)：同 SUBSTRING</span></span><br><span class="line"><span class="keyword">SELECT</span> MID(<span class="string">&#x27;Hello World&#x27;</span>, <span class="number">7</span>, <span class="number">5</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- &#x27;World&#x27;</span></span><br></pre></td></tr></table></figure>

<p><strong>注意</strong>：MySQL 中字符串位置从 1 开始，不是从 0 开始！</p>
<h3 id="2-4-字符串查找与替换"><a href="#2-4-字符串查找与替换" class="headerlink" title="2.4 字符串查找与替换"></a>2.4 字符串查找与替换</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- INSTR(s, substr)：返回子串第一次出现的位置</span></span><br><span class="line"><span class="keyword">SELECT</span> INSTR(<span class="string">&#x27;Hello World&#x27;</span>, <span class="string">&#x27;o&#x27;</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- 5</span></span><br><span class="line"><span class="keyword">SELECT</span> INSTR(<span class="string">&#x27;Hello World&#x27;</span>, <span class="string">&#x27;xyz&#x27;</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- 0（未找到）</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- LOCATE(substr, s)：同 INSTR</span></span><br><span class="line"><span class="keyword">SELECT</span> LOCATE(<span class="string">&#x27;World&#x27;</span>, <span class="string">&#x27;Hello World&#x27;</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- 7</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- REPLACE(s, from_str, to_str)：替换字符串</span></span><br><span class="line"><span class="keyword">SELECT</span> REPLACE(<span class="string">&#x27;Hello World&#x27;</span>, <span class="string">&#x27;World&#x27;</span>, <span class="string">&#x27;MySQL&#x27;</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- &#x27;Hello MySQL&#x27;</span></span><br><span class="line"><span class="keyword">UPDATE</span> products <span class="keyword">SET</span> description <span class="operator">=</span> REPLACE(description, <span class="string">&#x27;旧版&#x27;</span>, <span class="string">&#x27;新版&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- INSERT(str, pos, len, newstr)：在指定位置插入/替换字符串</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">INSERT</span>(<span class="string">&#x27;Hello World&#x27;</span>, <span class="number">7</span>, <span class="number">5</span>, <span class="string">&#x27;MySQL&#x27;</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- &#x27;Hello MySQL&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="2-5-去除空格"><a href="#2-5-去除空格" class="headerlink" title="2.5 去除空格"></a>2.5 去除空格</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- TRIM(s)：去除两端空格</span></span><br><span class="line"><span class="keyword">SELECT</span> CONCAT(<span class="string">&#x27;[&#x27;</span>, <span class="built_in">TRIM</span>(<span class="string">&#x27;  hello  &#x27;</span>), <span class="string">&#x27;]&#x27;</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- &#x27;[hello]&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- LTRIM(s)：去除左边空格</span></span><br><span class="line"><span class="keyword">SELECT</span> CONCAT(<span class="string">&#x27;[&#x27;</span>, LTRIM(<span class="string">&#x27;  hello  &#x27;</span>), <span class="string">&#x27;]&#x27;</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- &#x27;[hello  ]&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- RTRIM(s)：去除右边空格</span></span><br><span class="line"><span class="keyword">SELECT</span> CONCAT(<span class="string">&#x27;[&#x27;</span>, RTRIM(<span class="string">&#x27;  hello  &#x27;</span>), <span class="string">&#x27;]&#x27;</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- &#x27;[  hello]&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 去除指定字符（MySQL 特有）</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">TRIM</span>(<span class="keyword">BOTH</span> <span class="string">&#x27;x&#x27;</span> <span class="keyword">FROM</span> <span class="string">&#x27;xxxhelloxxx&#x27;</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- &#x27;hello&#x27;</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">TRIM</span>(<span class="keyword">LEADING</span> <span class="string">&#x27;x&#x27;</span> <span class="keyword">FROM</span> <span class="string">&#x27;xxxhelloxxx&#x27;</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- &#x27;helloxxx&#x27;</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">TRIM</span>(<span class="keyword">TRAILING</span> <span class="string">&#x27;x&#x27;</span> <span class="keyword">FROM</span> <span class="string">&#x27;xxxhelloxxx&#x27;</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- &#x27;xxxhello&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="2-6-字符串填充"><a href="#2-6-字符串填充" class="headerlink" title="2.6 字符串填充"></a>2.6 字符串填充</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- LPAD(s, len, pad)：左填充</span></span><br><span class="line"><span class="keyword">SELECT</span> LPAD(<span class="string">&#x27;123&#x27;</span>, <span class="number">8</span>, <span class="string">&#x27;0&#x27;</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- &#x27;00000123&#x27;</span></span><br><span class="line"><span class="keyword">SELECT</span> LPAD(<span class="string">&#x27;123&#x27;</span>, <span class="number">2</span>, <span class="string">&#x27;0&#x27;</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- &#x27;12&#x27;（长度超过则截断）</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- RPAD(s, len, pad)：右填充</span></span><br><span class="line"><span class="keyword">SELECT</span> RPAD(<span class="string">&#x27;123&#x27;</span>, <span class="number">8</span>, <span class="string">&#x27;0&#x27;</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- &#x27;12300000&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- LPAD 实战：生成固定长度的编号</span></span><br><span class="line"><span class="keyword">SELECT</span> LPAD(id, <span class="number">6</span>, <span class="string">&#x27;0&#x27;</span>) <span class="keyword">AS</span> order_no <span class="keyword">FROM</span> orders;  <span class="comment">-- &#x27;000001&#x27;, &#x27;000002&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="2-7-字符串反转与重复"><a href="#2-7-字符串反转与重复" class="headerlink" title="2.7 字符串反转与重复"></a>2.7 字符串反转与重复</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- REVERSE(s)：反转字符串</span></span><br><span class="line"><span class="keyword">SELECT</span> REVERSE(<span class="string">&#x27;hello&#x27;</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- &#x27;olleh&#x27;</span></span><br><span class="line"><span class="keyword">SELECT</span> REVERSE(phone) <span class="keyword">AS</span> reversed_phone <span class="keyword">FROM</span> users;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- REPEAT(s, n)：重复字符串 n 次</span></span><br><span class="line"><span class="keyword">SELECT</span> REPEAT(<span class="string">&#x27;*&#x27;</span>, <span class="number">5</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- &#x27;*****&#x27;</span></span><br><span class="line"><span class="keyword">SELECT</span> REPEAT(<span class="string">&#x27;-&#x27;</span>, <span class="number">20</span>) <span class="keyword">AS</span> separator;  <span class="comment">-- &#x27;--------------------&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="2-8-字符串比较"><a href="#2-8-字符串比较" class="headerlink" title="2.8 字符串比较"></a>2.8 字符串比较</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- STRCMP(s1, s2)：比较字符串</span></span><br><span class="line"><span class="keyword">SELECT</span> STRCMP(<span class="string">&#x27;abc&#x27;</span>, <span class="string">&#x27;abc&#x27;</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- 0（相等）</span></span><br><span class="line"><span class="keyword">SELECT</span> STRCMP(<span class="string">&#x27;abc&#x27;</span>, <span class="string">&#x27;abd&#x27;</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- -1（s1 &lt; s2）</span></span><br><span class="line"><span class="keyword">SELECT</span> STRCMP(<span class="string">&#x27;abd&#x27;</span>, <span class="string">&#x27;abc&#x27;</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- 1（s1 &gt; s2）</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- FIELD(s, s1, s2, ...)：返回 s 在列表中的位置</span></span><br><span class="line"><span class="keyword">SELECT</span> FIELD(<span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;C&#x27;</span>, <span class="string">&#x27;D&#x27;</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- 2</span></span><br><span class="line"><span class="keyword">SELECT</span> FIELD(<span class="string">&#x27;X&#x27;</span>, <span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;C&#x27;</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- 0（未找到）</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- ELT(n, s1, s2, ...)：返回第 n 个位置的字符串</span></span><br><span class="line"><span class="keyword">SELECT</span> ELT(<span class="number">2</span>, <span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;C&#x27;</span>, <span class="string">&#x27;D&#x27;</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- &#x27;B&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="2-9-其他常用函数"><a href="#2-9-其他常用函数" class="headerlink" title="2.9 其他常用函数"></a>2.9 其他常用函数</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- SPACE(n)：返回 n 个空格</span></span><br><span class="line"><span class="keyword">SELECT</span> CONCAT(<span class="string">&#x27;[&#x27;</span>, SPACE(<span class="number">5</span>), <span class="string">&#x27;]&#x27;</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- &#x27;[     ]&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- ASCII(s)：返回最左边字符的 ASCII 码</span></span><br><span class="line"><span class="keyword">SELECT</span> ASCII(<span class="string">&#x27;A&#x27;</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- 65</span></span><br><span class="line"><span class="keyword">SELECT</span> ASCII(<span class="string">&#x27;你好&#x27;</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- 228（多字节字符返回第一个字节）</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- CHAR(n, n2, ...)：返回 ASCII 码对应的字符</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="type">CHAR</span>(<span class="number">65</span>, <span class="number">66</span>, <span class="number">67</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- &#x27;ABC&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- BIN(n)：十进制转二进制</span></span><br><span class="line"><span class="keyword">SELECT</span> BIN(<span class="number">10</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- &#x27;1010&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- HEX(n 或 s)：十进制转十六进制，或字符串转十六进制</span></span><br><span class="line"><span class="keyword">SELECT</span> HEX(<span class="number">255</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- &#x27;FF&#x27;</span></span><br><span class="line"><span class="keyword">SELECT</span> HEX(<span class="string">&#x27;abc&#x27;</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- &#x27;616263&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- UNHEX(s)：十六进制转字符串</span></span><br><span class="line"><span class="keyword">SELECT</span> UNHEX(<span class="string">&#x27;616263&#x27;</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- &#x27;abc&#x27;</span></span><br></pre></td></tr></table></figure>

<h2 id="三、数值函数"><a href="#三、数值函数" class="headerlink" title="三、数值函数"></a>三、数值函数</h2><h3 id="3-1-绝对值与符号"><a href="#3-1-绝对值与符号" class="headerlink" title="3.1 绝对值与符号"></a>3.1 绝对值与符号</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- ABS(n)：绝对值</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">ABS</span>(<span class="number">-10</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- 10</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">ABS</span>(<span class="number">10</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;   <span class="comment">-- 10</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- SIGN(n)：符号函数</span></span><br><span class="line"><span class="keyword">SELECT</span> SIGN(<span class="number">-10</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- -1</span></span><br><span class="line"><span class="keyword">SELECT</span> SIGN(<span class="number">0</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;    <span class="comment">-- 0</span></span><br><span class="line"><span class="keyword">SELECT</span> SIGN(<span class="number">10</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;   <span class="comment">-- 1</span></span><br></pre></td></tr></table></figure>

<h3 id="3-2-四舍五入与截断"><a href="#3-2-四舍五入与截断" class="headerlink" title="3.2 四舍五入与截断"></a>3.2 四舍五入与截断</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- ROUND(n, d)：四舍五入到 d 位小数</span></span><br><span class="line"><span class="keyword">SELECT</span> ROUND(<span class="number">3.14159</span>, <span class="number">2</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- 3.14</span></span><br><span class="line"><span class="keyword">SELECT</span> ROUND(<span class="number">3.145</span>, <span class="number">2</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;    <span class="comment">-- 3.15（四舍五入）</span></span><br><span class="line"><span class="keyword">SELECT</span> ROUND(<span class="number">1234.567</span>, <span class="number">-1</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- 1230（负数表示小数点左边）</span></span><br><span class="line"><span class="keyword">SELECT</span> ROUND(<span class="number">1234.567</span>, <span class="number">-2</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- 1200</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- TRUNCATE(n, d)：截断到 d 位小数</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">TRUNCATE</span>(<span class="number">3.14159</span>, <span class="number">2</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- 3.14</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">TRUNCATE</span>(<span class="number">3.149</span>, <span class="number">2</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;    <span class="comment">-- 3.14（直接截断，不四舍五入）</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">TRUNCATE</span>(<span class="number">1234.567</span>, <span class="number">-1</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- 1230</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- CEIL(n) 或 CEILING(n)：向上取整</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">CEIL</span>(<span class="number">3.14</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- 4</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">CEIL</span>(<span class="number">3.99</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- 4</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">CEIL</span>(<span class="number">-3.14</span>) <span class="keyword">AS</span> <span class="keyword">result</span>; <span class="comment">-- -3</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- FLOOR(n)：向下取整</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">FLOOR</span>(<span class="number">3.14</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- 3</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">FLOOR</span>(<span class="number">3.99</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- 3</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">FLOOR</span>(<span class="number">-3.14</span>) <span class="keyword">AS</span> <span class="keyword">result</span>; <span class="comment">-- -4</span></span><br></pre></td></tr></table></figure>

<h3 id="3-3-取模运算"><a href="#3-3-取模运算" class="headerlink" title="3.3 取模运算"></a>3.3 取模运算</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- MOD(n, m) 或 n % m：取模</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">MOD</span>(<span class="number">10</span>, <span class="number">3</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- 1</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="number">10</span> <span class="operator">%</span> <span class="number">3</span> <span class="keyword">AS</span> <span class="keyword">result</span>;      <span class="comment">-- 1</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">MOD</span>(<span class="number">-10</span>, <span class="number">3</span>) <span class="keyword">AS</span> <span class="keyword">result</span>; <span class="comment">-- -1</span></span><br></pre></td></tr></table></figure>

<h3 id="3-4-随机数"><a href="#3-4-随机数" class="headerlink" title="3.4 随机数"></a>3.4 随机数</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- RAND()：返回 0-1 之间的随机数</span></span><br><span class="line"><span class="keyword">SELECT</span> RAND() <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- 0.7234567890123456</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- RAND(n)：使用种子生成可重复的随机数</span></span><br><span class="line"><span class="keyword">SELECT</span> RAND(<span class="number">5</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- 每次使用相同种子得到相同结果</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 生成指定范围的随机整数</span></span><br><span class="line"><span class="comment">-- 公式：FLOOR(RAND() * (max - min + 1)) + min</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">FLOOR</span>(RAND() <span class="operator">*</span> <span class="number">10</span>) <span class="keyword">AS</span> random_0_9;       <span class="comment">-- 0-9</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">FLOOR</span>(RAND() <span class="operator">*</span> <span class="number">100</span>) <span class="operator">+</span> <span class="number">1</span> <span class="keyword">AS</span> random_1_100; <span class="comment">-- 1-100</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">FLOOR</span>(RAND() <span class="operator">*</span> <span class="number">6</span>) <span class="operator">+</span> <span class="number">1</span> <span class="keyword">AS</span> dice;           <span class="comment">-- 模拟骰子 1-6</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 随机排序（慎用，性能差）</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees <span class="keyword">ORDER</span> <span class="keyword">BY</span> RAND() LIMIT <span class="number">5</span>;  <span class="comment">-- 随机抽取 5 条</span></span><br></pre></td></tr></table></figure>

<h3 id="3-5-幂运算与开方"><a href="#3-5-幂运算与开方" class="headerlink" title="3.5 幂运算与开方"></a>3.5 幂运算与开方</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- POW(x, y) 或 POWER(x, y)：x 的 y 次幂</span></span><br><span class="line"><span class="keyword">SELECT</span> POW(<span class="number">2</span>, <span class="number">3</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;    <span class="comment">-- 8</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">POWER</span>(<span class="number">2</span>, <span class="number">3</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- 8</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- SQRT(n)：平方根</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">SQRT</span>(<span class="number">16</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- 4</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">SQRT</span>(<span class="number">2</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;   <span class="comment">-- 1.4142135623730951</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- EXP(n)：e 的 n 次幂</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">EXP</span>(<span class="number">1</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- 2.718281828459045</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- LN(n)：自然对数</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">LN</span>(<span class="number">2.718281828459045</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- 1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- LOG10(n)：以 10 为底的对数</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">LOG10</span>(<span class="number">100</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- 2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- LOG2(n)：以 2 为底的对数</span></span><br><span class="line"><span class="keyword">SELECT</span> LOG2(<span class="number">8</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- 3</span></span><br></pre></td></tr></table></figure>

<h3 id="3-6-角度与弧度"><a href="#3-6-角度与弧度" class="headerlink" title="3.6 角度与弧度"></a>3.6 角度与弧度</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- RADIANS(n)：角度转弧度</span></span><br><span class="line"><span class="keyword">SELECT</span> RADIANS(<span class="number">180</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- 3.141592653589793</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- DEGREES(n)：弧度转角度</span></span><br><span class="line"><span class="keyword">SELECT</span> DEGREES(<span class="number">3.141592653589793</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- 180</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- PI()：返回圆周率</span></span><br><span class="line"><span class="keyword">SELECT</span> PI() <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- 3.141592653589793</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- SIN(n)、COS(n)、TAN(n)：三角函数</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">SIN</span>(RADIANS(<span class="number">30</span>)) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- 0.5</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COS</span>(RADIANS(<span class="number">60</span>)) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- 0.5</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">TAN</span>(RADIANS(<span class="number">45</span>)) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- 1</span></span><br></pre></td></tr></table></figure>

<h3 id="3-7-其他数值函数"><a href="#3-7-其他数值函数" class="headerlink" title="3.7 其他数值函数"></a>3.7 其他数值函数</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- CRC32(s)：计算循环冗余校验码</span></span><br><span class="line"><span class="keyword">SELECT</span> CRC32(<span class="string">&#x27;hello&#x27;</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- 907060870</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 实战：生成简短的哈希值</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">LOWER</span>(HEX(CRC32(<span class="string">&#x27;hello&#x27;</span>))) <span class="keyword">AS</span> short_hash;  <span class="comment">-- &#x27;0567e1b5&#x27;</span></span><br></pre></td></tr></table></figure>

<h2 id="四、日期时间函数"><a href="#四、日期时间函数" class="headerlink" title="四、日期时间函数"></a>四、日期时间函数</h2><h3 id="4-1-获取当前日期时间"><a href="#4-1-获取当前日期时间" class="headerlink" title="4.1 获取当前日期时间"></a>4.1 获取当前日期时间</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- NOW()：当前日期和时间</span></span><br><span class="line"><span class="keyword">SELECT</span> NOW() <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- &#x27;2024-02-20 15:30:45&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- CURRENT_TIMESTAMP：同 NOW()</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">CURRENT_TIMESTAMP</span>() <span class="keyword">AS</span> <span class="keyword">result</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- SYSDATE()：函数执行时的时间（与 NOW 略有不同）</span></span><br><span class="line"><span class="keyword">SELECT</span> SYSDATE() <span class="keyword">AS</span> <span class="keyword">result</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- CURDATE() 或 CURRENT_DATE：当前日期</span></span><br><span class="line"><span class="keyword">SELECT</span> CURDATE() <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- &#x27;2024-02-20&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- CURTIME() 或 CURRENT_TIME：当前时间</span></span><br><span class="line"><span class="keyword">SELECT</span> CURTIME() <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- &#x27;15:30:45&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="4-2-日期时间提取"><a href="#4-2-日期时间提取" class="headerlink" title="4.2 日期时间提取"></a>4.2 日期时间提取</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- DATE(d)：提取日期部分</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="type">DATE</span>(NOW()) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- &#x27;2024-02-20&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- TIME(d)：提取时间部分</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="type">TIME</span>(NOW()) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- &#x27;15:30:45&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- YEAR(d)：年份</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">YEAR</span>(NOW()) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- 2024</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">YEAR</span>(hire_date) <span class="keyword">AS</span> hire_year <span class="keyword">FROM</span> employees;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- MONTH(d)：月份</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">MONTH</span>(NOW()) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- 2</span></span><br><span class="line"><span class="keyword">SELECT</span> MONTHNAME(NOW()) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- &#x27;February&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- DAY(d) 或 DAYOFMONTH(d)：日期（月中第几天）</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DAY</span>(NOW()) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- 20</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- DAYOFWEEK(d)：星期几（1=Sunday, 7=Saturday）</span></span><br><span class="line"><span class="keyword">SELECT</span> DAYOFWEEK(NOW()) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- 3（周二）</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- DAYOFYEAR(d)：一年中的第几天</span></span><br><span class="line"><span class="keyword">SELECT</span> DAYOFYEAR(NOW()) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- 51</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- WEEK(d)：一年中的第几周</span></span><br><span class="line"><span class="keyword">SELECT</span> WEEK(NOW()) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- 8</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- WEEKDAY(d)：工作日（0=Monday, 6=Sunday）</span></span><br><span class="line"><span class="keyword">SELECT</span> WEEKDAY(NOW()) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- 1（周二）</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- HOUR(t)、MINUTE(t)、SECOND(t)：时分秒</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">HOUR</span>(NOW()) <span class="keyword">AS</span> <span class="keyword">hour</span>, <span class="keyword">MINUTE</span>(NOW()) <span class="keyword">AS</span> <span class="keyword">minute</span>, <span class="keyword">SECOND</span>(NOW()) <span class="keyword">AS</span> <span class="keyword">second</span>;</span><br></pre></td></tr></table></figure>

<h3 id="4-3-日期时间格式化"><a href="#4-3-日期时间格式化" class="headerlink" title="4.3 日期时间格式化"></a>4.3 日期时间格式化</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- DATE_FORMAT(d, format)：格式化日期</span></span><br><span class="line"><span class="keyword">SELECT</span> DATE_FORMAT(NOW(), <span class="string">&#x27;%Y-%m-%d&#x27;</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- &#x27;2024-02-20&#x27;</span></span><br><span class="line"><span class="keyword">SELECT</span> DATE_FORMAT(NOW(), <span class="string">&#x27;%Y 年%m 月%d 日&#x27;</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- &#x27;2024 年 02 月 20 日&#x27;</span></span><br><span class="line"><span class="keyword">SELECT</span> DATE_FORMAT(NOW(), <span class="string">&#x27;%H:%i:%s&#x27;</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- &#x27;15:30:45&#x27;</span></span><br><span class="line"><span class="keyword">SELECT</span> DATE_FORMAT(NOW(), <span class="string">&#x27;%W, %M %d, %Y&#x27;</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- &#x27;Tuesday, February 20, 2024&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- TIME_FORMAT(t, format)：格式化时间</span></span><br><span class="line"><span class="keyword">SELECT</span> TIME_FORMAT(NOW(), <span class="string">&#x27;%H 时%i 分%s 秒&#x27;</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- &#x27;15 时 30 分 45 秒&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 常用格式符：</span></span><br><span class="line"><span class="comment">-- %Y：四位年份  | %y：两位年份</span></span><br><span class="line"><span class="comment">-- %m：月份 (01-12) | %c：月份 (1-12)</span></span><br><span class="line"><span class="comment">-- %d：日期 (01-31) | %e：日期 (1-31)</span></span><br><span class="line"><span class="comment">-- %H：小时 (00-23) | %h/%I：小时 (01-12)</span></span><br><span class="line"><span class="comment">-- %i：分钟 (00-59) | %s/%S：秒 (00-59)</span></span><br><span class="line"><span class="comment">-- %p：AM/PM | %W：星期名 | %a：星期缩写</span></span><br><span class="line"><span class="comment">-- %M：月份名 | %b：月份缩写</span></span><br></pre></td></tr></table></figure>

<h3 id="4-4-字符串转日期"><a href="#4-4-字符串转日期" class="headerlink" title="4.4 字符串转日期"></a>4.4 字符串转日期</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- STR_TO_DATE(s, format)：字符串转日期</span></span><br><span class="line"><span class="keyword">SELECT</span> STR_TO_DATE(<span class="string">&#x27;2024-02-20&#x27;</span>, <span class="string">&#x27;%Y-%m-%d&#x27;</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- &#x27;2024-02-20&#x27;</span></span><br><span class="line"><span class="keyword">SELECT</span> STR_TO_DATE(<span class="string">&#x27;02/20/2024&#x27;</span>, <span class="string">&#x27;%m/%d/%Y&#x27;</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- &#x27;2024-02-20&#x27;</span></span><br><span class="line"><span class="keyword">SELECT</span> STR_TO_DATE(<span class="string">&#x27;20240220&#x27;</span>, <span class="string">&#x27;%Y%m%d&#x27;</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- &#x27;2024-02-20&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="4-5-日期时间运算"><a href="#4-5-日期时间运算" class="headerlink" title="4.5 日期时间运算"></a>4.5 日期时间运算</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- DATE_ADD(d, INTERVAL expr unit)：日期增加</span></span><br><span class="line"><span class="keyword">SELECT</span> DATE_ADD(NOW(), <span class="type">INTERVAL</span> <span class="number">1</span> <span class="keyword">DAY</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- 明天</span></span><br><span class="line"><span class="keyword">SELECT</span> DATE_ADD(NOW(), <span class="type">INTERVAL</span> <span class="number">-1</span> <span class="keyword">DAY</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- 昨天</span></span><br><span class="line"><span class="keyword">SELECT</span> DATE_ADD(NOW(), <span class="type">INTERVAL</span> <span class="number">1</span> <span class="keyword">MONTH</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- 下个月</span></span><br><span class="line"><span class="keyword">SELECT</span> DATE_ADD(NOW(), <span class="type">INTERVAL</span> <span class="number">1</span> <span class="keyword">YEAR</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- 明年</span></span><br><span class="line"><span class="keyword">SELECT</span> DATE_ADD(NOW(), <span class="type">INTERVAL</span> <span class="number">1</span> <span class="keyword">HOUR</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- 1 小时后</span></span><br><span class="line"><span class="keyword">SELECT</span> DATE_ADD(NOW(), <span class="type">INTERVAL</span> <span class="number">30</span> <span class="keyword">MINUTE</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- 30 分钟后</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- DATE_SUB(d, INTERVAL expr unit)：日期减少</span></span><br><span class="line"><span class="keyword">SELECT</span> DATE_SUB(NOW(), <span class="type">INTERVAL</span> <span class="number">1</span> <span class="keyword">DAY</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- 昨天</span></span><br><span class="line"><span class="keyword">SELECT</span> DATE_SUB(CURDATE(), <span class="type">INTERVAL</span> <span class="number">1</span> <span class="keyword">MONTH</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- 上个月</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 使用 + 和 - 运算符（简化写法）</span></span><br><span class="line"><span class="keyword">SELECT</span> NOW() <span class="operator">+</span> <span class="type">INTERVAL</span> <span class="number">1</span> <span class="keyword">DAY</span> <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- 明天</span></span><br><span class="line"><span class="keyword">SELECT</span> NOW() <span class="operator">-</span> <span class="type">INTERVAL</span> <span class="number">1</span> <span class="keyword">HOUR</span> <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- 1 小时前</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- ADDDATE(d, n)：增加 n 天</span></span><br><span class="line"><span class="keyword">SELECT</span> ADDDATE(CURDATE(), <span class="number">7</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- 7 天后</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- SUBDATE(d, n)：减少 n 天</span></span><br><span class="line"><span class="keyword">SELECT</span> SUBDATE(CURDATE(), <span class="number">7</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- 7 天前</span></span><br></pre></td></tr></table></figure>

<h3 id="4-6-日期差值"><a href="#4-6-日期差值" class="headerlink" title="4.6 日期差值"></a>4.6 日期差值</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- DATEDIFF(d1, d2)：d1 - d2 的天数差</span></span><br><span class="line"><span class="keyword">SELECT</span> DATEDIFF(<span class="string">&#x27;2024-02-20&#x27;</span>, <span class="string">&#x27;2024-01-01&#x27;</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- 50</span></span><br><span class="line"><span class="keyword">SELECT</span> DATEDIFF(CURDATE(), hire_date) <span class="keyword">AS</span> work_days <span class="keyword">FROM</span> employees;  <span class="comment">-- 入职天数</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- TIMEDIFF(t1, t2)：时间差</span></span><br><span class="line"><span class="keyword">SELECT</span> TIMEDIFF(<span class="string">&#x27;15:30:00&#x27;</span>, <span class="string">&#x27;10:00:00&#x27;</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- &#x27;05:30:00&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- TIMESTAMPDIFF(unit, d1, d2)：指定单位的差值</span></span><br><span class="line"><span class="keyword">SELECT</span> TIMESTAMPDIFF(<span class="keyword">DAY</span>, <span class="string">&#x27;2024-01-01&#x27;</span>, <span class="string">&#x27;2024-02-20&#x27;</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- 50</span></span><br><span class="line"><span class="keyword">SELECT</span> TIMESTAMPDIFF(<span class="keyword">MONTH</span>, <span class="string">&#x27;2024-01-01&#x27;</span>, <span class="string">&#x27;2024-02-20&#x27;</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- 1</span></span><br><span class="line"><span class="keyword">SELECT</span> TIMESTAMPDIFF(<span class="keyword">YEAR</span>, <span class="string">&#x27;2020-01-01&#x27;</span>, <span class="string">&#x27;2024-02-20&#x27;</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- 4</span></span><br><span class="line"><span class="keyword">SELECT</span> TIMESTAMPDIFF(<span class="keyword">SECOND</span>, <span class="string">&#x27;10:00:00&#x27;</span>, <span class="string">&#x27;15:30:00&#x27;</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- 19800</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 计算年龄</span></span><br><span class="line"><span class="keyword">SELECT</span> name, TIMESTAMPDIFF(<span class="keyword">YEAR</span>, birth_date, CURDATE()) <span class="keyword">AS</span> age <span class="keyword">FROM</span> users;</span><br></pre></td></tr></table></figure>

<h3 id="4-7-日期边界函数"><a href="#4-7-日期边界函数" class="headerlink" title="4.7 日期边界函数"></a>4.7 日期边界函数</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- LAST_DAY(d)：返回当月最后一天</span></span><br><span class="line"><span class="keyword">SELECT</span> LAST_DAY(CURDATE()) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- &#x27;2024-02-29&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- DAYNAME(d)：星期几的英文名</span></span><br><span class="line"><span class="keyword">SELECT</span> DAYNAME(CURDATE()) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- &#x27;Tuesday&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- MAKEDATE(year, day)：根据年份和一年中的第几天创建日期</span></span><br><span class="line"><span class="keyword">SELECT</span> MAKEDATE(<span class="number">2024</span>, <span class="number">50</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- &#x27;2024-02-19&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- MAKETIME(hour, minute, second)：创建时间</span></span><br><span class="line"><span class="keyword">SELECT</span> MAKETIME(<span class="number">15</span>, <span class="number">30</span>, <span class="number">45</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- &#x27;15:30:45&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="4-8-日期函数实战案例"><a href="#4-8-日期函数实战案例" class="headerlink" title="4.8 日期函数实战案例"></a>4.8 日期函数实战案例</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 案例 1：查询本月入职的员工</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">MONTH</span>(hire_date) <span class="operator">=</span> <span class="keyword">MONTH</span>(CURDATE())</span><br><span class="line"><span class="keyword">AND</span> <span class="keyword">YEAR</span>(hire_date) <span class="operator">=</span> <span class="keyword">YEAR</span>(CURDATE());</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 案例 2：查询本周的数据</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> orders</span><br><span class="line"><span class="keyword">WHERE</span> YEARWEEK(order_date) <span class="operator">=</span> YEARWEEK(CURDATE());</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 案例 3：查询超过 30 天未登录的用户</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users</span><br><span class="line"><span class="keyword">WHERE</span> DATEDIFF(CURDATE(), last_login) <span class="operator">&gt;</span> <span class="number">30</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 案例 4：计算员工的工龄（年）</span></span><br><span class="line"><span class="keyword">SELECT</span> name, hire_date,</span><br><span class="line">       TIMESTAMPDIFF(<span class="keyword">YEAR</span>, hire_date, CURDATE()) <span class="keyword">AS</span> work_years</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> work_years <span class="keyword">DESC</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 案例 5：格式化显示订单时间</span></span><br><span class="line"><span class="keyword">SELECT</span> order_no,</span><br><span class="line">       DATE_FORMAT(create_time, <span class="string">&#x27;%Y-%m-%d %H:%i&#x27;</span>) <span class="keyword">AS</span> order_time,</span><br><span class="line">       DATE_FORMAT(create_time, <span class="string">&#x27;%W %M %d&#x27;</span>) <span class="keyword">AS</span> display_time</span><br><span class="line"><span class="keyword">FROM</span> orders;</span><br></pre></td></tr></table></figure>

<h2 id="五、流程函数"><a href="#五、流程函数" class="headerlink" title="五、流程函数"></a>五、流程函数</h2><h3 id="5-1-IF-函数"><a href="#5-1-IF-函数" class="headerlink" title="5.1 IF 函数"></a>5.1 IF 函数</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- IF(expr, v1, v2)：如果 expr 为真返回 v1，否则返回 v2</span></span><br><span class="line"><span class="keyword">SELECT</span> IF(<span class="number">1</span> <span class="operator">&gt;</span> <span class="number">2</span>, <span class="string">&#x27;对&#x27;</span>, <span class="string">&#x27;错&#x27;</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- &#x27;错&#x27;</span></span><br><span class="line"><span class="keyword">SELECT</span> IF(<span class="number">1</span> <span class="operator">&gt;</span> <span class="number">2</span>, <span class="string">&#x27;对&#x27;</span>, <span class="string">&#x27;错&#x27;</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- &#x27;错&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 实战：判断员工工资水平</span></span><br><span class="line"><span class="keyword">SELECT</span> name, salary,</span><br><span class="line">       IF(salary <span class="operator">&gt;</span> <span class="number">10000</span>, <span class="string">&#x27;高薪&#x27;</span>, <span class="string">&#x27;普通&#x27;</span>) <span class="keyword">AS</span> salary_level</span><br><span class="line"><span class="keyword">FROM</span> employees;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 实战：判断是否成年</span></span><br><span class="line"><span class="keyword">SELECT</span> name, age, IF(age <span class="operator">&gt;=</span> <span class="number">18</span>, <span class="string">&#x27;成年&#x27;</span>, <span class="string">&#x27;未成年&#x27;</span>) <span class="keyword">AS</span> status <span class="keyword">FROM</span> users;</span><br></pre></td></tr></table></figure>

<h3 id="5-2-IFNULL-函数"><a href="#5-2-IFNULL-函数" class="headerlink" title="5.2 IFNULL 函数"></a>5.2 IFNULL 函数</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- IFNULL(v1, v2)：如果 v1 不为 NULL 返回 v1，否则返回 v2</span></span><br><span class="line"><span class="keyword">SELECT</span> IFNULL(<span class="keyword">NULL</span>, <span class="string">&#x27;默认值&#x27;</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- &#x27;默认值&#x27;</span></span><br><span class="line"><span class="keyword">SELECT</span> IFNULL(<span class="string">&#x27;有值&#x27;</span>, <span class="string">&#x27;默认值&#x27;</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- &#x27;有值&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 实战：处理 NULL 值</span></span><br><span class="line"><span class="keyword">SELECT</span> name, IFNULL(salary, <span class="number">0</span>) <span class="keyword">AS</span> salary <span class="keyword">FROM</span> employees;</span><br><span class="line"><span class="keyword">SELECT</span> name, IFNULL(phone, <span class="string">&#x27;未填写&#x27;</span>) <span class="keyword">AS</span> phone <span class="keyword">FROM</span> users;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 实战：计算平均工资（避免除以 NULL）</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">SUM</span>(salary) <span class="operator">/</span> IFNULL(<span class="built_in">COUNT</span>(<span class="built_in">NULLIF</span>(salary, <span class="keyword">NULL</span>)), <span class="number">1</span>) <span class="keyword">AS</span> avg_salary</span><br><span class="line"><span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>

<h3 id="5-3-NULLIF-函数"><a href="#5-3-NULLIF-函数" class="headerlink" title="5.3 NULLIF 函数"></a>5.3 NULLIF 函数</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- NULLIF(v1, v2)：如果 v1 = v2 返回 NULL，否则返回 v1</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">NULLIF</span>(<span class="number">10</span>, <span class="number">10</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- NULL</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">NULLIF</span>(<span class="number">10</span>, <span class="number">20</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- 10</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 实战：避免除以零</span></span><br><span class="line"><span class="keyword">SELECT</span> salary <span class="operator">/</span> <span class="built_in">NULLIF</span>(commission, <span class="number">0</span>) <span class="keyword">AS</span> ratio <span class="keyword">FROM</span> employees;</span><br><span class="line"><span class="comment">-- 如果 commission 为 0，返回 NULL 而不是报错</span></span><br></pre></td></tr></table></figure>

<h3 id="5-4-CASE-表达式"><a href="#5-4-CASE-表达式" class="headerlink" title="5.4 CASE 表达式"></a>5.4 CASE 表达式</h3><h4 id="简单-CASE"><a href="#简单-CASE" class="headerlink" title="简单 CASE"></a>简单 CASE</h4><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- CASE value WHEN v1 THEN r1 WHEN v2 THEN r2 ... ELSE rn END</span></span><br><span class="line"><span class="keyword">SELECT</span> name, dept_id,</span><br><span class="line">       <span class="keyword">CASE</span> dept_id</span><br><span class="line">           <span class="keyword">WHEN</span> <span class="number">1</span> <span class="keyword">THEN</span> <span class="string">&#x27;技术部&#x27;</span></span><br><span class="line">           <span class="keyword">WHEN</span> <span class="number">2</span> <span class="keyword">THEN</span> <span class="string">&#x27;市场部&#x27;</span></span><br><span class="line">           <span class="keyword">WHEN</span> <span class="number">3</span> <span class="keyword">THEN</span> <span class="string">&#x27;财务部&#x27;</span></span><br><span class="line">           <span class="keyword">WHEN</span> <span class="number">4</span> <span class="keyword">THEN</span> <span class="string">&#x27;人事部&#x27;</span></span><br><span class="line">           <span class="keyword">ELSE</span> <span class="string">&#x27;其他&#x27;</span></span><br><span class="line">       <span class="keyword">END</span> <span class="keyword">AS</span> dept_name</span><br><span class="line"><span class="keyword">FROM</span> employees;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 实战：将数字转为中文星期</span></span><br><span class="line"><span class="keyword">SELECT</span> DAYNAME(CURDATE()) <span class="keyword">AS</span> weekday,</span><br><span class="line">       <span class="keyword">CASE</span> DAYOFWEEK(CURDATE())</span><br><span class="line">           <span class="keyword">WHEN</span> <span class="number">1</span> <span class="keyword">THEN</span> <span class="string">&#x27;星期日&#x27;</span></span><br><span class="line">           <span class="keyword">WHEN</span> <span class="number">2</span> <span class="keyword">THEN</span> <span class="string">&#x27;星期一&#x27;</span></span><br><span class="line">           <span class="keyword">WHEN</span> <span class="number">3</span> <span class="keyword">THEN</span> <span class="string">&#x27;星期二&#x27;</span></span><br><span class="line">           <span class="keyword">WHEN</span> <span class="number">4</span> <span class="keyword">THEN</span> <span class="string">&#x27;星期三&#x27;</span></span><br><span class="line">           <span class="keyword">WHEN</span> <span class="number">5</span> <span class="keyword">THEN</span> <span class="string">&#x27;星期四&#x27;</span></span><br><span class="line">           <span class="keyword">WHEN</span> <span class="number">6</span> <span class="keyword">THEN</span> <span class="string">&#x27;星期五&#x27;</span></span><br><span class="line">           <span class="keyword">WHEN</span> <span class="number">7</span> <span class="keyword">THEN</span> <span class="string">&#x27;星期六&#x27;</span></span><br><span class="line">       <span class="keyword">END</span> <span class="keyword">AS</span> weekday_cn;</span><br></pre></td></tr></table></figure>

<h4 id="搜索-CASE"><a href="#搜索-CASE" class="headerlink" title="搜索 CASE"></a>搜索 CASE</h4><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- CASE WHEN condition1 THEN r1 WHEN condition2 THEN r2 ... ELSE rn END</span></span><br><span class="line"><span class="keyword">SELECT</span> name, salary,</span><br><span class="line">       <span class="keyword">CASE</span></span><br><span class="line">           <span class="keyword">WHEN</span> salary <span class="operator">&gt;=</span> <span class="number">15000</span> <span class="keyword">THEN</span> <span class="string">&#x27;高收入&#x27;</span></span><br><span class="line">           <span class="keyword">WHEN</span> salary <span class="operator">&gt;=</span> <span class="number">10000</span> <span class="keyword">THEN</span> <span class="string">&#x27;中高收入&#x27;</span></span><br><span class="line">           <span class="keyword">WHEN</span> salary <span class="operator">&gt;=</span> <span class="number">7000</span> <span class="keyword">THEN</span> <span class="string">&#x27;中等收入&#x27;</span></span><br><span class="line">           <span class="keyword">WHEN</span> salary <span class="operator">&gt;=</span> <span class="number">5000</span> <span class="keyword">THEN</span> <span class="string">&#x27;中低收入&#x27;</span></span><br><span class="line">           <span class="keyword">ELSE</span> <span class="string">&#x27;低收入&#x27;</span></span><br><span class="line">       <span class="keyword">END</span> <span class="keyword">AS</span> income_level</span><br><span class="line"><span class="keyword">FROM</span> employees;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 实战：根据成绩评定等级</span></span><br><span class="line"><span class="keyword">SELECT</span> student_name, score,</span><br><span class="line">       <span class="keyword">CASE</span></span><br><span class="line">           <span class="keyword">WHEN</span> score <span class="operator">&gt;=</span> <span class="number">90</span> <span class="keyword">THEN</span> <span class="string">&#x27;A&#x27;</span></span><br><span class="line">           <span class="keyword">WHEN</span> score <span class="operator">&gt;=</span> <span class="number">80</span> <span class="keyword">THEN</span> <span class="string">&#x27;B&#x27;</span></span><br><span class="line">           <span class="keyword">WHEN</span> score <span class="operator">&gt;=</span> <span class="number">70</span> <span class="keyword">THEN</span> <span class="string">&#x27;C&#x27;</span></span><br><span class="line">           <span class="keyword">WHEN</span> score <span class="operator">&gt;=</span> <span class="number">60</span> <span class="keyword">THEN</span> <span class="string">&#x27;D&#x27;</span></span><br><span class="line">           <span class="keyword">ELSE</span> <span class="string">&#x27;F&#x27;</span></span><br><span class="line">       <span class="keyword">END</span> <span class="keyword">AS</span> grade</span><br><span class="line"><span class="keyword">FROM</span> scores;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 实战：计算奖金</span></span><br><span class="line"><span class="keyword">SELECT</span> name, salary,</span><br><span class="line">       <span class="keyword">CASE</span></span><br><span class="line">           <span class="keyword">WHEN</span> salary <span class="operator">&gt;=</span> <span class="number">15000</span> <span class="keyword">THEN</span> salary <span class="operator">*</span> <span class="number">0.2</span></span><br><span class="line">           <span class="keyword">WHEN</span> salary <span class="operator">&gt;=</span> <span class="number">10000</span> <span class="keyword">THEN</span> salary <span class="operator">*</span> <span class="number">0.15</span></span><br><span class="line">           <span class="keyword">WHEN</span> salary <span class="operator">&gt;=</span> <span class="number">7000</span> <span class="keyword">THEN</span> salary <span class="operator">*</span> <span class="number">0.1</span></span><br><span class="line">           <span class="keyword">ELSE</span> salary <span class="operator">*</span> <span class="number">0.05</span></span><br><span class="line">       <span class="keyword">END</span> <span class="keyword">AS</span> bonus</span><br><span class="line"><span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>

<h3 id="5-5-CASE-在-ORDER-BY-中的应用"><a href="#5-5-CASE-在-ORDER-BY-中的应用" class="headerlink" title="5.5 CASE 在 ORDER BY 中的应用"></a>5.5 CASE 在 ORDER BY 中的应用</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 自定义排序顺序</span></span><br><span class="line"><span class="keyword">SELECT</span> name, dept_id <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span></span><br><span class="line">    <span class="keyword">CASE</span> dept_id</span><br><span class="line">        <span class="keyword">WHEN</span> <span class="number">1</span> <span class="keyword">THEN</span> <span class="number">1</span></span><br><span class="line">        <span class="keyword">WHEN</span> <span class="number">3</span> <span class="keyword">THEN</span> <span class="number">2</span></span><br><span class="line">        <span class="keyword">WHEN</span> <span class="number">2</span> <span class="keyword">THEN</span> <span class="number">3</span></span><br><span class="line">        <span class="keyword">ELSE</span> <span class="number">4</span></span><br><span class="line">    <span class="keyword">END</span>;</span><br><span class="line"><span class="comment">-- 排序：技术部 → 财务部 → 市场部 → 其他</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 多条件排序</span></span><br><span class="line"><span class="keyword">SELECT</span> name, status, salary <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span></span><br><span class="line">    <span class="keyword">CASE</span> status <span class="keyword">WHEN</span> <span class="number">1</span> <span class="keyword">THEN</span> <span class="number">0</span> <span class="keyword">ELSE</span> <span class="number">1</span> <span class="keyword">END</span>,  <span class="comment">-- 在职优先</span></span><br><span class="line">    salary <span class="keyword">DESC</span>;  <span class="comment">-- 工资降序</span></span><br></pre></td></tr></table></figure>

<h2 id="六、其他实用函数"><a href="#六、其他实用函数" class="headerlink" title="六、其他实用函数"></a>六、其他实用函数</h2><h3 id="6-1-信息函数"><a href="#6-1-信息函数" class="headerlink" title="6.1 信息函数"></a>6.1 信息函数</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- VERSION()：MySQL 版本</span></span><br><span class="line"><span class="keyword">SELECT</span> VERSION();</span><br><span class="line"></span><br><span class="line"><span class="comment">-- DATABASE()：当前数据库名</span></span><br><span class="line"><span class="keyword">SELECT</span> DATABASE();</span><br><span class="line"></span><br><span class="line"><span class="comment">-- USER()：当前用户</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">USER</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">-- CONNECTION_ID()：当前连接 ID</span></span><br><span class="line"><span class="keyword">SELECT</span> CONNECTION_ID();</span><br><span class="line"></span><br><span class="line"><span class="comment">-- CHARSET(s)：返回字符串的字符集</span></span><br><span class="line"><span class="keyword">SELECT</span> CHARSET(<span class="string">&#x27;hello&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- COLLATION(s)：返回字符串的排序规则</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">COLLATION</span>(<span class="string">&#x27;hello&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="6-2-加锁函数"><a href="#6-2-加锁函数" class="headerlink" title="6.2 加锁函数"></a>6.2 加锁函数</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- GET_LOCK(name, timeout)：获取命名锁</span></span><br><span class="line"><span class="keyword">SELECT</span> GET_LOCK(<span class="string">&#x27;my_lock&#x27;</span>, <span class="number">10</span>);  <span class="comment">-- 等待最多 10 秒</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- RELEASE_LOCK(name)：释放命名锁</span></span><br><span class="line"><span class="keyword">SELECT</span> RELEASE_LOCK(<span class="string">&#x27;my_lock&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- IS_USED_LOCK(name)：检查锁是否被使用</span></span><br><span class="line"><span class="keyword">SELECT</span> IS_USED_LOCK(<span class="string">&#x27;my_lock&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- IS_FREE_LOCK(name)：检查锁是否空闲</span></span><br><span class="line"><span class="keyword">SELECT</span> IS_FREE_LOCK(<span class="string">&#x27;my_lock&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="6-3-加密函数"><a href="#6-3-加密函数" class="headerlink" title="6.3 加密函数"></a>6.3 加密函数</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- MD5(s)：MD5 哈希</span></span><br><span class="line"><span class="keyword">SELECT</span> MD5(<span class="string">&#x27;password&#x27;</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- &#x27;5f4dcc3b5aa765d61d8327deb882cf99&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- SHA1(s)：SHA-1 哈希</span></span><br><span class="line"><span class="keyword">SELECT</span> SHA1(<span class="string">&#x27;password&#x27;</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- SHA2(s, n)：SHA-2 哈希（n=224,256,384,512）</span></span><br><span class="line"><span class="keyword">SELECT</span> SHA2(<span class="string">&#x27;password&#x27;</span>, <span class="number">256</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- AES_ENCRYPT(s, key) / AES_DECRYPT(s, key)：AES 加密解密</span></span><br><span class="line"><span class="keyword">SELECT</span> AES_ENCRYPT(<span class="string">&#x27;secret&#x27;</span>, <span class="string">&#x27;key&#x27;</span>) <span class="keyword">AS</span> encrypted;</span><br><span class="line"><span class="keyword">SELECT</span> AES_DECRYPT(AES_ENCRYPT(<span class="string">&#x27;secret&#x27;</span>, <span class="string">&#x27;key&#x27;</span>), <span class="string">&#x27;key&#x27;</span>) <span class="keyword">AS</span> decrypted;</span><br></pre></td></tr></table></figure>

<h3 id="6-4-JSON-函数（MySQL-5-7-）"><a href="#6-4-JSON-函数（MySQL-5-7-）" class="headerlink" title="6.4 JSON 函数（MySQL 5.7+）"></a>6.4 JSON 函数（MySQL 5.7+）</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- JSON_EXTRACT(json_doc, path)：提取 JSON 值</span></span><br><span class="line"><span class="keyword">SELECT</span> JSON_EXTRACT(<span class="string">&#x27;&#123;&quot;name&quot;: &quot;张三&quot;, &quot;age&quot;: 25&#125;&#x27;</span>, <span class="string">&#x27;$.name&#x27;</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- &#x27;&quot;张三&quot;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- -&gt; 操作符（简化提取）</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="string">&#x27;&#123;&quot;name&quot;: &quot;张三&quot;, &quot;age&quot;: 25&#125;&#x27;</span><span class="operator">-</span><span class="operator">&gt;</span><span class="string">&#x27;$.name&#x27;</span> <span class="keyword">AS</span> <span class="keyword">result</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- JSON_INSERT、JSON_REPLACE、JSON_SET：修改 JSON</span></span><br><span class="line"><span class="keyword">SELECT</span> JSON_SET(<span class="string">&#x27;&#123;&quot;name&quot;: &quot;张三&quot;&#125;&#x27;</span>, <span class="string">&#x27;$.age&#x27;</span>, <span class="number">25</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- JSON_ARRAY、JSON_OBJECT：创建 JSON</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">JSON_ARRAY</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- &#x27;[1, 2, 3]&#x27;</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">JSON_OBJECT</span>(<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;张三&#x27;</span>, <span class="string">&#x27;age&#x27;</span>, <span class="number">25</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- &#x27;&#123;&quot;name&quot;: &quot;张三&quot;, &quot;age&quot;: 25&#125;&#x27;</span></span><br></pre></td></tr></table></figure>

<h2 id="七、函数性能优化建议"><a href="#七、函数性能优化建议" class="headerlink" title="七、函数性能优化建议"></a>七、函数性能优化建议</h2><h3 id="7-1-避免在索引列上使用函数"><a href="#7-1-避免在索引列上使用函数" class="headerlink" title="7.1 避免在索引列上使用函数"></a>7.1 避免在索引列上使用函数</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 性能差：无法使用索引</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> <span class="keyword">YEAR</span>(hire_date) <span class="operator">=</span> <span class="number">2024</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 性能好：可以使用索引</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> hire_date <span class="operator">&gt;=</span> <span class="string">&#x27;2024-01-01&#x27;</span></span><br><span class="line"><span class="keyword">AND</span> hire_date <span class="operator">&lt;</span> <span class="string">&#x27;2025-01-01&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 性能差：无法使用索引</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> <span class="built_in">UPPER</span>(name) <span class="operator">=</span> <span class="string">&#x27;JOHN&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 性能好：可以使用索引</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> name <span class="operator">=</span> <span class="string">&#x27;John&#x27;</span>;</span><br><span class="line"><span class="comment">-- 或者使用大小写不敏感的排序规则</span></span><br></pre></td></tr></table></figure>

<h3 id="7-2-避免使用-ORDER-BY-RAND"><a href="#7-2-避免使用-ORDER-BY-RAND" class="headerlink" title="7.2 避免使用 ORDER BY RAND()"></a>7.2 避免使用 ORDER BY RAND()</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 性能差：全表排序</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees <span class="keyword">ORDER</span> <span class="keyword">BY</span> RAND() LIMIT <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 性能好：使用子查询</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> id <span class="operator">&gt;=</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> <span class="built_in">FLOOR</span>(RAND() <span class="operator">*</span> (<span class="keyword">SELECT</span> <span class="built_in">MAX</span>(id) <span class="keyword">FROM</span> employees))</span><br><span class="line">)</span><br><span class="line">LIMIT <span class="number">10</span>;</span><br></pre></td></tr></table></figure>

<h3 id="7-3-避免使用-SELECT"><a href="#7-3-避免使用-SELECT" class="headerlink" title="7.3 避免使用 SELECT *"></a>7.3 避免使用 SELECT *</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 只选择需要的列</span></span><br><span class="line"><span class="keyword">SELECT</span> name, salary, DATE_FORMAT(hire_date, <span class="string">&#x27;%Y-%m&#x27;</span>) <span class="keyword">AS</span> hire_month</span><br><span class="line"><span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>

<h2 id="八、小结"><a href="#八、小结" class="headerlink" title="八、小结"></a>八、小结</h2><h3 id="函数速查表"><a href="#函数速查表" class="headerlink" title="函数速查表"></a>函数速查表</h3><table>
<thead>
<tr>
<th>类型</th>
<th>函数</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><strong>字符串</strong></td>
<td>CONCAT, LENGTH, SUBSTRING, REPLACE, UPPER, LOWER, TRIM</td>
<td>字符串处理</td>
</tr>
<tr>
<td><strong>数值</strong></td>
<td>ABS, ROUND, CEIL, FLOOR, MOD, RAND</td>
<td>数值计算</td>
</tr>
<tr>
<td><strong>日期</strong></td>
<td>NOW, DATE_FORMAT, DATEDIFF, DATE_ADD</td>
<td>日期处理</td>
</tr>
<tr>
<td><strong>流程</strong></td>
<td>IF, IFNULL, NULLIF, CASE</td>
<td>条件判断</td>
</tr>
</tbody></table>
<h3 id="实用技巧"><a href="#实用技巧" class="headerlink" title="实用技巧"></a>实用技巧</h3><ol>
<li><strong>字符串处理</strong>：使用 CONCAT_WS 连接，使用 TRIM 去除空格</li>
<li><strong>数值处理</strong>：使用 ROUND 四舍五入，使用 TRUNCATE 截断</li>
<li><strong>日期处理</strong>：使用 DATE_FORMAT 格式化，使用 DATEDIFF 计算差值</li>
<li><strong>条件判断</strong>：简单条件用 IF，复杂条件用 CASE</li>
<li><strong>NULL 处理</strong>：使用 IFNULL 处理 NULL 值，使用 NULLIF 避免除以零</li>
</ol>
<h3 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h3><ol>
<li>函数可能影响索引使用，注意性能</li>
<li>日期函数中月份从 1 开始，星期函数注意返回值</li>
<li>字符串位置从 1 开始，不是从 0 开始</li>
<li>不同 MySQL 版本函数可能有差异</li>
</ol>
<hr>
<p><strong>下一篇</strong>：[MySQL 进阶教程（二）：数据库约束详解](&#x2F;2026&#x2F;02&#x2F;23&#x2F;MySQL 进阶教程（二）数据库约束详解&#x2F;)</p>
<p><strong>上一篇</strong>：[MySQL 基础教程（五）：DCL 数据控制语言详解](&#x2F;2026&#x2F;02&#x2F;23&#x2F;MySQL 基础教程（五）DCL 数据控制语言详解&#x2F;)</p>
]]></content>
      <categories>
        <category>MySQL 进阶教程</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
        <tag>函数</tag>
        <tag>内置函数</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQL 进阶教程（二）数据库约束详解</title>
    <url>/2026/02/23/MySQL%20%E8%BF%9B%E9%98%B6%E6%95%99%E7%A8%8B%EF%BC%88%E4%BA%8C%EF%BC%89%E6%95%B0%E6%8D%AE%E5%BA%93%E7%BA%A6%E6%9D%9F%E8%AF%A6%E8%A7%A3/</url>
    <content><![CDATA[<h1 id="MySQL-进阶教程（二）数据库约束详解"><a href="#MySQL-进阶教程（二）数据库约束详解" class="headerlink" title="MySQL 进阶教程（二）数据库约束详解"></a>MySQL 进阶教程（二）数据库约束详解</h1><p>数据库约束用于保证数据的完整性、一致性和有效性。本文将详细讲解 MySQL 中的各种约束类型及其使用方法。</p>
<h2 id="一、约束概述"><a href="#一、约束概述" class="headerlink" title="一、约束概述"></a>一、约束概述</h2><h3 id="1-1-什么是约束？"><a href="#1-1-什么是约束？" class="headerlink" title="1.1 什么是约束？"></a>1.1 什么是约束？</h3><p><strong>约束（Constraint）</strong> 是施加在数据库表上的规则，用于限制可以存储在表中的数据，确保数据的准确性和可靠性。</p>
<h3 id="1-2-约束的作用"><a href="#1-2-约束的作用" class="headerlink" title="1.2 约束的作用"></a>1.2 约束的作用</h3><ol>
<li><strong>保证数据完整性</strong>：防止无效或不一致的数据</li>
<li><strong>维护数据一致性</strong>：确保相关表之间的数据关系正确</li>
<li><strong>提高数据质量</strong>：强制执行业务规则</li>
<li><strong>减少应用层验证</strong>：在数据库层面进行数据验证</li>
</ol>
<h3 id="1-3-约束的分类"><a href="#1-3-约束的分类" class="headerlink" title="1.3 约束的分类"></a>1.3 约束的分类</h3><table>
<thead>
<tr>
<th>约束类型</th>
<th>关键字</th>
<th>说明</th>
<th>列级&#x2F;表级</th>
</tr>
</thead>
<tbody><tr>
<td>主键约束</td>
<td>PRIMARY KEY</td>
<td>唯一标识每条记录</td>
<td>两者</td>
</tr>
<tr>
<td>外键约束</td>
<td>FOREIGN KEY</td>
<td>建立表与表之间的关系</td>
<td>表级</td>
</tr>
<tr>
<td>唯一约束</td>
<td>UNIQUE</td>
<td>列值必须唯一</td>
<td>两者</td>
</tr>
<tr>
<td>非空约束</td>
<td>NOT NULL</td>
<td>列值不能为空</td>
<td>列级</td>
</tr>
<tr>
<td>默认约束</td>
<td>DEFAULT</td>
<td>列的默认值</td>
<td>列级</td>
</tr>
<tr>
<td>检查约束</td>
<td>CHECK</td>
<td>满足指定条件</td>
<td>表级</td>
</tr>
</tbody></table>
<h3 id="1-4-约束的定义时机"><a href="#1-4-约束的定义时机" class="headerlink" title="1.4 约束的定义时机"></a>1.4 约束的定义时机</h3><ul>
<li><strong>列级约束</strong>：在定义列时指定，直接跟在列名后面</li>
<li><strong>表级约束</strong>：在所有列定义完成后，在表末尾指定</li>
</ul>
<h2 id="二、约束演示"><a href="#二、约束演示" class="headerlink" title="二、约束演示"></a>二、约束演示</h2><h3 id="2-1-创建表时添加约束"><a href="#2-1-创建表时添加约束" class="headerlink" title="2.1 创建表时添加约束"></a>2.1 创建表时添加约束</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 完整示例：员工表</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> employees (</span><br><span class="line">    <span class="comment">-- 主键约束</span></span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;员工 ID&#x27;</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment">-- 非空约束</span></span><br><span class="line">    emp_no <span class="type">VARCHAR</span>(<span class="number">20</span>) <span class="keyword">NOT NULL</span> COMMENT <span class="string">&#x27;员工编号&#x27;</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment">-- 非空 + 唯一约束</span></span><br><span class="line">    name <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">NOT NULL</span> COMMENT <span class="string">&#x27;姓名&#x27;</span>,</span><br><span class="line">    email <span class="type">VARCHAR</span>(<span class="number">100</span>) <span class="keyword">UNIQUE</span> COMMENT <span class="string">&#x27;邮箱&#x27;</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment">-- 默认约束</span></span><br><span class="line">    gender ENUM(<span class="string">&#x27;男&#x27;</span>, <span class="string">&#x27;女&#x27;</span>) <span class="keyword">DEFAULT</span> <span class="string">&#x27;男&#x27;</span> COMMENT <span class="string">&#x27;性别&#x27;</span>,</span><br><span class="line">    status TINYINT <span class="keyword">DEFAULT</span> <span class="number">1</span> COMMENT <span class="string">&#x27;状态：1 在职 0 离职&#x27;</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment">-- 检查约束（MySQL 8.0.16+ 支持）</span></span><br><span class="line">    age TINYINT <span class="keyword">CHECK</span> (age <span class="operator">&gt;=</span> <span class="number">18</span> <span class="keyword">AND</span> age <span class="operator">&lt;=</span> <span class="number">65</span>) COMMENT <span class="string">&#x27;年龄&#x27;</span>,</span><br><span class="line">    salary <span class="type">DECIMAL</span>(<span class="number">10</span>, <span class="number">2</span>) <span class="keyword">CHECK</span> (salary <span class="operator">&gt;=</span> <span class="number">0</span>) COMMENT <span class="string">&#x27;工资&#x27;</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment">-- 日期约束</span></span><br><span class="line">    hire_date <span class="type">DATE</span> <span class="keyword">NOT NULL</span> COMMENT <span class="string">&#x27;入职日期&#x27;</span></span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4 COMMENT<span class="operator">=</span><span class="string">&#x27;员工表&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h3 id="2-2-表级约束语法"><a href="#2-2-表级约束语法" class="headerlink" title="2.2 表级约束语法"></a>2.2 表级约束语法</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> employees (</span><br><span class="line">    id <span class="type">INT</span> AUTO_INCREMENT,</span><br><span class="line">    emp_no <span class="type">VARCHAR</span>(<span class="number">20</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">    name <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">    email <span class="type">VARCHAR</span>(<span class="number">100</span>),</span><br><span class="line">    dept_id <span class="type">INT</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment">-- 表级约束（使用 CONSTRAINT 命名）</span></span><br><span class="line">    <span class="keyword">CONSTRAINT</span> pk_employees <span class="keyword">PRIMARY KEY</span> (id),</span><br><span class="line">    <span class="keyword">CONSTRAINT</span> uk_employees_emp_no <span class="keyword">UNIQUE</span> (emp_no),</span><br><span class="line">    <span class="keyword">CONSTRAINT</span> uk_employees_email <span class="keyword">UNIQUE</span> (email),</span><br><span class="line">    <span class="keyword">CONSTRAINT</span> chk_employees_age <span class="keyword">CHECK</span> (age <span class="operator">&gt;=</span> <span class="number">18</span> <span class="keyword">AND</span> age <span class="operator">&lt;=</span> <span class="number">65</span>),</span><br><span class="line">    <span class="keyword">CONSTRAINT</span> chk_employees_salary <span class="keyword">CHECK</span> (salary <span class="operator">&gt;=</span> <span class="number">0</span>)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4;</span><br></pre></td></tr></table></figure>

<p><strong>约束命名规范</strong>：</p>
<ul>
<li>主键约束：<code>pk_表名</code> 或 <code>pk_表名_列名</code></li>
<li>外键约束：<code>fk_表名_关联表名</code> 或 <code>fk_表名_列名</code></li>
<li>唯一约束：<code>uk_表名_列名</code></li>
<li>检查约束：<code>chk_表名_列名</code></li>
</ul>
<h3 id="2-3-修改表添加约束"><a href="#2-3-修改表添加约束" class="headerlink" title="2.3 修改表添加约束"></a>2.3 修改表添加约束</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 添加主键约束</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> employees <span class="keyword">ADD</span> <span class="keyword">PRIMARY KEY</span> (id);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 添加唯一约束</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> employees <span class="keyword">ADD</span> <span class="keyword">UNIQUE</span> (emp_no);</span><br><span class="line"><span class="keyword">ALTER TABLE</span> employees <span class="keyword">ADD CONSTRAINT</span> uk_email <span class="keyword">UNIQUE</span> (email);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 添加非空约束</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> employees MODIFY <span class="keyword">COLUMN</span> name <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">NOT NULL</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 添加默认约束</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> employees <span class="keyword">ALTER</span> <span class="keyword">COLUMN</span> status <span class="keyword">SET</span> <span class="keyword">DEFAULT</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">ALTER TABLE</span> employees <span class="keyword">ALTER</span> <span class="keyword">COLUMN</span> status <span class="keyword">DROP</span> <span class="keyword">DEFAULT</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 添加检查约束（MySQL 8.0.16+）</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> employees <span class="keyword">ADD CONSTRAINT</span> chk_age <span class="keyword">CHECK</span> (age <span class="operator">&gt;=</span> <span class="number">18</span> <span class="keyword">AND</span> age <span class="operator">&lt;=</span> <span class="number">65</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 删除约束</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> employees <span class="keyword">DROP</span> <span class="keyword">PRIMARY KEY</span>;</span><br><span class="line"><span class="keyword">ALTER TABLE</span> employees <span class="keyword">DROP</span> INDEX uk_email;</span><br><span class="line"><span class="keyword">ALTER TABLE</span> employees <span class="keyword">DROP</span> <span class="keyword">CHECK</span> chk_age;</span><br></pre></td></tr></table></figure>

<h3 id="2-4-查看约束信息"><a href="#2-4-查看约束信息" class="headerlink" title="2.4 查看约束信息"></a>2.4 查看约束信息</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 查看表结构（显示约束）</span></span><br><span class="line"><span class="keyword">DESC</span> employees;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看详细表结构</span></span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">CREATE TABLE</span> employees;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看表的所有约束</span></span><br><span class="line"><span class="keyword">SELECT</span> CONSTRAINT_NAME, CONSTRAINT_TYPE, TABLE_NAME</span><br><span class="line"><span class="keyword">FROM</span> information_schema.TABLE_CONSTRAINTS</span><br><span class="line"><span class="keyword">WHERE</span> TABLE_SCHEMA <span class="operator">=</span> <span class="string">&#x27;your_database&#x27;</span> <span class="keyword">AND</span> TABLE_NAME <span class="operator">=</span> <span class="string">&#x27;employees&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看外键约束</span></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    CONSTRAINT_NAME,</span><br><span class="line">    TABLE_NAME,</span><br><span class="line">    COLUMN_NAME,</span><br><span class="line">    REFERENCED_TABLE_NAME,</span><br><span class="line">    REFERENCED_COLUMN_NAME</span><br><span class="line"><span class="keyword">FROM</span> information_schema.KEY_COLUMN_USAGE</span><br><span class="line"><span class="keyword">WHERE</span> TABLE_SCHEMA <span class="operator">=</span> <span class="string">&#x27;your_database&#x27;</span> <span class="keyword">AND</span> TABLE_NAME <span class="operator">=</span> <span class="string">&#x27;employees&#x27;</span></span><br><span class="line"><span class="keyword">AND</span> REFERENCED_TABLE_NAME <span class="keyword">IS</span> <span class="keyword">NOT NULL</span>;</span><br></pre></td></tr></table></figure>

<h2 id="三、主键约束（PRIMARY-KEY）"><a href="#三、主键约束（PRIMARY-KEY）" class="headerlink" title="三、主键约束（PRIMARY KEY）"></a>三、主键约束（PRIMARY KEY）</h2><h3 id="3-1-主键的特点"><a href="#3-1-主键的特点" class="headerlink" title="3.1 主键的特点"></a>3.1 主键的特点</h3><ol>
<li><strong>唯一性</strong>：主键值必须唯一</li>
<li><strong>非空性</strong>：主键值不能为 NULL</li>
<li><strong>单一性</strong>：一张表只能有一个主键</li>
<li><strong>可组合</strong>：主键可以由多列组成（复合主键）</li>
</ol>
<h3 id="3-2-创建主键"><a href="#3-2-创建主键" class="headerlink" title="3.2 创建主键"></a>3.2 创建主键</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 单列主键</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> users (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span>,</span><br><span class="line">    name <span class="type">VARCHAR</span>(<span class="number">50</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 使用 CONSTRAINT 命名</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> users (</span><br><span class="line">    id <span class="type">INT</span>,</span><br><span class="line">    name <span class="type">VARCHAR</span>(<span class="number">50</span>),</span><br><span class="line">    <span class="keyword">CONSTRAINT</span> pk_users <span class="keyword">PRIMARY KEY</span> (id)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 复合主键（不推荐，建议使用单列主键）</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> order_items (</span><br><span class="line">    order_id <span class="type">INT</span>,</span><br><span class="line">    product_id <span class="type">INT</span>,</span><br><span class="line">    quantity <span class="type">INT</span>,</span><br><span class="line">    <span class="keyword">PRIMARY KEY</span> (order_id, product_id)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 自增主键（最常用）</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> users (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT,</span><br><span class="line">    name <span class="type">VARCHAR</span>(<span class="number">50</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h3 id="3-3-修改主键"><a href="#3-3-修改主键" class="headerlink" title="3.3 修改主键"></a>3.3 修改主键</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 添加主键</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> users <span class="keyword">ADD</span> <span class="keyword">PRIMARY KEY</span> (id);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 删除主键</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> users <span class="keyword">DROP</span> <span class="keyword">PRIMARY KEY</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 修改主键（先删除再添加）</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> users <span class="keyword">DROP</span> <span class="keyword">PRIMARY KEY</span>;</span><br><span class="line"><span class="keyword">ALTER TABLE</span> users <span class="keyword">ADD</span> <span class="keyword">PRIMARY KEY</span> (new_id);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 修改为复合主键</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> order_items</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">PRIMARY KEY</span>,</span><br><span class="line"><span class="keyword">ADD</span> <span class="keyword">PRIMARY KEY</span> (order_id, product_id);</span><br></pre></td></tr></table></figure>

<h3 id="3-4-主键选择建议"><a href="#3-4-主键选择建议" class="headerlink" title="3.4 主键选择建议"></a>3.4 主键选择建议</h3><ol>
<li><strong>使用无业务意义的列</strong>：如自增 ID、UUID</li>
<li><strong>避免使用业务字段</strong>：如身份证号、手机号可能变化</li>
<li><strong>优先使用单列主键</strong>：简化外键引用</li>
<li><strong>避免使用过长主键</strong>：影响索引性能</li>
</ol>
<h2 id="四、唯一约束（UNIQUE）"><a href="#四、唯一约束（UNIQUE）" class="headerlink" title="四、唯一约束（UNIQUE）"></a>四、唯一约束（UNIQUE）</h2><h3 id="4-1-唯一约束的特点"><a href="#4-1-唯一约束的特点" class="headerlink" title="4.1 唯一约束的特点"></a>4.1 唯一约束的特点</h3><ol>
<li><strong>唯一性</strong>：列值必须唯一</li>
<li><strong>允许 NULL</strong>：可以有多个 NULL 值（但有些数据库只允许一个）</li>
<li><strong>多列唯一</strong>：可以创建复合唯一索引</li>
</ol>
<h3 id="4-2-创建唯一约束"><a href="#4-2-创建唯一约束" class="headerlink" title="4.2 创建唯一约束"></a>4.2 创建唯一约束</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 列级唯一约束</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> users (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span>,</span><br><span class="line">    username <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">UNIQUE</span>,</span><br><span class="line">    email <span class="type">VARCHAR</span>(<span class="number">100</span>) <span class="keyword">UNIQUE</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 表级唯一约束</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> users (</span><br><span class="line">    id <span class="type">INT</span>,</span><br><span class="line">    username <span class="type">VARCHAR</span>(<span class="number">50</span>),</span><br><span class="line">    email <span class="type">VARCHAR</span>(<span class="number">100</span>),</span><br><span class="line">    <span class="keyword">UNIQUE</span> (username),</span><br><span class="line">    <span class="keyword">UNIQUE</span> (email)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 命名唯一约束</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> users (</span><br><span class="line">    id <span class="type">INT</span>,</span><br><span class="line">    username <span class="type">VARCHAR</span>(<span class="number">50</span>),</span><br><span class="line">    email <span class="type">VARCHAR</span>(<span class="number">100</span>),</span><br><span class="line">    <span class="keyword">CONSTRAINT</span> uk_username <span class="keyword">UNIQUE</span> (username),</span><br><span class="line">    <span class="keyword">CONSTRAINT</span> uk_email <span class="keyword">UNIQUE</span> (email)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 复合唯一约束（多列组合唯一）</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> user_roles (</span><br><span class="line">    user_id <span class="type">INT</span>,</span><br><span class="line">    role_id <span class="type">INT</span>,</span><br><span class="line">    <span class="keyword">CONSTRAINT</span> uk_user_role <span class="keyword">UNIQUE</span> (user_id, role_id)</span><br><span class="line">);</span><br><span class="line"><span class="comment">-- 同一个用户不能有相同的角色，但不同用户可以有相同角色</span></span><br></pre></td></tr></table></figure>

<h3 id="4-3-唯一约束与主键的区别"><a href="#4-3-唯一约束与主键的区别" class="headerlink" title="4.3 唯一约束与主键的区别"></a>4.3 唯一约束与主键的区别</h3><table>
<thead>
<tr>
<th>对比项</th>
<th>主键约束</th>
<th>唯一约束</th>
</tr>
</thead>
<tbody><tr>
<td>NULL 值</td>
<td>不允许</td>
<td>允许（可以有多个 NULL）</td>
</tr>
<tr>
<td>数量</td>
<td>一张表只能有一个</td>
<td>一张表可以有多个</td>
</tr>
<tr>
<td>索引类型</td>
<td>创建聚簇索引（InnoDB）</td>
<td>创建唯一索引</td>
</tr>
<tr>
<td>用途</td>
<td>唯一标识记录</td>
<td>保证列值唯一</td>
</tr>
</tbody></table>
<h2 id="五、非空约束（NOT-NULL）"><a href="#五、非空约束（NOT-NULL）" class="headerlink" title="五、非空约束（NOT NULL）"></a>五、非空约束（NOT NULL）</h2><h3 id="5-1-非空约束的特点"><a href="#5-1-非空约束的特点" class="headerlink" title="5.1 非空约束的特点"></a>5.1 非空约束的特点</h3><ul>
<li>列值不能为 NULL</li>
<li>只能在列级定义，不能在表级定义</li>
<li>插入或更新时必须提供值</li>
</ul>
<h3 id="5-2-创建非空约束"><a href="#5-2-创建非空约束" class="headerlink" title="5.2 创建非空约束"></a>5.2 创建非空约束</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 创建时指定非空</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> users (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span>,</span><br><span class="line">    username <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">    email <span class="type">VARCHAR</span>(<span class="number">100</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">    phone <span class="type">VARCHAR</span>(<span class="number">20</span>),  <span class="comment">-- 允许 NULL</span></span><br><span class="line">    age <span class="type">INT</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 修改为非空</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> users MODIFY <span class="keyword">COLUMN</span> age <span class="type">INT</span> <span class="keyword">NOT NULL</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 修改为允许 NULL</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> users MODIFY <span class="keyword">COLUMN</span> age <span class="type">INT</span>;</span><br></pre></td></tr></table></figure>

<h3 id="5-3-非空约束实战"><a href="#5-3-非空约束实战" class="headerlink" title="5.3 非空约束实战"></a>5.3 非空约束实战</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 尝试插入 NULL 值（会报错）</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> users (id, username) <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="keyword">NULL</span>);</span><br><span class="line"><span class="comment">-- ERROR: Column &#x27;username&#x27; cannot be null</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 正确插入</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> users (id, username, email) <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="string">&#x27;john&#x27;</span>, <span class="string">&#x27;john@example.com&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 使用 IFNULL 处理可能为 NULL 的查询</span></span><br><span class="line"><span class="keyword">SELECT</span> username, IFNULL(phone, <span class="string">&#x27;未填写&#x27;</span>) <span class="keyword">AS</span> phone <span class="keyword">FROM</span> users;</span><br></pre></td></tr></table></figure>

<h2 id="六、默认约束（DEFAULT）"><a href="#六、默认约束（DEFAULT）" class="headerlink" title="六、默认约束（DEFAULT）"></a>六、默认约束（DEFAULT）</h2><h3 id="6-1-默认约束的特点"><a href="#6-1-默认约束的特点" class="headerlink" title="6.1 默认约束的特点"></a>6.1 默认约束的特点</h3><ul>
<li>插入数据时如果不指定该列，则使用默认值</li>
<li>默认值可以是常量、表达式或函数</li>
</ul>
<h3 id="6-2-创建默认约束"><a href="#6-2-创建默认约束" class="headerlink" title="6.2 创建默认约束"></a>6.2 创建默认约束</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> users (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span>,</span><br><span class="line">    username <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment">-- 常量默认值</span></span><br><span class="line">    status TINYINT <span class="keyword">DEFAULT</span> <span class="number">1</span>,</span><br><span class="line">    gender ENUM(<span class="string">&#x27;男&#x27;</span>, <span class="string">&#x27;女&#x27;</span>) <span class="keyword">DEFAULT</span> <span class="string">&#x27;男&#x27;</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment">-- 函数默认值</span></span><br><span class="line">    create_time DATETIME <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span>,</span><br><span class="line">    update_time DATETIME <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> <span class="keyword">ON</span> <span class="keyword">UPDATE</span> <span class="built_in">CURRENT_TIMESTAMP</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment">-- NULL 默认值（显式指定）</span></span><br><span class="line">    remark <span class="type">VARCHAR</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h3 id="6-3-默认约束实战"><a href="#6-3-默认约束实战" class="headerlink" title="6.3 默认约束实战"></a>6.3 默认约束实战</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 使用默认值插入</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> users (id, username) <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="string">&#x27;john&#x27;</span>);</span><br><span class="line"><span class="comment">-- status=1, gender=&#x27;男&#x27;, create_time=当前时间</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 显式指定值</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> users (id, username, status, gender)</span><br><span class="line"><span class="keyword">VALUES</span> (<span class="number">2</span>, <span class="string">&#x27;jane&#x27;</span>, <span class="number">0</span>, <span class="string">&#x27;女&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 使用 DEFAULT 关键字显式使用默认值</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> users (id, username, status)</span><br><span class="line"><span class="keyword">VALUES</span> (<span class="number">3</span>, <span class="string">&#x27;bob&#x27;</span>, <span class="keyword">DEFAULT</span>);</span><br></pre></td></tr></table></figure>

<h3 id="6-4-修改默认约束"><a href="#6-4-修改默认约束" class="headerlink" title="6.4 修改默认约束"></a>6.4 修改默认约束</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 添加默认约束</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> users <span class="keyword">ALTER</span> <span class="keyword">COLUMN</span> status <span class="keyword">SET</span> <span class="keyword">DEFAULT</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 删除默认约束</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> users <span class="keyword">ALTER</span> <span class="keyword">COLUMN</span> status <span class="keyword">DROP</span> <span class="keyword">DEFAULT</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 修改默认值（先删除再添加）</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> users <span class="keyword">ALTER</span> <span class="keyword">COLUMN</span> status <span class="keyword">DROP</span> <span class="keyword">DEFAULT</span>;</span><br><span class="line"><span class="keyword">ALTER TABLE</span> users <span class="keyword">ALTER</span> <span class="keyword">COLUMN</span> status <span class="keyword">SET</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>;</span><br></pre></td></tr></table></figure>

<h2 id="七、检查约束（CHECK）"><a href="#七、检查约束（CHECK）" class="headerlink" title="七、检查约束（CHECK）"></a>七、检查约束（CHECK）</h2><h3 id="7-1-检查约束的特点"><a href="#7-1-检查约束的特点" class="headerlink" title="7.1 检查约束的特点"></a>7.1 检查约束的特点</h3><ul>
<li><strong>MySQL 8.0.16+</strong> 才开始支持 CHECK 约束</li>
<li>旧版本会忽略 CHECK 约束（不报错但不生效）</li>
<li>用于确保列值满足特定条件</li>
</ul>
<h3 id="7-2-创建检查约束"><a href="#7-2-创建检查约束" class="headerlink" title="7.2 创建检查约束"></a>7.2 创建检查约束</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 创建时添加检查约束</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> employees (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span>,</span><br><span class="line">    name <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">    age <span class="type">INT</span> <span class="keyword">CHECK</span> (age <span class="operator">&gt;=</span> <span class="number">18</span> <span class="keyword">AND</span> age <span class="operator">&lt;=</span> <span class="number">65</span>),</span><br><span class="line">    salary <span class="type">DECIMAL</span>(<span class="number">10</span>, <span class="number">2</span>) <span class="keyword">CHECK</span> (salary <span class="operator">&gt;=</span> <span class="number">0</span>),</span><br><span class="line">    gender ENUM(<span class="string">&#x27;男&#x27;</span>, <span class="string">&#x27;女&#x27;</span>),</span><br><span class="line">    hire_date <span class="type">DATE</span>,</span><br><span class="line">    <span class="keyword">CONSTRAINT</span> chk_hire_date <span class="keyword">CHECK</span> (hire_date <span class="operator">&lt;=</span> CURDATE())</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 使用多条件检查约束</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> orders (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span>,</span><br><span class="line">    amount <span class="type">DECIMAL</span>(<span class="number">10</span>, <span class="number">2</span>) <span class="keyword">CHECK</span> (amount <span class="operator">&gt;</span> <span class="number">0</span>),</span><br><span class="line">    status <span class="type">VARCHAR</span>(<span class="number">20</span>) <span class="keyword">CHECK</span> (status <span class="keyword">IN</span> (<span class="string">&#x27;PENDING&#x27;</span>, <span class="string">&#x27;PAID&#x27;</span>, <span class="string">&#x27;SHIPPED&#x27;</span>, <span class="string">&#x27;CANCELLED&#x27;</span>)),</span><br><span class="line">    discount <span class="type">DECIMAL</span>(<span class="number">5</span>, <span class="number">2</span>) <span class="keyword">CHECK</span> (discount <span class="operator">&gt;=</span> <span class="number">0</span> <span class="keyword">AND</span> discount <span class="operator">&lt;=</span> <span class="number">100</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h3 id="7-3-修改检查约束"><a href="#7-3-修改检查约束" class="headerlink" title="7.3 修改检查约束"></a>7.3 修改检查约束</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 添加检查约束</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> employees</span><br><span class="line"><span class="keyword">ADD CONSTRAINT</span> chk_age <span class="keyword">CHECK</span> (age <span class="operator">&gt;=</span> <span class="number">18</span> <span class="keyword">AND</span> age <span class="operator">&lt;=</span> <span class="number">65</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 删除检查约束</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> employees</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">CHECK</span> chk_age;</span><br></pre></td></tr></table></figure>

<h3 id="7-4-检查约束实战"><a href="#7-4-检查约束实战" class="headerlink" title="7.4 检查约束实战"></a>7.4 检查约束实战</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 尝试插入违反约束的数据（会报错）</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> employees (id, name, age, salary) <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="string">&#x27;张三&#x27;</span>, <span class="number">17</span>, <span class="number">8000</span>);</span><br><span class="line"><span class="comment">-- ERROR: CHECK constraint &#x27;chk_age&#x27; is violated</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT INTO</span> employees (id, name, age, salary) <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="string">&#x27;张三&#x27;</span>, <span class="number">30</span>, <span class="number">-5000</span>);</span><br><span class="line"><span class="comment">-- ERROR: CHECK constraint &#x27;chk_salary&#x27; is violated</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 正确插入</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> employees (id, name, age, salary) <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="string">&#x27;张三&#x27;</span>, <span class="number">30</span>, <span class="number">8000</span>);</span><br></pre></td></tr></table></figure>

<h2 id="八、外键约束（FOREIGN-KEY）"><a href="#八、外键约束（FOREIGN-KEY）" class="headerlink" title="八、外键约束（FOREIGN KEY）"></a>八、外键约束（FOREIGN KEY）</h2><h3 id="8-1-外键概述"><a href="#8-1-外键概述" class="headerlink" title="8.1 外键概述"></a>8.1 外键概述</h3><p><strong>外键（Foreign Key）</strong> 用于建立两个表之间的链接，保证数据的参照完整性。</p>
<p><strong>外键的特点</strong>：</p>
<ol>
<li>外键列的值必须存在于被引用表的主键列中，或者为 NULL</li>
<li>外键约束可以防止无效的数据插入</li>
<li>外键约束可以级联更新和删除</li>
</ol>
<h3 id="8-2-创建外键约束"><a href="#8-2-创建外键约束" class="headerlink" title="8.2 创建外键约束"></a>8.2 创建外键约束</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 创建部门表</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> departments (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT,</span><br><span class="line">    dept_name <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">NOT NULL</span> <span class="keyword">UNIQUE</span>,</span><br><span class="line">    dept_location <span class="type">VARCHAR</span>(<span class="number">100</span>)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建员工表（带外键）</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> employees (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT,</span><br><span class="line">    emp_no <span class="type">VARCHAR</span>(<span class="number">20</span>) <span class="keyword">NOT NULL</span> <span class="keyword">UNIQUE</span>,</span><br><span class="line">    name <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">    dept_id <span class="type">INT</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment">-- 外键约束</span></span><br><span class="line">    <span class="keyword">CONSTRAINT</span> fk_emp_dept</span><br><span class="line">        <span class="keyword">FOREIGN KEY</span> (dept_id)</span><br><span class="line">        <span class="keyword">REFERENCES</span> departments(id)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 简写形式（不命名）</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> employees (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span>,</span><br><span class="line">    name <span class="type">VARCHAR</span>(<span class="number">50</span>),</span><br><span class="line">    dept_id <span class="type">INT</span>,</span><br><span class="line">    <span class="keyword">FOREIGN KEY</span> (dept_id) <span class="keyword">REFERENCES</span> departments(id)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB;</span><br></pre></td></tr></table></figure>

<p><strong>重要提示</strong>：</p>
<ul>
<li>外键约束只在 InnoDB 引擎中生效</li>
<li>外键列和被引用列的数据类型必须相同</li>
<li>被引用列必须是主键或唯一索引</li>
</ul>
<h3 id="8-3-外键约束的参照完整性"><a href="#8-3-外键约束的参照完整性" class="headerlink" title="8.3 外键约束的参照完整性"></a>8.3 外键约束的参照完整性</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 插入部门</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> departments (dept_name, dept_location) <span class="keyword">VALUES</span></span><br><span class="line">(<span class="string">&#x27;技术部&#x27;</span>, <span class="string">&#x27;北京&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;市场部&#x27;</span>, <span class="string">&#x27;上海&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 插入员工（有效的外键值）</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> employees (emp_no, name, dept_id) <span class="keyword">VALUES</span></span><br><span class="line">(<span class="string">&#x27;E001&#x27;</span>, <span class="string">&#x27;张三&#x27;</span>, <span class="number">1</span>),  <span class="comment">-- 有效</span></span><br><span class="line">(<span class="string">&#x27;E002&#x27;</span>, <span class="string">&#x27;李四&#x27;</span>, <span class="number">2</span>);  <span class="comment">-- 有效</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 插入员工（无效的外键值，会报错）</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> employees (emp_no, name, dept_id) <span class="keyword">VALUES</span></span><br><span class="line">(<span class="string">&#x27;E003&#x27;</span>, <span class="string">&#x27;王五&#x27;</span>, <span class="number">99</span>);  <span class="comment">-- ERROR: 部门 99 不存在</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 插入员工（NULL 值，允许）</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> employees (emp_no, name, dept_id) <span class="keyword">VALUES</span></span><br><span class="line">(<span class="string">&#x27;E003&#x27;</span>, <span class="string">&#x27;王五&#x27;</span>, <span class="keyword">NULL</span>);  <span class="comment">-- 允许，表示该员工暂无部门</span></span><br></pre></td></tr></table></figure>

<h3 id="8-4-添加和删除外键"><a href="#8-4-添加和删除外键" class="headerlink" title="8.4 添加和删除外键"></a>8.4 添加和删除外键</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 添加外键约束</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> employees</span><br><span class="line"><span class="keyword">ADD CONSTRAINT</span> fk_emp_dept</span><br><span class="line"><span class="keyword">FOREIGN KEY</span> (dept_id) <span class="keyword">REFERENCES</span> departments(id);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 删除外键约束</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> employees</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">FOREIGN KEY</span> fk_emp_dept;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 删除外键后，还需要删除对应的外键索引</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> employees <span class="keyword">DROP</span> INDEX dept_id;</span><br></pre></td></tr></table></figure>

<h3 id="8-5-查看外键信息"><a href="#8-5-查看外键信息" class="headerlink" title="8.5 查看外键信息"></a>8.5 查看外键信息</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 查看表的外键</span></span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">CREATE TABLE</span> employees;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 从 information_schema 查询外键</span></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    TABLE_NAME,</span><br><span class="line">    COLUMN_NAME,</span><br><span class="line">    CONSTRAINT_NAME,</span><br><span class="line">    REFERENCED_TABLE_NAME,</span><br><span class="line">    REFERENCED_COLUMN_NAME</span><br><span class="line"><span class="keyword">FROM</span> information_schema.KEY_COLUMN_USAGE</span><br><span class="line"><span class="keyword">WHERE</span> TABLE_SCHEMA <span class="operator">=</span> <span class="string">&#x27;your_database&#x27;</span></span><br><span class="line"><span class="keyword">AND</span> TABLE_NAME <span class="operator">=</span> <span class="string">&#x27;employees&#x27;</span></span><br><span class="line"><span class="keyword">AND</span> REFERENCED_TABLE_NAME <span class="keyword">IS</span> <span class="keyword">NOT NULL</span>;</span><br></pre></td></tr></table></figure>

<h2 id="九、外键的删除和更新行为"><a href="#九、外键的删除和更新行为" class="headerlink" title="九、外键的删除和更新行为"></a>九、外键的删除和更新行为</h2><h3 id="9-1-外键行为选项"><a href="#9-1-外键行为选项" class="headerlink" title="9.1 外键行为选项"></a>9.1 外键行为选项</h3><p>当父表（被引用表）的记录被更新或删除时，子表（引用表）如何处理？</p>
<table>
<thead>
<tr>
<th>行为</th>
<th>说明</th>
<th>适用场景</th>
</tr>
</thead>
<tbody><tr>
<td>RESTRICT</td>
<td>拒绝删除&#x2F;更新父表记录（默认）</td>
<td>严格参照完整性</td>
</tr>
<tr>
<td>NO ACTION</td>
<td>同 RESTRICT（在 MySQL 中）</td>
<td>严格参照完整性</td>
</tr>
<tr>
<td>CASCADE</td>
<td>级联删除&#x2F;更新</td>
<td>强关联数据</td>
</tr>
<tr>
<td>SET NULL</td>
<td>将外键设为 NULL</td>
<td>可选关联</td>
</tr>
<tr>
<td>SET DEFAULT</td>
<td>设为默认值（MySQL 不支持）</td>
<td>-</td>
</tr>
</tbody></table>
<h3 id="9-2-CASCADE（级联）"><a href="#9-2-CASCADE（级联）" class="headerlink" title="9.2 CASCADE（级联）"></a>9.2 CASCADE（级联）</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 创建带级联删除/更新的外键</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> employees (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span>,</span><br><span class="line">    name <span class="type">VARCHAR</span>(<span class="number">50</span>),</span><br><span class="line">    dept_id <span class="type">INT</span>,</span><br><span class="line">    <span class="keyword">CONSTRAINT</span> fk_emp_dept</span><br><span class="line">        <span class="keyword">FOREIGN KEY</span> (dept_id)</span><br><span class="line">        <span class="keyword">REFERENCES</span> departments(id)</span><br><span class="line">        <span class="keyword">ON</span> <span class="keyword">DELETE</span> CASCADE    <span class="comment">-- 删除部门时，级联删除员工</span></span><br><span class="line">        <span class="keyword">ON</span> <span class="keyword">UPDATE</span> CASCADE    <span class="comment">-- 更新部门 ID 时，级联更新员工</span></span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 演示级联删除</span></span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> departments <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="comment">-- 所有 dept_id=1  的员工也会被删除</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 演示级联更新</span></span><br><span class="line"><span class="keyword">UPDATE</span> departments <span class="keyword">SET</span> id <span class="operator">=</span> <span class="number">10</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="comment">-- 所有 dept_id=1 的员工，dept_id 会更新为 10</span></span><br></pre></td></tr></table></figure>

<h3 id="9-3-SET-NULL（设为空）"><a href="#9-3-SET-NULL（设为空）" class="headerlink" title="9.3 SET NULL（设为空）"></a>9.3 SET NULL（设为空）</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 创建带 SET NULL 的外键</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> employees (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span>,</span><br><span class="line">    name <span class="type">VARCHAR</span>(<span class="number">50</span>),</span><br><span class="line">    dept_id <span class="type">INT</span> <span class="keyword">NULL</span>,  <span class="comment">-- 必须允许 NULL</span></span><br><span class="line">    <span class="keyword">CONSTRAINT</span> fk_emp_dept</span><br><span class="line">        <span class="keyword">FOREIGN KEY</span> (dept_id)</span><br><span class="line">        <span class="keyword">REFERENCES</span> departments(id)</span><br><span class="line">        <span class="keyword">ON</span> <span class="keyword">DELETE</span> <span class="keyword">SET</span> <span class="keyword">NULL</span>  <span class="comment">-- 删除部门时，员工的 dept_id 设为 NULL</span></span><br><span class="line">        <span class="keyword">ON</span> <span class="keyword">UPDATE</span> <span class="keyword">SET</span> <span class="keyword">NULL</span></span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 演示 SET NULL 删除</span></span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> departments <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="comment">-- 所有 dept_id=1 的员工，dept_id 会被设为 NULL</span></span><br></pre></td></tr></table></figure>

<h3 id="9-4-RESTRICT-NO-ACTION（限制）"><a href="#9-4-RESTRICT-NO-ACTION（限制）" class="headerlink" title="9.4 RESTRICT &#x2F; NO ACTION（限制）"></a>9.4 RESTRICT &#x2F; NO ACTION（限制）</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 创建带 RESTRICT 的外键（默认行为）</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> employees (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span>,</span><br><span class="line">    name <span class="type">VARCHAR</span>(<span class="number">50</span>),</span><br><span class="line">    dept_id <span class="type">INT</span>,</span><br><span class="line">    <span class="keyword">CONSTRAINT</span> fk_emp_dept</span><br><span class="line">        <span class="keyword">FOREIGN KEY</span> (dept_id)</span><br><span class="line">        <span class="keyword">REFERENCES</span> departments(id)</span><br><span class="line">        <span class="keyword">ON</span> <span class="keyword">DELETE</span> RESTRICT  <span class="comment">-- 或直接省略，默认就是 RESTRICT</span></span><br><span class="line">        <span class="keyword">ON</span> <span class="keyword">UPDATE</span> RESTRICT</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 尝试删除有员工关联的部门（会报错）</span></span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> departments <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="comment">-- ERROR: Cannot delete or update a parent row:</span></span><br><span class="line"><span class="comment">-- a foreign key constraint fails</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 必须先删除或更新子表记录</span></span><br><span class="line"><span class="keyword">UPDATE</span> employees <span class="keyword">SET</span> dept_id <span class="operator">=</span> <span class="keyword">NULL</span> <span class="keyword">WHERE</span> dept_id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="comment">-- 或者</span></span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> dept_id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 然后才能删除部门</span></span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> departments <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<h3 id="9-5-外键行为选择建议"><a href="#9-5-外键行为选择建议" class="headerlink" title="9.5 外键行为选择建议"></a>9.5 外键行为选择建议</h3><table>
<thead>
<tr>
<th>关系类型</th>
<th>推荐行为</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td>强依赖关系</td>
<td>CASCADE</td>
<td>订单和订单明细</td>
</tr>
<tr>
<td>可选关联</td>
<td>SET NULL</td>
<td>员工和部门（允许暂无部门）</td>
</tr>
<tr>
<td>严格参照</td>
<td>RESTRICT</td>
<td>用户和账户（不允许删除有账户的用户）</td>
</tr>
<tr>
<td>历史数据</td>
<td>RESTRICT + 逻辑删除</td>
<td>不允许物理删除，只标记状态</td>
</tr>
</tbody></table>
<h3 id="9-6-外键实战案例"><a href="#9-6-外键实战案例" class="headerlink" title="9.6 外键实战案例"></a>9.6 外键实战案例</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 案例 1：订单系统（级联删除）</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> orders (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span>,</span><br><span class="line">    user_id <span class="type">INT</span> <span class="keyword">NOT NULL</span>,</span><br><span class="line">    order_no <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">UNIQUE</span>,</span><br><span class="line">    <span class="keyword">CONSTRAINT</span> fk_orders_user</span><br><span class="line">        <span class="keyword">FOREIGN KEY</span> (user_id)</span><br><span class="line">        <span class="keyword">REFERENCES</span> users(id)</span><br><span class="line">        <span class="keyword">ON</span> <span class="keyword">DELETE</span> CASCADE</span><br><span class="line">        <span class="keyword">ON</span> <span class="keyword">UPDATE</span> CASCADE</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE TABLE</span> order_items (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span>,</span><br><span class="line">    order_id <span class="type">INT</span> <span class="keyword">NOT NULL</span>,</span><br><span class="line">    product_id <span class="type">INT</span> <span class="keyword">NOT NULL</span>,</span><br><span class="line">    quantity <span class="type">INT</span>,</span><br><span class="line">    <span class="keyword">CONSTRAINT</span> fk_items_order</span><br><span class="line">        <span class="keyword">FOREIGN KEY</span> (order_id)</span><br><span class="line">        <span class="keyword">REFERENCES</span> orders(id)</span><br><span class="line">        <span class="keyword">ON</span> <span class="keyword">DELETE</span> CASCADE</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 删除用户时，自动删除其所有订单和订单明细</span></span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 案例 2：文章评论系统（SET NULL）</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> articles (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span>,</span><br><span class="line">    title <span class="type">VARCHAR</span>(<span class="number">200</span>),</span><br><span class="line">    author_id <span class="type">INT</span>,</span><br><span class="line">    <span class="keyword">CONSTRAINT</span> fk_articles_author</span><br><span class="line">        <span class="keyword">FOREIGN KEY</span> (author_id)</span><br><span class="line">        <span class="keyword">REFERENCES</span> users(id)</span><br><span class="line">        <span class="keyword">ON</span> <span class="keyword">DELETE</span> <span class="keyword">SET</span> <span class="keyword">NULL</span>  <span class="comment">-- 作者删除后，文章保留但作者为空</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 案例 3：学生选课系统（限制删除）</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> enrollments (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span>,</span><br><span class="line">    student_id <span class="type">INT</span> <span class="keyword">NOT NULL</span>,</span><br><span class="line">    course_id <span class="type">INT</span> <span class="keyword">NOT NULL</span>,</span><br><span class="line">    <span class="keyword">CONSTRAINT</span> fk_enroll_student</span><br><span class="line">        <span class="keyword">FOREIGN KEY</span> (student_id)</span><br><span class="line">        <span class="keyword">REFERENCES</span> students(id)</span><br><span class="line">        <span class="keyword">ON</span> <span class="keyword">DELETE</span> RESTRICT,  <span class="comment">-- 有选课记录时不能删除学生</span></span><br><span class="line">    <span class="keyword">CONSTRAINT</span> fk_enroll_course</span><br><span class="line">        <span class="keyword">FOREIGN KEY</span> (course_id)</span><br><span class="line">        <span class="keyword">REFERENCES</span> courses(id)</span><br><span class="line">        <span class="keyword">ON</span> <span class="keyword">DELETE</span> RESTRICT   <span class="comment">-- 有选课记录时不能删除课程</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h2 id="十、约束综合实战"><a href="#十、约束综合实战" class="headerlink" title="十、约束综合实战"></a>十、约束综合实战</h2><h3 id="10-1-电商数据库设计"><a href="#10-1-电商数据库设计" class="headerlink" title="10.1 电商数据库设计"></a>10.1 电商数据库设计</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 用户表</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> users (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT,</span><br><span class="line">    username <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">NOT NULL</span> <span class="keyword">UNIQUE</span>,</span><br><span class="line">    password <span class="type">VARCHAR</span>(<span class="number">255</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">    email <span class="type">VARCHAR</span>(<span class="number">100</span>) <span class="keyword">NOT NULL</span> <span class="keyword">UNIQUE</span>,</span><br><span class="line">    phone <span class="type">VARCHAR</span>(<span class="number">20</span>) <span class="keyword">UNIQUE</span>,</span><br><span class="line">    status TINYINT <span class="keyword">DEFAULT</span> <span class="number">1</span>,</span><br><span class="line">    create_time DATETIME <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span>,</span><br><span class="line">    <span class="keyword">CONSTRAINT</span> chk_status <span class="keyword">CHECK</span> (status <span class="keyword">IN</span> (<span class="number">0</span>, <span class="number">1</span>))</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 商品分类表</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> categories (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT,</span><br><span class="line">    name <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">NOT NULL</span> <span class="keyword">UNIQUE</span>,</span><br><span class="line">    parent_id <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>,</span><br><span class="line">    sort_order <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>,</span><br><span class="line">    <span class="keyword">CONSTRAINT</span> chk_sort <span class="keyword">CHECK</span> (sort_order <span class="operator">&gt;=</span> <span class="number">0</span>)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 商品表</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> products (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT,</span><br><span class="line">    name <span class="type">VARCHAR</span>(<span class="number">200</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">    category_id <span class="type">INT</span>,</span><br><span class="line">    price <span class="type">DECIMAL</span>(<span class="number">10</span>, <span class="number">2</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">    stock <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>,</span><br><span class="line">    status TINYINT <span class="keyword">DEFAULT</span> <span class="number">1</span>,</span><br><span class="line">    <span class="keyword">CONSTRAINT</span> chk_price <span class="keyword">CHECK</span> (price <span class="operator">&gt;=</span> <span class="number">0</span>),</span><br><span class="line">    <span class="keyword">CONSTRAINT</span> chk_stock <span class="keyword">CHECK</span> (stock <span class="operator">&gt;=</span> <span class="number">0</span>),</span><br><span class="line">    <span class="keyword">CONSTRAINT</span> chk_status <span class="keyword">CHECK</span> (status <span class="keyword">IN</span> (<span class="number">0</span>, <span class="number">1</span>)),</span><br><span class="line">    <span class="keyword">CONSTRAINT</span> fk_prod_category</span><br><span class="line">        <span class="keyword">FOREIGN KEY</span> (category_id)</span><br><span class="line">        <span class="keyword">REFERENCES</span> categories(id)</span><br><span class="line">        <span class="keyword">ON</span> <span class="keyword">DELETE</span> <span class="keyword">SET</span> <span class="keyword">NULL</span></span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 订单表</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> orders (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT,</span><br><span class="line">    order_no <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">NOT NULL</span> <span class="keyword">UNIQUE</span>,</span><br><span class="line">    user_id <span class="type">INT</span> <span class="keyword">NOT NULL</span>,</span><br><span class="line">    total_amount <span class="type">DECIMAL</span>(<span class="number">10</span>, <span class="number">2</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">    status TINYINT <span class="keyword">DEFAULT</span> <span class="number">0</span>,</span><br><span class="line">    create_time DATETIME <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span>,</span><br><span class="line">    <span class="keyword">CONSTRAINT</span> chk_amount <span class="keyword">CHECK</span> (total_amount <span class="operator">&gt;=</span> <span class="number">0</span>),</span><br><span class="line">    <span class="keyword">CONSTRAINT</span> chk_order_status <span class="keyword">CHECK</span> (status <span class="keyword">IN</span> (<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>)),</span><br><span class="line">    <span class="keyword">CONSTRAINT</span> fk_orders_user</span><br><span class="line">        <span class="keyword">FOREIGN KEY</span> (user_id)</span><br><span class="line">        <span class="keyword">REFERENCES</span> users(id)</span><br><span class="line">        <span class="keyword">ON</span> <span class="keyword">DELETE</span> CASCADE</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 订单明细表</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> order_items (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT,</span><br><span class="line">    order_id <span class="type">INT</span> <span class="keyword">NOT NULL</span>,</span><br><span class="line">    product_id <span class="type">INT</span> <span class="keyword">NOT NULL</span>,</span><br><span class="line">    price <span class="type">DECIMAL</span>(<span class="number">10</span>, <span class="number">2</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">    quantity <span class="type">INT</span> <span class="keyword">NOT NULL</span>,</span><br><span class="line">    <span class="keyword">CONSTRAINT</span> chk_quantity <span class="keyword">CHECK</span> (quantity <span class="operator">&gt;</span> <span class="number">0</span>),</span><br><span class="line">    <span class="keyword">CONSTRAINT</span> chk_item_price <span class="keyword">CHECK</span> (price <span class="operator">&gt;=</span> <span class="number">0</span>),</span><br><span class="line">    <span class="keyword">CONSTRAINT</span> fk_items_order</span><br><span class="line">        <span class="keyword">FOREIGN KEY</span> (order_id)</span><br><span class="line">        <span class="keyword">REFERENCES</span> orders(id)</span><br><span class="line">        <span class="keyword">ON</span> <span class="keyword">DELETE</span> CASCADE,</span><br><span class="line">    <span class="keyword">CONSTRAINT</span> fk_items_product</span><br><span class="line">        <span class="keyword">FOREIGN KEY</span> (product_id)</span><br><span class="line">        <span class="keyword">REFERENCES</span> products(id)</span><br><span class="line">        <span class="keyword">ON</span> <span class="keyword">DELETE</span> RESTRICT</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4;</span><br></pre></td></tr></table></figure>

<h3 id="10-2-约束测试"><a href="#10-2-约束测试" class="headerlink" title="10.2 约束测试"></a>10.2 约束测试</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 测试 1：插入有效数据</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> users (username, password, email)</span><br><span class="line"><span class="keyword">VALUES</span> (<span class="string">&#x27;test&#x27;</span>, <span class="string">&#x27;pwd123&#x27;</span>, <span class="string">&#x27;test@example.com&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 测试 2：违反唯一约束</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> users (username, password, email)</span><br><span class="line"><span class="keyword">VALUES</span> (<span class="string">&#x27;test&#x27;</span>, <span class="string">&#x27;pwd456&#x27;</span>, <span class="string">&#x27;test2@example.com&#x27;</span>);  <span class="comment">-- ERROR: 用户名重复</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 测试 3：违反非空约束</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> users (username, email) <span class="keyword">VALUES</span> (<span class="keyword">NULL</span>, <span class="string">&#x27;test@example.com&#x27;</span>);  <span class="comment">-- ERROR</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 测试 4：违反检查约束</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> products (name, price, stock) <span class="keyword">VALUES</span> (<span class="string">&#x27;商品&#x27;</span>, <span class="number">-100</span>, <span class="number">10</span>);  <span class="comment">-- ERROR</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 测试 5：违反外键约束</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> orders (order_no, user_id, total_amount)</span><br><span class="line"><span class="keyword">VALUES</span> (<span class="string">&#x27;ORD001&#x27;</span>, <span class="number">999</span>, <span class="number">100</span>);  <span class="comment">-- ERROR: 用户不存在</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 测试 6：级联删除</span></span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="comment">-- 该用户的所有订单也会被删除</span></span><br></pre></td></tr></table></figure>

<h2 id="十一、小结"><a href="#十一、小结" class="headerlink" title="十一、小结"></a>十一、小结</h2><h3 id="约束类型总结"><a href="#约束类型总结" class="headerlink" title="约束类型总结"></a>约束类型总结</h3><table>
<thead>
<tr>
<th>约束</th>
<th>关键字</th>
<th>作用</th>
<th>可否命名</th>
</tr>
</thead>
<tbody><tr>
<td>主键</td>
<td>PRIMARY KEY</td>
<td>唯一标识记录</td>
<td>是</td>
</tr>
<tr>
<td>外键</td>
<td>FOREIGN KEY</td>
<td>建立表间关系</td>
<td>是</td>
</tr>
<tr>
<td>唯一</td>
<td>UNIQUE</td>
<td>保证列值唯一</td>
<td>是</td>
</tr>
<tr>
<td>非空</td>
<td>NOT NULL</td>
<td>禁止 NULL 值</td>
<td>否</td>
</tr>
<tr>
<td>默认</td>
<td>DEFAULT</td>
<td>设置默认值</td>
<td>否</td>
</tr>
<tr>
<td>检查</td>
<td>CHECK</td>
<td>验证数据有效性</td>
<td>是</td>
</tr>
</tbody></table>
<h3 id="最佳实践"><a href="#最佳实践" class="headerlink" title="最佳实践"></a>最佳实践</h3><ol>
<li><strong>主键选择</strong>：使用无业务意义的自增 ID</li>
<li><strong>外键使用</strong>：明确指定 ON DELETE&#x2F;UPDATE 行为</li>
<li><strong>约束命名</strong>：使用有意义的约束名便于维护</li>
<li><strong>检查约束</strong>：在数据库层面验证业务规则</li>
<li><strong>适度使用</strong>：不要过度约束影响性能</li>
</ol>
<h3 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h3><ol>
<li>外键只在 InnoDB 引擎中生效</li>
<li>MySQL 8.0.16 之前不支持 CHECK 约束</li>
<li>外键会影响插入、删除、更新性能</li>
<li>级联删除要小心使用，避免误删数据</li>
</ol>
<hr>
<p><strong>下一篇</strong>：[MySQL 进阶教程（三）：多表查询详解](&#x2F;2026&#x2F;02&#x2F;23&#x2F;MySQL 进阶教程（三）多表查询详解&#x2F;)</p>
<p><strong>上一篇</strong>：[MySQL 进阶教程（一）：常用函数详解](&#x2F;2026&#x2F;02&#x2F;23&#x2F;MySQL 进阶教程（一）常用函数详解&#x2F;)</p>
]]></content>
      <categories>
        <category>MySQL 进阶教程</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
        <tag>约束</tag>
        <tag>外键</tag>
      </tags>
  </entry>
  <entry>
    <title>我的第一篇博客</title>
    <url>/2026/02/20/%E6%88%91%E7%9A%84%E7%AC%AC%E4%B8%80%E7%AF%87%E5%8D%9A%E5%AE%A2/</url>
    <content><![CDATA[<p>这是我的第一篇博客文章，记录博客搭建的起点。</p>
]]></content>
      <categories>
        <category>生活随笔</category>
      </categories>
      <tags>
        <tag>博客搭建</tag>
        <tag>Hexo</tag>
        <tag>开始</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQL 进阶教程（三）多表查询详解</title>
    <url>/2026/02/23/MySQL%20%E8%BF%9B%E9%98%B6%E6%95%99%E7%A8%8B%EF%BC%88%E4%B8%89%EF%BC%89%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A2%E8%AF%A6%E8%A7%A3/</url>
    <content><![CDATA[<h1 id="MySQL-进阶教程（三）多表查询详解"><a href="#MySQL-进阶教程（三）多表查询详解" class="headerlink" title="MySQL 进阶教程（三）多表查询详解"></a>MySQL 进阶教程（三）多表查询详解</h1><p>在实际应用中，数据通常分布在多个表中。多表查询是 SQL 中最重要、最实用的技能之一。本文将详细讲解多表关系、连接查询、联合查询和子查询。</p>
<h2 id="一、多表关系介绍"><a href="#一、多表关系介绍" class="headerlink" title="一、多表关系介绍"></a>一、多表关系介绍</h2><h3 id="1-1-表与表之间的关系"><a href="#1-1-表与表之间的关系" class="headerlink" title="1.1 表与表之间的关系"></a>1.1 表与表之间的关系</h3><p>数据库中的表不是孤立的，它们之间通过各种关系相互关联。主要有三种关系：</p>
<table>
<thead>
<tr>
<th>关系类型</th>
<th>说明</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td>一对一（1:1）</td>
<td>一个表的一条记录对应另一个表的一条记录</td>
<td>用户和用户详情</td>
</tr>
<tr>
<td>一对多（1:N）</td>
<td>一个表的一条记录对应另一个表的多条记录</td>
<td>部门和员工</td>
</tr>
<tr>
<td>多对多（N:M）</td>
<td>一个表的多条记录对应另一个表的多条记录</td>
<td>学生和课程</td>
</tr>
</tbody></table>
<h3 id="1-2-一对一关系（1-1）"><a href="#1-2-一对一关系（1-1）" class="headerlink" title="1.2 一对一关系（1:1）"></a>1.2 一对一关系（1:1）</h3><p><strong>特点</strong>：</p>
<ul>
<li>表 A 的一条记录对应表 B 的一条记录</li>
<li>通常用于拆分大表，提高性能</li>
<li>外键可以放在任意一方</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 用户表</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> users (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT,</span><br><span class="line">    username <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">    password <span class="type">VARCHAR</span>(<span class="number">255</span>) <span class="keyword">NOT NULL</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 用户详情表（一对一）</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> user_profiles (</span><br><span class="line">    user_id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span>,  <span class="comment">-- 也是主键，保证一对一</span></span><br><span class="line">    real_name <span class="type">VARCHAR</span>(<span class="number">50</span>),</span><br><span class="line">    phone <span class="type">VARCHAR</span>(<span class="number">20</span>),</span><br><span class="line">    address <span class="type">VARCHAR</span>(<span class="number">200</span>),</span><br><span class="line">    <span class="keyword">FOREIGN KEY</span> (user_id) <span class="keyword">REFERENCES</span> users(id) <span class="keyword">ON</span> <span class="keyword">DELETE</span> CASCADE</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询用户及其详情</span></span><br><span class="line"><span class="keyword">SELECT</span> u.username, p.real_name, p.phone, p.address</span><br><span class="line"><span class="keyword">FROM</span> users u</span><br><span class="line"><span class="keyword">JOIN</span> user_profiles p <span class="keyword">ON</span> u.id <span class="operator">=</span> p.user_id;</span><br></pre></td></tr></table></figure>

<h3 id="1-3-一对多关系（1-N）"><a href="#1-3-一对多关系（1-N）" class="headerlink" title="1.3 一对多关系（1:N）"></a>1.3 一对多关系（1:N）</h3><p><strong>特点</strong>：</p>
<ul>
<li>表 A 的一条记录对应表 B 的多条记录</li>
<li>外键放在”多”的一方</li>
<li>最常见表关系</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 部门表（一方）</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> departments (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT,</span><br><span class="line">    dept_name <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">NOT NULL</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 员工表（多方）</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> employees (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT,</span><br><span class="line">    name <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">    dept_id <span class="type">INT</span>,  <span class="comment">-- 外键指向部门表</span></span><br><span class="line">    <span class="keyword">FOREIGN KEY</span> (dept_id) <span class="keyword">REFERENCES</span> departments(id)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 一个部门有多个员工</span></span><br><span class="line"><span class="comment">-- 一个员工只属于一个部门</span></span><br></pre></td></tr></table></figure>

<h3 id="1-4-多对多关系（N-M）"><a href="#1-4-多对多关系（N-M）" class="headerlink" title="1.4 多对多关系（N:M）"></a>1.4 多对多关系（N:M）</h3><p><strong>特点</strong>：</p>
<ul>
<li>表 A 的多条记录对应表 B 的多条记录</li>
<li>需要第三张关联表（中间表）</li>
<li>关联表包含两个外键</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 学生表</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> students (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT,</span><br><span class="line">    name <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">NOT NULL</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 课程表</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> courses (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT,</span><br><span class="line">    course_name <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">NOT NULL</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 选课表（中间表）</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> enrollments (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT,</span><br><span class="line">    student_id <span class="type">INT</span> <span class="keyword">NOT NULL</span>,</span><br><span class="line">    course_id <span class="type">INT</span> <span class="keyword">NOT NULL</span>,</span><br><span class="line">    enroll_date <span class="type">DATE</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_DATE</span>,</span><br><span class="line">    <span class="keyword">FOREIGN KEY</span> (student_id) <span class="keyword">REFERENCES</span> students(id),</span><br><span class="line">    <span class="keyword">FOREIGN KEY</span> (course_id) <span class="keyword">REFERENCES</span> courses(id),</span><br><span class="line">    <span class="keyword">UNIQUE</span> KEY uk_student_course (student_id, course_id)  <span class="comment">-- 防止重复选课</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 一个学生可以选多门课</span></span><br><span class="line"><span class="comment">-- 一门课可以被多个学生选</span></span><br></pre></td></tr></table></figure>

<h2 id="二、多表查询概述"><a href="#二、多表查询概述" class="headerlink" title="二、多表查询概述"></a>二、多表查询概述</h2><h3 id="2-1-多表查询的方式"><a href="#2-1-多表查询的方式" class="headerlink" title="2.1 多表查询的方式"></a>2.1 多表查询的方式</h3><table>
<thead>
<tr>
<th>查询方式</th>
<th>说明</th>
<th>关键字</th>
</tr>
</thead>
<tbody><tr>
<td>连接查询</td>
<td>通过连接条件将多个表关联</td>
<td>JOIN</td>
</tr>
<tr>
<td>联合查询</td>
<td>将多个查询结果合并</td>
<td>UNION</td>
</tr>
<tr>
<td>子查询</td>
<td>在一个查询中嵌套另一个查询</td>
<td>子 SELECT</td>
</tr>
</tbody></table>
<h3 id="2-2-笛卡尔积"><a href="#2-2-笛卡尔积" class="headerlink" title="2.2 笛卡尔积"></a>2.2 笛卡尔积</h3><p>当两个表进行连接时，如果没有连接条件，会得到笛卡尔积。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 表 A 有 3 条记录，表 B 有 4 条记录</span></span><br><span class="line"><span class="comment">-- 笛卡尔积结果：3 × 4 = 12 条记录</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 笛卡尔积（不推荐，数据量大会爆炸）</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> table_a, table_b;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 正确做法：添加连接条件</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> table_a, table_b <span class="keyword">WHERE</span> table_a.id <span class="operator">=</span> table_b.a_id;</span><br></pre></td></tr></table></figure>

<h3 id="2-3-准备测试数据"><a href="#2-3-准备测试数据" class="headerlink" title="2.3 准备测试数据"></a>2.3 准备测试数据</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 部门表</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> departments;</span><br><span class="line"><span class="keyword">CREATE TABLE</span> departments (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT,</span><br><span class="line">    dept_name <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">    dept_location <span class="type">VARCHAR</span>(<span class="number">100</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 员工表</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> employees;</span><br><span class="line"><span class="keyword">CREATE TABLE</span> employees (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT,</span><br><span class="line">    emp_no <span class="type">VARCHAR</span>(<span class="number">20</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">    name <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">    gender ENUM(<span class="string">&#x27;男&#x27;</span>, <span class="string">&#x27;女&#x27;</span>),</span><br><span class="line">    dept_id <span class="type">INT</span>,</span><br><span class="line">    salary <span class="type">DECIMAL</span>(<span class="number">10</span>, <span class="number">2</span>),</span><br><span class="line">    manager_id <span class="type">INT</span>,</span><br><span class="line">    <span class="keyword">FOREIGN KEY</span> (dept_id) <span class="keyword">REFERENCES</span> departments(id),</span><br><span class="line">    <span class="keyword">FOREIGN KEY</span> (manager_id) <span class="keyword">REFERENCES</span> employees(id)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 插入部门</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> departments (dept_name, dept_location) <span class="keyword">VALUES</span></span><br><span class="line">(<span class="string">&#x27;技术部&#x27;</span>, <span class="string">&#x27;北京&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;市场部&#x27;</span>, <span class="string">&#x27;上海&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;财务部&#x27;</span>, <span class="string">&#x27;北京&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;人事部&#x27;</span>, <span class="string">&#x27;广州&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 插入员工</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> employees (emp_no, name, gender, dept_id, salary, manager_id) <span class="keyword">VALUES</span></span><br><span class="line">(<span class="string">&#x27;E001&#x27;</span>, <span class="string">&#x27;张三&#x27;</span>, <span class="string">&#x27;男&#x27;</span>, <span class="number">1</span>, <span class="number">10000</span>, <span class="keyword">NULL</span>),      <span class="comment">-- 技术部经理</span></span><br><span class="line">(<span class="string">&#x27;E002&#x27;</span>, <span class="string">&#x27;李四&#x27;</span>, <span class="string">&#x27;女&#x27;</span>, <span class="number">1</span>, <span class="number">8000</span>, <span class="number">1</span>),          <span class="comment">-- 技术部员工</span></span><br><span class="line">(<span class="string">&#x27;E003&#x27;</span>, <span class="string">&#x27;王五&#x27;</span>, <span class="string">&#x27;男&#x27;</span>, <span class="number">1</span>, <span class="number">9000</span>, <span class="number">1</span>),          <span class="comment">-- 技术部员工</span></span><br><span class="line">(<span class="string">&#x27;E004&#x27;</span>, <span class="string">&#x27;赵六&#x27;</span>, <span class="string">&#x27;女&#x27;</span>, <span class="number">2</span>, <span class="number">8500</span>, <span class="keyword">NULL</span>),       <span class="comment">-- 市场部经理</span></span><br><span class="line">(<span class="string">&#x27;E005&#x27;</span>, <span class="string">&#x27;孙七&#x27;</span>, <span class="string">&#x27;男&#x27;</span>, <span class="number">2</span>, <span class="number">7500</span>, <span class="number">4</span>),          <span class="comment">-- 市场部员工</span></span><br><span class="line">(<span class="string">&#x27;E006&#x27;</span>, <span class="string">&#x27;周八&#x27;</span>, <span class="string">&#x27;女&#x27;</span>, <span class="number">3</span>, <span class="number">9000</span>, <span class="keyword">NULL</span>),       <span class="comment">-- 财务部经理</span></span><br><span class="line">(<span class="string">&#x27;E007&#x27;</span>, <span class="string">&#x27;吴九&#x27;</span>, <span class="string">&#x27;男&#x27;</span>, <span class="keyword">NULL</span>, <span class="number">6000</span>, <span class="keyword">NULL</span>);    <span class="comment">-- 暂无部门</span></span><br></pre></td></tr></table></figure>

<h2 id="三、内连接（INNER-JOIN）"><a href="#三、内连接（INNER-JOIN）" class="headerlink" title="三、内连接（INNER JOIN）"></a>三、内连接（INNER JOIN）</h2><h3 id="3-1-内连接概述"><a href="#3-1-内连接概述" class="headerlink" title="3.1 内连接概述"></a>3.1 内连接概述</h3><p><strong>内连接</strong> 返回两个表中满足连接条件的记录。</p>
<p><strong>特点</strong>：</p>
<ul>
<li>只返回匹配的记录</li>
<li>不匹配的记录不会出现在结果中</li>
<li>最常用的连接方式</li>
</ul>
<h3 id="3-2-内连接语法"><a href="#3-2-内连接语法" class="headerlink" title="3.2 内连接语法"></a>3.2 内连接语法</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 标准语法（推荐）</span></span><br><span class="line"><span class="keyword">SELECT</span> 列名</span><br><span class="line"><span class="keyword">FROM</span> 表 <span class="number">1</span></span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> 表 <span class="number">2</span> <span class="keyword">ON</span> 连接条件</span><br><span class="line">[<span class="keyword">WHERE</span> 条件]</span><br><span class="line">[<span class="keyword">GROUP</span> <span class="keyword">BY</span> 分组列]</span><br><span class="line">[<span class="keyword">ORDER</span> <span class="keyword">BY</span> 排序列]</span><br><span class="line">[LIMIT 数量];</span><br><span class="line"></span><br><span class="line"><span class="comment">-- INNER 可以省略</span></span><br><span class="line"><span class="keyword">SELECT</span> 列名</span><br><span class="line"><span class="keyword">FROM</span> 表 <span class="number">1</span></span><br><span class="line"><span class="keyword">JOIN</span> 表 <span class="number">2</span> <span class="keyword">ON</span> 连接条件;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 多表连接</span></span><br><span class="line"><span class="keyword">SELECT</span> 列名</span><br><span class="line"><span class="keyword">FROM</span> 表 <span class="number">1</span></span><br><span class="line"><span class="keyword">JOIN</span> 表 <span class="number">2</span> <span class="keyword">ON</span> 表 <span class="number">1.</span>id <span class="operator">=</span> 表 <span class="number">2.</span>表 <span class="number">1</span>_id</span><br><span class="line"><span class="keyword">JOIN</span> 表 <span class="number">3</span> <span class="keyword">ON</span> 表 <span class="number">2.</span>id <span class="operator">=</span> 表 <span class="number">3.</span>表 <span class="number">2</span>_id;</span><br></pre></td></tr></table></figure>

<h3 id="3-3-内连接示例"><a href="#3-3-内连接示例" class="headerlink" title="3.3 内连接示例"></a>3.3 内连接示例</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 查询员工及其所属部门</span></span><br><span class="line"><span class="keyword">SELECT</span> e.name, e.salary, d.dept_name</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> departments d <span class="keyword">ON</span> e.dept_id <span class="operator">=</span> d.id;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询技术部员工</span></span><br><span class="line"><span class="keyword">SELECT</span> e.name, e.salary, d.dept_name</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">JOIN</span> departments d <span class="keyword">ON</span> e.dept_id <span class="operator">=</span> d.id</span><br><span class="line"><span class="keyword">WHERE</span> d.dept_name <span class="operator">=</span> <span class="string">&#x27;技术部&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询工资高于 8000 的员工及部门</span></span><br><span class="line"><span class="keyword">SELECT</span> e.name, e.salary, d.dept_name, d.dept_location</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">JOIN</span> departments d <span class="keyword">ON</span> e.dept_id <span class="operator">=</span> d.id</span><br><span class="line"><span class="keyword">WHERE</span> e.salary <span class="operator">&gt;</span> <span class="number">8000</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 多条件连接</span></span><br><span class="line"><span class="keyword">SELECT</span> e.name, d.dept_name</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">JOIN</span> departments d <span class="keyword">ON</span> e.dept_id <span class="operator">=</span> d.id</span><br><span class="line"><span class="keyword">WHERE</span> e.gender <span class="operator">=</span> <span class="string">&#x27;男&#x27;</span> <span class="keyword">AND</span> d.dept_location <span class="operator">=</span> <span class="string">&#x27;北京&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h3 id="3-4-隐式内连接"><a href="#3-4-隐式内连接" class="headerlink" title="3.4 隐式内连接"></a>3.4 隐式内连接</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 隐式内连接（旧语法，不推荐）</span></span><br><span class="line"><span class="keyword">SELECT</span> e.name, d.dept_name</span><br><span class="line"><span class="keyword">FROM</span> employees e, departments d</span><br><span class="line"><span class="keyword">WHERE</span> e.dept_id <span class="operator">=</span> d.id;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 等价于显式内连接</span></span><br><span class="line"><span class="keyword">SELECT</span> e.name, d.dept_name</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">JOIN</span> departments d <span class="keyword">ON</span> e.dept_id <span class="operator">=</span> d.id;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 注意：隐式连接容易遗漏 WHERE 条件导致笛卡尔积</span></span><br></pre></td></tr></table></figure>

<h3 id="3-5-多表内连接"><a href="#3-5-多表内连接" class="headerlink" title="3.5 多表内连接"></a>3.5 多表内连接</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 查询员工、部门及其上级领导</span></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    e.name <span class="keyword">AS</span> 员工，</span><br><span class="line">    d.dept_name <span class="keyword">AS</span> 部门，</span><br><span class="line">    m.name <span class="keyword">AS</span> 上级领导</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">JOIN</span> departments d <span class="keyword">ON</span> e.dept_id <span class="operator">=</span> d.id</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> employees m <span class="keyword">ON</span> e.manager_id <span class="operator">=</span> m.id;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 三表连接示例：学生 - 选课 - 课程</span></span><br><span class="line"><span class="keyword">SELECT</span> s.name <span class="keyword">AS</span> 学生，c.course_name <span class="keyword">AS</span> 课程，e.score <span class="keyword">AS</span> 成绩</span><br><span class="line"><span class="keyword">FROM</span> students s</span><br><span class="line"><span class="keyword">JOIN</span> enrollments e <span class="keyword">ON</span> s.id <span class="operator">=</span> e.student_id</span><br><span class="line"><span class="keyword">JOIN</span> courses c <span class="keyword">ON</span> e.course_id <span class="operator">=</span> c.id;</span><br></pre></td></tr></table></figure>

<h2 id="四、外连接（OUTER-JOIN）"><a href="#四、外连接（OUTER-JOIN）" class="headerlink" title="四、外连接（OUTER JOIN）"></a>四、外连接（OUTER JOIN）</h2><h3 id="4-1-外连接概述"><a href="#4-1-外连接概述" class="headerlink" title="4.1 外连接概述"></a>4.1 外连接概述</h3><p><strong>外连接</strong> 返回一个表的所有记录，另一个表只返回匹配的记录。</p>
<table>
<thead>
<tr>
<th>类型</th>
<th>说明</th>
<th>返回</th>
</tr>
</thead>
<tbody><tr>
<td>左连接（LEFT JOIN）</td>
<td>返回左表所有记录</td>
<td>左表全部 + 右表匹配</td>
</tr>
<tr>
<td>右连接（RIGHT JOIN）</td>
<td>返回右表所有记录</td>
<td>右表全部 + 左表匹配</td>
</tr>
<tr>
<td>全外连接（FULL JOIN）</td>
<td>返回两个表所有记录</td>
<td>MySQL 不支持</td>
</tr>
</tbody></table>
<h3 id="4-2-左连接（LEFT-JOIN）"><a href="#4-2-左连接（LEFT-JOIN）" class="headerlink" title="4.2 左连接（LEFT JOIN）"></a>4.2 左连接（LEFT JOIN）</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 查询所有员工及其部门（包括没有部门的员工）</span></span><br><span class="line"><span class="keyword">SELECT</span> e.name, e.dept_id, d.dept_name</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> departments d <span class="keyword">ON</span> e.dept_id <span class="operator">=</span> d.id;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 结果：吴九（dept_id=NULL）也会显示，dept_name 为 NULL</span></span><br></pre></td></tr></table></figure>

<p><strong>左连接特点</strong>：</p>
<ul>
<li>左表的所有记录都会返回</li>
<li>右表没有匹配的记录填充 NULL</li>
</ul>
<h3 id="4-3-右连接（RIGHT-JOIN）"><a href="#4-3-右连接（RIGHT-JOIN）" class="headerlink" title="4.3 右连接（RIGHT JOIN）"></a>4.3 右连接（RIGHT JOIN）</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 查询所有部门及其员工（包括没有员工的部门）</span></span><br><span class="line"><span class="keyword">SELECT</span> d.dept_name, e.name</span><br><span class="line"><span class="keyword">FROM</span> departments d</span><br><span class="line"><span class="keyword">RIGHT</span> <span class="keyword">JOIN</span> employees e <span class="keyword">ON</span> d.id <span class="operator">=</span> e.dept_id;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 等价于（推荐）</span></span><br><span class="line"><span class="keyword">SELECT</span> d.dept_name, e.name</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> departments d <span class="keyword">ON</span> d.id <span class="operator">=</span> e.dept_id;</span><br></pre></td></tr></table></figure>

<p><strong>右连接特点</strong>：</p>
<ul>
<li>右表的所有记录都会返回</li>
<li>左表没有匹配的记录填充 NULL</li>
<li>可以用左连接替代</li>
</ul>
<h3 id="4-4-左连接-vs-内连接"><a href="#4-4-左连接-vs-内连接" class="headerlink" title="4.4 左连接 vs 内连接"></a>4.4 左连接 vs 内连接</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 内连接：只返回有部门的员工</span></span><br><span class="line"><span class="keyword">SELECT</span> e.name, d.dept_name</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">JOIN</span> departments d <span class="keyword">ON</span> e.dept_id <span class="operator">=</span> d.id;</span><br><span class="line"><span class="comment">-- 吴九不会出现在结果中</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 左连接：返回所有员工</span></span><br><span class="line"><span class="keyword">SELECT</span> e.name, d.dept_name</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> departments d <span class="keyword">ON</span> e.dept_id <span class="operator">=</span> d.id;</span><br><span class="line"><span class="comment">-- 吴九会显示，dept_name 为 NULL</span></span><br></pre></td></tr></table></figure>

<h3 id="4-5-外连接查询不匹配记录"><a href="#4-5-外连接查询不匹配记录" class="headerlink" title="4.5 外连接查询不匹配记录"></a>4.5 外连接查询不匹配记录</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 查询没有员工的部门</span></span><br><span class="line"><span class="keyword">SELECT</span> d.dept_name</span><br><span class="line"><span class="keyword">FROM</span> departments d</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> employees e <span class="keyword">ON</span> d.id <span class="operator">=</span> e.dept_id</span><br><span class="line"><span class="keyword">WHERE</span> e.id <span class="keyword">IS</span> <span class="keyword">NULL</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询没有部门的员工</span></span><br><span class="line"><span class="keyword">SELECT</span> e.name</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> departments d <span class="keyword">ON</span> e.dept_id <span class="operator">=</span> d.id</span><br><span class="line"><span class="keyword">WHERE</span> d.id <span class="keyword">IS</span> <span class="keyword">NULL</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询没有选课的学生</span></span><br><span class="line"><span class="keyword">SELECT</span> s.name</span><br><span class="line"><span class="keyword">FROM</span> students s</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> enrollments e <span class="keyword">ON</span> s.id <span class="operator">=</span> e.student_id</span><br><span class="line"><span class="keyword">WHERE</span> e.course_id <span class="keyword">IS</span> <span class="keyword">NULL</span>;</span><br></pre></td></tr></table></figure>

<h3 id="4-6-外连接条件位置"><a href="#4-6-外连接条件位置" class="headerlink" title="4.6 外连接条件位置"></a>4.6 外连接条件位置</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 连接条件在 ON 子句</span></span><br><span class="line"><span class="keyword">SELECT</span> e.name, d.dept_name</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> departments d <span class="keyword">ON</span> e.dept_id <span class="operator">=</span> d.id;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 过滤条件在 WHERE 子句</span></span><br><span class="line"><span class="keyword">SELECT</span> e.name, d.dept_name</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> departments d <span class="keyword">ON</span> e.dept_id <span class="operator">=</span> d.id</span><br><span class="line"><span class="keyword">WHERE</span> d.dept_location <span class="operator">=</span> <span class="string">&#x27;北京&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 注意：ON 和 WHERE 的区别</span></span><br><span class="line"><span class="comment">-- ON 在连接时过滤，WHERE 在连接后过滤</span></span><br></pre></td></tr></table></figure>

<h2 id="五、自连接（SELF-JOIN）"><a href="#五、自连接（SELF-JOIN）" class="headerlink" title="五、自连接（SELF JOIN）"></a>五、自连接（SELF JOIN）</h2><h3 id="5-1-自连接概述"><a href="#5-1-自连接概述" class="headerlink" title="5.1 自连接概述"></a>5.1 自连接概述</h3><p><strong>自连接</strong> 是表自己与自己连接，用于查询具有层级关系的数据。</p>
<p><strong>特点</strong>：</p>
<ul>
<li>同一张表使用不同的别名</li>
<li>常用于组织架构、分类层级等</li>
</ul>
<h3 id="5-2-自连接示例"><a href="#5-2-自连接示例" class="headerlink" title="5.2 自连接示例"></a>5.2 自连接示例</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 查询员工及其上级领导</span></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    e.name <span class="keyword">AS</span> 员工，</span><br><span class="line">    e.emp_no <span class="keyword">AS</span> 员工编号，</span><br><span class="line">    m.name <span class="keyword">AS</span> 上级领导，</span><br><span class="line">    m.emp_no <span class="keyword">AS</span> 领导编号</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> employees m <span class="keyword">ON</span> e.manager_id <span class="operator">=</span> m.id;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询所有领导（带下属的员工）</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> m.id, m.name</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">JOIN</span> employees m <span class="keyword">ON</span> e.manager_id <span class="operator">=</span> m.id;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询没有下属的员工（普通员工）</span></span><br><span class="line"><span class="keyword">SELECT</span> e.name</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> employees sub <span class="keyword">ON</span> sub.manager_id <span class="operator">=</span> e.id</span><br><span class="line"><span class="keyword">WHERE</span> sub.id <span class="keyword">IS</span> <span class="keyword">NULL</span>;</span><br></pre></td></tr></table></figure>

<h3 id="5-3-层级查询"><a href="#5-3-层级查询" class="headerlink" title="5.3 层级查询"></a>5.3 层级查询</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 查询员工的完整汇报链（需要递归，MySQL 8.0+ 使用 CTE）</span></span><br><span class="line"><span class="keyword">WITH</span> <span class="keyword">RECURSIVE</span> emp_hierarchy <span class="keyword">AS</span> (</span><br><span class="line">    <span class="comment">-- 基础查询：顶级领导（没有上级）</span></span><br><span class="line">    <span class="keyword">SELECT</span> id, name, manager_id, <span class="number">0</span> <span class="keyword">AS</span> level</span><br><span class="line">    <span class="keyword">FROM</span> employees</span><br><span class="line">    <span class="keyword">WHERE</span> manager_id <span class="keyword">IS</span> <span class="keyword">NULL</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">UNION</span> <span class="keyword">ALL</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">-- 递归查询：下属</span></span><br><span class="line">    <span class="keyword">SELECT</span> e.id, e.name, e.manager_id, eh.level <span class="operator">+</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">FROM</span> employees e</span><br><span class="line">    <span class="keyword">JOIN</span> emp_hierarchy eh <span class="keyword">ON</span> e.manager_id <span class="operator">=</span> eh.id</span><br><span class="line">)</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> emp_hierarchy;</span><br></pre></td></tr></table></figure>

<h3 id="5-4-自连接其他应用"><a href="#5-4-自连接其他应用" class="headerlink" title="5.4 自连接其他应用"></a>5.4 自连接其他应用</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 查询同一部门的员工对</span></span><br><span class="line"><span class="keyword">SELECT</span> e1.name <span class="keyword">AS</span> 员工 <span class="number">1</span>, e2.name <span class="keyword">AS</span> 员工 <span class="number">2</span>, e1.dept_id</span><br><span class="line"><span class="keyword">FROM</span> employees e1</span><br><span class="line"><span class="keyword">JOIN</span> employees e2 <span class="keyword">ON</span> e1.dept_id <span class="operator">=</span> e2.dept_id <span class="keyword">AND</span> e1.id <span class="operator">&lt;</span> e2.id;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询工资比同事高的员工</span></span><br><span class="line"><span class="keyword">SELECT</span> e1.name, e1.salary, e2.name <span class="keyword">AS</span> 同事，e2.salary <span class="keyword">AS</span> 同事工资</span><br><span class="line"><span class="keyword">FROM</span> employees e1</span><br><span class="line"><span class="keyword">JOIN</span> employees e2 <span class="keyword">ON</span> e1.dept_id <span class="operator">=</span> e2.dept_id</span><br><span class="line"><span class="keyword">WHERE</span> e1.salary <span class="operator">&gt;</span> e2.salary <span class="keyword">AND</span> e1.id <span class="operator">!=</span> e2.id;</span><br></pre></td></tr></table></figure>

<h2 id="六、联合查询（UNION）"><a href="#六、联合查询（UNION）" class="headerlink" title="六、联合查询（UNION）"></a>六、联合查询（UNION）</h2><h3 id="6-1-UNION-概述"><a href="#6-1-UNION-概述" class="headerlink" title="6.1 UNION 概述"></a>6.1 UNION 概述</h3><p><strong>UNION</strong> 用于将多个 SELECT 查询的结果合并为一个结果集。</p>
<p><strong>特点</strong>：</p>
<ul>
<li>自动去重（UNION ALL 不去重）</li>
<li>所有查询的列数必须相同</li>
<li>对应列的数据类型必须兼容</li>
</ul>
<h3 id="6-2-UNION-语法"><a href="#6-2-UNION-语法" class="headerlink" title="6.2 UNION 语法"></a>6.2 UNION 语法</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> 列 <span class="number">1</span>, 列 <span class="number">2</span> <span class="keyword">FROM</span> 表 <span class="number">1</span></span><br><span class="line"><span class="keyword">UNION</span> [<span class="keyword">ALL</span>]</span><br><span class="line"><span class="keyword">SELECT</span> 列 <span class="number">1</span>, 列 <span class="number">2</span> <span class="keyword">FROM</span> 表 <span class="number">2</span></span><br><span class="line">[<span class="keyword">UNION</span> [<span class="keyword">ALL</span>]</span><br><span class="line"><span class="keyword">SELECT</span> 列 <span class="number">1</span>, 列 <span class="number">2</span> <span class="keyword">FROM</span> 表 <span class="number">3</span>];</span><br></pre></td></tr></table></figure>

<h3 id="6-3-UNION-示例"><a href="#6-3-UNION-示例" class="headerlink" title="6.3 UNION 示例"></a>6.3 UNION 示例</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- UNION：合并两个查询结果并去重</span></span><br><span class="line"><span class="keyword">SELECT</span> name, dept_id <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> salary <span class="operator">&gt;</span> <span class="number">9000</span></span><br><span class="line"><span class="keyword">UNION</span></span><br><span class="line"><span class="keyword">SELECT</span> name, dept_id <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> dept_id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- UNION ALL：合并但保留重复（性能更好）</span></span><br><span class="line"><span class="keyword">SELECT</span> name <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> gender <span class="operator">=</span> <span class="string">&#x27;男&#x27;</span></span><br><span class="line"><span class="keyword">UNION</span> <span class="keyword">ALL</span></span><br><span class="line"><span class="keyword">SELECT</span> name <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> dept_id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 多个查询合并</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="string">&#x27;高工资&#x27;</span> <span class="keyword">AS</span> 类型，name <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> salary <span class="operator">&gt;</span> <span class="number">9000</span></span><br><span class="line"><span class="keyword">UNION</span> <span class="keyword">ALL</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="string">&#x27;北京部门&#x27;</span> <span class="keyword">AS</span> 类型，name</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">JOIN</span> departments d <span class="keyword">ON</span> e.dept_id <span class="operator">=</span> d.id</span><br><span class="line"><span class="keyword">WHERE</span> d.dept_location <span class="operator">=</span> <span class="string">&#x27;北京&#x27;</span></span><br><span class="line"><span class="keyword">UNION</span> <span class="keyword">ALL</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="string">&#x27;经理&#x27;</span> <span class="keyword">AS</span> 类型，name <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> manager_id <span class="keyword">IS</span> <span class="keyword">NULL</span>;</span><br></pre></td></tr></table></figure>

<h3 id="6-4-UNION-vs-OR"><a href="#6-4-UNION-vs-OR" class="headerlink" title="6.4 UNION vs OR"></a>6.4 UNION vs OR</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 使用 UNION（推荐，可以利用索引）</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> dept_id <span class="operator">=</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">UNION</span> <span class="keyword">ALL</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> dept_id <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 使用 OR（可能影响索引使用）</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> dept_id <span class="operator">=</span> <span class="number">1</span> <span class="keyword">OR</span> dept_id <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- UNION 适用场景：</span></span><br><span class="line"><span class="comment">-- 1. 查询不同表的数据合并</span></span><br><span class="line"><span class="comment">-- 2. 复杂 OR 条件优化</span></span><br></pre></td></tr></table></figure>

<h3 id="6-5-UNION-排序和分页"><a href="#6-5-UNION-排序和分页" class="headerlink" title="6.5 UNION 排序和分页"></a>6.5 UNION 排序和分页</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- UNION 后排序（对整个结果集排序）</span></span><br><span class="line">(<span class="keyword">SELECT</span> name, salary <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> dept_id <span class="operator">=</span> <span class="number">1</span>)</span><br><span class="line"><span class="keyword">UNION</span> <span class="keyword">ALL</span></span><br><span class="line">(<span class="keyword">SELECT</span> name, salary <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> dept_id <span class="operator">=</span> <span class="number">2</span>)</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> salary <span class="keyword">DESC</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- UNION 后分页</span></span><br><span class="line">(<span class="keyword">SELECT</span> name, salary <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> dept_id <span class="operator">=</span> <span class="number">1</span>)</span><br><span class="line"><span class="keyword">UNION</span> <span class="keyword">ALL</span></span><br><span class="line">(<span class="keyword">SELECT</span> name, salary <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> dept_id <span class="operator">=</span> <span class="number">2</span>)</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> salary <span class="keyword">DESC</span></span><br><span class="line">LIMIT <span class="number">5</span>, <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 注意：每个 SELECT 单独加 ORDER BY 需要使用括号</span></span><br><span class="line">(<span class="keyword">SELECT</span> name, salary <span class="keyword">FROM</span> employees <span class="keyword">ORDER</span> <span class="keyword">BY</span> salary <span class="keyword">DESC</span> LIMIT <span class="number">3</span>)</span><br><span class="line"><span class="keyword">UNION</span> <span class="keyword">ALL</span></span><br><span class="line">(<span class="keyword">SELECT</span> name, salary <span class="keyword">FROM</span> employees <span class="keyword">ORDER</span> <span class="keyword">BY</span> salary <span class="keyword">ASC</span> LIMIT <span class="number">3</span>);</span><br></pre></td></tr></table></figure>

<h2 id="七、子查询介绍"><a href="#七、子查询介绍" class="headerlink" title="七、子查询介绍"></a>七、子查询介绍</h2><h3 id="7-1-子查询概述"><a href="#7-1-子查询概述" class="headerlink" title="7.1 子查询概述"></a>7.1 子查询概述</h3><p><strong>子查询</strong> 是嵌套在其他 SQL 语句中的 SELECT 查询。</p>
<p><strong>子查询的位置</strong>：</p>
<ul>
<li>WHERE 子句中</li>
<li>FROM 子句中</li>
<li>SELECT 子句中</li>
<li>HAVING 子句中</li>
</ul>
<p><strong>子查询的分类</strong>：</p>
<ul>
<li>标量子查询：返回单个值</li>
<li>列子查询：返回单列多行</li>
<li>行子查询：返回单行多列</li>
<li>表子查询：返回多行多列</li>
</ul>
<h3 id="7-2-子查询基本语法"><a href="#7-2-子查询基本语法" class="headerlink" title="7.2 子查询基本语法"></a>7.2 子查询基本语法</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- WHERE 子句中的子查询</span></span><br><span class="line"><span class="keyword">SELECT</span> name <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> salary <span class="operator">&gt;</span> (<span class="keyword">SELECT</span> <span class="built_in">AVG</span>(salary) <span class="keyword">FROM</span> employees);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- FROM 子句中的子查询（派生表）</span></span><br><span class="line"><span class="keyword">SELECT</span> dept_name, avg_salary</span><br><span class="line"><span class="keyword">FROM</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> d.dept_name, <span class="built_in">AVG</span>(e.salary) <span class="keyword">AS</span> avg_salary</span><br><span class="line">    <span class="keyword">FROM</span> departments d</span><br><span class="line">    <span class="keyword">JOIN</span> employees e <span class="keyword">ON</span> d.id <span class="operator">=</span> e.dept_id</span><br><span class="line">    <span class="keyword">GROUP</span> <span class="keyword">BY</span> d.id</span><br><span class="line">) <span class="keyword">AS</span> dept_stats;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- SELECT 子句中的子查询（标量）</span></span><br><span class="line"><span class="keyword">SELECT</span> name, salary,</span><br><span class="line">       (<span class="keyword">SELECT</span> <span class="built_in">AVG</span>(salary) <span class="keyword">FROM</span> employees) <span class="keyword">AS</span> 公司平均工资</span><br><span class="line"><span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>

<h2 id="八、标量子查询"><a href="#八、标量子查询" class="headerlink" title="八、标量子查询"></a>八、标量子查询</h2><h3 id="8-1-标量子查询概述"><a href="#8-1-标量子查询概述" class="headerlink" title="8.1 标量子查询概述"></a>8.1 标量子查询概述</h3><p><strong>标量子查询</strong> 返回单个值（一行一列），通常用于比较。</p>
<h3 id="8-2-标量子查询示例"><a href="#8-2-标量子查询示例" class="headerlink" title="8.2 标量子查询示例"></a>8.2 标量子查询示例</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 查询工资高于平均工资的员工</span></span><br><span class="line"><span class="keyword">SELECT</span> name, salary <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> salary <span class="operator">&gt;</span> (<span class="keyword">SELECT</span> <span class="built_in">AVG</span>(salary) <span class="keyword">FROM</span> employees);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询工资最高的员工</span></span><br><span class="line"><span class="keyword">SELECT</span> name, salary <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> salary <span class="operator">=</span> (<span class="keyword">SELECT</span> <span class="built_in">MAX</span>(salary) <span class="keyword">FROM</span> employees);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询入职最早的员工</span></span><br><span class="line"><span class="keyword">SELECT</span> name, hire_date <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> hire_date <span class="operator">=</span> (<span class="keyword">SELECT</span> <span class="built_in">MIN</span>(hire_date) <span class="keyword">FROM</span> employees);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询低于本部门平均工资的员工</span></span><br><span class="line"><span class="keyword">SELECT</span> e1.name, e1.dept_id, e1.salary</span><br><span class="line"><span class="keyword">FROM</span> employees e1</span><br><span class="line"><span class="keyword">WHERE</span> e1.salary <span class="operator">&lt;</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> <span class="built_in">AVG</span>(e2.salary)</span><br><span class="line">    <span class="keyword">FROM</span> employees e2</span><br><span class="line">    <span class="keyword">WHERE</span> e2.dept_id <span class="operator">=</span> e1.dept_id</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 在 SELECT 中使用标量子查询</span></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    name,</span><br><span class="line">    salary,</span><br><span class="line">    (<span class="keyword">SELECT</span> <span class="built_in">AVG</span>(salary) <span class="keyword">FROM</span> employees) <span class="keyword">AS</span> 公司平均工资，</span><br><span class="line">    (<span class="keyword">SELECT</span> <span class="built_in">AVG</span>(e2.salary) <span class="keyword">FROM</span> employees e2 <span class="keyword">WHERE</span> e2.dept_id <span class="operator">=</span> e.dept_id) <span class="keyword">AS</span> 部门平均工资</span><br><span class="line"><span class="keyword">FROM</span> employees e;</span><br></pre></td></tr></table></figure>

<h2 id="九、列子查询"><a href="#九、列子查询" class="headerlink" title="九、列子查询"></a>九、列子查询</h2><h3 id="9-1-列子查询概述"><a href="#9-1-列子查询概述" class="headerlink" title="9.1 列子查询概述"></a>9.1 列子查询概述</h3><p><strong>列子查询</strong> 返回单列多行，通常与 IN、NOT IN、ANY、ALL 配合使用。</p>
<h3 id="9-2-IN-NOT-IN"><a href="#9-2-IN-NOT-IN" class="headerlink" title="9.2 IN &#x2F; NOT IN"></a>9.2 IN &#x2F; NOT IN</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 查询技术部和市场部的员工</span></span><br><span class="line"><span class="keyword">SELECT</span> name, dept_id <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> dept_id <span class="keyword">IN</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> id <span class="keyword">FROM</span> departments <span class="keyword">WHERE</span> dept_name <span class="keyword">IN</span> (<span class="string">&#x27;技术部&#x27;</span>, <span class="string">&#x27;市场部&#x27;</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询没有员工的部门</span></span><br><span class="line"><span class="keyword">SELECT</span> dept_name <span class="keyword">FROM</span> departments</span><br><span class="line"><span class="keyword">WHERE</span> id <span class="keyword">NOT</span> <span class="keyword">IN</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> dept_id <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> dept_id <span class="keyword">IS</span> <span class="keyword">NOT NULL</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询选了某门课程的学生</span></span><br><span class="line"><span class="keyword">SELECT</span> name <span class="keyword">FROM</span> students</span><br><span class="line"><span class="keyword">WHERE</span> id <span class="keyword">IN</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> student_id <span class="keyword">FROM</span> enrollments <span class="keyword">WHERE</span> course_id <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h3 id="9-3-ANY-SOME"><a href="#9-3-ANY-SOME" class="headerlink" title="9.3 ANY &#x2F; SOME"></a>9.3 ANY &#x2F; SOME</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 查询工资比任一技术部员工高的员工</span></span><br><span class="line"><span class="keyword">SELECT</span> name, salary <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> salary <span class="operator">&gt;</span> <span class="keyword">ANY</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> salary <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> dept_id <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 等价于（使用 MIN）</span></span><br><span class="line"><span class="keyword">SELECT</span> name, salary <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> salary <span class="operator">&gt;</span> (<span class="keyword">SELECT</span> <span class="built_in">MIN</span>(salary) <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> dept_id <span class="operator">=</span> <span class="number">1</span>);</span><br></pre></td></tr></table></figure>

<h3 id="9-4-ALL"><a href="#9-4-ALL" class="headerlink" title="9.4 ALL"></a>9.4 ALL</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 查询工资比所有技术部员工都高的员工</span></span><br><span class="line"><span class="keyword">SELECT</span> name, salary <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> salary <span class="operator">&gt;</span> <span class="keyword">ALL</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> salary <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> dept_id <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 等价于（使用 MAX）</span></span><br><span class="line"><span class="keyword">SELECT</span> name, salary <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> salary <span class="operator">&gt;</span> (<span class="keyword">SELECT</span> <span class="built_in">MAX</span>(salary) <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> dept_id <span class="operator">=</span> <span class="number">1</span>);</span><br></pre></td></tr></table></figure>

<h2 id="十、行子查询"><a href="#十、行子查询" class="headerlink" title="十、行子查询"></a>十、行子查询</h2><h3 id="10-1-行子查询概述"><a href="#10-1-行子查询概述" class="headerlink" title="10.1 行子查询概述"></a>10.1 行子查询概述</h3><p><strong>行子查询</strong> 返回单行多列，可以与行构造符配合使用。</p>
<h3 id="10-2-行子查询示例"><a href="#10-2-行子查询示例" class="headerlink" title="10.2 行子查询示例"></a>10.2 行子查询示例</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 查询工资和部门都与张三相同的员工</span></span><br><span class="line"><span class="keyword">SELECT</span> name, dept_id, salary <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> (salary, dept_id) <span class="operator">=</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> salary, dept_id <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> name <span class="operator">=</span> <span class="string">&#x27;张三&#x27;</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 使用行构造符比较</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> (dept_id, salary) <span class="operator">&gt;</span> (<span class="number">1</span>, <span class="number">8000</span>);  <span class="comment">-- dept_id&gt;1 或 (dept_id=1 且 salary&gt;8000)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询工资最高的前几名员工</span></span><br><span class="line"><span class="keyword">SELECT</span> name, salary <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> (salary, id) <span class="keyword">IN</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> salary, id <span class="keyword">FROM</span> employees <span class="keyword">ORDER</span> <span class="keyword">BY</span> salary <span class="keyword">DESC</span> LIMIT <span class="number">3</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h2 id="十一、表子查询"><a href="#十一、表子查询" class="headerlink" title="十一、表子查询"></a>十一、表子查询</h2><h3 id="11-1-表子查询概述"><a href="#11-1-表子查询概述" class="headerlink" title="11.1 表子查询概述"></a>11.1 表子查询概述</h3><p><strong>表子查询</strong> 返回多行多列，通常用作派生表（FROM 子句中的子查询）。</p>
<h3 id="11-2-FROM-子句中的子查询"><a href="#11-2-FROM-子句中的子查询" class="headerlink" title="11.2 FROM 子句中的子查询"></a>11.2 FROM 子句中的子查询</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 查询各部门平均工资及高于平均工资的员工</span></span><br><span class="line"><span class="keyword">SELECT</span> e.name, e.salary, d.dept_name, d.avg_salary</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">JOIN</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> dept_id, <span class="built_in">AVG</span>(salary) <span class="keyword">AS</span> avg_salary</span><br><span class="line">    <span class="keyword">FROM</span> employees</span><br><span class="line">    <span class="keyword">GROUP</span> <span class="keyword">BY</span> dept_id</span><br><span class="line">) d <span class="keyword">ON</span> e.dept_id <span class="operator">=</span> d.dept_id</span><br><span class="line"><span class="keyword">WHERE</span> e.salary <span class="operator">&gt;</span> d.avg_salary;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询员工数超过 2 人的部门</span></span><br><span class="line"><span class="keyword">SELECT</span> d.dept_name, dept_stats.emp_count</span><br><span class="line"><span class="keyword">FROM</span> departments d</span><br><span class="line"><span class="keyword">JOIN</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> dept_id, <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">AS</span> emp_count</span><br><span class="line">    <span class="keyword">FROM</span> employees</span><br><span class="line">    <span class="keyword">GROUP</span> <span class="keyword">BY</span> dept_id</span><br><span class="line">    <span class="keyword">HAVING</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="operator">&gt;</span> <span class="number">2</span></span><br><span class="line">) dept_stats <span class="keyword">ON</span> d.id <span class="operator">=</span> dept_stats.dept_id;</span><br></pre></td></tr></table></figure>

<h3 id="11-3-相关子查询（EXISTS）"><a href="#11-3-相关子查询（EXISTS）" class="headerlink" title="11.3 相关子查询（EXISTS）"></a>11.3 相关子查询（EXISTS）</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 查询有员工的部门（使用 EXISTS）</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> departments d</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">EXISTS</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> <span class="number">1</span> <span class="keyword">FROM</span> employees e <span class="keyword">WHERE</span> e.dept_id <span class="operator">=</span> d.id</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询没有员工的部门</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> departments d</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> <span class="number">1</span> <span class="keyword">FROM</span> employees e <span class="keyword">WHERE</span> e.dept_id <span class="operator">=</span> d.id</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询至少选了 2 门课的学生</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> students s</span><br><span class="line"><span class="keyword">WHERE</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">FROM</span> enrollments e <span class="keyword">WHERE</span> e.student_id <span class="operator">=</span> s.id</span><br><span class="line">) <span class="operator">&gt;=</span> <span class="number">2</span>;</span><br></pre></td></tr></table></figure>

<h2 id="十二、多表查询综合练习"><a href="#十二、多表查询综合练习" class="headerlink" title="十二、多表查询综合练习"></a>十二、多表查询综合练习</h2><h3 id="练习-1：基础查询"><a href="#练习-1：基础查询" class="headerlink" title="练习 1：基础查询"></a>练习 1：基础查询</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 1. 查询所有员工姓名、工资、部门名称</span></span><br><span class="line"><span class="keyword">SELECT</span> e.name, e.salary, d.dept_name</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> departments d <span class="keyword">ON</span> e.dept_id <span class="operator">=</span> d.id;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 2. 查询北京部门的员工</span></span><br><span class="line"><span class="keyword">SELECT</span> e.name, d.dept_name, d.dept_location</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">JOIN</span> departments d <span class="keyword">ON</span> e.dept_id <span class="operator">=</span> d.id</span><br><span class="line"><span class="keyword">WHERE</span> d.dept_location <span class="operator">=</span> <span class="string">&#x27;北京&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 3. 查询工资高于公司平均工资的员工</span></span><br><span class="line"><span class="keyword">SELECT</span> name, salary</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> salary <span class="operator">&gt;</span> (<span class="keyword">SELECT</span> <span class="built_in">AVG</span>(salary) <span class="keyword">FROM</span> employees);</span><br></pre></td></tr></table></figure>

<h3 id="练习-2：分组统计"><a href="#练习-2：分组统计" class="headerlink" title="练习 2：分组统计"></a>练习 2：分组统计</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 4. 查询各部门人数</span></span><br><span class="line"><span class="keyword">SELECT</span> d.dept_name, <span class="built_in">COUNT</span>(e.id) <span class="keyword">AS</span> emp_count</span><br><span class="line"><span class="keyword">FROM</span> departments d</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> employees e <span class="keyword">ON</span> d.id <span class="operator">=</span> e.dept_id</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> d.id, d.dept_name;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 5. 查询各部门平均工资</span></span><br><span class="line"><span class="keyword">SELECT</span> d.dept_name, ROUND(<span class="built_in">AVG</span>(e.salary), <span class="number">2</span>) <span class="keyword">AS</span> avg_salary</span><br><span class="line"><span class="keyword">FROM</span> departments d</span><br><span class="line"><span class="keyword">JOIN</span> employees e <span class="keyword">ON</span> d.id <span class="operator">=</span> e.dept_id</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> d.id, d.dept_name;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 6. 查询平均工资高于 8000 的部门</span></span><br><span class="line"><span class="keyword">SELECT</span> d.dept_name, ROUND(<span class="built_in">AVG</span>(e.salary), <span class="number">2</span>) <span class="keyword">AS</span> avg_salary</span><br><span class="line"><span class="keyword">FROM</span> departments d</span><br><span class="line"><span class="keyword">JOIN</span> employees e <span class="keyword">ON</span> d.id <span class="operator">=</span> e.dept_id</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> d.id, d.dept_name</span><br><span class="line"><span class="keyword">HAVING</span> <span class="built_in">AVG</span>(e.salary) <span class="operator">&gt;</span> <span class="number">8000</span>;</span><br></pre></td></tr></table></figure>

<h3 id="练习-3：复杂查询"><a href="#练习-3：复杂查询" class="headerlink" title="练习 3：复杂查询"></a>练习 3：复杂查询</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 7. 查询工资最高的前 3 名员工</span></span><br><span class="line"><span class="keyword">SELECT</span> e.name, e.salary, d.dept_name</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">JOIN</span> departments d <span class="keyword">ON</span> e.dept_id <span class="operator">=</span> d.id</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> e.salary <span class="keyword">DESC</span></span><br><span class="line">LIMIT <span class="number">3</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 8. 查询每个部门工资最高的员工</span></span><br><span class="line"><span class="keyword">SELECT</span> e.name, e.dept_id, e.salary</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">WHERE</span> e.salary <span class="operator">=</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> <span class="built_in">MAX</span>(e2.salary)</span><br><span class="line">    <span class="keyword">FROM</span> employees e2</span><br><span class="line">    <span class="keyword">WHERE</span> e2.dept_id <span class="operator">=</span> e.dept_id</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 9. 查询员工及其上级领导（自连接）</span></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    e.name <span class="keyword">AS</span> 员工，</span><br><span class="line">    m.name <span class="keyword">AS</span> 上级领导</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> employees m <span class="keyword">ON</span> e.manager_id <span class="operator">=</span> m.id;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 10. 查询没有下属的领导</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> m.name</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">JOIN</span> employees m <span class="keyword">ON</span> e.manager_id <span class="operator">=</span> m.id</span><br><span class="line"><span class="keyword">WHERE</span> m.id <span class="keyword">NOT</span> <span class="keyword">IN</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> manager_id <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> manager_id <span class="keyword">IS</span> <span class="keyword">NOT NULL</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h2 id="十三、小结"><a href="#十三、小结" class="headerlink" title="十三、小结"></a>十三、小结</h2><h3 id="连接查询总结"><a href="#连接查询总结" class="headerlink" title="连接查询总结"></a>连接查询总结</h3><table>
<thead>
<tr>
<th>连接类型</th>
<th>关键字</th>
<th>返回结果</th>
</tr>
</thead>
<tbody><tr>
<td>内连接</td>
<td>INNER JOIN</td>
<td>只返回匹配记录</td>
</tr>
<tr>
<td>左连接</td>
<td>LEFT JOIN</td>
<td>左表全部 + 右表匹配</td>
</tr>
<tr>
<td>右连接</td>
<td>RIGHT JOIN</td>
<td>右表全部 + 左表匹配</td>
</tr>
<tr>
<td>自连接</td>
<td>表别名</td>
<td>表自己连接自己</td>
</tr>
<tr>
<td>交叉连接</td>
<td>CROSS JOIN</td>
<td>笛卡尔积</td>
</tr>
</tbody></table>
<h3 id="子查询总结"><a href="#子查询总结" class="headerlink" title="子查询总结"></a>子查询总结</h3><table>
<thead>
<tr>
<th>子查询类型</th>
<th>返回值</th>
<th>常用位置</th>
</tr>
</thead>
<tbody><tr>
<td>标量子查询</td>
<td>单个值</td>
<td>WHERE、SELECT</td>
</tr>
<tr>
<td>列子查询</td>
<td>单列多行</td>
<td>WHERE (IN&#x2F;NOT IN)</td>
</tr>
<tr>
<td>行子查询</td>
<td>单行多列</td>
<td>WHERE</td>
</tr>
<tr>
<td>表子查询</td>
<td>多行多列</td>
<td>FROM</td>
</tr>
</tbody></table>
<h3 id="最佳实践"><a href="#最佳实践" class="headerlink" title="最佳实践"></a>最佳实践</h3><ol>
<li><strong>优先使用连接</strong>：大多数子查询可以用连接改写</li>
<li><strong>EXISTS vs IN</strong>： EXISTS 通常在子查询结果集大时性能更好</li>
<li>**避免 SELECT ***：只选择需要的列</li>
<li><strong>使用表别名</strong>：简化 SQL 语句</li>
<li><strong>注意 NULL 值</strong>：NOT IN 遇到 NULL 可能返回空结果</li>
</ol>
<hr>
<p><strong>下一篇</strong>：[MySQL 进阶教程（四）：事务详解](&#x2F;2026&#x2F;02&#x2F;23&#x2F;MySQL 进阶教程（四）事务详解&#x2F;)</p>
<p><strong>上一篇</strong>：[MySQL 进阶教程（二）：数据库约束详解](&#x2F;2026&#x2F;02&#x2F;23&#x2F;MySQL 进阶教程（二）数据库约束详解&#x2F;)</p>
]]></content>
      <categories>
        <category>MySQL 进阶教程</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
        <tag>多表查询</tag>
        <tag>连接查询</tag>
        <tag>子查询</tag>
      </tags>
  </entry>
</search>
