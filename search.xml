<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>Git 版本控制与团队协作</title>
    <url>/2026/02/24/Git%20%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6%E4%B8%8E%E5%9B%A2%E9%98%9F%E5%8D%8F%E4%BD%9C/</url>
    <content><![CDATA[<h1 id="Git-版本控制与团队协作"><a href="#Git-版本控制与团队协作" class="headerlink" title="Git 版本控制与团队协作"></a>Git 版本控制与团队协作</h1><p>Git 是现代软件开发中不可或缺的工具。本篇将介绍 Git 的核心概念、常用命令、分支管理和团队协作流程。</p>
<h2 id="一、Git-基础"><a href="#一、Git-基础" class="headerlink" title="一、Git 基础"></a>一、Git 基础</h2><h3 id="1-1-版本控制简介"><a href="#1-1-版本控制简介" class="headerlink" title="1.1 版本控制简介"></a>1.1 版本控制简介</h3><p><strong>版本控制系统（VCS）</strong> 用于跟踪文件的变化历史，主要类型：</p>
<table>
<thead>
<tr>
<th>类型</th>
<th>特点</th>
<th>代表</th>
</tr>
</thead>
<tbody><tr>
<td>本地 VCS</td>
<td>单用户，单机器</td>
<td>RCS, SCCS</td>
</tr>
<tr>
<td>集中式 VCS</td>
<td>单服务器，多客户端</td>
<td>SVN, CVS</td>
</tr>
<tr>
<td>分布式 VCS</td>
<td>每人都有完整仓库</td>
<td>Git, Mercurial</td>
</tr>
</tbody></table>
<h3 id="1-2-Git-的特点"><a href="#1-2-Git-的特点" class="headerlink" title="1.2 Git 的特点"></a>1.2 Git 的特点</h3><ul>
<li><strong>分布式</strong>：每个人都是完整的仓库</li>
<li><strong>分支模型</strong>：轻量级分支，快速切换</li>
<li><strong>快照模式</strong>：存储快照而非差异</li>
<li><strong>数据校验</strong>：SHA-1 校验和保证数据完整性</li>
<li><strong>支持非线性开发</strong>：强大的合并能力</li>
</ul>
<h3 id="1-3-Git-的三个区域"><a href="#1-3-Git-的三个区域" class="headerlink" title="1.3 Git 的三个区域"></a>1.3 Git 的三个区域</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">工作目录 (Working Directory)</span><br><span class="line">    ↓ git add</span><br><span class="line">暂存区 (Staging Area / Index)</span><br><span class="line">    ↓ git commit</span><br><span class="line">仓库 (Repository / .git)</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>工作目录</strong>：你看到和编辑的文件</li>
<li><strong>暂存区</strong>：准备提交的快照</li>
<li><strong>仓库</strong>：永久存储的提交历史</li>
</ul>
<h3 id="1-4-安装与配置"><a href="#1-4-安装与配置" class="headerlink" title="1.4 安装与配置"></a>1.4 安装与配置</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 安装 Git</span></span><br><span class="line"><span class="comment"># Ubuntu/Debian</span></span><br><span class="line"><span class="built_in">sudo</span> apt install git</span><br><span class="line"></span><br><span class="line"><span class="comment"># CentOS/RHEL</span></span><br><span class="line"><span class="built_in">sudo</span> yum install git</span><br><span class="line"></span><br><span class="line"><span class="comment"># macOS</span></span><br><span class="line">brew install git</span><br><span class="line"></span><br><span class="line"><span class="comment"># Windows</span></span><br><span class="line"><span class="comment"># 下载 https://git-scm.com/download/win</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置用户信息（重要！）</span></span><br><span class="line">git config --global user.name <span class="string">&quot;张三&quot;</span></span><br><span class="line">git config --global user.email <span class="string">&quot;zhangsan@example.com&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看配置</span></span><br><span class="line">git config --list</span><br><span class="line">git config user.name</span><br><span class="line"></span><br><span class="line"><span class="comment"># 常用配置</span></span><br><span class="line">git config --global core.editor <span class="string">&quot;vim&quot;</span>           <span class="comment"># 设置编辑器</span></span><br><span class="line">git config --global init.defaultBranch main     <span class="comment"># 默认分支名</span></span><br><span class="line">git config --global color.ui <span class="literal">true</span>               <span class="comment"># 启用颜色</span></span><br><span class="line">git config --global core.autocrlf input         <span class="comment"># 换行符处理（Mac/Linux）</span></span><br><span class="line">git config --global core.autocrlf <span class="literal">true</span>          <span class="comment"># 换行符处理（Windows）</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 提醒自己：</span></span><br><span class="line"><span class="comment"># - --global 表示全局配置（~/.gitconfig）</span></span><br><span class="line"><span class="comment"># - 去掉--global 表示仅当前仓库</span></span><br></pre></td></tr></table></figure>

<h2 id="二、基础操作"><a href="#二、基础操作" class="headerlink" title="二、基础操作"></a>二、基础操作</h2><h3 id="2-1-创建仓库"><a href="#2-1-创建仓库" class="headerlink" title="2.1 创建仓库"></a>2.1 创建仓库</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 初始化新仓库</span></span><br><span class="line"><span class="built_in">mkdir</span> myproject</span><br><span class="line"><span class="built_in">cd</span> myproject</span><br><span class="line">git init</span><br><span class="line"></span><br><span class="line"><span class="comment"># 克隆现有仓库</span></span><br><span class="line">git <span class="built_in">clone</span> https://github.com/user/repo.git</span><br><span class="line">git <span class="built_in">clone</span> git@github.com:user/repo.git          <span class="comment"># SSH 方式</span></span><br><span class="line">git <span class="built_in">clone</span> https://github.com/user/repo.git <span class="built_in">dir</span>  <span class="comment"># 指定目录</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 克隆特定分支</span></span><br><span class="line">git <span class="built_in">clone</span> -b dev https://github.com/user/repo.git</span><br><span class="line"></span><br><span class="line"><span class="comment"># 提醒自己：</span></span><br><span class="line"><span class="comment"># - SSH 方式需要配置 SSH 密钥</span></span><br><span class="line"><span class="comment"># - HTTPS 方式每次可能需要输入密码</span></span><br></pre></td></tr></table></figure>

<h3 id="2-2-查看状态"><a href="#2-2-查看状态" class="headerlink" title="2.2 查看状态"></a>2.2 查看状态</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 查看仓库状态</span></span><br><span class="line">git status</span><br><span class="line">git status -s         <span class="comment"># 简洁模式</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 状态说明：</span></span><br><span class="line"><span class="comment"># ?? 未跟踪</span></span><br><span class="line"><span class="comment"># A  新增</span></span><br><span class="line"><span class="comment"># M  修改</span></span><br><span class="line"><span class="comment"># D  删除</span></span><br><span class="line"><span class="comment"># R  重命名</span></span><br></pre></td></tr></table></figure>

<h3 id="2-3-添加文件"><a href="#2-3-添加文件" class="headerlink" title="2.3 添加文件"></a>2.3 添加文件</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 添加到暂存区</span></span><br><span class="line">git add file.txt              <span class="comment"># 添加指定文件</span></span><br><span class="line">git add .                     <span class="comment"># 添加所有文件</span></span><br><span class="line">git add *.py                  <span class="comment"># 通配符</span></span><br><span class="line">git add -A                    <span class="comment"># 添加所有（包括删除）</span></span><br><span class="line">git add -p                    <span class="comment"># 交互式添加</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看暂存区内容</span></span><br><span class="line">git diff --staged             <span class="comment"># 已暂存的变更</span></span><br><span class="line">git diff --staged file.txt    <span class="comment"># 指定文件</span></span><br></pre></td></tr></table></figure>

<h3 id="2-4-提交"><a href="#2-4-提交" class="headerlink" title="2.4 提交"></a>2.4 提交</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 提交</span></span><br><span class="line">git commit -m <span class="string">&quot;提交信息&quot;</span></span><br><span class="line">git commit -m <span class="string">&quot;标题&quot;</span> -m <span class="string">&quot;详细描述&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 提交所有修改（跳过 add）</span></span><br><span class="line">git commit -am <span class="string">&quot;提交信息&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改最后一次提交</span></span><br><span class="line">git commit --amend -m <span class="string">&quot;新的提交信息&quot;</span></span><br><span class="line">git commit --amend --no-edit  <span class="comment"># 只添加遗漏的文件</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 提交时跳过 hooks</span></span><br><span class="line">git commit -m <span class="string">&quot;消息&quot;</span> --no-verify</span><br><span class="line"></span><br><span class="line"><span class="comment"># 提醒自己：</span></span><br><span class="line"><span class="comment"># - 提交信息要简洁明了</span></span><br><span class="line"><span class="comment"># - 一次提交只做一件事</span></span><br></pre></td></tr></table></figure>

<h3 id="2-5-查看历史"><a href="#2-5-查看历史" class="headerlink" title="2.5 查看历史"></a>2.5 查看历史</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 查看提交历史</span></span><br><span class="line">git <span class="built_in">log</span></span><br><span class="line">git <span class="built_in">log</span> --oneline             <span class="comment"># 简洁模式</span></span><br><span class="line">git <span class="built_in">log</span> --graph               <span class="comment"># 图形化</span></span><br><span class="line">git <span class="built_in">log</span> --graph --oneline --all  <span class="comment"># 完整图形</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定数量</span></span><br><span class="line">git <span class="built_in">log</span> -n 5</span><br><span class="line">git <span class="built_in">log</span> -5</span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定文件</span></span><br><span class="line">git <span class="built_in">log</span> -- file.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定作者</span></span><br><span class="line">git <span class="built_in">log</span> --author=<span class="string">&quot;张三&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定时间</span></span><br><span class="line">git <span class="built_in">log</span> --since=<span class="string">&quot;2 weeks ago&quot;</span></span><br><span class="line">git <span class="built_in">log</span> --<span class="keyword">until</span>=<span class="string">&quot;2024-01-01&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 格式化输出</span></span><br><span class="line">git <span class="built_in">log</span> --pretty=format:<span class="string">&quot;%h - %an - %s&quot;</span></span><br><span class="line">git <span class="built_in">log</span> --pretty=format:<span class="string">&quot;%Cred%h%Creset - %an - %s&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 常用格式占位符：</span></span><br><span class="line"><span class="comment"># %H 完整哈希  %h 短哈希</span></span><br><span class="line"><span class="comment"># %an 作者名   %ae 作者邮箱</span></span><br><span class="line"><span class="comment"># %ad 日期     %s 提交信息</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看某次提交的详情</span></span><br><span class="line">git show commit_hash</span><br></pre></td></tr></table></figure>

<h2 id="三、分支管理"><a href="#三、分支管理" class="headerlink" title="三、分支管理"></a>三、分支管理</h2><h3 id="3-1-分支基础"><a href="#3-1-分支基础" class="headerlink" title="3.1 分支基础"></a>3.1 分支基础</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 查看分支</span></span><br><span class="line">git branch                    <span class="comment"># 本地分支</span></span><br><span class="line">git branch -a                 <span class="comment"># 所有分支</span></span><br><span class="line">git branch -r                 <span class="comment"># 远程分支</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建分支</span></span><br><span class="line">git branch feature-login      <span class="comment"># 创建分支</span></span><br><span class="line">git branch feature-login abc123  <span class="comment"># 从指定提交创建</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 切换分支</span></span><br><span class="line">git checkout feature-login</span><br><span class="line">git switch feature-login      <span class="comment"># Git 2.23+ 推荐</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建并切换</span></span><br><span class="line">git checkout -b feature-login</span><br><span class="line">git switch -c feature-login   <span class="comment"># Git 2.23+</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除分支</span></span><br><span class="line">git branch -d feature-login   <span class="comment"># 安全删除（已合并）</span></span><br><span class="line">git branch -D feature-login   <span class="comment"># 强制删除（未合并）</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 重命名分支</span></span><br><span class="line">git branch -m old-name new-name</span><br><span class="line">git branch -m new-name        <span class="comment"># 重命名当前分支</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看分支合并情况</span></span><br><span class="line">git branch --merged           <span class="comment"># 已合并的分支</span></span><br><span class="line">git branch --no-merged        <span class="comment"># 未合并的分支</span></span><br></pre></td></tr></table></figure>

<h3 id="3-2-分支模型"><a href="#3-2-分支模型" class="headerlink" title="3.2 分支模型"></a>3.2 分支模型</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">main/master</span><br><span class="line">  ├── develop</span><br><span class="line">  │   ├── feature/login</span><br><span class="line">  │   ├── feature/register</span><br><span class="line">  │   └── feature/profile</span><br><span class="line">  ├── release/v1.0</span><br><span class="line">  └── hotfix/bug-fix</span><br></pre></td></tr></table></figure>

<p><strong>常用分支命名规范：</strong></p>
<ul>
<li><code>main</code> &#x2F; <code>master</code> - 主分支（生产环境）</li>
<li><code>develop</code> - 开发分支</li>
<li><code>feature/xxx</code> - 功能分支</li>
<li><code>bugfix/xxx</code> - 修复分支</li>
<li><code>hotfix/xxx</code> - 紧急修复分支</li>
<li><code>release/x.y</code> - 发布分支</li>
</ul>
<h3 id="3-3-合并分支"><a href="#3-3-合并分支" class="headerlink" title="3.3 合并分支"></a>3.3 合并分支</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 合并分支</span></span><br><span class="line">git checkout main</span><br><span class="line">git merge feature-login</span><br><span class="line"></span><br><span class="line"><span class="comment"># 合并类型：</span></span><br><span class="line"><span class="comment"># 1. Fast-forward（快进合并）- 没有分叉</span></span><br><span class="line"><span class="comment"># 2. Recursive（递归合并）- 有分叉，创建合并提交</span></span><br><span class="line"><span class="comment"># 3. Squash（压缩合并）- 多次提交合并为一次</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 压缩合并</span></span><br><span class="line">git merge --squash feature-login</span><br><span class="line">git commit -m <span class="string">&quot;添加登录功能&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 取消合并</span></span><br><span class="line">git merge --abort</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看合并冲突</span></span><br><span class="line">git status</span><br><span class="line">git diff</span><br><span class="line"></span><br><span class="line"><span class="comment"># 解决冲突后</span></span><br><span class="line">git add conflicted_file.txt</span><br><span class="line">git commit</span><br></pre></td></tr></table></figure>

<h3 id="3-4-解决冲突"><a href="#3-4-解决冲突" class="headerlink" title="3.4 解决冲突"></a>3.4 解决冲突</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 当发生冲突时，文件内容如下：</span></span><br><span class="line">&lt;&lt;&lt;&lt;&lt;&lt;&lt; <span class="string">HEAD</span></span><br><span class="line"><span class="string">这是当前分支的内容</span></span><br><span class="line"><span class="string">=======</span></span><br><span class="line"><span class="string">这是要合并分支的内容</span></span><br><span class="line"><span class="string">&gt;&gt;&gt;&gt;&gt;&gt;&gt; feature-branch</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 解决步骤：</span></span><br><span class="line"><span class="string"># 1. 编辑文件，保留需要的内容</span></span><br><span class="line"><span class="string"># 2. 删除冲突标记（&lt;&lt;&lt;&lt;&lt;&lt;，======，&gt;&gt;&gt;&gt;&gt;&gt;&gt;）</span></span><br><span class="line"><span class="string"># 3. git add 解决冲突的文件</span></span><br><span class="line"><span class="string"># 4. git commit 完成合并</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 使用工具解决冲突</span></span><br><span class="line"><span class="string">git mergetool                   # 使用配置的合并工具</span></span><br><span class="line"><span class="string">git difftool                    # 查看差异</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 配置合并工具</span></span><br><span class="line"><span class="string">git config --global merge.tool vimdiff</span></span><br><span class="line"><span class="string">git config --global merge.conflictstyle diff3</span></span><br></pre></td></tr></table></figure>

<h3 id="3-5-变基（Rebase）"><a href="#3-5-变基（Rebase）" class="headerlink" title="3.5 变基（Rebase）"></a>3.5 变基（Rebase）</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 变基操作</span></span><br><span class="line">git checkout feature</span><br><span class="line">git rebase main</span><br><span class="line"></span><br><span class="line"><span class="comment"># 交互式变基</span></span><br><span class="line">git rebase -i HEAD~5            <span class="comment"># 最近 5 次提交</span></span><br><span class="line">git rebase -i abc123            <span class="comment"># 从指定提交开始</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 交互式变基操作：</span></span><br><span class="line"><span class="comment"># pick   - 使用提交</span></span><br><span class="line"><span class="comment"># reword - 使用提交，修改信息</span></span><br><span class="line"><span class="comment"># edit   - 使用提交，暂停修改</span></span><br><span class="line"><span class="comment"># squash - 与前一个提交合并</span></span><br><span class="line"><span class="comment"># fixup  - 与前一个提交合并，丢弃信息</span></span><br><span class="line"><span class="comment"># drop   - 删除提交</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 继续/取消变基</span></span><br><span class="line">git rebase --<span class="built_in">continue</span></span><br><span class="line">git rebase --abort</span><br><span class="line"></span><br><span class="line"><span class="comment"># 提醒自己：</span></span><br><span class="line"><span class="comment"># - 不要对已推送到远程的提交进行变基</span></span><br><span class="line"><span class="comment"># - 变基会修改历史，需要谨慎使用</span></span><br></pre></td></tr></table></figure>

<h2 id="四、远程协作"><a href="#四、远程协作" class="headerlink" title="四、远程协作"></a>四、远程协作</h2><h3 id="4-1-远程仓库"><a href="#4-1-远程仓库" class="headerlink" title="4.1 远程仓库"></a>4.1 远程仓库</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 查看远程仓库</span></span><br><span class="line">git remote</span><br><span class="line">git remote -v</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加远程仓库</span></span><br><span class="line">git remote add origin https://github.com/user/repo.git</span><br><span class="line">git remote add upstream https://github.com/original/repo.git  <span class="comment"># 上游仓库</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 重命名远程仓库</span></span><br><span class="line">git remote rename origin upstream</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除远程仓库</span></span><br><span class="line">git remote remove origin</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取远程信息</span></span><br><span class="line">git fetch origin              <span class="comment"># 获取所有分支</span></span><br><span class="line">git fetch origin main         <span class="comment"># 获取指定分支</span></span><br><span class="line">git fetch --all               <span class="comment"># 获取所有远程仓库</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 拉取并合并</span></span><br><span class="line">git pull origin main</span><br><span class="line">git pull --rebase origin main  <span class="comment"># 拉取并变基</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 推送</span></span><br><span class="line">git push origin main</span><br><span class="line">git push -u origin main       <span class="comment"># 推送并设置上游</span></span><br><span class="line">git push --force              <span class="comment"># 强制推送（危险！）</span></span><br><span class="line">git push --force-with-lease   <span class="comment"># 安全强制推送</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除远程分支</span></span><br><span class="line">git push origin --delete feature-login</span><br><span class="line">git push origin :feature-login  <span class="comment"># 旧语法</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 提醒自己：</span></span><br><span class="line"><span class="comment"># - git fetch 只下载，不合并</span></span><br><span class="line"><span class="comment"># - git pull = git fetch + git merge</span></span><br><span class="line"><span class="comment"># - 强制推送前确保了解风险</span></span><br></pre></td></tr></table></figure>

<h3 id="4-2-SSH-密钥配置"><a href="#4-2-SSH-密钥配置" class="headerlink" title="4.2 SSH 密钥配置"></a>4.2 SSH 密钥配置</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 生成 SSH 密钥</span></span><br><span class="line">ssh-keygen -t ed25519 -C <span class="string">&quot;zhangsan@example.com&quot;</span></span><br><span class="line">ssh-keygen -t rsa -b 4096 -C <span class="string">&quot;zhangsan@example.com&quot;</span>  <span class="comment"># 旧算法</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看公钥</span></span><br><span class="line"><span class="built_in">cat</span> ~/.ssh/id_ed25519.pub</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加公钥到 GitHub/Gitee</span></span><br><span class="line"><span class="comment"># 复制公钥内容，添加到对应平台的 SSH Keys 设置</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 测试连接</span></span><br><span class="line">ssh -T git@github.com</span><br><span class="line">ssh -T git@gitee.com</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置多个 SSH 密钥</span></span><br><span class="line"><span class="comment"># ~/.ssh/config</span></span><br><span class="line">Host github.com</span><br><span class="line">    HostName github.com</span><br><span class="line">    User git</span><br><span class="line">    IdentityFile ~/.ssh/id_ed25519_github</span><br><span class="line"></span><br><span class="line">Host gitee.com</span><br><span class="line">    HostName gitee.com</span><br><span class="line">    User git</span><br><span class="line">    IdentityFile ~/.ssh/id_ed25519_gitee</span><br><span class="line"></span><br><span class="line"><span class="comment"># 提醒自己：</span></span><br><span class="line"><span class="comment"># - 私钥不能泄露</span></span><br><span class="line"><span class="comment"># - 公钥可以随意分享</span></span><br></pre></td></tr></table></figure>

<h3 id="4-3-标签管理"><a href="#4-3-标签管理" class="headerlink" title="4.3 标签管理"></a>4.3 标签管理</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 查看标签</span></span><br><span class="line">git tag</span><br><span class="line">git tag -l <span class="string">&quot;v1.*&quot;</span>             <span class="comment"># 模糊匹配</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建标签</span></span><br><span class="line">git tag v1.0.0                <span class="comment"># 轻量标签</span></span><br><span class="line">git tag -a v1.0.0 -m <span class="string">&quot;版本 1.0.0&quot;</span>  <span class="comment"># 附注标签（推荐）</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看标签详情</span></span><br><span class="line">git show v1.0.0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 推送标签</span></span><br><span class="line">git push origin v1.0.0</span><br><span class="line">git push origin --tags        <span class="comment"># 推送所有标签</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除标签</span></span><br><span class="line">git tag -d v1.0.0</span><br><span class="line">git push origin --delete v1.0.0  <span class="comment"># 删除远程标签</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 切换到标签</span></span><br><span class="line">git checkout v1.0.0</span><br></pre></td></tr></table></figure>

<h2 id="五、团队协作流程"><a href="#五、团队协作流程" class="headerlink" title="五、团队协作流程"></a>五、团队协作流程</h2><h3 id="5-1-Git-Flow-工作流"><a href="#5-1-Git-Flow-工作流" class="headerlink" title="5.1 Git Flow 工作流"></a>5.1 Git Flow 工作流</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">main/master (生产)</span><br><span class="line">  ↑</span><br><span class="line">  └── develop (开发)</span><br><span class="line">      ↑</span><br><span class="line">      ├── feature/login (功能)</span><br><span class="line">      ├── feature/register (功能)</span><br><span class="line">      │</span><br><span class="line">      └── release/v1.0 (发布)</span><br><span class="line">          ↑</span><br><span class="line">          └── hotfix/xxx (紧急修复)</span><br></pre></td></tr></table></figure>

<p><strong>Git Flow 流程：</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 1. 创建功能分支</span></span><br><span class="line">git checkout develop</span><br><span class="line">git checkout -b feature/login</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 开发并提交</span></span><br><span class="line">git add .</span><br><span class="line">git commit -m <span class="string">&quot;添加登录功能&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 同步主分支</span></span><br><span class="line">git fetch origin</span><br><span class="line">git rebase origin/develop</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. 完成功能，合并到 develop</span></span><br><span class="line">git checkout develop</span><br><span class="line">git merge --no-ff feature-login</span><br><span class="line">git branch -d feature-login</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5. 发布版本</span></span><br><span class="line">git checkout -b release/v1.0 develop</span><br><span class="line"><span class="comment"># 进行最后的调整和测试</span></span><br><span class="line">git checkout main</span><br><span class="line">git merge --no-ff release/v1.0</span><br><span class="line">git tag v1.0.0</span><br><span class="line">git checkout develop</span><br><span class="line">git merge --no-ff release/v1.0</span><br><span class="line">git branch -d release/v1.0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 6. 紧急修复</span></span><br><span class="line">git checkout -b hotfix/xxx main</span><br><span class="line"><span class="comment"># 修复 bug</span></span><br><span class="line">git checkout main</span><br><span class="line">git merge --no-ff hotfix/xxx</span><br><span class="line">git tag v1.0.1</span><br><span class="line">git checkout develop</span><br><span class="line">git merge --no-ff hotfix/xxx</span><br><span class="line">git branch -d hotfix/xxx</span><br></pre></td></tr></table></figure>

<h3 id="5-2-GitHub-Flow-工作流"><a href="#5-2-GitHub-Flow-工作流" class="headerlink" title="5.2 GitHub Flow 工作流"></a>5.2 GitHub Flow 工作流</h3><p>GitHub Flow 更简单，适合持续部署：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 1. 从 main 创建分支</span></span><br><span class="line">git checkout main</span><br><span class="line">git checkout -b feature-login</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 开发并提交</span></span><br><span class="line">git add .</span><br><span class="line">git commit -m <span class="string">&quot;添加登录功能&quot;</span></span><br><span class="line">git push -u origin feature-login</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 创建 Pull Request</span></span><br><span class="line"><span class="comment"># 在 GitHub/Gitee 网页上创建 PR</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. 代码审查</span></span><br><span class="line"><span class="comment"># 根据审查意见修改</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 5. 合并到 main</span></span><br><span class="line"><span class="comment"># PR 批准后合并</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 6. 部署</span></span><br><span class="line"><span class="comment"># 自动或手动部署</span></span><br></pre></td></tr></table></figure>

<h3 id="5-3-Pull-Request-Merge-Request-流程"><a href="#5-3-Pull-Request-Merge-Request-流程" class="headerlink" title="5.3 Pull Request &#x2F; Merge Request 流程"></a>5.3 Pull Request &#x2F; Merge Request 流程</h3><p><strong>创建 PR 的步骤：</strong></p>
<ol>
<li>Fork 仓库（如果是外部贡献）</li>
<li>克隆仓库：<code>git clone your-fork</code></li>
<li>创建功能分支：<code>git checkout -b feature-xxx</code></li>
<li>提交更改：<code>git commit -m &quot;描述&quot;</code></li>
<li>推送分支：<code>git push origin feature-xxx</code></li>
<li>在 GitHub&#x2F;Gitee 上创建 PR</li>
<li>等待审查，根据意见修改</li>
<li>PR 合并</li>
</ol>
<p><strong>PR 最佳实践：</strong></p>
<ul>
<li>标题简洁明了</li>
<li>描述说明更改内容和原因</li>
<li>一次 PR 只做一件事</li>
<li>确保 CI 测试通过</li>
<li>及时回复审查意见</li>
</ul>
<h3 id="5-4-提交信息规范"><a href="#5-4-提交信息规范" class="headerlink" title="5.4 提交信息规范"></a>5.4 提交信息规范</h3><p><strong>Conventional Commits 规范：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;type&gt;(&lt;scope&gt;): &lt;subject&gt;</span><br><span class="line"></span><br><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line">&lt;footer&gt;</span><br></pre></td></tr></table></figure>

<p><strong>Type 类型：</strong></p>
<ul>
<li><code>feat</code> - 新功能</li>
<li><code>fix</code> - 修复 bug</li>
<li><code>docs</code> - 文档更新</li>
<li><code>style</code> - 代码格式（不影响功能）</li>
<li><code>refactor</code> - 重构</li>
<li><code>perf</code> - 性能优化</li>
<li><code>test</code> - 测试相关</li>
<li><code>chore</code> - 构建&#x2F;工具&#x2F;配置</li>
<li><code>ci</code> - CI 配置</li>
<li><code>revert</code> - 回滚</li>
</ul>
<p><strong>示例：</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">feat(auth): 添加用户登录功能</span><br><span class="line"></span><br><span class="line">- 实现登录页面</span><br><span class="line">- 添加 JWT 认证</span><br><span class="line">- 添加记住登录功能</span><br><span class="line"></span><br><span class="line">Closes <span class="comment">#123</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">fix(api): 修复用户 API 的空指针异常</span><br><span class="line"></span><br><span class="line">当用户不存在时返回 404 而不是 500</span><br><span class="line"></span><br><span class="line">Fixes <span class="comment">#456</span></span><br></pre></td></tr></table></figure>

<h2 id="六、高级技巧"><a href="#六、高级技巧" class="headerlink" title="六、高级技巧"></a>六、高级技巧</h2><h3 id="6-1-暂存（Stash）"><a href="#6-1-暂存（Stash）" class="headerlink" title="6.1 暂存（Stash）"></a>6.1 暂存（Stash）</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 暂存当前更改</span></span><br><span class="line">git stash</span><br><span class="line">git stash save <span class="string">&quot;WIP: 登录功能&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看暂存列表</span></span><br><span class="line">git stash list</span><br><span class="line"></span><br><span class="line"><span class="comment"># 应用暂存</span></span><br><span class="line">git stash apply              <span class="comment"># 应用但不删除</span></span><br><span class="line">git stash apply stash@&#123;1&#125;    <span class="comment"># 应用指定暂存</span></span><br><span class="line">git stash pop                <span class="comment"># 应用并删除</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除暂存</span></span><br><span class="line">git stash drop</span><br><span class="line">git stash drop stash@&#123;1&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 清空所有暂存</span></span><br><span class="line">git stash clear</span><br><span class="line"></span><br><span class="line"><span class="comment"># 从暂存创建分支</span></span><br><span class="line">git stash branch feature-login stash@&#123;0&#125;</span><br></pre></td></tr></table></figure>

<h3 id="6-2-撤销操作"><a href="#6-2-撤销操作" class="headerlink" title="6.2 撤销操作"></a>6.2 撤销操作</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 撤销工作区修改</span></span><br><span class="line">git checkout -- file.txt</span><br><span class="line">git restore file.txt         <span class="comment"># Git 2.23+</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 撤销暂存</span></span><br><span class="line">git reset HEAD file.txt</span><br><span class="line">git restore --staged file.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># 撤销提交（保留更改）</span></span><br><span class="line">git reset --soft HEAD~1      <span class="comment"># 回退提交，保留暂存</span></span><br><span class="line">git reset --mixed HEAD~1     <span class="comment"># 回退提交，保留工作区（默认）</span></span><br><span class="line">git reset --hard HEAD~1      <span class="comment"># 完全回退（危险！）</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 撤销已推送的提交</span></span><br><span class="line">git revert commit_hash       <span class="comment"># 创建新的提交撤销更改</span></span><br><span class="line">git revert HEAD~3..HEAD      <span class="comment"># 撤销多个提交</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 提醒自己：</span></span><br><span class="line"><span class="comment"># - reset 会修改历史，revert 不会</span></span><br><span class="line"><span class="comment"># - 已推送的提交用 revert，不要用 reset</span></span><br></pre></td></tr></table></figure>

<h3 id="6-3-Cherry-pick"><a href="#6-3-Cherry-pick" class="headerlink" title="6.3 Cherry-pick"></a>6.3 Cherry-pick</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 拣选提交（将某提交应用到当前分支）</span></span><br><span class="line">git cherry-pick commit_hash</span><br><span class="line"></span><br><span class="line"><span class="comment"># 拣选多个提交</span></span><br><span class="line">git cherry-pick hash1 hash2 hash3</span><br><span class="line">git cherry-pick hash1..hash2   <span class="comment"># 范围</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 继续/跳过/中止</span></span><br><span class="line">git cherry-pick --<span class="built_in">continue</span></span><br><span class="line">git cherry-pick --skip</span><br><span class="line">git cherry-pick --abort</span><br><span class="line"></span><br><span class="line"><span class="comment"># 提醒自己：</span></span><br><span class="line"><span class="comment"># - 用于将特定提交从一个分支移到另一个分支</span></span><br><span class="line"><span class="comment"># - 会创建新的提交（哈希值不同）</span></span><br></pre></td></tr></table></figure>

<h3 id="6-4-子模块（Submodule）"><a href="#6-4-子模块（Submodule）" class="headerlink" title="6.4 子模块（Submodule）"></a>6.4 子模块（Submodule）</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 添加子模块</span></span><br><span class="line">git submodule add https://github.com/user/lib.git libs/mylib</span><br><span class="line"></span><br><span class="line"><span class="comment"># 初始化子模块</span></span><br><span class="line">git submodule init</span><br><span class="line">git submodule update</span><br><span class="line"></span><br><span class="line"><span class="comment"># 克隆带子模块的仓库</span></span><br><span class="line">git <span class="built_in">clone</span> --recursive https://github.com/user/repo.git</span><br><span class="line"></span><br><span class="line"><span class="comment"># 更新子模块</span></span><br><span class="line">git submodule update --remote</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除子模块</span></span><br><span class="line">git submodule deinit libs/mylib</span><br><span class="line">git <span class="built_in">rm</span> libs/mylib</span><br><span class="line"><span class="built_in">rm</span> -rf .git/modules/libs/mylib</span><br></pre></td></tr></table></figure>

<h3 id="6-5-Git-Hooks"><a href="#6-5-Git-Hooks" class="headerlink" title="6.5 Git Hooks"></a>6.5 Git Hooks</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Git hooks 位置：.git/hooks/</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 常用 hooks：</span></span><br><span class="line"><span class="comment"># pre-commit     - 提交前检查</span></span><br><span class="line"><span class="comment"># pre-push       - 推送前检查</span></span><br><span class="line"><span class="comment"># post-merge     - 合并后执行</span></span><br><span class="line"><span class="comment"># post-checkout  - 切换分支后执行</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 示例：pre-commit 检查代码风格</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="comment"># .git/hooks/pre-commit</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查是否有语法错误</span></span><br><span class="line">python -m py_compile $(git diff --cached --name-only --diff-filter=ACM | grep <span class="string">&#x27;\.py$&#x27;</span>)</span><br><span class="line"><span class="keyword">if</span> [ $? -ne 0 ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Python 语法检查失败&quot;</span></span><br><span class="line">    <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 运行 linter</span></span><br><span class="line">flake8 $(git diff --cached --name-only --diff-filter=ACM | grep <span class="string">&#x27;\.py$&#x27;</span>)</span><br><span class="line"><span class="keyword">if</span> [ $? -ne 0 ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;代码风格检查失败&quot;</span></span><br><span class="line">    <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<h2 id="七、最佳实践"><a href="#七、最佳实践" class="headerlink" title="七、最佳实践"></a>七、最佳实践</h2><blockquote>
<p><strong>提醒自己</strong>：</p>
<ol>
<li><strong>提交要频繁</strong>：小步提交，便于回滚和审查</li>
<li><strong>提交信息要清晰</strong>：说明做了什么和为什么</li>
<li><strong>分支命名要规范</strong>：feature&#x2F;xxx, bugfix&#x2F;xxx</li>
<li><strong>及时同步主分支</strong>：避免大的合并冲突</li>
<li><strong>代码审查要认真</strong>：及时回复，互相学习</li>
<li><strong>不要推送修改的历史</strong>：避免给别人造成困扰</li>
<li><strong>定期清理分支</strong>：删除已合并的分支</li>
<li><strong>使用.gitignore</strong>：不提交不必要的文件</li>
</ol>
</blockquote>
<h3 id="gitignore-模板"><a href="#gitignore-模板" class="headerlink" title=".gitignore 模板"></a>.gitignore 模板</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 操作系统</span><br><span class="line">.DS_Store</span><br><span class="line">Thumbs.db</span><br><span class="line"></span><br><span class="line"># IDE</span><br><span class="line">.vscode/</span><br><span class="line">.idea/</span><br><span class="line">*.swp</span><br><span class="line">*.swo</span><br><span class="line"></span><br><span class="line"># 依赖</span><br><span class="line">node_modules/</span><br><span class="line">vendor/</span><br><span class="line">__pycache__/</span><br><span class="line">*.pyc</span><br><span class="line"></span><br><span class="line"># 构建输出</span><br><span class="line">dist/</span><br><span class="line">build/</span><br><span class="line">*.o</span><br><span class="line">*.so</span><br><span class="line"></span><br><span class="line"># 日志</span><br><span class="line">*.log</span><br><span class="line">logs/</span><br><span class="line"></span><br><span class="line"># 环境配置</span><br><span class="line">.env</span><br><span class="line">.env.local</span><br><span class="line">.env.*.local</span><br><span class="line"></span><br><span class="line"># 敏感信息</span><br><span class="line">*.pem</span><br><span class="line">*.key</span><br><span class="line">secrets/</span><br><span class="line"></span><br><span class="line"># 数据</span><br><span class="line">*.db</span><br><span class="line">*.sqlite</span><br><span class="line">data/</span><br><span class="line"></span><br><span class="line"># 提醒自己：</span><br><span class="line"># - .gitignore 对已跟踪的文件无效</span><br><span class="line"># - 可以用 git rm -r --cached 清除缓存</span><br></pre></td></tr></table></figure>

<h2 id="八、练习"><a href="#八、练习" class="headerlink" title="八、练习"></a>八、练习</h2><ol>
<li>初始化一个 Git 仓库，创建并提交多个文件</li>
<li>创建功能分支，开发后合并到主分支</li>
<li>模拟并解决合并冲突</li>
<li>配置 SSH 密钥，推送到 GitHub&#x2F;Gitee</li>
<li>实践 Git Flow 或 GitHub Flow 工作流</li>
<li>使用 git rebase -i 整理提交历史</li>
<li>创建一个规范的 Pull Request</li>
</ol>
<hr>
<p><strong>上一篇</strong>：<a href="/2026/02/24/Linux-%E4%B8%8E-Shell%EF%BC%88%E4%BA%8C%EF%BC%89Shell-%E8%84%9A%E6%9C%AC%E7%BC%96%E5%86%99/">Linux 与 Shell（二）：Shell 脚本编写</a></p>
<p><strong>下一篇</strong>：<a href="/2026/02/24/IDE-%E5%B7%A5%E5%85%B7%E9%85%8D%E7%BD%AE/">IDE 工具配置：VS Code + Jupyter + DataGrip</a></p>
<p><strong>参考资源</strong>：</p>
<ul>
<li><a href="https://git-scm.com/doc">Git 官方文档</a></li>
<li><a href="https://git-scm.com/book/zh/v2">Pro Git 电子书（中文）</a></li>
<li><a href="https://nvie.com/posts/a-successful-git-branching-model/">Git Flow 工作流</a></li>
<li><a href="https://www.conventionalcommits.org/">Conventional Commits</a></li>
</ul>
]]></content>
      <categories>
        <category>系统与工具</category>
      </categories>
      <tags>
        <tag>Git</tag>
        <tag>版本控制</tag>
        <tag>团队协作</tag>
        <tag>开发流程</tag>
      </tags>
  </entry>
  <entry>
    <title>Linux 与 Shell（一）Linux 基础与常用命令</title>
    <url>/2026/02/24/Linux%20%E4%B8%8E%20Shell%EF%BC%88%E4%B8%80%EF%BC%89Linux%20%E5%9F%BA%E7%A1%80%E4%B8%8E%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/</url>
    <content><![CDATA[<h1 id="Linux-与-Shell（一）Linux-基础与常用命令"><a href="#Linux-与-Shell（一）Linux-基础与常用命令" class="headerlink" title="Linux 与 Shell（一）Linux 基础与常用命令"></a>Linux 与 Shell（一）Linux 基础与常用命令</h1><p>Linux 是服务器端最主流的操作系统。本篇将介绍 Linux 基础、常用命令、文件权限和进程管理，帮助你快速上手 Linux 系统操作。</p>
<h2 id="一、Linux-基础"><a href="#一、Linux-基础" class="headerlink" title="一、Linux 基础"></a>一、Linux 基础</h2><h3 id="1-1-Linux-简介"><a href="#1-1-Linux-简介" class="headerlink" title="1.1 Linux 简介"></a>1.1 Linux 简介</h3><p><strong>Linux</strong> 是一个开源、免费的操作系统内核，具有以下特点：</p>
<ul>
<li><strong>开源免费</strong>：源代码开放，可自由使用和修改</li>
<li><strong>多用户多任务</strong>：支持多个用户同时执行多个任务</li>
<li><strong>稳定可靠</strong>：服务器首选操作系统</li>
<li><strong>强大的命令行</strong>：Shell 提供强大的文本操作能力</li>
</ul>
<h3 id="1-2-常见-Linux-发行版"><a href="#1-2-常见-Linux-发行版" class="headerlink" title="1.2 常见 Linux 发行版"></a>1.2 常见 Linux 发行版</h3><table>
<thead>
<tr>
<th>发行版</th>
<th>特点</th>
<th>适用场景</th>
</tr>
</thead>
<tbody><tr>
<td>Ubuntu</td>
<td>易用、社区活跃</td>
<td>桌面、服务器</td>
</tr>
<tr>
<td>CentOS&#x2F;RHEL</td>
<td>稳定、企业支持</td>
<td>企业服务器</td>
</tr>
<tr>
<td>Debian</td>
<td>稳定、软件丰富</td>
<td>服务器</td>
</tr>
<tr>
<td>Fedora</td>
<td>新技术先行</td>
<td>开发测试</td>
</tr>
<tr>
<td>Alpine</td>
<td>轻量、安全</td>
<td>容器、嵌入式</td>
</tr>
</tbody></table>
<h3 id="1-3-目录结构"><a href="#1-3-目录结构" class="headerlink" title="1.3 目录结构"></a>1.3 目录结构</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/</span><br><span class="line">├── bin/          # 常用命令</span><br><span class="line">├── boot/         # 启动文件</span><br><span class="line">├── dev/          # 设备文件</span><br><span class="line">├── etc/          # 配置文件</span><br><span class="line">├── home/         # 用户主目录</span><br><span class="line">├── lib/          # 库文件</span><br><span class="line">├── media/        # 可移动媒体</span><br><span class="line">├── mnt/          # 挂载点</span><br><span class="line">├── opt/          # 可选软件包</span><br><span class="line">├── proc/         # 进程信息（虚拟文件系统）</span><br><span class="line">├── root/         # root 用户主目录</span><br><span class="line">├── run/          # 运行时数据</span><br><span class="line">├── sbin/         # 系统管理命令</span><br><span class="line">├── srv/          # 服务数据</span><br><span class="line">├── sys/          # 系统信息</span><br><span class="line">├── tmp/          # 临时文件</span><br><span class="line">├── usr/          # 用户程序</span><br><span class="line">├── var/          # 可变数据（日志、邮件等）</span><br><span class="line">└── var/log/      # 日志文件</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>提醒自己</strong>：</p>
<ul>
<li><code>/etc</code> 存放配置文件</li>
<li><code>/var/log</code> 存放日志文件</li>
<li><code>/home</code> 是普通用户的主目录</li>
<li><code>/root</code> 是 root 用户的主目录</li>
</ul>
</blockquote>
<h2 id="二、常用命令"><a href="#二、常用命令" class="headerlink" title="二、常用命令"></a>二、常用命令</h2><h3 id="2-1-文件与目录操作"><a href="#2-1-文件与目录操作" class="headerlink" title="2.1 文件与目录操作"></a>2.1 文件与目录操作</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#  pwd - 显示当前目录</span></span><br><span class="line"><span class="built_in">pwd</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  ls - 列出目录内容</span></span><br><span class="line"><span class="built_in">ls</span>                  <span class="comment"># 列出文件</span></span><br><span class="line"><span class="built_in">ls</span> -l               <span class="comment"># 详细信息</span></span><br><span class="line"><span class="built_in">ls</span> -la              <span class="comment"># 包括隐藏文件</span></span><br><span class="line"><span class="built_in">ls</span> -lh              <span class="comment"># 人类可读的文件大小</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  cd - 切换目录</span></span><br><span class="line"><span class="built_in">cd</span> /home            <span class="comment"># 切换到 /home</span></span><br><span class="line"><span class="built_in">cd</span> ..               <span class="comment"># 返回上级目录</span></span><br><span class="line"><span class="built_in">cd</span> ~                <span class="comment"># 回到主目录</span></span><br><span class="line"><span class="built_in">cd</span> -                <span class="comment"># 回到上一个目录</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  mkdir - 创建目录</span></span><br><span class="line"><span class="built_in">mkdir</span> mydir                     <span class="comment"># 创建单个目录</span></span><br><span class="line"><span class="built_in">mkdir</span> -p a/b/c                  <span class="comment"># 递归创建目录</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  touch - 创建空文件或更新时间戳</span></span><br><span class="line"><span class="built_in">touch</span> file.txt                  <span class="comment"># 创建空文件</span></span><br><span class="line"><span class="built_in">touch</span> file1 file2 file3         <span class="comment"># 创建多个文件</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  cp - 复制</span></span><br><span class="line"><span class="built_in">cp</span> source.txt dest.txt          <span class="comment"># 复制文件</span></span><br><span class="line"><span class="built_in">cp</span> -r dir1 dir2                 <span class="comment"># 递归复制目录</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  mv - 移动或重命名</span></span><br><span class="line"><span class="built_in">mv</span> old.txt new.txt              <span class="comment"># 重命名</span></span><br><span class="line"><span class="built_in">mv</span> file.txt /path/to/dir/       <span class="comment"># 移动文件</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  rm - 删除</span></span><br><span class="line"><span class="built_in">rm</span> file.txt                     <span class="comment"># 删除文件</span></span><br><span class="line"><span class="built_in">rm</span> -r <span class="built_in">dir</span>/                      <span class="comment"># 删除目录</span></span><br><span class="line"><span class="built_in">rm</span> -rf <span class="built_in">dir</span>/                     <span class="comment"># 强制删除（危险！）</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  ln - 创建链接</span></span><br><span class="line"><span class="built_in">ln</span> -s /path/to/target <span class="built_in">link</span>      <span class="comment"># 创建软链接</span></span><br><span class="line"><span class="built_in">ln</span> target <span class="built_in">link</span>                  <span class="comment"># 创建硬链接</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  提醒自己：</span></span><br><span class="line"><span class="comment">#  - rm -rf 非常危险，使用前务必确认路径</span></span><br><span class="line"><span class="comment">#  - 软链接类似 Windows 快捷方式</span></span><br><span class="line"><span class="comment">#  - 硬链接是同一个 inode 的不同名字</span></span><br></pre></td></tr></table></figure>

<h3 id="2-2-文件查看"><a href="#2-2-文件查看" class="headerlink" title="2.2 文件查看"></a>2.2 文件查看</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#  cat - 查看文件内容</span></span><br><span class="line"><span class="built_in">cat</span> file.txt                    <span class="comment"># 显示全部内容</span></span><br><span class="line"><span class="built_in">cat</span> -n file.txt                 <span class="comment"># 显示行号</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  less/more - 分页查看</span></span><br><span class="line">less large_file.log             <span class="comment"># 分页查看（可上下滚动）</span></span><br><span class="line"><span class="comment">#  操作：空格下翻，b 上翻，q 退出，/搜索</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  head/tail - 查看首尾</span></span><br><span class="line"><span class="built_in">head</span> file.txt                   <span class="comment"># 前 10 行</span></span><br><span class="line"><span class="built_in">head</span> -n 20 file.txt             <span class="comment"># 前 20 行</span></span><br><span class="line"><span class="built_in">tail</span> file.txt                   <span class="comment"># 后 10 行</span></span><br><span class="line"><span class="built_in">tail</span> -f file.log                <span class="comment"># 实时追踪日志（常用！）</span></span><br><span class="line"><span class="built_in">tail</span> -n 50 -f file.log          <span class="comment"># 追踪后 50 行</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  wc - 统计</span></span><br><span class="line"><span class="built_in">wc</span> file.txt                     <span class="comment"># 行数、单词数、字节数</span></span><br><span class="line"><span class="built_in">wc</span> -l file.txt                  <span class="comment"># 只统计行数</span></span><br><span class="line"><span class="built_in">wc</span> -w file.txt                  <span class="comment"># 只统计单词数</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  提醒自己：</span></span><br><span class="line"><span class="comment">#  - tail -f 是查看日志的神器</span></span><br><span class="line"><span class="comment">#  - 大文件不要用 cat，用 less</span></span><br></pre></td></tr></table></figure>

<h3 id="2-3-查找与搜索"><a href="#2-3-查找与搜索" class="headerlink" title="2.3 查找与搜索"></a>2.3 查找与搜索</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#  find - 查找文件</span></span><br><span class="line">find / -name <span class="string">&quot;filename&quot;</span>         <span class="comment"># 按名称查找</span></span><br><span class="line">find /home -name <span class="string">&quot;*.txt&quot;</span>        <span class="comment"># 按扩展名查找</span></span><br><span class="line">find . -<span class="built_in">type</span> f                  <span class="comment"># 查找所有文件</span></span><br><span class="line">find . -<span class="built_in">type</span> d                  <span class="comment"># 查找所有目录</span></span><br><span class="line">find . -size +100M              <span class="comment"># 大于 100M 的文件</span></span><br><span class="line">find . -mtime -7                <span class="comment"># 7 天内修改的文件</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  locate - 快速查找（使用数据库）</span></span><br><span class="line">locate filename                 <span class="comment"># 快速查找文件</span></span><br><span class="line">updatedb                        <span class="comment"># 更新数据库</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  grep - 文本搜索</span></span><br><span class="line">grep <span class="string">&quot;error&quot;</span> file.log           <span class="comment"># 搜索包含 error 的行</span></span><br><span class="line">grep -i <span class="string">&quot;error&quot;</span> file.log        <span class="comment"># 忽略大小写</span></span><br><span class="line">grep -r <span class="string">&quot;error&quot;</span> ./logs/         <span class="comment"># 递归搜索</span></span><br><span class="line">grep -n <span class="string">&quot;error&quot;</span> file.log        <span class="comment"># 显示行号</span></span><br><span class="line">grep -v <span class="string">&quot;info&quot;</span> file.log         <span class="comment"># 反向选择（不包含）</span></span><br><span class="line">grep -E <span class="string">&quot;err1|err2&quot;</span> file.log    <span class="comment"># 正则表达式</span></span><br><span class="line">grep -C 3 <span class="string">&quot;error&quot;</span> file.log      <span class="comment"># 显示匹配行及前后 3 行</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  提醒自己：</span></span><br><span class="line"><span class="comment">#  - find 实时搜索，locate 从数据库搜索（更快）</span></span><br><span class="line"><span class="comment">#  - grep 是日志分析的核心工具</span></span><br><span class="line"><span class="comment">#  - grep -C 可以查看上下文</span></span><br></pre></td></tr></table></figure>

<h3 id="2-4-压缩与解压"><a href="#2-4-压缩与解压" class="headerlink" title="2.4 压缩与解压"></a>2.4 压缩与解压</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#  tar - 打包/解包</span></span><br><span class="line">tar -cvf archive.tar file1 file2    <span class="comment"># 打包</span></span><br><span class="line">tar -xvf archive.tar                <span class="comment"># 解包</span></span><br><span class="line">tar -tzf archive.tar.gz             <span class="comment"># 查看内容</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  gzip - 压缩</span></span><br><span class="line">gzip file.txt                       <span class="comment"># 压缩成 file.txt.gz</span></span><br><span class="line">gunzip file.txt.gz                  <span class="comment"># 解压</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  组合使用（常见格式）</span></span><br><span class="line">tar -czvf archive.tar.gz <span class="built_in">dir</span>/       <span class="comment"># 打包并用 gzip 压缩</span></span><br><span class="line">tar -xzvf archive.tar.gz            <span class="comment"># 解压 gzip 压缩包</span></span><br><span class="line">tar -cjvf archive.tar.bz2 <span class="built_in">dir</span>/      <span class="comment"># 打包并用 bzip2 压缩</span></span><br><span class="line">tar -xjvf archive.tar.bz2           <span class="comment"># 解压 bzip2 压缩包</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  zip/unzip</span></span><br><span class="line">zip -r archive.zip <span class="built_in">dir</span>/             <span class="comment"># 压缩</span></span><br><span class="line">unzip archive.zip                   <span class="comment"># 解压</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  提醒自己：</span></span><br><span class="line"><span class="comment">#  - .tar 只是打包，没有压缩</span></span><br><span class="line"><span class="comment">#  - .tar.gz 或.tgz是最常见的格式</span></span><br><span class="line"><span class="comment">#  - -c 创建，-x 解压，-z gzip，-j bzip2，-v 详细，-f 文件</span></span><br></pre></td></tr></table></figure>

<h3 id="2-5-系统信息"><a href="#2-5-系统信息" class="headerlink" title="2.5 系统信息"></a>2.5 系统信息</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#  系统信息</span></span><br><span class="line"><span class="built_in">uname</span> -a                    <span class="comment"># 内核信息</span></span><br><span class="line">hostname                    <span class="comment"># 主机名</span></span><br><span class="line"><span class="built_in">uptime</span>                      <span class="comment"># 运行时间</span></span><br><span class="line"><span class="built_in">date</span>                        <span class="comment"># 当前时间</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  硬件信息</span></span><br><span class="line">free -h                     <span class="comment"># 内存使用</span></span><br><span class="line"><span class="built_in">df</span> -h                       <span class="comment"># 磁盘使用</span></span><br><span class="line"><span class="built_in">du</span> -sh */                   <span class="comment"># 目录大小</span></span><br><span class="line">top                         <span class="comment"># 实时进程</span></span><br><span class="line">htop                        <span class="comment"># 增强的 top（需安装）</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  CPU 信息</span></span><br><span class="line"><span class="built_in">cat</span> /proc/cpuinfo           <span class="comment"># CPU 详情</span></span><br><span class="line"><span class="built_in">nproc</span>                       <span class="comment"># CPU 核心数</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  提醒自己：</span></span><br><span class="line"><span class="comment">#  - free -h 查看内存最直观</span></span><br><span class="line"><span class="comment">#  - df -h 查看磁盘空间</span></span><br><span class="line"><span class="comment">#  - du -sh * 查看各目录占用</span></span><br></pre></td></tr></table></figure>

<h2 id="三、文件权限"><a href="#三、文件权限" class="headerlink" title="三、文件权限"></a>三、文件权限</h2><h3 id="3-1-权限基础"><a href="#3-1-权限基础" class="headerlink" title="3.1 权限基础"></a>3.1 权限基础</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#  查看权限</span></span><br><span class="line"><span class="built_in">ls</span> -l file.txt</span><br><span class="line"><span class="comment">#  输出：-rwxr-xr-- 1 user group 1234 Jan 1 12:00 file.txt</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  权限解析：</span></span><br><span class="line"><span class="comment">#  -：文件类型（-文件，d 目录，l 链接）</span></span><br><span class="line"><span class="comment">#  rwx：所有者权限</span></span><br><span class="line"><span class="comment">#  r-x：组权限</span></span><br><span class="line"><span class="comment">#  r--：其他人权限</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  权限数值：</span></span><br><span class="line"><span class="comment">#  r = 4, w = 2, x = 1, - = 0</span></span><br><span class="line"><span class="comment">#  rwx = 7, r-x = 5, r-- = 4, --- = 0</span></span><br></pre></td></tr></table></figure>

<h3 id="3-2-修改权限"><a href="#3-2-修改权限" class="headerlink" title="3.2 修改权限"></a>3.2 修改权限</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#  chmod - 修改权限</span></span><br><span class="line"><span class="built_in">chmod</span> 755 file.sh               <span class="comment"># rwxr-xr-x</span></span><br><span class="line"><span class="built_in">chmod</span> 644 file.txt              <span class="comment"># rw-r--r--</span></span><br><span class="line"><span class="built_in">chmod</span> +x script.sh              <span class="comment"># 添加执行权限</span></span><br><span class="line"><span class="built_in">chmod</span> -w file.txt               <span class="comment"># 移除写权限</span></span><br><span class="line"><span class="built_in">chmod</span> u+x,g+w,o-r file.txt      <span class="comment"># 分别设置</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  chown - 修改所有者</span></span><br><span class="line"><span class="built_in">chown</span> user file.txt             <span class="comment"># 修改所有者</span></span><br><span class="line"><span class="built_in">chown</span> user:group file.txt       <span class="comment"># 同时修改所有者和组</span></span><br><span class="line"><span class="built_in">chown</span> -R user:group <span class="built_in">dir</span>/        <span class="comment"># 递归修改</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  chgrp - 修改组</span></span><br><span class="line"><span class="built_in">chgrp</span> group file.txt            <span class="comment"># 修改所属组</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  提醒自己：</span></span><br><span class="line"><span class="comment">#  - 脚本文件通常需要 +x 执行权限</span></span><br><span class="line"><span class="comment">#  - 配置文件通常是 644</span></span><br><span class="line"><span class="comment">#  - 目录需要 x 权限才能进入</span></span><br></pre></td></tr></table></figure>

<h3 id="3-3-特殊权限"><a href="#3-3-特殊权限" class="headerlink" title="3.3 特殊权限"></a>3.3 特殊权限</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#  SUID - 执行时以所有者身份运行</span></span><br><span class="line"><span class="built_in">chmod</span> u+s /usr/bin/passwd</span><br><span class="line"><span class="comment">#  显示为：-rwsr-xr-x</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  SGID - 目录中创建的文件继承组</span></span><br><span class="line"><span class="built_in">chmod</span> g+s /shared/dir</span><br><span class="line"></span><br><span class="line"><span class="comment">#  Sticky Bit - 目录中只有所有者能删除自己的文件</span></span><br><span class="line"><span class="built_in">chmod</span> +t /tmp</span><br><span class="line"><span class="comment">#  显示为：drwxrwxrwt</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  提醒自己：</span></span><br><span class="line"><span class="comment">#  - SUID 有安全风险，谨慎使用</span></span><br><span class="line"><span class="comment">#  - /tmp 目录必须有 Sticky Bit</span></span><br></pre></td></tr></table></figure>

<h2 id="四、进程管理"><a href="#四、进程管理" class="headerlink" title="四、进程管理"></a>四、进程管理</h2><h3 id="4-1-查看进程"><a href="#4-1-查看进程" class="headerlink" title="4.1 查看进程"></a>4.1 查看进程</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#  ps - 进程快照</span></span><br><span class="line">ps aux                          <span class="comment"># 所有进程</span></span><br><span class="line">ps -ef | grep python            <span class="comment"># 查找 Python 进程</span></span><br><span class="line">ps aux --<span class="built_in">sort</span>=-%mem | <span class="built_in">head</span>      <span class="comment"># 内存占用前 10</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  top/htop - 实时进程</span></span><br><span class="line">top                             <span class="comment"># 实时查看</span></span><br><span class="line">htop                            <span class="comment"># 更友好的界面</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  pgrep - 按名称查找进程</span></span><br><span class="line">pgrep nginx                     <span class="comment"># 查找 nginx 进程</span></span><br><span class="line">pgrep -l python                 <span class="comment"># 显示进程名</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  提醒自己：</span></span><br><span class="line"><span class="comment">#  - ps aux 第一行是标题行</span></span><br><span class="line"><span class="comment">#  - %CPU 和 %MEM 是重要指标</span></span><br><span class="line"><span class="comment">#  - PID 是进程 ID</span></span><br></pre></td></tr></table></figure>

<h3 id="4-2-控制进程"><a href="#4-2-控制进程" class="headerlink" title="4.2 控制进程"></a>4.2 控制进程</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#  kill - 终止进程</span></span><br><span class="line"><span class="built_in">kill</span> 1234                       <span class="comment"># 发送 TERM 信号</span></span><br><span class="line"><span class="built_in">kill</span> -9 1234                    <span class="comment"># 强制终止（SIGKILL）</span></span><br><span class="line"><span class="built_in">kill</span> -15 1234                   <span class="comment"># 优雅终止（默认）</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  killall - 按名称终止</span></span><br><span class="line">killall nginx                   <span class="comment"># 终止所有 nginx 进程</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  pkill - 按模式终止</span></span><br><span class="line">pkill -f <span class="string">&quot;python app.py&quot;</span>        <span class="comment"># 终止匹配的命令</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  提醒自己：</span></span><br><span class="line"><span class="comment">#  - 先用 kill -15，不行再用 kill -9</span></span><br><span class="line"><span class="comment">#  - kill -9 可能留下残留资源</span></span><br></pre></td></tr></table></figure>

<h3 id="4-3-后台运行"><a href="#4-3-后台运行" class="headerlink" title="4.3 后台运行"></a>4.3 后台运行</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#  &amp; - 后台运行</span></span><br><span class="line"><span class="built_in">sleep</span> 100 &amp;                     <span class="comment"># 后台运行</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  jobs - 查看后台任务</span></span><br><span class="line"><span class="built_in">jobs</span></span><br><span class="line"><span class="built_in">jobs</span> -l                         <span class="comment"># 显示 PID</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  fg/bg - 切换前台/后台</span></span><br><span class="line"><span class="built_in">fg</span>                              <span class="comment"># 切换到前台</span></span><br><span class="line"><span class="built_in">fg</span> %1                           <span class="comment"># 切换到任务 1</span></span><br><span class="line">Ctrl+Z                          <span class="comment"># 挂起当前任务</span></span><br><span class="line"><span class="built_in">bg</span>                              <span class="comment"># 将挂起的任务放到后台</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  nohup - 不挂断运行</span></span><br><span class="line"><span class="built_in">nohup</span> python app.py &amp;           <span class="comment"># 退出终端后继续运行</span></span><br><span class="line"><span class="built_in">nohup</span> python app.py &gt; log.txt 2&gt;&amp;1 &amp;</span><br><span class="line"></span><br><span class="line"><span class="comment">#  提醒自己：</span></span><br><span class="line"><span class="comment">#  - 后台任务在终端关闭后会终止</span></span><br><span class="line"><span class="comment">#  - 长期运行的程序用 nohup 或 screen/tmux</span></span><br></pre></td></tr></table></figure>

<h3 id="4-4-计划任务"><a href="#4-4-计划任务" class="headerlink" title="4.4 计划任务"></a>4.4 计划任务</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#  crontab - 定时任务</span></span><br><span class="line">crontab -e                      <span class="comment"># 编辑定时任务</span></span><br><span class="line">crontab -l                      <span class="comment"># 查看定时任务</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  格式：分 时 日 月 周 命令</span></span><br><span class="line"><span class="comment">#  * * * * * command</span></span><br><span class="line"><span class="comment">#  │ │ │ │ │</span></span><br><span class="line"><span class="comment">#  │ │ │ │ └─ 星期 (0-7, 0 和 7 都是周日)</span></span><br><span class="line"><span class="comment">#  │ │ │ └─── 月份 (1-12)</span></span><br><span class="line"><span class="comment">#  │ │ └───── 日期 (1-31)</span></span><br><span class="line"><span class="comment">#  │ └─────── 小时 (0-23)</span></span><br><span class="line"><span class="comment">#  └───────── 分钟 (0-59)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  示例：</span></span><br><span class="line">* * * * * /path/to/every_minute.sh      <span class="comment"># 每分钟</span></span><br><span class="line">0 * * * * /path/to/every_hour.sh        <span class="comment"># 每小时</span></span><br><span class="line">0 0 * * * /path/to/every_day.sh         <span class="comment"># 每天零点</span></span><br><span class="line">0 0 * * 0 /path/to/every_week.sh        <span class="comment"># 每周日</span></span><br><span class="line">0 0 1 * * /path/to/every_month.sh       <span class="comment"># 每月 1 号</span></span><br><span class="line">*/5 * * * * /path/to/every_5min.sh      <span class="comment"># 每 5 分钟</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  systemctl - 系统服务</span></span><br><span class="line">systemctl status nginx                  <span class="comment"># 查看状态</span></span><br><span class="line">systemctl start nginx                   <span class="comment"># 启动</span></span><br><span class="line">systemctl stop nginx                    <span class="comment"># 停止</span></span><br><span class="line">systemctl restart nginx                 <span class="comment"># 重启</span></span><br><span class="line">systemctl <span class="built_in">enable</span> nginx                  <span class="comment"># 开机自启</span></span><br><span class="line">systemctl <span class="built_in">disable</span> nginx                 <span class="comment"># 禁用开机自启</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  提醒自己：</span></span><br><span class="line"><span class="comment">#  - crontab 编辑后自动生效</span></span><br><span class="line"><span class="comment">#  - 系统服务用 systemctl 管理</span></span><br></pre></td></tr></table></figure>

<h2 id="五、用户与组管理"><a href="#五、用户与组管理" class="headerlink" title="五、用户与组管理"></a>五、用户与组管理</h2><h3 id="5-1-用户管理"><a href="#5-1-用户管理" class="headerlink" title="5.1 用户管理"></a>5.1 用户管理</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#  添加用户</span></span><br><span class="line">useradd username                    <span class="comment"># 创建用户</span></span><br><span class="line">useradd -m username                 <span class="comment"># 创建并创建主目录</span></span><br><span class="line">passwd username                     <span class="comment"># 设置密码</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  修改用户</span></span><br><span class="line">usermod -aG groupname username      <span class="comment"># 添加到组</span></span><br><span class="line">usermod -s /bin/bash username       <span class="comment"># 修改 shell</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  删除用户</span></span><br><span class="line">userdel username                    <span class="comment"># 删除用户</span></span><br><span class="line">userdel -r username                 <span class="comment"># 删除用户和主目录</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  查看用户</span></span><br><span class="line"><span class="built_in">id</span> username                         <span class="comment"># 用户信息</span></span><br><span class="line"><span class="built_in">who</span>                                 <span class="comment"># 登录用户</span></span><br><span class="line">w                                   <span class="comment"># 登录用户及活动</span></span><br><span class="line">last                                <span class="comment"># 登录历史</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  提醒自己：</span></span><br><span class="line"><span class="comment">#  - usermod -aG 的-a很重要，否则用户会离开其他组</span></span><br></pre></td></tr></table></figure>

<h3 id="5-2-切换用户"><a href="#5-2-切换用户" class="headerlink" title="5.2 切换用户"></a>5.2 切换用户</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#  su - 切换用户</span></span><br><span class="line">su - username                       <span class="comment"># 切换为用户（带环境）</span></span><br><span class="line">su username                         <span class="comment"># 切换用户（不带环境）</span></span><br><span class="line">su -                                <span class="comment"># 切换到 root</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  sudo - 以其他用户执行命令</span></span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">command</span>                        <span class="comment"># 以 root 身份执行</span></span><br><span class="line"><span class="built_in">sudo</span> -u username <span class="built_in">command</span>            <span class="comment"># 以指定用户执行</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  配置 sudo 权限</span></span><br><span class="line">visudo                              <span class="comment"># 编辑 sudoers 文件</span></span><br><span class="line"><span class="comment">#  添加：username ALL=(ALL:ALL) ALL</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  提醒自己：</span></span><br><span class="line"><span class="comment">#  - su - 会加载目标用户的环境</span></span><br><span class="line"><span class="comment">#  - sudo 需要用户在 sudoers 中</span></span><br></pre></td></tr></table></figure>

<h2 id="六、网络命令"><a href="#六、网络命令" class="headerlink" title="六、网络命令"></a>六、网络命令</h2><h3 id="6-1-网络配置"><a href="#6-1-网络配置" class="headerlink" title="6.1 网络配置"></a>6.1 网络配置</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#  IP 地址</span></span><br><span class="line">ip addr show                        <span class="comment"># 显示 IP 地址</span></span><br><span class="line">ifconfig                            <span class="comment"># 旧命令（可能需安装）</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  路由</span></span><br><span class="line">ip route show                       <span class="comment"># 显示路由表</span></span><br><span class="line">route -n                            <span class="comment"># 旧命令</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  DNS</span></span><br><span class="line"><span class="built_in">cat</span> /etc/resolv.conf                <span class="comment"># 查看 DNS 配置</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  端口</span></span><br><span class="line">netstat -tulpn                      <span class="comment"># 监听端口</span></span><br><span class="line">ss -tulpn                           <span class="comment"># 新版替代命令</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  提醒自己：</span></span><br><span class="line"><span class="comment">#  - ss 比 netstat 更快</span></span><br><span class="line"><span class="comment">#  - -tulpn 显示 TCP/UDP 监听端口及进程</span></span><br></pre></td></tr></table></figure>

<h3 id="6-2-网络诊断"><a href="#6-2-网络诊断" class="headerlink" title="6.2 网络诊断"></a>6.2 网络诊断</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#  ping - 测试连通性</span></span><br><span class="line">ping google.com                     <span class="comment"># 持续 ping</span></span><br><span class="line">ping -c 4 google.com                <span class="comment"># ping 4 次</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  traceroute - 路由追踪</span></span><br><span class="line">traceroute google.com               <span class="comment"># Linux</span></span><br><span class="line">tracert google.com                  <span class="comment"># Windows</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  curl - HTTP 请求</span></span><br><span class="line">curl http://example.com             <span class="comment"># 获取页面</span></span><br><span class="line">curl -I http://example.com          <span class="comment"># 只获取响应头</span></span><br><span class="line">curl -o file.zip URL                <span class="comment"># 下载文件</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  wget - 下载工具</span></span><br><span class="line">wget http://example.com/file.zip    <span class="comment"># 下载</span></span><br><span class="line">wget -c file.zip                    <span class="comment"># 断点续传</span></span><br><span class="line">wget -r URL                         <span class="comment"># 递归下载</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  提醒自己：</span></span><br><span class="line"><span class="comment">#  - curl 更适合 API 测试</span></span><br><span class="line"><span class="comment">#  - wget 更适合下载大文件</span></span><br></pre></td></tr></table></figure>

<h2 id="七、实践建议"><a href="#七、实践建议" class="headerlink" title="七、实践建议"></a>七、实践建议</h2><blockquote>
<p><strong>提醒自己</strong>：</p>
<ol>
<li><strong>熟练使用 grep 和 find</strong>：这是最常用的命令</li>
<li><strong>学会查看日志</strong>：<code>/var/log/</code> 下有很多重要日志</li>
<li><strong>谨慎使用 rm -rf</strong>：删除前再三确认</li>
<li><strong>使用 Tab 补全</strong>：提高效率，减少拼写错误</li>
<li><strong>学会用 help 和 man</strong>：<code>command --help</code> 或<code>man command</code></li>
<li><strong>使用别名</strong>：在 <code>~/.bashrc</code> 中添加常用命令别名</li>
</ol>
</blockquote>
<h3 id="常用别名示例"><a href="#常用别名示例" class="headerlink" title="常用别名示例"></a>常用别名示例</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#  ~/.bashrc 或~/.bash_profile</span></span><br><span class="line"><span class="built_in">alias</span> ll=<span class="string">&#x27;ls -la&#x27;</span></span><br><span class="line"><span class="built_in">alias</span> gs=<span class="string">&#x27;git status&#x27;</span></span><br><span class="line"><span class="built_in">alias</span> gp=<span class="string">&#x27;git push&#x27;</span></span><br><span class="line"><span class="built_in">alias</span> ..=<span class="string">&#x27;cd ..&#x27;</span></span><br><span class="line"><span class="built_in">alias</span> ...=<span class="string">&#x27;cd ../..&#x27;</span></span><br><span class="line"><span class="built_in">alias</span> h=<span class="string">&#x27;history&#x27;</span></span><br></pre></td></tr></table></figure>

<h2 id="八、练习"><a href="#八、练习" class="headerlink" title="八、练习"></a>八、练习</h2><ol>
<li>创建目录结构：<code>project/{src,dist,docs}</code>，并在 src 下创建空文件</li>
<li>查找系统中所有大于 100MB 的文件</li>
<li>查看当前系统中内存占用最高的 5 个进程</li>
<li>设置一个定时任务，每天凌晨 2 点执行备份脚本</li>
<li>创建一个用户，并赋予 sudo 权限</li>
</ol>
<hr>
<p><strong>下一篇</strong>：<a href="/2026/02/24/Linux-%E4%B8%8E-Shell%EF%BC%88%E4%BA%8C%EF%BC%89Shell-%E8%84%9A%E6%9C%AC%E7%BC%96%E5%86%99/">Linux 与 Shell（二）：Shell 脚本编写</a></p>
<p><strong>参考资源</strong>：</p>
<ul>
<li><a href="https://linux-command.github.io/">Linux 命令行教程</a></li>
<li><a href="https://www.gnu.org/software/coreutils/manual/">GNU Coreutils 文档</a></li>
<li><a href="https://man7.org/linux/man-pages/">Linux  man 手册</a></li>
</ul>
]]></content>
      <categories>
        <category>系统与工具</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>Shell</tag>
        <tag>系统管理</tag>
        <tag>运维</tag>
      </tags>
  </entry>
  <entry>
    <title>IDE 工具配置：VS Code + Jupyter + DataGrip</title>
    <url>/2026/02/24/IDE%20%E5%B7%A5%E5%85%B7%E9%85%8D%E7%BD%AE%EF%BC%9AVS%20Code%20+%20Jupyter%20+%20DataGrip/</url>
    <content><![CDATA[<h1 id="IDE-工具配置：VS-Code-Jupyter-DataGrip"><a href="#IDE-工具配置：VS-Code-Jupyter-DataGrip" class="headerlink" title="IDE 工具配置：VS Code + Jupyter + DataGrip"></a>IDE 工具配置：VS Code + Jupyter + DataGrip</h1><p>工欲善其事，必先利其器。本篇将介绍三款常用的开发工具：VS Code（通用 IDE）、Jupyter Notebook（数据科学）和 DataGrip（数据库管理）。</p>
<h2 id="一、VS-Code"><a href="#一、VS-Code" class="headerlink" title="一、VS Code"></a>一、VS Code</h2><h3 id="1-1-简介与安装"><a href="#1-1-简介与安装" class="headerlink" title="1.1 简介与安装"></a>1.1 简介与安装</h3><p><strong>Visual Studio Code (VS Code)</strong> 是微软开发的免费开源代码编辑器，支持几乎所有主流编程语言。</p>
<p><strong>特点：</strong></p>
<ul>
<li>免费开源</li>
<li>跨平台（Windows、macOS、Linux）</li>
<li>丰富的插件生态</li>
<li>轻量快速</li>
<li>内置 Git 支持</li>
</ul>
<p><strong>下载安装：</strong></p>
<ul>
<li>官网：<a href="https://code.visualstudio.com/">https://code.visualstudio.com/</a></li>
<li>下载对应系统版本安装</li>
</ul>
<h3 id="1-2-基础配置"><a href="#1-2-基础配置" class="headerlink" title="1.2 基础配置"></a>1.2 基础配置</h3><figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="comment">// settings.json (文件 -&gt; 首选项 -&gt; 设置 -&gt; 点击右上角打开 settings.json)</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="comment">// 编辑器设置</span></span><br><span class="line">    <span class="attr">&quot;editor.fontSize&quot;</span><span class="punctuation">:</span> <span class="number">14</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;editor.fontFamily&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&#x27;JetBrains Mono&#x27;, &#x27;Fira Code&#x27;, Consolas, &#x27;Courier New&#x27;, monospace&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;editor.minimap.enabled&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;editor.renderWhitespace&quot;</span><span class="punctuation">:</span> <span class="string">&quot;selection&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;editor.formatOnSave&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;editor.tabSize&quot;</span><span class="punctuation">:</span> <span class="number">4</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;editor.insertSpaces&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;editor.wordWrap&quot;</span><span class="punctuation">:</span> <span class="string">&quot;on&quot;</span><span class="punctuation">,</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 文件设置</span></span><br><span class="line">    <span class="attr">&quot;files.encoding&quot;</span><span class="punctuation">:</span> <span class="string">&quot;utf8&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;files.eol&quot;</span><span class="punctuation">:</span> <span class="string">&quot;\n&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;files.autoSave&quot;</span><span class="punctuation">:</span> <span class="string">&quot;afterDelay&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;files.autoSaveDelay&quot;</span><span class="punctuation">:</span> <span class="number">1000</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;files.exclude&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;**/.git&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;**/.svn&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;**/.hg&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;**/node_modules&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;**/__pycache__&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;**/*.pyc&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 终端设置</span></span><br><span class="line">    <span class="attr">&quot;terminal.integrated.defaultProfile.windows&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Git Bash&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;terminal.integrated.fontSize&quot;</span><span class="punctuation">:</span> <span class="number">13</span><span class="punctuation">,</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 工作台设置</span></span><br><span class="line">    <span class="attr">&quot;workbench.colorTheme&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Default Dark+&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;workbench.iconTheme&quot;</span><span class="punctuation">:</span> <span class="string">&quot;material-icon-theme&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;workbench.statusBar.visible&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;workbench.activityBar.visible&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Python 设置</span></span><br><span class="line">    <span class="attr">&quot;python.defaultInterpreterPath&quot;</span><span class="punctuation">:</span> <span class="string">&quot;python&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;python.linting.enabled&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;python.linting.pylintEnabled&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;python.formatting.provider&quot;</span><span class="punctuation">:</span> <span class="string">&quot;black&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;python.formatting.blackPath&quot;</span><span class="punctuation">:</span> <span class="string">&quot;black&quot;</span><span class="punctuation">,</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Git 设置</span></span><br><span class="line">    <span class="attr">&quot;git.autorefresh&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;git.enableSmartCommit&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;git.confirmSync&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;git.pruneOnFetch&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="1-3-必备插件"><a href="#1-3-必备插件" class="headerlink" title="1.3 必备插件"></a>1.3 必备插件</h3><p><strong>通用插件：</strong></p>
<table>
<thead>
<tr>
<th>插件名</th>
<th>用途</th>
</tr>
</thead>
<tbody><tr>
<td>Chinese (Simplified)</td>
<td>中文语言包</td>
</tr>
<tr>
<td>Material Icon Theme</td>
<td>文件图标美化</td>
</tr>
<tr>
<td>One Dark Pro &#x2F; Dracula</td>
<td>主题</td>
</tr>
<tr>
<td>Prettier - Code formatter</td>
<td>代码格式化</td>
</tr>
<tr>
<td>ESLint</td>
<td>JavaScript 语法检查</td>
</tr>
<tr>
<td>GitLens</td>
<td>Git 增强</td>
</tr>
<tr>
<td>Path Intellisense</td>
<td>路径自动补全</td>
</tr>
<tr>
<td>Bracket Pair Colorizer</td>
<td>括号颜色配对</td>
</tr>
<tr>
<td>Settings Sync</td>
<td>配置同步</td>
</tr>
</tbody></table>
<p><strong>Python 开发：</strong></p>
<table>
<thead>
<tr>
<th>插件名</th>
<th>用途</th>
</tr>
</thead>
<tbody><tr>
<td>Python (Microsoft)</td>
<td>Python 支持</td>
</tr>
<tr>
<td>Pylance</td>
<td>Python 语言服务器</td>
</tr>
<tr>
<td>Jupyter</td>
<td>Jupyter Notebook 支持</td>
</tr>
<tr>
<td>Python Indent</td>
<td>Python 缩进优化</td>
</tr>
<tr>
<td>autoDocstring</td>
<td>自动生成文档字符串</td>
</tr>
</tbody></table>
<p><strong>Web 开发：</strong></p>
<table>
<thead>
<tr>
<th>插件名</th>
<th>用途</th>
</tr>
</thead>
<tbody><tr>
<td>Live Server</td>
<td>本地服务器</td>
</tr>
<tr>
<td>Auto Rename Tag</td>
<td>自动重命名 HTML 标签</td>
</tr>
<tr>
<td>CSS Peek</td>
<td>CSS 定义跳转</td>
</tr>
<tr>
<td>JavaScript (ES6) code snippets</td>
<td>JS 代码片段</td>
</tr>
<tr>
<td>Vue Language Features</td>
<td>Vue 支持</td>
</tr>
<tr>
<td>Vetur</td>
<td>Vue 2 支持</td>
</tr>
</tbody></table>
<p><strong>其他语言：</strong></p>
<table>
<thead>
<tr>
<th>插件名</th>
<th>用途</th>
</tr>
</thead>
<tbody><tr>
<td>C&#x2F;C++ (Microsoft)</td>
<td>C&#x2F;C++ 支持</td>
</tr>
<tr>
<td>Go (Go Team at Google)</td>
<td>Go 支持</td>
</tr>
<tr>
<td>Rust Analyzer</td>
<td>Rust 支持</td>
</tr>
<tr>
<td>Java Extension Pack</td>
<td>Java 支持</td>
</tr>
</tbody></table>
<h3 id="1-4-快捷键"><a href="#1-4-快捷键" class="headerlink" title="1.4 快捷键"></a>1.4 快捷键</h3><p><strong>常用快捷键（Windows）：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Ctrl + P          快速打开文件</span><br><span class="line">Ctrl + Shift + P  命令面板</span><br><span class="line">Ctrl + `          打开终端</span><br><span class="line">Ctrl + S          保存</span><br><span class="line">Ctrl + Z          撤销</span><br><span class="line">Ctrl + Y          重做</span><br><span class="line">Ctrl + F          查找</span><br><span class="line">Ctrl + H          替换</span><br><span class="line">Ctrl + /          行注释</span><br><span class="line">Ctrl + Shift + /  块注释</span><br><span class="line">Alt + Up/Down     移动行</span><br><span class="line">Shift + Alt + Up/Down  复制行</span><br><span class="line">F12               跳转到定义</span><br><span class="line">Alt + F12         查看定义</span><br><span class="line">Shift + F12       查看引用</span><br><span class="line">Ctrl + D          选择下一个匹配项</span><br><span class="line">Ctrl + Shift + L  选择所有匹配项</span><br><span class="line">Ctrl + K, Ctrl + S  查看快捷键列表</span><br></pre></td></tr></table></figure>

<p><strong>自定义快捷键（keybindings.json）：</strong></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;key&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ctrl+s&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;command&quot;</span><span class="punctuation">:</span> <span class="string">&quot;workbench.action.files.save&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;key&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ctrl+/&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;command&quot;</span><span class="punctuation">:</span> <span class="string">&quot;editor.action.commentLine&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;when&quot;</span><span class="punctuation">:</span> <span class="string">&quot;editorTextFocus&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;key&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ctrl+`&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;command&quot;</span><span class="punctuation">:</span> <span class="string">&quot;workbench.action.terminal.toggleTerminal&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">]</span></span><br></pre></td></tr></table></figure>

<h3 id="1-5-代码片段（Snippets）"><a href="#1-5-代码片段（Snippets）" class="headerlink" title="1.5 代码片段（Snippets）"></a>1.5 代码片段（Snippets）</h3><p><strong>创建自定义代码片段：</strong><br>文件 -&gt; 首选项 -&gt; 配置用户代码片段</p>
<p><strong>Python 代码片段示例：</strong></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;Python Main&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;prefix&quot;</span><span class="punctuation">:</span> <span class="string">&quot;main&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;body&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">            <span class="string">&quot;if __name__ == &#x27;__main__&#x27;:&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;    $&#123;0&#125;&quot;</span></span><br><span class="line">        <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Python main 入口&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;Python Class&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;prefix&quot;</span><span class="punctuation">:</span> <span class="string">&quot;class&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;body&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">            <span class="string">&quot;class $&#123;1:ClassName&#125;:&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;    \&quot;\&quot;\&quot;$&#123;2:类描述&#125;\&quot;\&quot;\&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;    &quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;    def __init__(self, $&#123;3:args&#125;):&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;        self.$&#123;3&#125; = $&#123;3&#125;&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;    &quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;    def $&#123;4:method&#125;(self):&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;        $&#123;0&#125;&quot;</span></span><br><span class="line">        <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Python 类模板&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;Python Function&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;prefix&quot;</span><span class="punctuation">:</span> <span class="string">&quot;def&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;body&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">            <span class="string">&quot;def $&#123;1:function_name&#125;($&#123;2:args&#125;):&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;    \&quot;\&quot;\&quot;$&#123;3:函数描述&#125;\&quot;\&quot;\&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;    $&#123;0&#125;&quot;</span></span><br><span class="line">        <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Python 函数模板&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="1-6-调试配置"><a href="#1-6-调试配置" class="headerlink" title="1.6 调试配置"></a>1.6 调试配置</h3><p><strong>launch.json 示例：</strong></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0.2.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;configurations&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Python: 当前文件&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;python&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;request&quot;</span><span class="punctuation">:</span> <span class="string">&quot;launch&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;program&quot;</span><span class="punctuation">:</span> <span class="string">&quot;$&#123;file&#125;&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;console&quot;</span><span class="punctuation">:</span> <span class="string">&quot;integratedTerminal&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;justMyCode&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Python: 带参数&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;python&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;request&quot;</span><span class="punctuation">:</span> <span class="string">&quot;launch&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;program&quot;</span><span class="punctuation">:</span> <span class="string">&quot;$&#123;file&#125;&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;console&quot;</span><span class="punctuation">:</span> <span class="string">&quot;integratedTerminal&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;args&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;--arg1&quot;</span><span class="punctuation">,</span> <span class="string">&quot;value1&quot;</span><span class="punctuation">,</span> <span class="string">&quot;--arg2&quot;</span><span class="punctuation">,</span> <span class="string">&quot;value2&quot;</span><span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Python: Django&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;python&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;request&quot;</span><span class="punctuation">:</span> <span class="string">&quot;launch&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;program&quot;</span><span class="punctuation">:</span> <span class="string">&quot;$&#123;workspaceFolder&#125;/manage.py&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;console&quot;</span><span class="punctuation">:</span> <span class="string">&quot;integratedTerminal&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;args&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="string">&quot;runserver&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;--noreload&quot;</span></span><br><span class="line">            <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;django&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Python: Flask&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;python&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;request&quot;</span><span class="punctuation">:</span> <span class="string">&quot;launch&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;module&quot;</span><span class="punctuation">:</span> <span class="string">&quot;flask&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;env&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;FLASK_APP&quot;</span><span class="punctuation">:</span> <span class="string">&quot;app.py&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;FLASK_ENV&quot;</span><span class="punctuation">:</span> <span class="string">&quot;development&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;FLASK_DEBUG&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;args&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="string">&quot;run&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;--no-debugger&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;--no-reload&quot;</span></span><br><span class="line">            <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;jinja&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="二、Jupyter-Notebook"><a href="#二、Jupyter-Notebook" class="headerlink" title="二、Jupyter Notebook"></a>二、Jupyter Notebook</h2><h3 id="2-1-简介与安装"><a href="#2-1-简介与安装" class="headerlink" title="2.1 简介与安装"></a>2.1 简介与安装</h3><p><strong>Jupyter Notebook</strong> 是一个开源的 Web 应用程序，支持创建和共享包含实时代码、公式、可视化和叙述性文本的文档。</p>
<p><strong>适用场景：</strong></p>
<ul>
<li>数据清洗和转换</li>
<li>数值模拟</li>
<li>统计建模</li>
<li>数据可视化</li>
<li>机器学习</li>
</ul>
<p><strong>安装方式：</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 方式一：pip 安装</span></span><br><span class="line">pip install jupyter</span><br><span class="line">pip install notebook</span><br><span class="line"></span><br><span class="line"><span class="comment"># 方式二：conda 安装（推荐）</span></span><br><span class="line">conda install jupyter notebook</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动 Jupyter</span></span><br><span class="line">jupyter notebook</span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定端口</span></span><br><span class="line">jupyter notebook --port 8889</span><br><span class="line"></span><br><span class="line"><span class="comment"># 允许远程访问</span></span><br><span class="line">jupyter notebook --ip=0.0.0.0 --port=8888 --no-browser</span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成配置文件</span></span><br><span class="line">jupyter notebook --generate-config</span><br></pre></td></tr></table></figure>

<h3 id="2-2-JupyterLab"><a href="#2-2-JupyterLab" class="headerlink" title="2.2 JupyterLab"></a>2.2 JupyterLab</h3><p><strong>JupyterLab</strong> 是新一代的 Jupyter 界面，更强大更灵活。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 安装</span></span><br><span class="line">pip install jupyterlab</span><br><span class="line">conda install jupyterlab</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动</span></span><br><span class="line">jupyter lab</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装插件</span></span><br><span class="line">jupyter labextension install @jupyterlab/git</span><br></pre></td></tr></table></figure>

<h3 id="2-3-基本使用"><a href="#2-3-基本使用" class="headerlink" title="2.3 基本使用"></a>2.3 基本使用</h3><p><strong>Notebook 界面元素：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">菜单栏：File, Edit, View, Insert, Cell, Kernel, Help</span><br><span class="line">工具栏：保存、添加单元格、剪切、复制、粘贴、移动、运行、停止</span><br><span class="line">单元格类型：Code（代码）、Markdown（文本）、Raw NBConvert（原始文本）</span><br></pre></td></tr></table></figure>

<p><strong>常用操作：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Esc          进入命令模式</span><br><span class="line">Enter        进入编辑模式</span><br><span class="line">A            在上方插入单元格</span><br><span class="line">B            在下方插入单元格</span><br><span class="line">M            转为 Markdown 单元格</span><br><span class="line">Y            转为 Code 单元格</span><br><span class="line">D, D         删除单元格</span><br><span class="line">Z            撤销删除</span><br><span class="line">C            复制单元格</span><br><span class="line">V            粘贴单元格</span><br><span class="line">X            剪切单元格</span><br><span class="line">Shift + V    粘贴到上方</span><br><span class="line">Shift + Enter 运行并跳到下一个</span><br><span class="line">Ctrl + Enter 运行当前单元格</span><br><span class="line">Alt + Enter  运行并在下方插入新单元格</span><br><span class="line">1, 2, 3...   设置为对应级别的标题</span><br></pre></td></tr></table></figure>

<h3 id="2-4-Markdown-单元格"><a href="#2-4-Markdown-单元格" class="headerlink" title="2.4 Markdown 单元格"></a>2.4 Markdown 单元格</h3><figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line"><span class="section"># 一级标题</span></span><br><span class="line"><span class="section">## 二级标题</span></span><br><span class="line"><span class="section">### 三级标题</span></span><br><span class="line"></span><br><span class="line"><span class="strong">**粗体文本**</span></span><br><span class="line"><span class="emphasis">*斜体文本*</span></span><br><span class="line">~~删除线~~</span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> 无序列表项 1</span><br><span class="line"><span class="bullet">-</span> 无序列表项 2</span><br><span class="line"></span><br><span class="line"><span class="bullet">1.</span> 有序列表项 1</span><br><span class="line"><span class="bullet">2.</span> 有序列表项 2</span><br><span class="line"></span><br><span class="line">[<span class="string">链接文本</span>](<span class="link">https://example.com</span>)</span><br><span class="line"></span><br><span class="line">![<span class="string">图片描述</span>](<span class="link">image.png</span>)</span><br><span class="line"></span><br><span class="line"><span class="quote">&gt; 引用文本</span></span><br><span class="line"></span><br><span class="line"><span class="code">`行内代码`</span></span><br><span class="line"></span><br><span class="line"><span class="code">```python</span></span><br><span class="line"><span class="code"># 代码块</span></span><br><span class="line"><span class="code">def hello():</span></span><br><span class="line"><span class="code">    print(&quot;Hello, World!&quot;)</span></span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>表头 1</th>
<th>表头 2</th>
<th>表头 3</th>
</tr>
</thead>
<tbody><tr>
<td>单元格</td>
<td>单元格</td>
<td>单元格</td>
</tr>
</tbody></table>
<p>$E &#x3D; mc^2$  # LaTeX 公式</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">### 2.5 常用魔法命令</span><br><span class="line"></span><br><span class="line">```python</span><br><span class="line"># 魔法命令（Magic Commands）</span><br><span class="line"></span><br><span class="line"># 时间相关</span><br><span class="line">%timeit result = sum(range(1000))      # 测量执行时间</span><br><span class="line">%time result = sum(range(1000000))     # 单次执行时间</span><br><span class="line"></span><br><span class="line"># 系统命令</span><br><span class="line">!ls -la                                # 执行 shell 命令</span><br><span class="line">!pip install package                   # 安装包</span><br><span class="line">!python script.py                      # 运行 Python 脚本</span><br><span class="line"></span><br><span class="line"># 工作目录</span><br><span class="line">%pwd                                   # 当前目录</span><br><span class="line">%ls                                    # 列出文件</span><br><span class="line">%cd /path/to/dir                       # 切换目录</span><br><span class="line"></span><br><span class="line"># 变量和状态</span><br><span class="line">%who                                   # 显示变量</span><br><span class="line">%whos                                  # 显示变量详情</span><br><span class="line">%env                                   # 显示环境变量</span><br><span class="line"></span><br><span class="line"># 代码执行</span><br><span class="line">%run script.py                         # 运行脚本</span><br><span class="line">%load script.py                        # 加载脚本到单元格</span><br><span class="line">%edit                                  # 打开编辑器</span><br><span class="line"></span><br><span class="line"># 调试</span><br><span class="line">%debug                                 # 进入调试模式</span><br><span class="line">%pdb                                   # 异常时自动调试</span><br><span class="line"></span><br><span class="line"># 其他</span><br><span class="line">%matplotlib inline                     # 内嵌显示 matplotlib 图表</span><br><span class="line">%config InlineBackend.figure_format = &#x27;retina&#x27;  # 高清图表</span><br></pre></td></tr></table></figure>

<h3 id="2-6-数据科学插件"><a href="#2-6-数据科学插件" class="headerlink" title="2.6 数据科学插件"></a>2.6 数据科学插件</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 安装常用数据科学库</span></span><br><span class="line">pip install numpy pandas matplotlib seaborn scikit-learn jupyter</span><br><span class="line"></span><br><span class="line"><span class="comment"># 导入</span></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> seaborn <span class="keyword">as</span> sns</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置中文字体</span></span><br><span class="line">plt.rcParams[<span class="string">&#x27;font.sans-serif&#x27;</span>] = [<span class="string">&#x27;SimHei&#x27;</span>, <span class="string">&#x27;Arial Unicode MS&#x27;</span>, <span class="string">&#x27;DejaVu Sans&#x27;</span>]</span><br><span class="line">plt.rcParams[<span class="string">&#x27;axes.unicode_minus&#x27;</span>] = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置图表样式</span></span><br><span class="line">sns.set_style(<span class="string">&quot;whitegrid&quot;</span>)</span><br><span class="line">plt.rcParams[<span class="string">&#x27;figure.figsize&#x27;</span>] = (<span class="number">12</span>, <span class="number">8</span>)</span><br></pre></td></tr></table></figure>

<h3 id="2-7-实用技巧"><a href="#2-7-实用技巧" class="headerlink" title="2.7 实用技巧"></a>2.7 实用技巧</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 1. 使用帮助</span></span><br><span class="line">?pd.read_csv           <span class="comment"># 查看函数文档</span></span><br><span class="line">pd.read_csv?           <span class="comment"># 同上</span></span><br><span class="line">??pd.read_csv          <span class="comment"># 查看源码</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 自动补全</span></span><br><span class="line"><span class="comment"># 输入对象名后按 Tab 键</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 对象信息</span></span><br><span class="line"><span class="built_in">dir</span>(<span class="built_in">object</span>)            <span class="comment"># 列出所有属性和方法</span></span><br><span class="line"><span class="built_in">type</span>(<span class="built_in">object</span>)           <span class="comment"># 查看类型</span></span><br><span class="line"><span class="built_in">help</span>(<span class="built_in">object</span>)           <span class="comment"># 查看帮助</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. 魔法命令自动补全</span></span><br><span class="line"><span class="comment"># 输入%后按 Tab</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 5. 笔记本书签</span></span><br><span class="line"><span class="comment"># 在 URL 中添加 #cellid=xxx 可以跳转到指定单元格</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 6. 导出为其他格式</span></span><br><span class="line"><span class="comment"># File -&gt; Download as -&gt; PDF/HTML/Python Script</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 7. 使用模板</span></span><br><span class="line"><span class="comment"># jupyter nbconvert --to slides notebook.ipynb</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 8. 隐藏代码/输出</span></span><br><span class="line"><span class="comment"># 在单元格开头添加：</span></span><br><span class="line"><span class="comment"># %hide_input</span></span><br><span class="line"><span class="comment"># %hide_output</span></span><br></pre></td></tr></table></figure>

<h3 id="2-8-扩展插件"><a href="#2-8-扩展插件" class="headerlink" title="2.8 扩展插件"></a>2.8 扩展插件</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 安装 Jupyter Notebook 扩展</span></span><br><span class="line">pip install jupyter_contrib_nbextensions</span><br><span class="line">jupyter contrib nbextension install --user</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装 JupyterLab 扩展</span></span><br><span class="line">pip install jupyterlab-git</span><br><span class="line">pip install @jupyterlab/toc  <span class="comment"># 目录</span></span><br><span class="line">pip install @jupyterlab/celltags  <span class="comment"># 单元格标签</span></span><br><span class="line">pip install jupyterlab-code-formatter  <span class="comment"># 代码格式化</span></span><br></pre></td></tr></table></figure>

<p><strong>常用扩展：</strong></p>
<ul>
<li>Table of Contents (toc2) - 目录</li>
<li>Code Prettify - 代码格式化</li>
<li>Hide Input&#x2F;Output - 隐藏输入输出</li>
<li>ExecuteTime - 显示执行时间</li>
<li>Variable Inspector - 变量检查器</li>
<li>Spellchecker - 拼写检查</li>
</ul>
<h2 id="三、DataGrip"><a href="#三、DataGrip" class="headerlink" title="三、DataGrip"></a>三、DataGrip</h2><h3 id="3-1-简介与安装"><a href="#3-1-简介与安装" class="headerlink" title="3.1 简介与安装"></a>3.1 简介与安装</h3><p><strong>DataGrip</strong> 是 JetBrains 出品的专业数据库管理工具，支持多种数据库。</p>
<p><strong>支持的数据库：</strong></p>
<ul>
<li>MySQL &#x2F; MariaDB</li>
<li>PostgreSQL</li>
<li>Oracle</li>
<li>SQL Server</li>
<li>SQLite</li>
<li>MongoDB (通过插件)</li>
<li>Redis (通过插件)</li>
<li>以及更多…</li>
</ul>
<p><strong>下载安装：</strong></p>
<ul>
<li>官网：<a href="https://www.jetbrains.com/datagrip/">https://www.jetbrains.com/datagrip/</a></li>
<li>30 天试用，之后需要订阅</li>
<li>学生可免费使用（凭学生证）</li>
</ul>
<h3 id="3-2-创建数据源"><a href="#3-2-创建数据源" class="headerlink" title="3.2 创建数据源"></a>3.2 创建数据源</h3><p><strong>连接 MySQL：</strong></p>
<ol>
<li>打开 DataGrip，点击 <code>File</code> -&gt; <code>New</code> -&gt; <code>Data Source</code> -&gt; <code>MySQL</code></li>
<li>填写连接信息：<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Host: localhost</span><br><span class="line">Port: 3306</span><br><span class="line">User: root</span><br><span class="line">Password: ******</span><br><span class="line">Database: (可选，连接后选择)</span><br></pre></td></tr></table></figure></li>
<li>点击 <code>Test Connection</code> 测试</li>
<li>点击 <code>OK</code> 保存</li>
</ol>
<p><strong>连接 PostgreSQL：</strong></p>
<ol>
<li><code>File</code> -&gt; <code>New</code> -&gt; <code>Data Source</code> -&gt; <code>PostgreSQL</code></li>
<li>填写连接信息：<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Host: localhost</span><br><span class="line">Port: 5432</span><br><span class="line">User: postgres</span><br><span class="line">Password: ******</span><br><span class="line">Database: postgres</span><br></pre></td></tr></table></figure></li>
<li>测试并保存</li>
</ol>
<h3 id="3-3-界面介绍"><a href="#3-3-界面介绍" class="headerlink" title="3.3 界面介绍"></a>3.3 界面介绍</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">左侧：Database 面板（数据库结构树）</span><br><span class="line">中间：SQL 编辑器和结果面板</span><br><span class="line">右侧：工具窗口（Structure, Favorites 等）</span><br><span class="line">底部：Services 面板（数据源列表）</span><br></pre></td></tr></table></figure>

<h3 id="3-4-SQL-编写技巧"><a href="#3-4-SQL-编写技巧" class="headerlink" title="3.4 SQL 编写技巧"></a>3.4 SQL 编写技巧</h3><p><strong>代码补全：</strong></p>
<ul>
<li><code>Ctrl + Space</code> - 基本补全</li>
<li><code>Ctrl + Shift + Space</code> - 智能补全</li>
<li><code>Ctrl + Q</code> - 查看文档</li>
<li><code>Ctrl + B</code> - 跳转到定义</li>
<li><code>Ctrl + Alt + B</code> - 查看实现</li>
</ul>
<p><strong>代码格式化：</strong></p>
<ul>
<li><code>Ctrl + Alt + L</code> - 格式化代码</li>
<li><code>Code</code> -&gt; <code>Reformat Code</code></li>
</ul>
<p><strong>代码模板：</strong></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 输入缩写后按 Tab 键</span></span><br><span class="line"></span><br><span class="line">sel<span class="operator">*</span>     <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span></span><br><span class="line">selt     <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span></span><br><span class="line">ins      <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">INSERT INTO</span></span><br><span class="line">upd      <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">UPDATE</span></span><br><span class="line">del      <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">DELETE</span> <span class="keyword">FROM</span></span><br><span class="line">cre      <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">CREATE TABLE</span></span><br><span class="line">joi      <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">JOIN</span></span><br><span class="line">wh       <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">WHERE</span></span><br><span class="line">gro      <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">GROUP</span> <span class="keyword">BY</span></span><br><span class="line">ord      <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">ORDER</span> <span class="keyword">BY</span></span><br><span class="line">hav      <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">HAVING</span></span><br></pre></td></tr></table></figure>

<h3 id="3-5-常用功能"><a href="#3-5-常用功能" class="headerlink" title="3.5 常用功能"></a>3.5 常用功能</h3><p><strong>执行 SQL：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Ctrl + Enter        执行当前语句</span><br><span class="line">Alt + X             执行当前文件</span><br><span class="line">Ctrl + Shift + F10  执行当前语句（带运行配置）</span><br></pre></td></tr></table></figure>

<p><strong>查看数据：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">双击表名          打开表结构</span><br><span class="line">Ctrl + N          在表中查找</span><br><span class="line">F4              查看数据</span><br><span class="line">Ctrl + Shift + F  查找数据</span><br></pre></td></tr></table></figure>

<p><strong>导出导入：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">右键表名 -&gt; Import/Export -&gt; Export Data</span><br><span class="line">支持格式：CSV, Excel, SQL, JSON, XML 等</span><br></pre></td></tr></table></figure>

<p><strong>生成 SQL：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">右键表名 -&gt; SQL Scripts -&gt; DDL</span><br><span class="line">可以选择生成 CREATE/INSERT/UPDATE/DELETE 语句</span><br></pre></td></tr></table></figure>

<h3 id="3-6-版本控制集成"><a href="#3-6-版本控制集成" class="headerlink" title="3.6 版本控制集成"></a>3.6 版本控制集成</h3><p>DataGrip 可以关联 SQL 文件到 Git：</p>
<ol>
<li>创建 <code>db/migrations</code> 目录</li>
<li>将 SQL 脚本放入该目录</li>
<li>DataGrip 会自动识别并关联到 Git</li>
<li>可以像普通代码一样进行版本控制</li>
</ol>
<h3 id="3-7-实用配置"><a href="#3-7-实用配置" class="headerlink" title="3.7 实用配置"></a>3.7 实用配置</h3><p><strong>设置中的推荐配置：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Settings -&gt; Editor -&gt; General -&gt; Appearance</span><br><span class="line">  ✓ Show line numbers          显示行号</span><br><span class="line">  ✓ Show whitespaces           显示空白字符</span><br><span class="line">  ✓ Show intention lightbulb   显示意图灯泡</span><br><span class="line"></span><br><span class="line">Settings -&gt; Editor -&gt; Font</span><br><span class="line">  设置喜欢的字体和大小</span><br><span class="line"></span><br><span class="line">Settings -&gt; Editor -&gt; Color Scheme</span><br><span class="line">  选择喜欢的主题</span><br><span class="line"></span><br><span class="line">Settings -&gt; Database -&gt; SQL Dialects</span><br><span class="line">  设置全局 SQL 方言</span><br><span class="line"></span><br><span class="line">Settings -&gt; Database -&gt; User Parameters</span><br><span class="line">  设置常用参数模板</span><br></pre></td></tr></table></figure>

<h3 id="3-8-快捷键"><a href="#3-8-快捷键" class="headerlink" title="3.8 快捷键"></a>3.8 快捷键</h3><p><strong>Windows&#x2F;Linux：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Ctrl + Space        代码补全</span><br><span class="line">Ctrl + Q          快速文档</span><br><span class="line">Ctrl + B            跳转到定义</span><br><span class="line">Ctrl + Alt + L      格式化代码</span><br><span class="line">Ctrl + /            行注释</span><br><span class="line">Ctrl + Shift + /    块注释</span><br><span class="line">Ctrl + F            查找</span><br><span class="line">Ctrl + R            替换</span><br><span class="line">Ctrl + G            跳转到行</span><br><span class="line">Ctrl + N            查找对象</span><br><span class="line">Ctrl + Shift + N    查找文件</span><br><span class="line">Alt + Enter         显示意图动作</span><br><span class="line">Ctrl + Alt + T      用结构包裹</span><br><span class="line">Ctrl + Shift + F10  运行</span><br><span class="line">Ctrl + Shift + F    查找用法</span><br></pre></td></tr></table></figure>

<p><strong>macOS：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Cmd + Space         代码补全</span><br><span class="line">F1                快速文档</span><br><span class="line">Cmd + B             跳转到定义</span><br><span class="line">Cmd + Alt + L       格式化代码</span><br><span class="line">Cmd + /             行注释</span><br><span class="line">Cmd + Shift + /     块注释</span><br><span class="line">Cmd + F             查找</span><br><span class="line">Cmd + R             替换</span><br><span class="line">Cmd + G             跳转到行</span><br></pre></td></tr></table></figure>

<h3 id="3-9-数据编辑器技巧"><a href="#3-9-数据编辑器技巧" class="headerlink" title="3.9 数据编辑器技巧"></a>3.9 数据编辑器技巧</h3><p><strong>单元格操作：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Enter             编辑单元格</span><br><span class="line">Escape            取消编辑</span><br><span class="line">Ctrl + Enter      提交编辑</span><br><span class="line">Ctrl + Alt + Enter  放弃编辑</span><br><span class="line">Delete            设置为 NULL</span><br><span class="line">Ctrl + D          复制行</span><br><span class="line">Ctrl + Y          删除行</span><br></pre></td></tr></table></figure>

<p><strong>筛选和排序：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">点击列头          排序</span><br><span class="line">右键列头 -&gt; Filter  添加筛选条件</span><br><span class="line">Ctrl + F          在结果中查找</span><br></pre></td></tr></table></figure>

<p><strong>数据导航：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Ctrl + G            跳转到行</span><br><span class="line">Ctrl + Alt + Left   上一页</span><br><span class="line">Ctrl + Alt + Right  下一页</span><br></pre></td></tr></table></figure>

<h2 id="四、工具整合"><a href="#四、工具整合" class="headerlink" title="四、工具整合"></a>四、工具整合</h2><h3 id="4-1-VS-Code-Jupyter"><a href="#4-1-VS-Code-Jupyter" class="headerlink" title="4.1 VS Code + Jupyter"></a>4.1 VS Code + Jupyter</h3><p>在 VS Code 中运行 Jupyter Notebook：</p>
<ol>
<li>安装 <code>Jupyter</code> 和 <code>Python</code> 插件</li>
<li>打开 <code>.ipynb</code> 文件</li>
<li>选择 Python 内核</li>
<li>运行单元格（<code>Shift + Enter</code>）</li>
</ol>
<p><strong>优势：</strong></p>
<ul>
<li>在 VS Code 中编辑 Notebook，享受 VS Code 的所有功能</li>
<li>支持变量查看器、数据查看器</li>
<li>支持交互式窗口</li>
</ul>
<h3 id="4-2-VS-Code-数据库"><a href="#4-2-VS-Code-数据库" class="headerlink" title="4.2 VS Code + 数据库"></a>4.2 VS Code + 数据库</h3><p>在 VS Code 中管理数据库：</p>
<p><strong>安装插件：</strong></p>
<ul>
<li><code>MySQL</code> (Jun Han)</li>
<li><code>PostgreSQL</code> (Microsoft)</li>
<li><code>SQLTools</code> (Matheus Teixeira)</li>
</ul>
<p><strong>使用 SQLTools：</strong></p>
<ol>
<li>安装插件</li>
<li>配置连接</li>
<li>在侧边栏查看数据库结构</li>
<li>执行 SQL 查询</li>
</ol>
<h3 id="4-3-工作流建议"><a href="#4-3-工作流建议" class="headerlink" title="4.3 工作流建议"></a>4.3 工作流建议</h3><p><strong>日常开发：</strong></p>
<ul>
<li><strong>代码编辑</strong>：VS Code</li>
<li><strong>数据分析</strong>：Jupyter Notebook</li>
<li><strong>数据库管理</strong>：DataGrip</li>
</ul>
<p><strong>数据科学项目：</strong></p>
<ol>
<li>用 DataGrip 探索和导出样本数据</li>
<li>用 Jupyter 进行数据探索和建模</li>
<li>用 VS Code 编写生产代码</li>
<li>用 Git 进行版本控制</li>
</ol>
<h2 id="五、最佳实践"><a href="#五、最佳实践" class="headerlink" title="五、最佳实践"></a>五、最佳实践</h2><blockquote>
<p><strong>提醒自己</strong>：</p>
<ol>
<li><strong>善用快捷键</strong>：提高效率，减少鼠标使用</li>
<li><strong>配置同步</strong>：使用 Settings Sync 同步配置</li>
<li><strong>插件适度</strong>：不要安装太多插件，影响性能</li>
<li><strong>定期备份</strong>：Notebook 定期导出备份</li>
<li><strong>代码格式化</strong>：保存时自动格式化</li>
<li><strong>版本控制</strong>：所有代码（包括 SQL）都纳入 Git</li>
<li><strong>敏感信息</strong>：数据库密码等不要硬编码</li>
</ol>
</blockquote>
<h2 id="六、练习"><a href="#六、练习" class="headerlink" title="六、练习"></a>六、练习</h2><ol>
<li>安装 VS Code，配置 Python 开发环境</li>
<li>安装 Jupyter，创建一个数据分析 Notebook</li>
<li>安装 DataGrip，连接本地或远程数据库</li>
<li>在 VS Code 中安装并配置常用插件</li>
<li>配置 Settings Sync，同步开发环境</li>
<li>学习并使用每个工具的快捷键</li>
<li>创建一个包含代码、文本、图表的完整 Notebook</li>
</ol>
<hr>
<p><strong>上一篇</strong>：<a href="/2026/02/24/Git-%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6%E4%B8%8E%E5%9B%A2%E9%98%9F%E5%8D%8F%E4%BD%9C/">Git 版本控制与团队协作</a></p>
<p><strong>系统与工具系列完成！</strong></p>
<p><strong>参考资源</strong>：</p>
<ul>
<li><a href="https://code.visualstudio.com/docs">VS Code 官方文档</a></li>
<li><a href="https://jupyter.org/documentation">Jupyter 官方文档</a></li>
<li><a href="https://www.jetbrains.com/help/datagrip/">DataGrip 官方文档</a></li>
<li><a href="https://code.visualstudio.com/docs/getstarted/keybindings">VS Code 快捷键</a></li>
</ul>
]]></content>
      <categories>
        <category>系统与工具</category>
      </categories>
      <tags>
        <tag>IDE</tag>
        <tag>VS Code</tag>
        <tag>Jupyter</tag>
        <tag>DataGrip</tag>
        <tag>开发工具</tag>
      </tags>
  </entry>
  <entry>
    <title>Linux 与 Shell（二）Shell 脚本编写</title>
    <url>/2026/02/24/Linux%20%E4%B8%8E%20Shell%EF%BC%88%E4%BA%8C%EF%BC%89Shell%20%E8%84%9A%E6%9C%AC%E7%BC%96%E5%86%99/</url>
    <content><![CDATA[<h1 id="Linux-与-Shell（二）Shell-脚本编写"><a href="#Linux-与-Shell（二）Shell-脚本编写" class="headerlink" title="Linux 与 Shell（二）Shell 脚本编写"></a>Linux 与 Shell（二）Shell 脚本编写</h1><p>Shell 脚本是自动化运维和批量处理的神器。本篇将介绍 Shell 脚本的基础语法、实用技巧和实战案例。</p>
<h2 id="一、Shell-脚本基础"><a href="#一、Shell-脚本基础" class="headerlink" title="一、Shell 脚本基础"></a>一、Shell 脚本基础</h2><h3 id="1-1-第一个脚本"><a href="#1-1-第一个脚本" class="headerlink" title="1.1 第一个脚本"></a>1.1 第一个脚本</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">#  第一个 Shell 脚本</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Hello, World!&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;当前用户：<span class="subst">$(whoami)</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;当前目录：<span class="subst">$(pwd)</span>&quot;</span></span><br></pre></td></tr></table></figure>

<p><strong>运行脚本：</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#  方式一：添加执行权限</span></span><br><span class="line"><span class="built_in">chmod</span> +x script.sh</span><br><span class="line">./script.sh</span><br><span class="line"></span><br><span class="line"><span class="comment">#  方式二：用 bash 执行</span></span><br><span class="line">bash script.sh</span><br><span class="line"></span><br><span class="line"><span class="comment">#  方式三：用 source 执行（在当前 shell 中）</span></span><br><span class="line"><span class="built_in">source</span> script.sh</span><br><span class="line">. script.sh</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>提醒自己</strong>：</p>
<ul>
<li><code>#!/bin/bash</code> 叫 shebang，指定解释器</li>
<li><code>#</code> 开头的行是注释</li>
<li>脚本文件通常用 <code>.sh</code> 扩展名</li>
</ul>
</blockquote>
<h3 id="1-2-变量"><a href="#1-2-变量" class="headerlink" title="1.2 变量"></a>1.2 变量</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  定义变量（等号两边不能有空格）</span></span><br><span class="line">name=<span class="string">&quot;张三&quot;</span></span><br><span class="line">age=25</span><br><span class="line"></span><br><span class="line"><span class="comment">#  使用变量</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;姓名：<span class="variable">$name</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;姓名：<span class="variable">$&#123;name&#125;</span>&quot;</span>  <span class="comment"># 推荐，更清晰</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  只读变量</span></span><br><span class="line"><span class="built_in">readonly</span> PI=3.14</span><br><span class="line"><span class="comment">#  PI=3.15  # 错误！不能修改</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  删除变量</span></span><br><span class="line">temp=<span class="string">&quot;临时变量&quot;</span></span><br><span class="line"><span class="built_in">unset</span> temp</span><br><span class="line"></span><br><span class="line"><span class="comment">#  特殊变量</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;脚本名：<span class="variable">$0</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;参数 1: <span class="variable">$1</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;参数 2: <span class="variable">$2</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;参数个数：<span class="variable">$#</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;所有参数：$*&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;所有参数：<span class="variable">$@</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;上一个命令的退出码：$?&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;当前进程 ID: $$&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  使用示例</span></span><br><span class="line"><span class="comment"># ./script.sh arg1 arg2</span></span><br></pre></td></tr></table></figure>

<h3 id="1-3-字符串"><a href="#1-3-字符串" class="headerlink" title="1.3 字符串"></a>1.3 字符串</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  单引号和双引号的区别</span></span><br><span class="line">name=<span class="string">&quot;张三&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;Hello, $name&#x27;</span>    <span class="comment"># Hello, $name（原样输出）</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Hello, <span class="variable">$name</span>&quot;</span>    <span class="comment"># Hello, 张三（变量替换）</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  字符串拼接</span></span><br><span class="line">greeting=<span class="string">&quot;Hello&quot;</span></span><br><span class="line">name=<span class="string">&quot;张三&quot;</span></span><br><span class="line">message=<span class="string">&quot;<span class="variable">$&#123;greeting&#125;</span>, <span class="variable">$&#123;name&#125;</span>!&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  字符串长度</span></span><br><span class="line">str=<span class="string">&quot;Hello&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;#str&#125;</span>           <span class="comment"># 5</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  子字符串</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;str:1:3&#125;</span>        <span class="comment"># ell（从索引 1 开始，取 3 个字符）</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  提醒自己：</span></span><br><span class="line"><span class="comment"># - 单引号内的内容原样输出</span></span><br><span class="line"><span class="comment"># - 双引号内会进行变量替换</span></span><br></pre></td></tr></table></figure>

<h3 id="1-4-数组"><a href="#1-4-数组" class="headerlink" title="1.4 数组"></a>1.4 数组</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  定义数组</span></span><br><span class="line">fruits=(<span class="string">&quot;苹果&quot;</span> <span class="string">&quot;香蕉&quot;</span> <span class="string">&quot;橙子&quot;</span>)</span><br><span class="line">colors=(red green blue)</span><br><span class="line"></span><br><span class="line"><span class="comment">#  访问元素</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;fruits[0]&#125;</span>      <span class="comment"># 苹果</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;fruits[1]&#125;</span>      <span class="comment"># 香蕉</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  访问所有元素</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;fruits[@]&#125;</span>      <span class="comment"># 苹果 香蕉 橙子</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;fruits[*]&#125;</span>      <span class="comment"># 同上</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  数组长度</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;#fruits[@]&#125;</span>     <span class="comment"># 3</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  修改元素</span></span><br><span class="line">fruits[0]=<span class="string">&quot;葡萄&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  添加元素</span></span><br><span class="line">fruits+=(<span class="string">&quot;西瓜&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#  删除元素</span></span><br><span class="line"><span class="built_in">unset</span> fruits[1]</span><br><span class="line"></span><br><span class="line"><span class="comment">#  遍历数组</span></span><br><span class="line"><span class="keyword">for</span> fruit <span class="keyword">in</span> <span class="string">&quot;<span class="variable">$&#123;fruits[@]&#125;</span>&quot;</span>; <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$fruit</span>&quot;</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<h2 id="二、运算符"><a href="#二、运算符" class="headerlink" title="二、运算符"></a>二、运算符</h2><h3 id="2-1-算术运算符"><a href="#2-1-算术运算符" class="headerlink" title="2.1 算术运算符"></a>2.1 算术运算符</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">a=10</span><br><span class="line">b=3</span><br><span class="line"></span><br><span class="line"><span class="comment">#  方式一：$(( ))</span></span><br><span class="line"><span class="built_in">echo</span> $((a + b))    <span class="comment"># 13</span></span><br><span class="line"><span class="built_in">echo</span> $((a - b))    <span class="comment"># 7</span></span><br><span class="line"><span class="built_in">echo</span> $((a * b))    <span class="comment"># 30</span></span><br><span class="line"><span class="built_in">echo</span> $((a / b))    <span class="comment"># 3（整数除法）</span></span><br><span class="line"><span class="built_in">echo</span> $((a % b))    <span class="comment"># 1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  方式二：expr</span></span><br><span class="line"><span class="built_in">echo</span> $(<span class="built_in">expr</span> <span class="variable">$a</span> + <span class="variable">$b</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#  方式三：let</span></span><br><span class="line"><span class="built_in">let</span> result=a+b</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$result</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  自增自减</span></span><br><span class="line">((a++))</span><br><span class="line">((b--))</span><br><span class="line"></span><br><span class="line"><span class="comment">#  提醒自己：</span></span><br><span class="line"><span class="comment"># - Shell 默认只支持整数运算</span></span><br><span class="line"><span class="comment"># - 浮点数需要用 bc</span></span><br></pre></td></tr></table></figure>

<h3 id="2-2-比较运算符"><a href="#2-2-比较运算符" class="headerlink" title="2.2 比较运算符"></a>2.2 比较运算符</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">a=10</span><br><span class="line">b=20</span><br><span class="line"></span><br><span class="line"><span class="comment">#  数值比较</span></span><br><span class="line">[ <span class="variable">$a</span> -eq <span class="variable">$b</span> ]     <span class="comment"># 等于 (equal)</span></span><br><span class="line">[ <span class="variable">$a</span> -ne <span class="variable">$b</span> ]     <span class="comment"># 不等于 (not equal)</span></span><br><span class="line">[ <span class="variable">$a</span> -gt <span class="variable">$b</span> ]     <span class="comment"># 大于 (greater than)</span></span><br><span class="line">[ <span class="variable">$a</span> -ge <span class="variable">$b</span> ]     <span class="comment"># 大于等于</span></span><br><span class="line">[ <span class="variable">$a</span> -lt <span class="variable">$b</span> ]     <span class="comment"># 小于 (less than)</span></span><br><span class="line">[ <span class="variable">$a</span> -le <span class="variable">$b</span> ]     <span class="comment"># 小于等于</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  字符串比较</span></span><br><span class="line">[ <span class="string">&quot;<span class="variable">$a</span>&quot;</span> = <span class="string">&quot;<span class="variable">$b</span>&quot;</span> ]   <span class="comment"># 等于</span></span><br><span class="line">[ <span class="string">&quot;<span class="variable">$a</span>&quot;</span> != <span class="string">&quot;<span class="variable">$b</span>&quot;</span> ]  <span class="comment"># 不等于</span></span><br><span class="line">[ -z <span class="string">&quot;<span class="variable">$a</span>&quot;</span> ]       <span class="comment"># 字符串为空</span></span><br><span class="line">[ -n <span class="string">&quot;<span class="variable">$a</span>&quot;</span> ]       <span class="comment"># 字符串不为空</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  文件测试</span></span><br><span class="line">[ -e file.txt ]   <span class="comment"># 文件存在</span></span><br><span class="line">[ -f file.txt ]   <span class="comment"># 是普通文件</span></span><br><span class="line">[ -d <span class="built_in">dir</span> ]        <span class="comment"># 是目录</span></span><br><span class="line">[ -x file.sh ]    <span class="comment"># 可执行</span></span><br><span class="line">[ -r file.txt ]   <span class="comment"># 可读</span></span><br><span class="line">[ -w file.txt ]   <span class="comment"># 可写</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  提醒自己：</span></span><br><span class="line"><span class="comment"># - [ ] 是 test 命令的简写</span></span><br><span class="line"><span class="comment"># - 比较运算符两边要有空格</span></span><br></pre></td></tr></table></figure>

<h3 id="2-3-逻辑运算符"><a href="#2-3-逻辑运算符" class="headerlink" title="2.3 逻辑运算符"></a>2.3 逻辑运算符</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">a=10</span><br><span class="line">b=20</span><br><span class="line"></span><br><span class="line"><span class="comment">#  逻辑与、或、非</span></span><br><span class="line">[ <span class="variable">$a</span> -gt 5 ] &amp;&amp; [ <span class="variable">$b</span> -gt 5 ]    <span class="comment"># and</span></span><br><span class="line">[ <span class="variable">$a</span> -gt 5 ] || [ <span class="variable">$b</span> -gt 5 ]    <span class="comment"># or</span></span><br><span class="line">! [ <span class="variable">$a</span> -gt <span class="variable">$b</span> ]                 <span class="comment"># not</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  简化写法</span></span><br><span class="line">[ <span class="variable">$a</span> -gt 5 ] &amp;&amp; <span class="built_in">echo</span> <span class="string">&quot;a 大于 5&quot;</span></span><br><span class="line">[ <span class="variable">$a</span> -gt 5 ] || <span class="built_in">echo</span> <span class="string">&quot;a 不大于 5&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  复合条件</span></span><br><span class="line">[[ <span class="variable">$a</span> -gt 5 &amp;&amp; <span class="variable">$b</span> -gt 5 ]]</span><br><span class="line">[[ <span class="variable">$a</span> -gt 5 || <span class="variable">$b</span> -gt 5 ]]</span><br></pre></td></tr></table></figure>

<h2 id="三、流程控制"><a href="#三、流程控制" class="headerlink" title="三、流程控制"></a>三、流程控制</h2><h3 id="3-1-if-条件语句"><a href="#3-1-if-条件语句" class="headerlink" title="3.1 if 条件语句"></a>3.1 if 条件语句</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  基本 if</span></span><br><span class="line">age=20</span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$age</span> -ge 18 ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;成年&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  if-else</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$age</span> -ge 18 ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;成年&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;未成年&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  if-elif-else</span></span><br><span class="line">score=85</span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$score</span> -ge 90 ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;优秀&quot;</span></span><br><span class="line"><span class="keyword">elif</span> [ <span class="variable">$score</span> -ge 80 ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;良好&quot;</span></span><br><span class="line"><span class="keyword">elif</span> [ <span class="variable">$score</span> -ge 60 ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;及格&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;不及格&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  单行写法</span></span><br><span class="line">[ <span class="variable">$age</span> -ge 18 ] &amp;&amp; <span class="built_in">echo</span> <span class="string">&quot;成年&quot;</span> || <span class="built_in">echo</span> <span class="string">&quot;未成年&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="3-2-case-语句"><a href="#3-2-case-语句" class="headerlink" title="3.2 case 语句"></a>3.2 case 语句</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  基本 case</span></span><br><span class="line">os=<span class="string">&quot;linux&quot;</span></span><br><span class="line"><span class="keyword">case</span> <span class="variable">$os</span> <span class="keyword">in</span></span><br><span class="line">    <span class="string">&quot;linux&quot;</span>)</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;Linux 系统&quot;</span></span><br><span class="line">        ;;</span><br><span class="line">    <span class="string">&quot;windows&quot;</span>)</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;Windows 系统&quot;</span></span><br><span class="line">        ;;</span><br><span class="line">    <span class="string">&quot;macos&quot;</span>)</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;macOS 系统&quot;</span></span><br><span class="line">        ;;</span><br><span class="line">    *)</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;未知系统&quot;</span></span><br><span class="line">        ;;</span><br><span class="line"><span class="keyword">esac</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  模式匹配</span></span><br><span class="line"><span class="keyword">case</span> <span class="variable">$1</span> <span class="keyword">in</span></span><br><span class="line">    start|begin)</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;启动服务&quot;</span></span><br><span class="line">        ;;</span><br><span class="line">    stop|end)</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;停止服务&quot;</span></span><br><span class="line">        ;;</span><br><span class="line">    restart)</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;重启服务&quot;</span></span><br><span class="line">        ;;</span><br><span class="line">    *)</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;用法：<span class="variable">$0</span> &#123;start|stop|restart&#125;&quot;</span></span><br><span class="line">        <span class="built_in">exit</span> 1</span><br><span class="line">        ;;</span><br><span class="line"><span class="keyword">esac</span></span><br></pre></td></tr></table></figure>

<h3 id="3-3-for-循环"><a href="#3-3-for-循环" class="headerlink" title="3.3 for 循环"></a>3.3 for 循环</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  遍历列表</span></span><br><span class="line"><span class="keyword">for</span> fruit <span class="keyword">in</span> 苹果 香蕉 橙子; <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;水果：<span class="variable">$fruit</span>&quot;</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  遍历数组</span></span><br><span class="line">fruits=(<span class="string">&quot;苹果&quot;</span> <span class="string">&quot;香蕉&quot;</span> <span class="string">&quot;橙子&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> fruit <span class="keyword">in</span> <span class="string">&quot;<span class="variable">$&#123;fruits[@]&#125;</span>&quot;</span>; <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;水果：<span class="variable">$fruit</span>&quot;</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  范围循环</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..5&#125;; <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;数字：<span class="variable">$i</span>&quot;</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  C 风格 for</span></span><br><span class="line"><span class="keyword">for</span> ((i=<span class="number">0</span>; i&lt;<span class="number">5</span>; i++)); <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;数字：<span class="variable">$i</span>&quot;</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  遍历文件</span></span><br><span class="line"><span class="keyword">for</span> file <span class="keyword">in</span> *.txt; <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;文件：<span class="variable">$file</span>&quot;</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  遍历命令行参数</span></span><br><span class="line"><span class="keyword">for</span> arg <span class="keyword">in</span> <span class="string">&quot;<span class="variable">$@</span>&quot;</span>; <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;参数：<span class="variable">$arg</span>&quot;</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<h3 id="3-4-while-循环"><a href="#3-4-while-循环" class="headerlink" title="3.4 while 循环"></a>3.4 while 循环</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  基本 while</span></span><br><span class="line">count=1</span><br><span class="line"><span class="keyword">while</span> [ <span class="variable">$count</span> -le 5 ]; <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;计数：<span class="variable">$count</span>&quot;</span></span><br><span class="line">    ((count++))</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  无限循环</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">true</span>; <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;持续运行...&quot;</span></span><br><span class="line">    <span class="built_in">sleep</span> 1</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  读取文件</span></span><br><span class="line"><span class="keyword">while</span> <span class="built_in">read</span> -r line; <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;行：<span class="variable">$line</span>&quot;</span></span><br><span class="line"><span class="keyword">done</span> &lt; file.txt</span><br><span class="line"></span><br><span class="line"><span class="comment">#  带条件的 while</span></span><br><span class="line"><span class="keyword">while</span> [ -f /var/run/app.pid ]; <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;应用正在运行&quot;</span></span><br><span class="line">    <span class="built_in">sleep</span> 5</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<h3 id="3-5-循环控制"><a href="#3-5-循环控制" class="headerlink" title="3.5 循环控制"></a>3.5 循环控制</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  break - 跳出循环</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..10&#125;; <span class="keyword">do</span></span><br><span class="line">    <span class="keyword">if</span> [ <span class="variable">$i</span> -eq 5 ]; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">break</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="variable">$i</span>  <span class="comment"># 1 2 3 4</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  continue - 跳过本次</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..10&#125;; <span class="keyword">do</span></span><br><span class="line">    <span class="keyword">if</span> [ $((i % <span class="number">2</span>)) -eq 0 ]; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">continue</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="variable">$i</span>  <span class="comment"># 1 3 5 7 9</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  select - 创建菜单</span></span><br><span class="line">PS3=<span class="string">&quot;请选择一个水果：&quot;</span></span><br><span class="line">fruits=(<span class="string">&quot;苹果&quot;</span> <span class="string">&quot;香蕉&quot;</span> <span class="string">&quot;橙子&quot;</span> <span class="string">&quot;退出&quot;</span>)</span><br><span class="line"><span class="keyword">select</span> fruit <span class="keyword">in</span> <span class="string">&quot;<span class="variable">$&#123;fruits[@]&#125;</span>&quot;</span>; <span class="keyword">do</span></span><br><span class="line">    <span class="keyword">case</span> <span class="variable">$fruit</span> <span class="keyword">in</span></span><br><span class="line">        <span class="string">&quot;退出&quot;</span>)</span><br><span class="line">            <span class="built_in">break</span></span><br><span class="line">            ;;</span><br><span class="line">        *)</span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&quot;你选择了：<span class="variable">$fruit</span>&quot;</span></span><br><span class="line">            ;;</span><br><span class="line">    <span class="keyword">esac</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<h2 id="四、函数"><a href="#四、函数" class="headerlink" title="四、函数"></a>四、函数</h2><h3 id="4-1-函数定义"><a href="#4-1-函数定义" class="headerlink" title="4.1 函数定义"></a>4.1 函数定义</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  定义函数</span></span><br><span class="line"><span class="function"><span class="title">greet</span></span>() &#123;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Hello, <span class="variable">$1</span>!&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#  调用函数</span></span><br><span class="line">greet <span class="string">&quot;张三&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  带返回值</span></span><br><span class="line"><span class="function"><span class="title">add</span></span>() &#123;</span><br><span class="line">    <span class="built_in">local</span> a=<span class="variable">$1</span></span><br><span class="line">    <span class="built_in">local</span> b=<span class="variable">$2</span></span><br><span class="line">    <span class="built_in">local</span> <span class="built_in">sum</span>=$((a + b))</span><br><span class="line">    <span class="built_in">echo</span> <span class="variable">$sum</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">result=$(add 3 5)</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;结果：<span class="variable">$result</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  使用 return（返回状态码，0-255）</span></span><br><span class="line"><span class="function"><span class="title">check_age</span></span>() &#123;</span><br><span class="line">    <span class="built_in">local</span> age=<span class="variable">$1</span></span><br><span class="line">    <span class="keyword">if</span> [ <span class="variable">$age</span> -ge 18 ]; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">return</span> 0  <span class="comment"># 成功</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">return</span> 1  <span class="comment"># 失败</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">check_age 20</span><br><span class="line"><span class="keyword">if</span> [ $? -eq 0 ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;成年&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  提醒自己：</span></span><br><span class="line"><span class="comment"># - local 定义局部变量</span></span><br><span class="line"><span class="comment"># - return 只能返回 0-255 的状态码</span></span><br><span class="line"><span class="comment"># - 返回值用 echo，调用时用$()捕获</span></span><br></pre></td></tr></table></figure>

<h3 id="4-2-函数库"><a href="#4-2-函数库" class="headerlink" title="4.2 函数库"></a>4.2 函数库</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">#  utils.sh - 函数库</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">log_info</span></span>() &#123;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;[INFO] <span class="subst">$(date &#x27;+%Y-%m-%d %H:%M:%S&#x27;)</span> - <span class="variable">$1</span>&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">log_error</span></span>() &#123;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;[ERROR] <span class="subst">$(date &#x27;+%Y-%m-%d %H:%M:%S&#x27;)</span> - <span class="variable">$1</span>&quot;</span> &gt;&amp;2</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">check_root</span></span>() &#123;</span><br><span class="line">    <span class="keyword">if</span> [ $(<span class="built_in">id</span> -u) -ne 0 ]; <span class="keyword">then</span></span><br><span class="line">        log_error <span class="string">&quot;需要 root 权限&quot;</span></span><br><span class="line">        <span class="built_in">exit</span> 1</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">#  main.sh - 主脚本</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">source</span> utils.sh</span><br><span class="line"><span class="comment"># 或</span></span><br><span class="line">. utils.sh</span><br><span class="line"></span><br><span class="line">log_info <span class="string">&quot;程序启动&quot;</span></span><br><span class="line">check_root</span><br></pre></td></tr></table></figure>

<h2 id="五、输入输出"><a href="#五、输入输出" class="headerlink" title="五、输入输出"></a>五、输入输出</h2><h3 id="5-1-读取输入"><a href="#5-1-读取输入" class="headerlink" title="5.1 读取输入"></a>5.1 读取输入</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  读取一行</span></span><br><span class="line"><span class="built_in">echo</span> -n <span class="string">&quot;请输入姓名：&quot;</span></span><br><span class="line"><span class="built_in">read</span> name</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;你好，<span class="variable">$name</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  读取多个值</span></span><br><span class="line"><span class="built_in">echo</span> -n <span class="string">&quot;请输入姓名和年龄：&quot;</span></span><br><span class="line"><span class="built_in">read</span> name age</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$name</span>, <span class="variable">$age</span> 岁&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  带提示</span></span><br><span class="line"><span class="built_in">read</span> -p <span class="string">&quot;请输入密码：&quot;</span> password</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;密码已输入&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  隐藏输入</span></span><br><span class="line"><span class="built_in">read</span> -s -p <span class="string">&quot;请输入密码：&quot;</span> password</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span>  <span class="comment"># 换行</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  限时读取</span></span><br><span class="line"><span class="built_in">read</span> -t 5 -p <span class="string">&quot;请在 5 秒内输入：&quot;</span> input</span><br><span class="line"><span class="keyword">if</span> [ -z <span class="string">&quot;<span class="variable">$input</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;超时&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  读取文件</span></span><br><span class="line"><span class="keyword">while</span> <span class="built_in">read</span> -r line; <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;行：<span class="variable">$line</span>&quot;</span></span><br><span class="line"><span class="keyword">done</span> &lt; file.txt</span><br></pre></td></tr></table></figure>

<h3 id="5-2-重定向"><a href="#5-2-重定向" class="headerlink" title="5.2 重定向"></a>5.2 重定向</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  标准输出重定向</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;hello&quot;</span> &gt; output.txt      <span class="comment"># 覆盖</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;hello&quot;</span> &gt;&gt; output.txt     <span class="comment"># 追加</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  标准错误重定向</span></span><br><span class="line"><span class="built_in">command</span> 2&gt; error.log</span><br><span class="line"><span class="built_in">command</span> &gt; output.log 2&gt;&amp;1      <span class="comment"># 标准输出和错误都重定向</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  输入重定向</span></span><br><span class="line"><span class="built_in">wc</span> -l &lt; file.txt</span><br><span class="line"></span><br><span class="line"><span class="comment">#  Here 文档</span></span><br><span class="line"><span class="built_in">cat</span> &lt;&lt; <span class="string">EOF &gt; file.txt</span></span><br><span class="line"><span class="string">这是第一行</span></span><br><span class="line"><span class="string">这是第二行</span></span><br><span class="line"><span class="string">变量：$name</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  Here 字符串</span></span><br><span class="line">grep <span class="string">&quot;pattern&quot;</span> &lt;&lt;&lt; <span class="string">&quot;search in this string&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="六、实战案例"><a href="#六、实战案例" class="headerlink" title="六、实战案例"></a>六、实战案例</h2><h3 id="6-1-系统信息收集脚本"><a href="#6-1-系统信息收集脚本" class="headerlink" title="6.1 系统信息收集脚本"></a>6.1 系统信息收集脚本</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">#  system_info.sh - 收集系统信息</span></span><br><span class="line"></span><br><span class="line">OUTPUT_FILE=<span class="string">&quot;system_info_<span class="subst">$(date +%Y%m%d_%H%M%S)</span>.txt&quot;</span></span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;========== 系统信息 ==========&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;时间：<span class="subst">$(date)</span>&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;主机名：<span class="subst">$(hostname)</span>&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;========== CPU 信息 ==========&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;核心数：<span class="subst">$(nproc)</span>&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;========== 内存信息 ==========&quot;</span></span><br><span class="line">    free -h</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;========== 磁盘信息 ==========&quot;</span></span><br><span class="line">    <span class="built_in">df</span> -h</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;========== 网络信息 ==========&quot;</span></span><br><span class="line">    ip addr show</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;========== 监听端口 ==========&quot;</span></span><br><span class="line">    ss -tulpn</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;========== 最近登录 ==========&quot;</span></span><br><span class="line">    last -n 5</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">&#125; &gt; <span class="string">&quot;<span class="variable">$OUTPUT_FILE</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;系统信息已保存到：<span class="variable">$OUTPUT_FILE</span>&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="6-2-批量备份脚本"><a href="#6-2-批量备份脚本" class="headerlink" title="6.2 批量备份脚本"></a>6.2 批量备份脚本</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">#  backup.sh - 批量备份脚本</span></span><br><span class="line"></span><br><span class="line">SOURCE_DIR=<span class="string">&quot;/data&quot;</span></span><br><span class="line">BACKUP_DIR=<span class="string">&quot;/backup&quot;</span></span><br><span class="line">DATE=$(<span class="built_in">date</span> +%Y%m%d_%H%M%S)</span><br><span class="line">KEEP_DAYS=7</span><br><span class="line"></span><br><span class="line"><span class="comment">#  创建备份目录</span></span><br><span class="line"><span class="built_in">mkdir</span> -p <span class="string">&quot;<span class="variable">$BACKUP_DIR</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  备份函数</span></span><br><span class="line"><span class="function"><span class="title">backup_dir</span></span>() &#123;</span><br><span class="line">    <span class="built_in">local</span> src=<span class="variable">$1</span></span><br><span class="line">    <span class="built_in">local</span> name=$(<span class="built_in">basename</span> <span class="string">&quot;<span class="variable">$src</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">local</span> tar_file=<span class="string">&quot;<span class="variable">$&#123;BACKUP_DIR&#125;</span>/<span class="variable">$&#123;name&#125;</span>_<span class="variable">$&#123;DATE&#125;</span>.tar.gz&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;正在备份：<span class="variable">$src</span>&quot;</span></span><br><span class="line">    tar -czf <span class="string">&quot;<span class="variable">$tar_file</span>&quot;</span> <span class="string">&quot;<span class="variable">$src</span>&quot;</span> 2&gt;/dev/null</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> [ $? -eq 0 ]; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;备份成功：<span class="variable">$tar_file</span>&quot;</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;备份失败：<span class="variable">$src</span>&quot;</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#  备份多个目录</span></span><br><span class="line">backup_dir <span class="string">&quot;/data/www&quot;</span></span><br><span class="line">backup_dir <span class="string">&quot;/data/database&quot;</span></span><br><span class="line">backup_dir <span class="string">&quot;/data/config&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  清理旧备份</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;清理 <span class="variable">$&#123;KEEP_DAYS&#125;</span> 天前的备份...&quot;</span></span><br><span class="line">find <span class="string">&quot;<span class="variable">$BACKUP_DIR</span>&quot;</span> -name <span class="string">&quot;*.tar.gz&quot;</span> -mtime +<span class="variable">$&#123;KEEP_DAYS&#125;</span> -delete</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;备份完成&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="6-3-日志分析脚本"><a href="#6-3-日志分析脚本" class="headerlink" title="6.3 日志分析脚本"></a>6.3 日志分析脚本</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">#  log_analyzer.sh - 日志分析脚本</span></span><br><span class="line"></span><br><span class="line">LOG_FILE=<span class="string">&quot;<span class="variable">$&#123;1:-/var/log/nginx/access.log&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ ! -f <span class="string">&quot;<span class="variable">$LOG_FILE</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;错误：日志文件不存在：<span class="variable">$LOG_FILE</span>&quot;</span></span><br><span class="line">    <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;========== 日志分析：<span class="variable">$LOG_FILE</span> ==========&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  PV（访问量）</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;总访问量 (PV):&quot;</span></span><br><span class="line"><span class="built_in">wc</span> -l &lt; <span class="string">&quot;<span class="variable">$LOG_FILE</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  UV（独立访客）</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;独立访客 (UV):&quot;</span></span><br><span class="line">awk <span class="string">&#x27;&#123;print $1&#125;&#x27;</span> <span class="string">&quot;<span class="variable">$LOG_FILE</span>&quot;</span> | <span class="built_in">sort</span> -u | <span class="built_in">wc</span> -l</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  Top 10 IP</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Top 10 IP:&quot;</span></span><br><span class="line">awk <span class="string">&#x27;&#123;print $1&#125;&#x27;</span> <span class="string">&quot;<span class="variable">$LOG_FILE</span>&quot;</span> | <span class="built_in">sort</span> | <span class="built_in">uniq</span> -c | <span class="built_in">sort</span> -rn | <span class="built_in">head</span> -10</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  状态码统计</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;状态码统计:&quot;</span></span><br><span class="line">awk <span class="string">&#x27;&#123;print $9&#125;&#x27;</span> <span class="string">&quot;<span class="variable">$LOG_FILE</span>&quot;</span> | <span class="built_in">sort</span> | <span class="built_in">uniq</span> -c | <span class="built_in">sort</span> -rn</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  错误请求（4xx, 5xx）</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;错误请求:&quot;</span></span><br><span class="line">grep -E <span class="string">&#x27;&quot; [45][0-9]&#123;2&#125; &#x27;</span> <span class="string">&quot;<span class="variable">$LOG_FILE</span>&quot;</span> | <span class="built_in">wc</span> -l</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  最近错误</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;最近 10 个错误请求:&quot;</span></span><br><span class="line">grep -E <span class="string">&#x27;&quot; [45][0-9]&#123;2&#125; &#x27;</span> <span class="string">&quot;<span class="variable">$LOG_FILE</span>&quot;</span> | <span class="built_in">tail</span> -10</span><br></pre></td></tr></table></figure>

<h3 id="6-4-服务监控脚本"><a href="#6-4-服务监控脚本" class="headerlink" title="6.4 服务监控脚本"></a>6.4 服务监控脚本</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">#  monitor.sh - 服务监控脚本</span></span><br><span class="line"></span><br><span class="line">SERVICES=(<span class="string">&quot;nginx&quot;</span> <span class="string">&quot;mysql&quot;</span> <span class="string">&quot;redis&quot;</span>)</span><br><span class="line">LOG_FILE=<span class="string">&quot;/var/log/service_monitor.log&quot;</span></span><br><span class="line">ALERT_EMAIL=<span class="string">&quot;admin@example.com&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">log</span></span>() &#123;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;[<span class="subst">$(date &#x27;+%Y-%m-%d %H:%M:%S&#x27;)</span>] <span class="variable">$1</span>&quot;</span> | <span class="built_in">tee</span> -a <span class="string">&quot;<span class="variable">$LOG_FILE</span>&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">check_service</span></span>() &#123;</span><br><span class="line">    <span class="built_in">local</span> service=<span class="variable">$1</span></span><br><span class="line">    <span class="keyword">if</span> ! pgrep -x <span class="string">&quot;<span class="variable">$service</span>&quot;</span> &gt; /dev/null; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">log</span> <span class="string">&quot;警告：<span class="variable">$service</span> 服务未运行！&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">#  尝试重启</span></span><br><span class="line">        <span class="built_in">log</span> <span class="string">&quot;尝试重启 <span class="variable">$service</span>...&quot;</span></span><br><span class="line">        systemctl restart <span class="string">&quot;<span class="variable">$service</span>&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> [ $? -eq 0 ]; <span class="keyword">then</span></span><br><span class="line">            <span class="built_in">log</span> <span class="string">&quot;<span class="variable">$service</span> 服务已重启&quot;</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="built_in">log</span> <span class="string">&quot;错误：<span class="variable">$service</span> 服务重启失败！&quot;</span></span><br><span class="line">            <span class="comment">#  发送邮件告警（需要配置邮件）</span></span><br><span class="line">            <span class="comment"># echo &quot;$service 服务重启失败&quot; | mail -s &quot;服务告警&quot; &quot;$ALERT_EMAIL&quot;</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">log</span> <span class="string">&quot;<span class="variable">$service</span> 服务运行正常&quot;</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#  主循环</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">true</span>; <span class="keyword">do</span></span><br><span class="line">    <span class="keyword">for</span> service <span class="keyword">in</span> <span class="string">&quot;<span class="variable">$&#123;SERVICES[@]&#125;</span>&quot;</span>; <span class="keyword">do</span></span><br><span class="line">        check_service <span class="string">&quot;<span class="variable">$service</span>&quot;</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;---&quot;</span></span><br><span class="line">    <span class="built_in">sleep</span> 60  <span class="comment"># 每分钟检查一次</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<h3 id="6-5-自动化部署脚本"><a href="#6-5-自动化部署脚本" class="headerlink" title="6.5 自动化部署脚本"></a>6.5 自动化部署脚本</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">#  deploy.sh - 自动化部署脚本</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span> -e  <span class="comment"># 遇到错误立即退出</span></span><br><span class="line"></span><br><span class="line">APP_NAME=<span class="string">&quot;myapp&quot;</span></span><br><span class="line">APP_DIR=<span class="string">&quot;/opt/<span class="variable">$APP_NAME</span>&quot;</span></span><br><span class="line">BACKUP_DIR=<span class="string">&quot;/backup/<span class="variable">$APP_NAME</span>&quot;</span></span><br><span class="line">GIT_REPO=<span class="string">&quot;git@github.com:user/myapp.git&quot;</span></span><br><span class="line">BRANCH=<span class="string">&quot;main&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">log</span></span>() &#123;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;[<span class="subst">$(date &#x27;+%Y-%m-%d %H:%M:%S&#x27;)</span>] <span class="variable">$1</span>&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">log</span> <span class="string">&quot;========== 开始部署 <span class="variable">$APP_NAME</span> ==========&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  1. 备份当前版本</span></span><br><span class="line"><span class="built_in">log</span> <span class="string">&quot;备份当前版本...&quot;</span></span><br><span class="line"><span class="keyword">if</span> [ -d <span class="string">&quot;<span class="variable">$APP_DIR</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">mkdir</span> -p <span class="string">&quot;<span class="variable">$BACKUP_DIR</span>&quot;</span></span><br><span class="line">    tar -czf <span class="string">&quot;<span class="variable">$&#123;BACKUP_DIR&#125;</span>/backup_<span class="subst">$(date +%Y%m%d_%H%M%S)</span>.tar.gz&quot;</span> <span class="string">&quot;<span class="variable">$APP_DIR</span>&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  2. 拉取最新代码</span></span><br><span class="line"><span class="built_in">log</span> <span class="string">&quot;拉取最新代码...&quot;</span></span><br><span class="line"><span class="keyword">if</span> [ -d <span class="string">&quot;<span class="variable">$APP_DIR</span>/.git&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">cd</span> <span class="string">&quot;<span class="variable">$APP_DIR</span>&quot;</span></span><br><span class="line">    git pull origin <span class="string">&quot;<span class="variable">$BRANCH</span>&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    git <span class="built_in">clone</span> -b <span class="string">&quot;<span class="variable">$BRANCH</span>&quot;</span> <span class="string">&quot;<span class="variable">$GIT_REPO</span>&quot;</span> <span class="string">&quot;<span class="variable">$APP_DIR</span>&quot;</span></span><br><span class="line">    <span class="built_in">cd</span> <span class="string">&quot;<span class="variable">$APP_DIR</span>&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  3. 安装依赖</span></span><br><span class="line"><span class="built_in">log</span> <span class="string">&quot;安装依赖...&quot;</span></span><br><span class="line">pip install -r requirements.txt</span><br><span class="line"></span><br><span class="line"><span class="comment">#  4. 构建（如果需要）</span></span><br><span class="line"><span class="built_in">log</span> <span class="string">&quot;构建项目...&quot;</span></span><br><span class="line"><span class="comment"># npm run build</span></span><br><span class="line"><span class="comment"># 或</span></span><br><span class="line"><span class="comment"># go build</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  5. 数据库迁移（如果需要）</span></span><br><span class="line"><span class="built_in">log</span> <span class="string">&quot;数据库迁移...&quot;</span></span><br><span class="line"><span class="comment"># python manage.py migrate</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  6. 重启服务</span></span><br><span class="line"><span class="built_in">log</span> <span class="string">&quot;重启服务...&quot;</span></span><br><span class="line">systemctl restart <span class="string">&quot;<span class="variable">$APP_NAME</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  7. 检查服务状态</span></span><br><span class="line"><span class="built_in">log</span> <span class="string">&quot;检查服务状态...&quot;</span></span><br><span class="line"><span class="built_in">sleep</span> 2</span><br><span class="line"><span class="keyword">if</span> systemctl is-active --quiet <span class="string">&quot;<span class="variable">$APP_NAME</span>&quot;</span>; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">log</span> <span class="string">&quot;部署成功！&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">log</span> <span class="string">&quot;错误：服务启动失败！&quot;</span></span><br><span class="line">    <span class="built_in">log</span> <span class="string">&quot;回滚到之前的版本...&quot;</span></span><br><span class="line">    <span class="comment"># 回滚逻辑</span></span><br><span class="line">    <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">log</span> <span class="string">&quot;========== 部署完成 ==========&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="七、调试技巧"><a href="#七、调试技巧" class="headerlink" title="七、调试技巧"></a>七、调试技巧</h2><h3 id="7-1-调试选项"><a href="#7-1-调试选项" class="headerlink" title="7.1 调试选项"></a>7.1 调试选项</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  -x：打印执行的命令</span></span><br><span class="line">bash -x script.sh</span><br><span class="line"></span><br><span class="line"><span class="comment">#  -v：打印读取的行</span></span><br><span class="line">bash -v script.sh</span><br><span class="line"></span><br><span class="line"><span class="comment">#  -n：检查语法（不执行）</span></span><br><span class="line">bash -n script.sh</span><br><span class="line"></span><br><span class="line"><span class="comment">#  脚本内启用调试</span></span><br><span class="line"><span class="built_in">set</span> -x      <span class="comment"># 开启调试</span></span><br><span class="line"><span class="comment">#  代码...</span></span><br><span class="line"><span class="built_in">set</span> +x      <span class="comment"># 关闭调试</span></span><br></pre></td></tr></table></figure>

<h3 id="7-2-错误处理"><a href="#7-2-错误处理" class="headerlink" title="7.2 错误处理"></a>7.2 错误处理</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  set -e：遇到错误立即退出</span></span><br><span class="line"><span class="built_in">set</span> -e</span><br><span class="line"></span><br><span class="line"><span class="comment">#  set -u：使用未定义变量时报错</span></span><br><span class="line"><span class="built_in">set</span> -u</span><br><span class="line"></span><br><span class="line"><span class="comment">#  set -o pipefail：管道中任何命令失败都返回失败</span></span><br><span class="line"><span class="built_in">set</span> -o pipefail</span><br><span class="line"></span><br><span class="line"><span class="comment">#  组合使用（推荐）</span></span><br><span class="line"><span class="built_in">set</span> -euo pipefail</span><br><span class="line"></span><br><span class="line"><span class="comment">#  trap：捕获信号</span></span><br><span class="line"><span class="built_in">trap</span> <span class="string">&#x27;echo &quot;错误：脚本在第 $LINENO 行失败&quot;&#x27;</span> ERR</span><br><span class="line"></span><br><span class="line"><span class="comment">#  清理函数</span></span><br><span class="line"><span class="function"><span class="title">cleanup</span></span>() &#123;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;清理临时文件...&quot;</span></span><br><span class="line">    <span class="built_in">rm</span> -rf /tmp/myapp_*</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">trap</span> cleanup EXIT</span><br></pre></td></tr></table></figure>

<h2 id="八、最佳实践"><a href="#八、最佳实践" class="headerlink" title="八、最佳实践"></a>八、最佳实践</h2><blockquote>
<p><strong>提醒自己</strong>：</p>
<ol>
<li><strong>脚本开头加 shebang</strong>：<code>#!/bin/bash</code></li>
<li><strong>使用 set -euo pipefail</strong>：增强错误处理</li>
<li><strong>变量用双引号包裹</strong>：避免空格和通配符问题</li>
<li><strong>函数用 local 声明局部变量</strong>：避免污染全局作用域</li>
<li><strong>有意义的变量名</strong>：使用大写表示常量</li>
<li><strong>添加注释和文档</strong>：说明用途、参数、返回值</li>
<li><strong>日志输出加时间戳</strong>：便于追踪</li>
<li><strong>敏感信息用环境变量</strong>：不要硬编码密码</li>
</ol>
</blockquote>
<h2 id="九、练习"><a href="#九、练习" class="headerlink" title="九、练习"></a>九、练习</h2><ol>
<li>编写一个脚本，检查磁盘使用率，超过 80% 时告警</li>
<li>编写一个脚本，批量创建用户并设置密码</li>
<li>编写一个脚本，分析 Apache&#x2F;Nginx 日志，统计访问量和错误率</li>
<li>编写一个脚本，监控系统负载，超过阈值时发送邮件告警</li>
<li>编写一个自动化部署脚本，支持回滚功能</li>
</ol>
<hr>
<p><strong>上一篇</strong>：<a href="/2026/02/24/Linux-%E4%B8%8E-Shell%EF%BC%88%E4%B8%80%EF%BC%89Linux-%E5%9F%BA%E7%A1%80%E4%B8%8E%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/">Linux 与 Shell（一）：Linux 基础与常用命令</a></p>
<p><strong>下一篇</strong>：<a href="/2026/02/24/Git-%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6%E4%B8%8E%E5%9B%A2%E9%98%9F%E5%8D%8F%E4%BD%9C/">Git 版本控制与团队协作</a></p>
<p><strong>参考资源</strong>：</p>
<ul>
<li><a href="https://www.shellscript.sh/">Shell 脚本教程</a></li>
<li><a href="https://github.com/learnbyexample/cmdline_text_processing">Bash 指南</a></li>
<li><a href="https://www.gnu.org/software/bash/manual/">GNU Bash 手册</a></li>
</ul>
]]></content>
      <categories>
        <category>系统与工具</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>Shell</tag>
        <tag>脚本编程</tag>
        <tag>自动化</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQL 基础教程（一）数据库基础与环境搭建</title>
    <url>/2026/02/23/MySQL%20%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B%EF%BC%88%E4%B8%80%EF%BC%89%E6%95%B0%E6%8D%AE%E5%BA%93%E5%9F%BA%E7%A1%80%E4%B8%8E%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/</url>
    <content><![CDATA[<h1 id="MySQL-基础教程（一）数据库基础与环境搭建"><a href="#MySQL-基础教程（一）数据库基础与环境搭建" class="headerlink" title="MySQL 基础教程（一）数据库基础与环境搭建"></a>MySQL 基础教程（一）数据库基础与环境搭建</h1><p>欢迎来到 MySQL 基础教程系列的第一篇！在本篇文章中，我们将从零开始了解数据库的基本概念，完成 MySQL 的安装配置，并了解数据模型和 SQL 的分类。</p>
<h2 id="一、数据库相关概念"><a href="#一、数据库相关概念" class="headerlink" title="一、数据库相关概念"></a>一、数据库相关概念</h2><h3 id="1-1-什么是数据库？"><a href="#1-1-什么是数据库？" class="headerlink" title="1.1 什么是数据库？"></a>1.1 什么是数据库？</h3><p><strong>数据库（Database）</strong> 是按照数据结构来组织、存储和管理数据的仓库。它可以持久化存储数据，并且支持高效的数据访问和管理。</p>
<p>简单来说，数据库就是一个<strong>电子化的文件柜</strong>，用于存储和管理数据。</p>
<h3 id="1-2-什么是-DBMS？"><a href="#1-2-什么是-DBMS？" class="headerlink" title="1.2 什么是 DBMS？"></a>1.2 什么是 DBMS？</h3><p><strong>DBMS（Database Management System，数据库管理系统）</strong> 是用于创建、管理和维护数据库的软件。</p>
<p>常见的 DBMS 有：</p>
<ul>
<li><strong>MySQL</strong>：开源、轻量、流行，适合中小型项目</li>
<li><strong>Oracle</strong>：功能强大、性能优异，适合大型企业</li>
<li><strong>SQL Server</strong>：微软出品，与 Windows 生态集成良好</li>
<li><strong>PostgreSQL</strong>：开源、功能丰富，支持复杂查询</li>
<li><strong>SQLite</strong>：嵌入式数据库，适合移动端和小型应用</li>
</ul>
<h3 id="1-3-数据库的优势"><a href="#1-3-数据库的优势" class="headerlink" title="1.3 数据库的优势"></a>1.3 数据库的优势</h3><table>
<thead>
<tr>
<th>对比项</th>
<th>文件系统</th>
<th>数据库系统</th>
</tr>
</thead>
<tbody><tr>
<td>数据结构</td>
<td>松散，由应用程序定义</td>
<td>结构化，由 DBMS 统一管理</td>
</tr>
<tr>
<td>数据共享</td>
<td>差，数据孤立</td>
<td>好，多用户共享</td>
</tr>
<tr>
<td>数据冗余</td>
<td>高，容易重复</td>
<td>低，减少冗余</td>
</tr>
<tr>
<td>数据一致性</td>
<td>难保证</td>
<td>容易保证</td>
</tr>
<tr>
<td>数据独立性</td>
<td>差，依赖程序</td>
<td>好，独立于程序</td>
</tr>
<tr>
<td>并发访问</td>
<td>难处理</td>
<td>支持良好</td>
</tr>
</tbody></table>
<h3 id="1-4-什么是-SQL？"><a href="#1-4-什么是-SQL？" class="headerlink" title="1.4 什么是 SQL？"></a>1.4 什么是 SQL？</h3><p><strong>SQL（Structured Query Language，结构化查询语言）</strong> 是用于访问和处理数据库的标准计算机语言。</p>
<p>SQL 的主要功能：</p>
<ul>
<li>查询数据</li>
<li>插入、更新、删除数据</li>
<li>创建、修改、删除数据库对象</li>
<li>设置访问权限</li>
</ul>
<h2 id="二、MySQL-简介"><a href="#二、MySQL-简介" class="headerlink" title="二、MySQL 简介"></a>二、MySQL 简介</h2><h3 id="2-1-MySQL-的特点"><a href="#2-1-MySQL-的特点" class="headerlink" title="2.1 MySQL 的特点"></a>2.1 MySQL 的特点</h3><ul>
<li><strong>开源免费</strong>：社区版完全免费</li>
<li><strong>跨平台</strong>：支持 Windows、Linux、macOS 等</li>
<li><strong>高性能</strong>：查询速度快，支持大量并发</li>
<li><strong>易用性</strong>：安装简单，学习成本低</li>
<li><strong>生态完善</strong>：有丰富的图形化工具和驱动支持</li>
</ul>
<h3 id="2-2-MySQL-版本选择"><a href="#2-2-MySQL-版本选择" class="headerlink" title="2.2 MySQL 版本选择"></a>2.2 MySQL 版本选择</h3><ul>
<li><strong>MySQL Community Server</strong>：社区版，免费，适合学习和个人项目</li>
<li><strong>MySQL Enterprise Server</strong>：企业版，收费，提供高级功能和技术支持</li>
<li><strong>MySQL Cluster</strong>：集群版，适合高可用场景</li>
</ul>
<p><strong>建议初学者使用 MySQL 8.0 社区版</strong>。</p>
<h2 id="三、MySQL-安装与配置（Windows）"><a href="#三、MySQL-安装与配置（Windows）" class="headerlink" title="三、MySQL 安装与配置（Windows）"></a>三、MySQL 安装与配置（Windows）</h2><h3 id="3-1-下载安装包"><a href="#3-1-下载安装包" class="headerlink" title="3.1 下载安装包"></a>3.1 下载安装包</h3><ol>
<li>访问 MySQL 官网：<a href="https://dev.mysql.com/downloads/mysql/">https://dev.mysql.com/downloads/mysql/</a></li>
<li>选择对应操作系统的版本</li>
<li>下载 MySQL Installer（推荐）或 Zip Archive</li>
</ol>
<h3 id="3-2-使用-Installer-安装（推荐）"><a href="#3-2-使用-Installer-安装（推荐）" class="headerlink" title="3.2 使用 Installer 安装（推荐）"></a>3.2 使用 Installer 安装（推荐）</h3><ol>
<li>运行 <code>mysql-installer-community-8.0.x.msi</code></li>
<li>选择安装类型：<ul>
<li><strong>Developer Default</strong>：开发默认（推荐）</li>
<li><strong>Server only</strong>：仅服务器</li>
<li><strong>Client only</strong>：仅客户端</li>
<li><strong>Full</strong>：完全安装</li>
</ul>
</li>
<li>设置 root 密码（<strong>重要！请务必记住</strong>）</li>
<li>配置 MySQL 服务：<ul>
<li>服务名：<code>MySQL80</code></li>
<li>端口：<code>3306</code>（默认）</li>
</ul>
</li>
<li>完成安装</li>
</ol>
<h3 id="3-3-使用-Zip-Archive-手动安装"><a href="#3-3-使用-Zip-Archive-手动安装" class="headerlink" title="3.3 使用 Zip Archive 手动安装"></a>3.3 使用 Zip Archive 手动安装</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 1. 解压到指定目录，如 C:\mysql</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 创建配置文件 my.ini</span></span><br><span class="line">[mysqld]</span><br><span class="line">port=3306</span><br><span class="line">basedir=C:\mysql</span><br><span class="line">datadir=C:\mysql\data</span><br><span class="line">max_connections=200</span><br><span class="line">character-set-server=utf8mb4</span><br><span class="line">default-storage-engine=INNODB</span><br><span class="line"></span><br><span class="line">[mysql]</span><br><span class="line">default-character-set=utf8mb4</span><br><span class="line"></span><br><span class="line">[client]</span><br><span class="line">port=3306</span><br><span class="line">default-character-set=utf8mb4</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 初始化数据库（使用管理员权限运行 CMD）</span></span><br><span class="line"><span class="built_in">cd</span> C:\mysql\bin</span><br><span class="line">mysqld --initialize-insecure --console</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. 安装服务</span></span><br><span class="line">mysqld --install</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5. 启动服务</span></span><br><span class="line">net start mysql</span><br><span class="line"></span><br><span class="line"><span class="comment"># 6. 首次登录（无密码）</span></span><br><span class="line">mysql -u root -p</span><br><span class="line"><span class="comment"># 直接回车即可</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 7. 修改 root 密码</span></span><br><span class="line">ALTER USER <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> IDENTIFIED BY <span class="string">&#x27;你的密码&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h3 id="3-4-验证安装"><a href="#3-4-验证安装" class="headerlink" title="3.4 验证安装"></a>3.4 验证安装</h3><p>打开命令行，执行以下命令验证 MySQL 是否正常运行：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 查看 MySQL 服务状态</span></span><br><span class="line">net start | findstr MySQL</span><br><span class="line"></span><br><span class="line"><span class="comment"># 登录 MySQL</span></span><br><span class="line">mysql -u root -p</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看版本</span></span><br><span class="line">mysql --version</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在 MySQL 中查看数据库</span></span><br><span class="line">SHOW DATABASES;</span><br></pre></td></tr></table></figure>

<h3 id="3-5-常用服务命令"><a href="#3-5-常用服务命令" class="headerlink" title="3.5 常用服务命令"></a>3.5 常用服务命令</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Windows 服务命令</span></span><br><span class="line">net start mysql80      <span class="comment"># 启动服务</span></span><br><span class="line">net stop mysql80       <span class="comment"># 停止服务</span></span><br><span class="line">net restart mysql80    <span class="comment"># 重启服务</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Linux 服务命令</span></span><br><span class="line"><span class="built_in">sudo</span> systemctl start mysql</span><br><span class="line"><span class="built_in">sudo</span> systemctl stop mysql</span><br><span class="line"><span class="built_in">sudo</span> systemctl restart mysql</span><br><span class="line"><span class="built_in">sudo</span> systemctl status mysql</span><br></pre></td></tr></table></figure>

<h2 id="四、数据模型"><a href="#四、数据模型" class="headerlink" title="四、数据模型"></a>四、数据模型</h2><h3 id="4-1-什么是数据模型？"><a href="#4-1-什么是数据模型？" class="headerlink" title="4.1 什么是数据模型？"></a>4.1 什么是数据模型？</h3><p><strong>数据模型</strong> 是对现实世界数据的抽象描述，它定义了数据的结构、操作和约束。</p>
<h3 id="4-2-关系模型"><a href="#4-2-关系模型" class="headerlink" title="4.2 关系模型"></a>4.2 关系模型</h3><p>MySQL 使用的是<strong>关系模型</strong>，主要概念包括：</p>
<table>
<thead>
<tr>
<th>概念</th>
<th>说明</th>
<th>对应表结构</th>
</tr>
</thead>
<tbody><tr>
<td>表（Table）</td>
<td>数据的集合</td>
<td>一张二维表</td>
</tr>
<tr>
<td>行（Row）</td>
<td>一条记录</td>
<td>表中的一行数据</td>
</tr>
<tr>
<td>列（Column）</td>
<td>一个字段</td>
<td>表中的一列</td>
</tr>
<tr>
<td>主键（Primary Key）</td>
<td>唯一标识一条记录</td>
<td>不能重复，不能为空</td>
</tr>
<tr>
<td>外键（Foreign Key）</td>
<td>关联其他表的主键</td>
<td>建立表与表之间的关系</td>
</tr>
</tbody></table>
<h3 id="4-3-ER-图（实体-关系图）"><a href="#4-3-ER-图（实体-关系图）" class="headerlink" title="4.3 ER 图（实体 - 关系图）"></a>4.3 ER 图（实体 - 关系图）</h3><p>ER 图用于描述实体之间的关系，基本元素：</p>
<ul>
<li><strong>矩形</strong>：表示实体（如：学生、课程）</li>
<li><strong>椭圆</strong>：表示属性（如：姓名、学号）</li>
<li><strong>菱形</strong>：表示关系（如：选课）</li>
<li><strong>连线</strong>：连接各元素，标注关系类型</li>
</ul>
<h3 id="4-4-关系的类型"><a href="#4-4-关系的类型" class="headerlink" title="4.4 关系的类型"></a>4.4 关系的类型</h3><ol>
<li><strong>一对一（1:1）</strong>：一个学生对应一个身份证号码</li>
<li><strong>一对多（1:N）</strong>：一个部门有多名员工</li>
<li><strong>多对多（N:M）</strong>：学生可以选多门课，一门课可以被多个学生选</li>
</ol>
<h3 id="4-5-数据库范式"><a href="#4-5-数据库范式" class="headerlink" title="4.5 数据库范式"></a>4.5 数据库范式</h3><p>范式是设计数据库时遵循的规范，目的是减少数据冗余，提高数据一致性。</p>
<p><strong>第一范式（1NF）</strong>：每个列都不可再分</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">错误示例：</span><br><span class="line">| 姓名 | 联系方式          |</span><br><span class="line">|------|-------------------|</span><br><span class="line">| 张三 | 手机：138xxx; 固话：010xxx |</span><br><span class="line"></span><br><span class="line">正确示例：</span><br><span class="line">| 姓名 | 手机号  | 固话    |</span><br><span class="line">|------|--------|---------|</span><br><span class="line">| 张三 | 138xxx | 010xxx  |</span><br></pre></td></tr></table></figure>

<p><strong>第二范式（2NF）</strong>：在 1NF 基础上，非主键字段完全依赖于主键</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">错误示例（主键为学号 + 课程）：</span><br><span class="line">| 学号 | 课程 | 学生姓名 | 成绩 |</span><br><span class="line">|------|------|----------|------|</span><br><span class="line">| 001  | 数学 | 张三     | 90   |</span><br><span class="line"></span><br><span class="line">问题：学生姓名只依赖于学号，与课程无关</span><br><span class="line"></span><br><span class="line">正确示例（拆分为两张表）：</span><br><span class="line">学生表：| 学号 | 学生姓名 |</span><br><span class="line">成绩表：| 学号 | 课程 | 成绩 |</span><br></pre></td></tr></table></figure>

<p><strong>第三范式（3NF）</strong>：在 2NF 基础上，非主键字段之间不能相互依赖</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">错误示例：</span><br><span class="line">| 学号 | 姓名 | 系名 | 系主任 |</span><br><span class="line">|------|------|------|--------|</span><br><span class="line">| 001  | 张三 | 计算机系 | 李四 |</span><br><span class="line"></span><br><span class="line">问题：系主任依赖于系名，而不是学号</span><br><span class="line"></span><br><span class="line">正确示例（拆分）：</span><br><span class="line">学生表：| 学号 | 姓名 | 系名 |</span><br><span class="line">系表：  | 系名 | 系主任 |</span><br></pre></td></tr></table></figure>

<h2 id="五、SQL-语法及分类"><a href="#五、SQL-语法及分类" class="headerlink" title="五、SQL 语法及分类"></a>五、SQL 语法及分类</h2><h3 id="5-1-SQL-通用语法"><a href="#5-1-SQL-通用语法" class="headerlink" title="5.1 SQL 通用语法"></a>5.1 SQL 通用语法</h3><ol>
<li><strong>语句以分号结尾</strong></li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> students;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><strong>不区分大小写</strong>（推荐关键字大写，表名、列名小写）</li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> students;  <span class="comment">-- 合法</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> students;  <span class="comment">-- 推荐</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li><strong>注释</strong></li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 单行注释</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 多行注释 */</span></span><br><span class="line"></span><br><span class="line"># MySQL 特有的单行注释</span><br></pre></td></tr></table></figure>

<ol start="4">
<li><strong>字符串使用单引号或双引号</strong></li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="string">&#x27;Hello&#x27;</span>, &quot;World&quot;;</span><br></pre></td></tr></table></figure>

<h3 id="5-2-SQL-的分类"><a href="#5-2-SQL-的分类" class="headerlink" title="5.2 SQL 的分类"></a>5.2 SQL 的分类</h3><p>SQL 语言分为四大类：</p>
<h4 id="1-DDL（Data-Definition-Language，数据定义语言）"><a href="#1-DDL（Data-Definition-Language，数据定义语言）" class="headerlink" title="1. DDL（Data Definition Language，数据定义语言）"></a>1. DDL（Data Definition Language，数据定义语言）</h4><p>用于定义和管理数据库对象（库、表、索引等）。</p>
<table>
<thead>
<tr>
<th>命令</th>
<th>功能</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td>CREATE</td>
<td>创建对象</td>
<td><code>CREATE DATABASE db_name;</code></td>
</tr>
<tr>
<td>ALTER</td>
<td>修改对象</td>
<td><code>ALTER TABLE tb_name ADD COLUMN ...;</code></td>
</tr>
<tr>
<td>DROP</td>
<td>删除对象</td>
<td><code>DROP TABLE tb_name;</code></td>
</tr>
<tr>
<td>TRUNCATE</td>
<td>清空表</td>
<td><code>TRUNCATE TABLE tb_name;</code></td>
</tr>
<tr>
<td>RENAME</td>
<td>重命名</td>
<td><code>RENAME TABLE old TO new;</code></td>
</tr>
</tbody></table>
<h4 id="2-DML（Data-Manipulation-Language，数据操作语言）"><a href="#2-DML（Data-Manipulation-Language，数据操作语言）" class="headerlink" title="2. DML（Data Manipulation Language，数据操作语言）"></a>2. DML（Data Manipulation Language，数据操作语言）</h4><p>用于对表中数据进行增删改操作。</p>
<table>
<thead>
<tr>
<th>命令</th>
<th>功能</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td>INSERT</td>
<td>插入数据</td>
<td><code>INSERT INTO tb VALUES (...);</code></td>
</tr>
<tr>
<td>UPDATE</td>
<td>更新数据</td>
<td><code>UPDATE tb SET col=val WHERE ...;</code></td>
</tr>
<tr>
<td>DELETE</td>
<td>删除数据</td>
<td><code>DELETE FROM tb WHERE ...;</code></td>
</tr>
</tbody></table>
<h4 id="3-DQL（Data-Query-Language，数据查询语言）"><a href="#3-DQL（Data-Query-Language，数据查询语言）" class="headerlink" title="3. DQL（Data Query Language，数据查询语言）"></a>3. DQL（Data Query Language，数据查询语言）</h4><p>用于查询数据。</p>
<table>
<thead>
<tr>
<th>命令</th>
<th>功能</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td>SELECT</td>
<td>查询数据</td>
<td><code>SELECT * FROM tb;</code></td>
</tr>
</tbody></table>
<p>DQL 是 SQL 中使用频率最高的部分，包含：</p>
<ul>
<li>基础查询</li>
<li>条件查询</li>
<li>聚合函数</li>
<li>分组查询</li>
<li>排序查询</li>
<li>分页查询</li>
<li>多表连接查询</li>
</ul>
<h4 id="4-DCL（Data-Control-Language，数据控制语言）"><a href="#4-DCL（Data-Control-Language，数据控制语言）" class="headerlink" title="4. DCL（Data Control Language，数据控制语言）"></a>4. DCL（Data Control Language，数据控制语言）</h4><p>用于管理数据库权限和事务控制。</p>
<table>
<thead>
<tr>
<th>命令</th>
<th>功能</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td>GRANT</td>
<td>授权</td>
<td><code>GRANT SELECT ON db.* TO user;</code></td>
</tr>
<tr>
<td>REVOKE</td>
<td>撤销权限</td>
<td><code>REVOKE SELECT ON db.* FROM user;</code></td>
</tr>
<tr>
<td>COMMIT</td>
<td>提交事务</td>
<td><code>COMMIT;</code></td>
</tr>
<tr>
<td>ROLLBACK</td>
<td>回滚事务</td>
<td><code>ROLLBACK;</code></td>
</tr>
</tbody></table>
<h3 id="5-3-SQL-执行顺序概览"><a href="#5-3-SQL-执行顺序概览" class="headerlink" title="5.3 SQL 执行顺序概览"></a>5.3 SQL 执行顺序概览</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">FROM → WHERE → GROUP BY → HAVING → SELECT → ORDER BY → LIMIT</span><br></pre></td></tr></table></figure>

<p>这个执行顺序将在 DQL 章节详细讲解。</p>
<h2 id="六、第一个-SQL-示例"><a href="#六、第一个-SQL-示例" class="headerlink" title="六、第一个 SQL 示例"></a>六、第一个 SQL 示例</h2><p>登录 MySQL 后，尝试以下命令：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 查看所有数据库</span></span><br><span class="line"><span class="keyword">SHOW</span> DATABASES;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建数据库</span></span><br><span class="line"><span class="keyword">CREATE</span> DATABASE mydb;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 使用数据库</span></span><br><span class="line">USE mydb;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建表</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> students (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT,</span><br><span class="line">    name <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">    age <span class="type">INT</span>,</span><br><span class="line">    gender <span class="type">VARCHAR</span>(<span class="number">10</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看表结构</span></span><br><span class="line"><span class="keyword">DESC</span> students;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 插入数据</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> students (name, age, gender) <span class="keyword">VALUES</span> (<span class="string">&#x27;张三&#x27;</span>, <span class="number">18</span>, <span class="string">&#x27;男&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT INTO</span> students (name, age, gender) <span class="keyword">VALUES</span> (<span class="string">&#x27;李四&#x27;</span>, <span class="number">19</span>, <span class="string">&#x27;女&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询数据</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> students;</span><br></pre></td></tr></table></figure>

<h2 id="七、小结"><a href="#七、小结" class="headerlink" title="七、小结"></a>七、小结</h2><p>本文我们学习了：</p>
<ol>
<li><strong>数据库基础概念</strong>：数据库、DBMS、SQL 的定义和作用</li>
<li><strong>MySQL 简介</strong>：特点、版本选择</li>
<li><strong>MySQL 安装配置</strong>：Windows 下的安装步骤和服务管理</li>
<li><strong>数据模型</strong>：关系模型、ER 图、三大范式</li>
<li><strong>SQL 语法及分类</strong>：DDL、DML、DQL、DCL 四大类</li>
</ol>
<h2 id="八、练习与思考"><a href="#八、练习与思考" class="headerlink" title="八、练习与思考"></a>八、练习与思考</h2><ol>
<li>在本地成功安装 MySQL，并能够使用命令行登录</li>
<li>记住 root 用户的密码</li>
<li>了解 SQL 四大分类各自的作用和常用命令</li>
<li>思考：为什么数据库设计要遵循范式？</li>
</ol>
<hr>
<p><strong>下一篇</strong>：[MySQL 基础教程（二）：DDL 数据定义语言详解](&#x2F;2026&#x2F;02&#x2F;23&#x2F;MySQL 基础教程（二）DDL 数据定义语言详解&#x2F;)</p>
]]></content>
      <categories>
        <category>MySQL 基础教程</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
        <tag>数据库</tag>
        <tag>入门</tag>
      </tags>
  </entry>
  <entry>
    <title>Markdown 语法教程——如何写博客</title>
    <url>/2026/02/24/Markdown%20%E8%AF%AD%E6%B3%95%E6%95%99%E7%A8%8B%E2%80%94%E2%80%94%E5%A6%82%E4%BD%95%E5%86%99%E5%8D%9A%E5%AE%A2/</url>
    <content><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>这篇教程是写给我自己的 Markdown 语法备忘录。记录常用的 Markdown 语法和博客配置，方便以后写博客时快速查阅。</p>
<blockquote>
<p><strong>提醒自己</strong>：写博客不是为了追求完美，而是为了记录和分享。不要等到什么都准备好了才开始，先写起来，在写作中不断完善。</p>
</blockquote>
<h2 id="一、Markdown-基础语法"><a href="#一、Markdown-基础语法" class="headerlink" title="一、Markdown 基础语法"></a>一、Markdown 基础语法</h2><h3 id="1-1-标题"><a href="#1-1-标题" class="headerlink" title="1.1 标题"></a>1.1 标题</h3><p>使用 <code>#</code> 符号来定义标题：</p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line"><span class="section"># 一级标题（文章标题，每篇文章只能有一个）</span></span><br><span class="line"><span class="section">## 二级标题（主要章节）</span></span><br><span class="line"><span class="section">### 三级标题（小节）</span></span><br><span class="line"><span class="section">#### 四级标题（细分内容）</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>提醒自己</strong>：</p>
<ul>
<li>文章标题用一级标题，正文中从二级标题开始</li>
<li>标题层级要清晰，不要跳级使用（比如不要从 ## 直接跳到 ####）</li>
<li>每个大章节用 ##，子内容用 ###</li>
</ul>
</blockquote>
<h3 id="1-2-段落与换行"><a href="#1-2-段落与换行" class="headerlink" title="1.2 段落与换行"></a>1.2 段落与换行</h3><figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">这是第一段。段落之间要空一行。</span><br><span class="line"></span><br><span class="line">这是第二段。行尾加两个空格可以强制换行。</span><br><span class="line">这是换行后的内容。</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>提醒自己</strong>：</p>
<ul>
<li>段落不要太长，3-5 句一段比较合适</li>
<li>代码教程中，解释和代码示例之间要空行，方便阅读</li>
</ul>
</blockquote>
<h3 id="1-3-文本样式"><a href="#1-3-文本样式" class="headerlink" title="1.3 文本样式"></a>1.3 文本样式</h3><table>
<thead>
<tr>
<th>样式</th>
<th>语法</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td>粗体</td>
<td><code>**文本**</code></td>
<td><strong>重要内容</strong></td>
</tr>
<tr>
<td>斜体</td>
<td><code>*文本*</code></td>
<td><em>强调一下</em></td>
</tr>
<tr>
<td>删除线</td>
<td><code>~~文本~~</code></td>
<td><del>过时的内容</del></td>
</tr>
</tbody></table>
<blockquote>
<p><strong>提醒自己</strong>：</p>
<ul>
<li>粗体用于强调<strong>关键概念</strong>和<strong>重要提示</strong></li>
<li>不要滥用粗体，满篇都是重点就没有重点了</li>
<li>斜体可以用来标注<em>英文术语</em>或<em>书名</em></li>
</ul>
</blockquote>
<h3 id="1-4-引用块"><a href="#1-4-引用块" class="headerlink" title="1.4 引用块"></a>1.4 引用块</h3><figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line"><span class="quote">&gt; 这是一级引用</span></span><br><span class="line"><span class="quote">&gt; &gt; 这是嵌套引用</span></span><br><span class="line"><span class="quote">&gt;</span></span><br><span class="line"><span class="quote">&gt; 这是引用的另一段</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>提醒自己</strong>：引用块适合用于：</p>
<ul>
<li>引用官方文档的原文</li>
<li>标注注意事项</li>
<li>记录他人的观点</li>
</ul>
</blockquote>
<h2 id="二、列表的使用"><a href="#二、列表的使用" class="headerlink" title="二、列表的使用"></a>二、列表的使用</h2><h3 id="2-1-无序列表"><a href="#2-1-无序列表" class="headerlink" title="2.1 无序列表"></a>2.1 无序列表</h3><figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line"><span class="bullet">-</span> 项目 1</span><br><span class="line"><span class="bullet">-</span> 项目 2</span><br><span class="line"><span class="bullet">  -</span> 子项目（前面加两个空格）</span><br><span class="line"><span class="bullet">  -</span> 子项目</span><br><span class="line"><span class="bullet">-</span> 项目 3</span><br></pre></td></tr></table></figure>

<h3 id="2-2-有序列表"><a href="#2-2-有序列表" class="headerlink" title="2.2 有序列表"></a>2.2 有序列表</h3><figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line"><span class="bullet">1.</span> 第一步</span><br><span class="line"><span class="bullet">2.</span> 第二步</span><br><span class="line"><span class="bullet">3.</span> 第三步</span><br></pre></td></tr></table></figure>

<h3 id="2-3-任务列表"><a href="#2-3-任务列表" class="headerlink" title="2.3 任务列表"></a>2.3 任务列表</h3><figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line"><span class="bullet">-</span> [x] 已完成</span><br><span class="line"><span class="bullet">-</span> [ ] 待完成</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>提醒自己</strong>：</p>
<ul>
<li>并列的内容用无序列表</li>
<li>有顺序的步骤用有序列表（比如教程的操作步骤）</li>
<li>任务列表可以用来做 TODO 清单</li>
</ul>
</blockquote>
<h2 id="三、代码展示"><a href="#三、代码展示" class="headerlink" title="三、代码展示"></a>三、代码展示</h2><h3 id="3-1-行内代码"><a href="#3-1-行内代码" class="headerlink" title="3.1 行内代码"></a>3.1 行内代码</h3><figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">使用 <span class="code">`console.log()`</span> 输出，使用 <span class="code">`print()`</span> 打印。</span><br></pre></td></tr></table></figure>

<p>效果：使用 <code>console.log()</code> 输出，使用 <code>print()</code> 打印。</p>
<h3 id="3-2-代码块"><a href="#3-2-代码块" class="headerlink" title="3.2 代码块"></a>3.2 代码块</h3><figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line"><span class="code">```语言名称</span></span><br><span class="line"><span class="code">代码内容</span></span><br><span class="line"><span class="code">```</span></span><br></pre></td></tr></table></figure>

<p>支持的语言：<code>javascript</code>、<code>python</code>、<code>sql</code>、<code>java</code>、<code>cpp</code>、<code>html</code>、<code>css</code>、<code>json</code>、<code>yaml</code> 等。</p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line"><span class="code">```javascript</span></span><br><span class="line"><span class="code">// JavaScript 示例</span></span><br><span class="line"><span class="code">function sayHello() &#123;</span></span><br><span class="line"><span class="code">    console.log(&quot;Hello!&quot;);</span></span><br><span class="line"><span class="code">&#125;</span></span><br><span class="line"><span class="code">```</span></span><br><span class="line"></span><br><span class="line"><span class="code">```python</span></span><br><span class="line"><span class="code"># Python 示例</span></span><br><span class="line"><span class="code">def say_hello():</span></span><br><span class="line"><span class="code">    print(&quot;Hello!&quot;)</span></span><br><span class="line"><span class="code">```</span></span><br><span class="line"></span><br><span class="line"><span class="code">```sql</span></span><br><span class="line"><span class="code">-- SQL 示例</span></span><br><span class="line"><span class="code">SELECT * FROM users WHERE id = 1;</span></span><br><span class="line"><span class="code">```</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>提醒自己</strong>：</p>
<ul>
<li>代码块一定要标注语言，这样才有语法高亮</li>
<li>代码示例要简洁，只展示关键部分</li>
<li>复杂的代码要加注释说明</li>
<li>SQL 代码用 <code>sql</code>，不要用 <code>mysql</code>（可能不支持）</li>
</ul>
</blockquote>
<h2 id="四、链接与图片"><a href="#四、链接与图片" class="headerlink" title="四、链接与图片"></a>四、链接与图片</h2><h3 id="4-1-链接"><a href="#4-1-链接" class="headerlink" title="4.1 链接"></a>4.1 链接</h3><figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">[<span class="string">显示文字</span>](<span class="link">https://www.example.com</span>)</span><br><span class="line">[<span class="string">带标题</span>](<span class="link">https://www.example.com &quot;鼠标悬停显示的标题&quot;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="4-2-图片"><a href="#4-2-图片" class="headerlink" title="4.2 图片"></a>4.2 图片</h3><figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">![<span class="string">替代文字</span>](<span class="link">图片路径</span>)</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>提醒自己</strong>：</p>
<ul>
<li>图片放在 <code>source/img/</code> 目录下</li>
<li>引用时使用 <code>/img/图片名.jpg</code></li>
<li>替代文字要描述图片内容，方便 SEO</li>
<li>图片不要太大，影响加载速度</li>
<li>教程中的截图要清晰，关键部分可以用红框标注</li>
</ul>
</blockquote>
<h2 id="五、表格"><a href="#五、表格" class="headerlink" title="五、表格"></a>五、表格</h2><figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">| 表头 1 | 表头 2 | 表头 3 |</span><br><span class="line">|--------|--------|--------|</span><br><span class="line">| 内容 1 | 内容 2 | 内容 3 |</span><br></pre></td></tr></table></figure>

<p>效果：</p>
<table>
<thead>
<tr>
<th>表头 1</th>
<th>表头 2</th>
<th>表头 3</th>
</tr>
</thead>
<tbody><tr>
<td>内容 1</td>
<td>内容 2</td>
<td>内容 3</td>
</tr>
</tbody></table>
<h3 id="表格对齐"><a href="#表格对齐" class="headerlink" title="表格对齐"></a>表格对齐</h3><figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">| 左对齐 | 居中 | 右对齐 |</span><br><span class="line">|:-------|:----:|-------:|</span><br><span class="line">| 内容 | 内容 | 内容 |</span><br></pre></td></tr></table></figure>

<p>效果：</p>
<table>
<thead>
<tr>
<th align="left">左对齐</th>
<th align="center">居中</th>
<th align="right">右对齐</th>
</tr>
</thead>
<tbody><tr>
<td align="left">内容</td>
<td align="center">内容</td>
<td align="right">内容</td>
</tr>
</tbody></table>
<blockquote>
<p><strong>提醒自己</strong>：</p>
<ul>
<li>表格适合对比多个项目的属性</li>
<li>教程中可以用表格总结知识点</li>
<li>表格不要太复杂，列数控制在 5 列以内</li>
</ul>
</blockquote>
<h2 id="六、Hexo-博客配置"><a href="#六、Hexo-博客配置" class="headerlink" title="六、Hexo 博客配置"></a>六、Hexo 博客配置</h2><h3 id="6-1-Front-Matter（文章头部配置）"><a href="#6-1-Front-Matter（文章头部配置）" class="headerlink" title="6.1 Front Matter（文章头部配置）"></a>6.1 Front Matter（文章头部配置）</h3><p>每篇文章开头必须有这个：</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">title:</span> <span class="string">文章标题</span></span><br><span class="line"><span class="attr">date:</span> <span class="number">2026-02-24 10:00:00</span></span><br><span class="line"><span class="attr">categories:</span> <span class="string">分类名称</span></span><br><span class="line"><span class="attr">tags:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">标签</span> <span class="number">1</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">标签</span> <span class="number">2</span></span><br><span class="line"><span class="meta">---</span></span><br></pre></td></tr></table></figure>

<h3 id="6-2-常用配置字段"><a href="#6-2-常用配置字段" class="headerlink" title="6.2 常用配置字段"></a>6.2 常用配置字段</h3><table>
<thead>
<tr>
<th>字段</th>
<th>说明</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td><code>title</code></td>
<td>文章标题</td>
<td><code>title: MySQL 教程</code></td>
</tr>
<tr>
<td><code>date</code></td>
<td>发布时间</td>
<td><code>date: 2026-02-24 10:00:00</code></td>
</tr>
<tr>
<td><code>categories</code></td>
<td>分类</td>
<td><code>categories: 技术教程</code></td>
</tr>
<tr>
<td><code>tags</code></td>
<td>标签（多个）</td>
<td><code>tags: [MySQL, 数据库]</code></td>
</tr>
<tr>
<td><code>top</code></td>
<td>置顶（数字越大越靠前）</td>
<td><code>top: 100</code></td>
</tr>
<tr>
<td><code>cover</code></td>
<td>封面图</td>
<td><code>cover: /img/cover.jpg</code></td>
</tr>
</tbody></table>
<blockquote>
<p><strong>提醒自己</strong>：</p>
<ul>
<li><code>categories</code> 用现有的分类，保持一致性</li>
<li><code>tags</code> 可以多个，用短横线开头</li>
<li>系列教程要统一分类名称</li>
<li>重要文章可以设置 <code>top</code> 置顶</li>
</ul>
</blockquote>
<h3 id="6-3-常用命令"><a href="#6-3-常用命令" class="headerlink" title="6.3 常用命令"></a>6.3 常用命令</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 创建新文章</span></span><br><span class="line">hexo new post <span class="string">&quot;文章标题&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动本地服务器预览</span></span><br><span class="line">hexo server</span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成静态文件</span></span><br><span class="line">hexo generate</span><br><span class="line"></span><br><span class="line"><span class="comment"># 部署到 GitHub</span></span><br><span class="line">hexo deploy</span><br><span class="line"></span><br><span class="line"><span class="comment"># 或者直接生成 + 部署</span></span><br><span class="line">hexo g -d</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>提醒自己</strong>：</p>
<ul>
<li>发布前一定要 <code>hexo server</code> 本地预览一下</li>
<li>检查有没有格式问题、图片是否能正常显示</li>
<li>部署命令是 <code>hexo g -d</code>（generate + deploy）</li>
</ul>
</blockquote>
<h2 id="七、写作流程提醒"><a href="#七、写作流程提醒" class="headerlink" title="七、写作流程提醒"></a>七、写作流程提醒</h2><h3 id="7-1-写作前"><a href="#7-1-写作前" class="headerlink" title="7.1 写作前"></a>7.1 写作前</h3><ul>
<li><input disabled="" type="checkbox"> 确定文章主题和分类</li>
<li><input disabled="" type="checkbox"> 想好文章结构（可以用大纲）</li>
<li><input disabled="" type="checkbox"> 准备好需要用到的图片素材</li>
</ul>
<h3 id="7-2-写作中"><a href="#7-2-写作中" class="headerlink" title="7.2 写作中"></a>7.2 写作中</h3><ul>
<li><input disabled="" type="checkbox"> 先写内容，不要纠结格式</li>
<li><input disabled="" type="checkbox"> 用标题划分章节</li>
<li><input disabled="" type="checkbox"> 代码示例要测试过再贴上去</li>
<li><input disabled="" type="checkbox"> 关键步骤要解释清楚</li>
</ul>
<h3 id="7-3-发布前检查清单"><a href="#7-3-发布前检查清单" class="headerlink" title="7.3 发布前检查清单"></a>7.3 发布前检查清单</h3><ul>
<li><input disabled="" type="checkbox"> 标题有没有错别字</li>
<li><input disabled="" type="checkbox"> Front Matter 配置是否正确（分类、标签）</li>
<li><input disabled="" type="checkbox"> 代码块有没有标注语言</li>
<li><input disabled="" type="checkbox"> 图片路径是否正确，能否正常显示</li>
<li><input disabled="" type="checkbox"> 本地预览效果是否正常</li>
<li><input disabled="" type="checkbox"> 有没有明显的错别字或语病</li>
</ul>
<blockquote>
<p><strong>提醒自己</strong>：</p>
<ul>
<li>不要追求完美，完成比完美重要</li>
<li>文章可以后续修改，先发布再说</li>
<li>读者的反馈会帮助你改进</li>
</ul>
</blockquote>
<h2 id="八、Butterfly-主题特有功能"><a href="#八、Butterfly-主题特有功能" class="headerlink" title="八、Butterfly 主题特有功能"></a>八、Butterfly 主题特有功能</h2><h3 id="8-1-笔记块（Notes）"><a href="#8-1-笔记块（Notes）" class="headerlink" title="8.1 笔记块（Notes）"></a>8.1 笔记块（Notes）</h3><p>Butterfly 主题支持笔记块：</p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">&#123;% note [class] %&#125;</span><br><span class="line">笔记内容</span><br><span class="line">&#123;% endnote %&#125;</span><br></pre></td></tr></table></figure>

<p>class 可以是：<code>default</code>、<code>primary</code>、<code>info</code>、<code>success</code>、<code>warning</code>、<code>danger</code></p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">&#123;% note warning %&#125;</span><br><span class="line">这是一个警告提示！</span><br><span class="line">&#123;% endnote %&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>提醒自己</strong>：笔记块适合用于：</p>
<ul>
<li>标注注意事项</li>
<li>强调重要内容</li>
<li>添加补充说明</li>
</ul>
</blockquote>
<h3 id="8-2-标签页"><a href="#8-2-标签页" class="headerlink" title="8.2 标签页"></a>8.2 标签页</h3><figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">&#123;% tabs UniqueID %&#125;</span><br><span class="line">&#123;% tab 标签名 1 %&#125;</span><br><span class="line">内容 1</span><br><span class="line">&#123;% endtab %&#125;</span><br><span class="line">&#123;% tab 标签名 2 %&#125;</span><br><span class="line">内容 2</span><br><span class="line">&#123;% endtab %&#125;</span><br><span class="line">&#123;% endtabs %&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>提醒自己</strong>：标签页适合展示同一内容的不同版本（比如不同语言的代码实现）</p>
</blockquote>
<h2 id="九、常见错误与解决方法"><a href="#九、常见错误与解决方法" class="headerlink" title="九、常见错误与解决方法"></a>九、常见错误与解决方法</h2><table>
<thead>
<tr>
<th>问题</th>
<th>可能原因</th>
<th>解决方法</th>
</tr>
</thead>
<tbody><tr>
<td>文章不显示</td>
<td>Front Matter 格式错误</td>
<td>检查 <code>---</code> 是否成对，YAML 格式是否正确</td>
</tr>
<tr>
<td>图片不显示</td>
<td>路径错误</td>
<td>图片放在 <code>source/img/</code>，引用用 <code>/img/xxx</code></td>
</tr>
<tr>
<td>代码没有高亮</td>
<td>没标注语言</td>
<td>在 ``` 后面加上语言名称</td>
</tr>
<tr>
<td>分类&#x2F;标签不显示</td>
<td>拼写不一致</td>
<td>保持分类&#x2F;标签名称一致，注意大小写</td>
</tr>
<tr>
<td>本地预览正常，部署后异常</td>
<td>缓存问题</td>
<td>执行 <code>hexo clean &amp;&amp; hexo g -d</code></td>
</tr>
</tbody></table>
<h2 id="十、总结"><a href="#十、总结" class="headerlink" title="十、总结"></a>十、总结</h2><h3 id="核心语法（必须掌握）"><a href="#核心语法（必须掌握）" class="headerlink" title="核心语法（必须掌握）"></a>核心语法（必须掌握）</h3><ul>
<li>标题 <code>#</code></li>
<li>段落（空行分隔）</li>
<li>粗体 <code>**</code></li>
<li>列表 <code>-</code> 和 <code>1.</code></li>
<li>代码块 ```</li>
<li>链接 <code>[]()</code></li>
<li>图片 <code>![]()</code></li>
</ul>
<h3 id="写给自己的话"><a href="#写给自己的话" class="headerlink" title="写给自己的话"></a>写给自己的话</h3><blockquote>
<p><strong>记住</strong>：</p>
<ol>
<li>写作是一个思考的过程，不要等想清楚了再写，写本身就是思考</li>
<li>第一篇总是最难写的，写下去就好了</li>
<li>文章不需要完美，只要能帮助到别人（包括未来的自己）就有价值</li>
<li>持续更新比单篇质量更重要</li>
<li>读者的反馈是改进的动力</li>
</ol>
</blockquote>
<hr>
<p><strong>参考资源</strong>：</p>
<ul>
<li><a href="https://daringfireball.net/projects/markdown/">Markdown 官方文档</a></li>
<li><a href="https://www.markdownguide.org/">Markdown Guide</a></li>
<li><a href="https://hexo.io/zh-cn/">Hexo 官方文档</a></li>
<li><a href="https://butterfly.js.org/">Butterfly 主题文档</a></li>
</ul>
]]></content>
      <categories>
        <category>技术教程</category>
      </categories>
      <tags>
        <tag>Markdown</tag>
        <tag>博客写作</tag>
        <tag>入门教程</tag>
        <tag>个人笔记</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQL 基础教程（五）DCL 数据控制语言详解</title>
    <url>/2026/02/23/MySQL%20%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B%EF%BC%88%E4%BA%94%EF%BC%89DCL%20%E6%95%B0%E6%8D%AE%E6%8E%A7%E5%88%B6%E8%AF%AD%E8%A8%80%E8%AF%A6%E8%A7%A3/</url>
    <content><![CDATA[<h1 id="MySQL-基础教程（五）DCL-数据控制语言详解"><a href="#MySQL-基础教程（五）DCL-数据控制语言详解" class="headerlink" title="MySQL 基础教程（五）DCL 数据控制语言详解"></a>MySQL 基础教程（五）DCL 数据控制语言详解</h1><p>DCL（Data Control Language，数据控制语言）用于管理数据库权限和事务控制。本文我们将学习如何创建用户、管理权限，以及事务控制的相关知识。</p>
<h2 id="一、DCL-概述"><a href="#一、DCL-概述" class="headerlink" title="一、DCL 概述"></a>一、DCL 概述</h2><p>DCL 主要包含两类操作：</p>
<ol>
<li><strong>权限管理</strong>：GRANT（授权）、REVOKE（撤销权限）</li>
<li><strong>事务控制</strong>：COMMIT（提交）、ROLLBACK（回滚）、SAVEPOINT（保存点）</li>
</ol>
<table>
<thead>
<tr>
<th>命令</th>
<th>功能</th>
<th>分类</th>
</tr>
</thead>
<tbody><tr>
<td>GRANT</td>
<td>授予用户权限</td>
<td>权限管理</td>
</tr>
<tr>
<td>REVOKE</td>
<td>撤销用户权限</td>
<td>权限管理</td>
</tr>
<tr>
<td>COMMIT</td>
<td>提交事务</td>
<td>事务控制</td>
</tr>
<tr>
<td>ROLLBACK</td>
<td>回滚事务</td>
<td>事务控制</td>
</tr>
<tr>
<td>SAVEPOINT</td>
<td>设置保存点</td>
<td>事务控制</td>
</tr>
</tbody></table>
<h2 id="二、用户管理"><a href="#二、用户管理" class="headerlink" title="二、用户管理"></a>二、用户管理</h2><h3 id="2-1-用户表结构"><a href="#2-1-用户表结构" class="headerlink" title="2.1 用户表结构"></a>2.1 用户表结构</h3><p>MySQL 的用户信息存储在 <code>mysql.user</code> 表中：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 查看所有用户</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">user</span>, host <span class="keyword">FROM</span> mysql.user;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看用户详细信息</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">user</span>, host, authentication_string, plugin <span class="keyword">FROM</span> mysql.user;</span><br></pre></td></tr></table></figure>

<p><strong>用户名的组成</strong>：<code>&#39;username&#39;@&#39;host&#39;</code></p>
<ul>
<li><code>username</code>：用户名</li>
<li><code>host</code>：允许连接的主机<ul>
<li><code>localhost</code>：仅本地连接</li>
<li><code>%</code>：允许任何主机连接</li>
<li><code>192.168.1.%</code>：允许特定网段连接</li>
</ul>
</li>
</ul>
<h3 id="2-2-创建用户（CREATE-USER）"><a href="#2-2-创建用户（CREATE-USER）" class="headerlink" title="2.2 创建用户（CREATE USER）"></a>2.2 创建用户（CREATE USER）</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 基础语法</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> <span class="string">&#x27;用户名&#x27;</span>@<span class="string">&#x27;主机&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;密码&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建仅本地登录的用户</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> <span class="string">&#x27;local_user&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;password123&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建可远程登录的用户（任何主机）</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> <span class="string">&#x27;remote_user&#x27;</span>@<span class="string">&#x27;%&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;password123&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建允许特定网段登录的用户</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> <span class="string">&#x27;app_user&#x27;</span>@<span class="string">&#x27;192.168.1.%&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;password123&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建用户时不设置密码（不推荐）</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> <span class="string">&#x27;nopass_user&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建用户并指定密码过期策略</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> <span class="string">&#x27;temp_user&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span></span><br><span class="line">IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;password123&#x27;</span></span><br><span class="line">PASSWORD EXPIRE <span class="type">INTERVAL</span> <span class="number">90</span> <span class="keyword">DAY</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建用户并限制连接数</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> <span class="string">&#x27;limited_user&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span></span><br><span class="line">IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;password123&#x27;</span></span><br><span class="line"><span class="keyword">WITH</span> MAX_USER_CONNECTIONS <span class="number">10</span>;</span><br></pre></td></tr></table></figure>

<h3 id="2-3-修改用户（ALTER-USER）"><a href="#2-3-修改用户（ALTER-USER）" class="headerlink" title="2.3 修改用户（ALTER USER）"></a>2.3 修改用户（ALTER USER）</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 修改用户密码（MySQL 5.7.6+）</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">USER</span> <span class="string">&#x27;local_user&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;new_password&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 修改用户密码（MySQL 5.7.6 之前）</span></span><br><span class="line"><span class="keyword">SET</span> PASSWORD <span class="keyword">FOR</span> <span class="string">&#x27;local_user&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> <span class="operator">=</span> PASSWORD(<span class="string">&#x27;new_password&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 解锁用户</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">USER</span> <span class="string">&#x27;local_user&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> ACCOUNT UNLOCK;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 锁定用户</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">USER</span> <span class="string">&#x27;local_user&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> ACCOUNT LOCK;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 设置密码过期</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">USER</span> <span class="string">&#x27;local_user&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> PASSWORD EXPIRE;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 设置密码永不过期</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">USER</span> <span class="string">&#x27;local_user&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> PASSWORD EXPIRE NEVER;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 修改主机权限（先删除再创建）</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">USER</span> <span class="string">&#x27;local_user&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> <span class="string">&#x27;local_user&#x27;</span>@<span class="string">&#x27;%&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;password123&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h3 id="2-4-删除用户（DROP-USER）"><a href="#2-4-删除用户（DROP-USER）" class="headerlink" title="2.4 删除用户（DROP USER）"></a>2.4 删除用户（DROP USER）</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 删除用户</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">USER</span> <span class="string">&#x27;local_user&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 删除多个用户</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">USER</span> <span class="string">&#x27;user1&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span>, <span class="string">&#x27;user2&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 删除不存在的用户（MySQL 8.0+ 支持 IF EXISTS）</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">USER</span> IF <span class="keyword">EXISTS</span> <span class="string">&#x27;nonexistent&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h3 id="2-5-查看用户权限"><a href="#2-5-查看用户权限" class="headerlink" title="2.5 查看用户权限"></a>2.5 查看用户权限</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 查看当前用户</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">USER</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看当前登录用户的所有权限</span></span><br><span class="line"><span class="keyword">SHOW</span> GRANTS;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看指定用户的权限</span></span><br><span class="line"><span class="keyword">SHOW</span> GRANTS <span class="keyword">FOR</span> <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看用户表</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">user</span>, host, Select_priv, Insert_priv, Update_priv, Delete_priv</span><br><span class="line"><span class="keyword">FROM</span> mysql.user;</span><br></pre></td></tr></table></figure>

<h2 id="三、权限管理"><a href="#三、权限管理" class="headerlink" title="三、权限管理"></a>三、权限管理</h2><h3 id="3-1-权限类型"><a href="#3-1-权限类型" class="headerlink" title="3.1 权限类型"></a>3.1 权限类型</h3><p>MySQL 支持多种权限类型，按作用范围分为：</p>
<table>
<thead>
<tr>
<th>权限级别</th>
<th>说明</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td>全局权限</td>
<td>作用于所有数据库</td>
<td><code>GRANT SELECT ON *.*</code></td>
</tr>
<tr>
<td>数据库权限</td>
<td>作用于特定数据库</td>
<td><code>GRANT SELECT ON db.*</code></td>
</tr>
<tr>
<td>表权限</td>
<td>作用于特定表</td>
<td><code>GRANT SELECT ON db.table</code></td>
</tr>
<tr>
<td>列权限</td>
<td>作用于特定列</td>
<td><code>GRANT SELECT(id, name) ON db.table</code></td>
</tr>
<tr>
<td>存储过程权限</td>
<td>作用于存储过程</td>
<td><code>GRANT EXECUTE ON PROCEDURE db.proc</code></td>
</tr>
</tbody></table>
<p><strong>常用权限</strong>：</p>
<table>
<thead>
<tr>
<th>权限</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>SELECT</td>
<td>查询权限</td>
</tr>
<tr>
<td>INSERT</td>
<td>插入权限</td>
</tr>
<tr>
<td>UPDATE</td>
<td>更新权限</td>
</tr>
<tr>
<td>DELETE</td>
<td>删除权限</td>
</tr>
<tr>
<td>CREATE</td>
<td>创建数据库&#x2F;表权限</td>
</tr>
<tr>
<td>DROP</td>
<td>删除数据库&#x2F;表权限</td>
</tr>
<tr>
<td>ALTER</td>
<td>修改表结构权限</td>
</tr>
<tr>
<td>INDEX</td>
<td>创建&#x2F;删除索引权限</td>
</tr>
<tr>
<td>CREATE VIEW</td>
<td>创建视图权限</td>
</tr>
<tr>
<td>EXECUTE</td>
<td>执行存储过程权限</td>
</tr>
<tr>
<td>TRIGGER</td>
<td>触发器权限</td>
</tr>
<tr>
<td>ALL PRIVILEGES</td>
<td>所有权限</td>
</tr>
<tr>
<td>GRANT OPTION</td>
<td>授权权限</td>
</tr>
</tbody></table>
<h3 id="3-2-授予权限（GRANT）"><a href="#3-2-授予权限（GRANT）" class="headerlink" title="3.2 授予权限（GRANT）"></a>3.2 授予权限（GRANT）</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 基础语法</span></span><br><span class="line"><span class="keyword">GRANT</span> 权限列表 <span class="keyword">ON</span> 数据库。表 <span class="keyword">TO</span> <span class="string">&#x27;用户名&#x27;</span>@<span class="string">&#x27;主机&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 授予所有权限（慎用！）</span></span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">ALL</span> PRIVILEGES <span class="keyword">ON</span> <span class="operator">*</span>.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;admin&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 授予全局查询权限</span></span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">SELECT</span> <span class="keyword">ON</span> <span class="operator">*</span>.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;reader&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 授予特定数据库的所有权限</span></span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">ALL</span> PRIVILEGES <span class="keyword">ON</span> mydb.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;dbuser&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 授予特定表的部分权限</span></span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">SELECT</span>, <span class="keyword">INSERT</span>, <span class="keyword">UPDATE</span> <span class="keyword">ON</span> mydb.employees <span class="keyword">TO</span> <span class="string">&#x27;hr&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 授予特定列的权限</span></span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">SELECT</span>(id, name, salary) <span class="keyword">ON</span> mydb.employees <span class="keyword">TO</span> <span class="string">&#x27;manager&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 授予存储过程执行权限</span></span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">EXECUTE</span> <span class="keyword">ON</span> <span class="keyword">PROCEDURE</span> mydb.get_employee <span class="keyword">TO</span> <span class="string">&#x27;app&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 授予创建数据库权限</span></span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">CREATE</span> <span class="keyword">ON</span> <span class="operator">*</span>.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;developer&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 授予授权权限（允许该用户再授权给其他人）</span></span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">SELECT</span> <span class="keyword">ON</span> mydb.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;reader&#x27;</span>@<span class="string">&#x27;%&#x27;</span> <span class="keyword">WITH</span> <span class="keyword">GRANT</span> OPTION;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 授予文件权限（可读写服务器文件，危险！）</span></span><br><span class="line"><span class="keyword">GRANT</span> FILE <span class="keyword">ON</span> <span class="operator">*</span>.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;data_importer&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p><strong>权限范围语法</strong>：</p>
<ul>
<li><code>*.*</code>：所有数据库的所有表</li>
<li><code>db.*</code>：特定数据库的所有表</li>
<li><code>db.table</code>：特定数据库的特定表</li>
</ul>
<h3 id="3-3-撤销权限（REVOKE）"><a href="#3-3-撤销权限（REVOKE）" class="headerlink" title="3.3 撤销权限（REVOKE）"></a>3.3 撤销权限（REVOKE）</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 基础语法</span></span><br><span class="line"><span class="keyword">REVOKE</span> 权限列表 <span class="keyword">ON</span> 数据库。表 <span class="keyword">FROM</span> <span class="string">&#x27;用户名&#x27;</span>@<span class="string">&#x27;主机&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 撤销所有权限</span></span><br><span class="line"><span class="keyword">REVOKE</span> <span class="keyword">ALL</span> PRIVILEGES, <span class="keyword">GRANT</span> OPTION <span class="keyword">FROM</span> <span class="string">&#x27;user&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 撤销特定权限</span></span><br><span class="line"><span class="keyword">REVOKE</span> <span class="keyword">DELETE</span>, <span class="keyword">UPDATE</span> <span class="keyword">ON</span> mydb.employees <span class="keyword">FROM</span> <span class="string">&#x27;hr&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 撤销全局权限</span></span><br><span class="line"><span class="keyword">REVOKE</span> <span class="keyword">SELECT</span> <span class="keyword">ON</span> <span class="operator">*</span>.<span class="operator">*</span> <span class="keyword">FROM</span> <span class="string">&#x27;reader&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 撤销授权权限</span></span><br><span class="line"><span class="keyword">REVOKE</span> <span class="keyword">GRANT</span> OPTION <span class="keyword">ON</span> mydb.<span class="operator">*</span> <span class="keyword">FROM</span> <span class="string">&#x27;manager&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h3 id="3-4-权限刷新"><a href="#3-4-权限刷新" class="headerlink" title="3.4 权限刷新"></a>3.4 权限刷新</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 刷新权限（修改权限表后生效）</span></span><br><span class="line">FLUSH PRIVILEGES;</span><br></pre></td></tr></table></figure>

<p><strong>注意</strong>：使用 GRANT 和 REVOKE 修改权限后会自动生效，不需要 FLUSH PRIVILEGES。只有直接修改 <code>mysql.user</code> 表后才需要刷新。</p>
<h3 id="3-5-权限查看与继承"><a href="#3-5-权限查看与继承" class="headerlink" title="3.5 权限查看与继承"></a>3.5 权限查看与继承</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 查看当前用户权限</span></span><br><span class="line"><span class="keyword">SHOW</span> GRANTS;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看其他用户权限</span></span><br><span class="line"><span class="keyword">SHOW</span> GRANTS <span class="keyword">FOR</span> <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看具有全局 SELECT 权限的用户</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">user</span>, host <span class="keyword">FROM</span> mysql.user <span class="keyword">WHERE</span> Select_priv <span class="operator">=</span> <span class="string">&#x27;Y&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p><strong>权限继承规则</strong>：</p>
<ul>
<li>全局权限 &gt; 数据库权限 &gt; 表权限 &gt; 列权限</li>
<li>用户拥有多个权限时，取并集</li>
</ul>
<h2 id="四、角色管理（MySQL-8-0-）"><a href="#四、角色管理（MySQL-8-0-）" class="headerlink" title="四、角色管理（MySQL 8.0+）"></a>四、角色管理（MySQL 8.0+）</h2><p>角色是一组权限的集合，可以分配给用户。</p>
<h3 id="4-1-创建角色"><a href="#4-1-创建角色" class="headerlink" title="4.1 创建角色"></a>4.1 创建角色</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 创建角色</span></span><br><span class="line"><span class="keyword">CREATE</span> ROLE <span class="string">&#x27;read_only&#x27;</span>;</span><br><span class="line"><span class="keyword">CREATE</span> ROLE <span class="string">&#x27;app_read&#x27;</span>, <span class="string">&#x27;app_write&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看角色</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> mysql.default_roles;</span><br></pre></td></tr></table></figure>

<h3 id="4-2-给角色授权"><a href="#4-2-给角色授权" class="headerlink" title="4.2 给角色授权"></a>4.2 给角色授权</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 给角色授予权限</span></span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">SELECT</span> <span class="keyword">ON</span> mydb.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;read_only&#x27;</span>;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">SELECT</span>, <span class="keyword">INSERT</span> <span class="keyword">ON</span> mydb.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;app_read&#x27;</span>;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">INSERT</span>, <span class="keyword">UPDATE</span>, <span class="keyword">DELETE</span> <span class="keyword">ON</span> mydb.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;app_write&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h3 id="4-3-给用户分配角色"><a href="#4-3-给用户分配角色" class="headerlink" title="4.3 给用户分配角色"></a>4.3 给用户分配角色</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 给用户分配角色</span></span><br><span class="line"><span class="keyword">GRANT</span> <span class="string">&#x27;read_only&#x27;</span> <span class="keyword">TO</span> <span class="string">&#x27;user1&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span>;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="string">&#x27;app_read&#x27;</span>, <span class="string">&#x27;app_write&#x27;</span> <span class="keyword">TO</span> <span class="string">&#x27;app_user&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 设置默认角色</span></span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">DEFAULT</span> ROLE <span class="string">&#x27;read_only&#x27;</span> <span class="keyword">TO</span> <span class="string">&#x27;user1&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看用户的角色</span></span><br><span class="line"><span class="keyword">SHOW</span> GRANTS <span class="keyword">FOR</span> <span class="string">&#x27;user1&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h3 id="4-4-激活角色"><a href="#4-4-激活角色" class="headerlink" title="4.4 激活角色"></a>4.4 激活角色</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 激活所有角色</span></span><br><span class="line"><span class="keyword">SET</span> ROLE <span class="keyword">ALL</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 激活特定角色</span></span><br><span class="line"><span class="keyword">SET</span> ROLE <span class="string">&#x27;read_only&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 激活所有默认角色</span></span><br><span class="line"><span class="keyword">SET</span> ROLE <span class="keyword">DEFAULT</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看当前激活的角色</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">CURRENT_ROLE</span>();</span><br></pre></td></tr></table></figure>

<h3 id="4-5-撤销角色"><a href="#4-5-撤销角色" class="headerlink" title="4.5 撤销角色"></a>4.5 撤销角色</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 撤销用户的角色</span></span><br><span class="line"><span class="keyword">REVOKE</span> <span class="string">&#x27;read_only&#x27;</span> <span class="keyword">FROM</span> <span class="string">&#x27;user1&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 删除角色</span></span><br><span class="line"><span class="keyword">DROP</span> ROLE <span class="string">&#x27;read_only&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h2 id="五、事务控制"><a href="#五、事务控制" class="headerlink" title="五、事务控制"></a>五、事务控制</h2><h3 id="5-1-事务基础"><a href="#5-1-事务基础" class="headerlink" title="5.1 事务基础"></a>5.1 事务基础</h3><p>事务是一组原子性的 SQL 操作，要么全部成功，要么全部失败。</p>
<p><strong>事务的 ACID 特性</strong>：</p>
<table>
<thead>
<tr>
<th>特性</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>原子性（Atomicity）</td>
<td>事务是不可分割的最小单位</td>
</tr>
<tr>
<td>一致性（Consistency）</td>
<td>事务执行前后数据保持一致</td>
</tr>
<tr>
<td>隔离性（Isolation）</td>
<td>并发事务互不干扰</td>
</tr>
<tr>
<td>持久性（Durability）</td>
<td>事务提交后永久保存</td>
</tr>
</tbody></table>
<h3 id="5-2-事务操作"><a href="#5-2-事务操作" class="headerlink" title="5.2 事务操作"></a>5.2 事务操作</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 查看自动提交状态</span></span><br><span class="line"><span class="keyword">SELECT</span> @<span class="variable">@autocommit</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 关闭自动提交</span></span><br><span class="line"><span class="keyword">SET</span> autocommit <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 开启事务</span></span><br><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"><span class="comment">-- 或</span></span><br><span class="line"><span class="keyword">BEGIN</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 执行 DML 操作</span></span><br><span class="line"><span class="keyword">UPDATE</span> accounts <span class="keyword">SET</span> balance <span class="operator">=</span> balance <span class="operator">-</span> <span class="number">100</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">UPDATE</span> accounts <span class="keyword">SET</span> balance <span class="operator">=</span> balance <span class="operator">+</span> <span class="number">100</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 提交事务</span></span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 回滚事务</span></span><br><span class="line"><span class="keyword">ROLLBACK</span>;</span><br></pre></td></tr></table></figure>

<h3 id="5-3-保存点（SAVEPOINT）"><a href="#5-3-保存点（SAVEPOINT）" class="headerlink" title="5.3 保存点（SAVEPOINT）"></a>5.3 保存点（SAVEPOINT）</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 开始事务</span></span><br><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 第一条操作</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> orders (order_no, amount) <span class="keyword">VALUES</span> (<span class="string">&#x27;ORD001&#x27;</span>, <span class="number">100</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 设置保存点</span></span><br><span class="line"><span class="keyword">SAVEPOINT</span> sp1;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 第二条操作</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> orders (order_no, amount) <span class="keyword">VALUES</span> (<span class="string">&#x27;ORD002&#x27;</span>, <span class="number">200</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 设置保存点</span></span><br><span class="line"><span class="keyword">SAVEPOINT</span> sp2;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 第三条操作（假设出错了）</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> orders (order_no, amount) <span class="keyword">VALUES</span> (<span class="string">&#x27;ORD003&#x27;</span>, <span class="number">300</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 回滚到保存点 sp2</span></span><br><span class="line"><span class="keyword">ROLLBACK</span> <span class="keyword">TO</span> sp2;  <span class="comment">-- ORD003 被撤销</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 提交事务（ORD001 和 ORD002 保留）</span></span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 释放保存点</span></span><br><span class="line"><span class="keyword">RELEASE</span> <span class="keyword">SAVEPOINT</span> sp1;</span><br></pre></td></tr></table></figure>

<h3 id="5-4-事务隔离级别"><a href="#5-4-事务隔离级别" class="headerlink" title="5.4 事务隔离级别"></a>5.4 事务隔离级别</h3><p>MySQL 支持四种事务隔离级别：</p>
<table>
<thead>
<tr>
<th>隔离级别</th>
<th>脏读</th>
<th>不可重复读</th>
<th>幻读</th>
</tr>
</thead>
<tbody><tr>
<td>READ UNCOMMITTED</td>
<td>可能</td>
<td>可能</td>
<td>可能</td>
</tr>
<tr>
<td>READ COMMITTED</td>
<td>否</td>
<td>可能</td>
<td>可能</td>
</tr>
<tr>
<td>REPEATABLE READ（默认）</td>
<td>否</td>
<td>否</td>
<td>可能</td>
</tr>
<tr>
<td>SERIALIZABLE</td>
<td>否</td>
<td>否</td>
<td>否</td>
</tr>
</tbody></table>
<p><strong>并发读问题</strong>：</p>
<ul>
<li><strong>脏读</strong>：读到其他事务未提交的数据</li>
<li><strong>不可重复读</strong>：同一事务中多次读取结果不一致</li>
<li><strong>幻读</strong>：同一事务中多次查询，记录数不一致</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 查看当前隔离级别</span></span><br><span class="line"><span class="keyword">SELECT</span> @<span class="variable">@transaction_isolation</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 设置隔离级别（会话级）</span></span><br><span class="line"><span class="keyword">SET</span> SESSION TRANSACTION ISOLATION LEVEL READ COMMITTED;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 设置隔离级别（全局级）</span></span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span> TRANSACTION ISOLATION LEVEL READ COMMITTED;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 设置隔离级别（在事务开始前）</span></span><br><span class="line"><span class="keyword">SET</span> TRANSACTION ISOLATION LEVEL SERIALIZABLE;</span><br><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br></pre></td></tr></table></figure>

<p><strong>MySQL InnoDB 的隔离级别特点</strong>：</p>
<ul>
<li>默认使用 <code>REPEATABLE READ</code></li>
<li>通过 MVCC（多版本并发控制）避免了幻读</li>
<li><code>READ COMMITTED</code> 下会使用不同的锁定策略</li>
</ul>
<h3 id="5-5-锁机制"><a href="#5-5-锁机制" class="headerlink" title="5.5 锁机制"></a>5.5 锁机制</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 查看锁信息</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> information_schema.innodb_locks;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> information_schema.innodb_lock_waits;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看正在执行的事务</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> information_schema.innodb_trx;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 表锁</span></span><br><span class="line">LOCK TABLES employees READ;   <span class="comment">-- 读锁</span></span><br><span class="line">LOCK TABLES employees WRITE;  <span class="comment">-- 写锁</span></span><br><span class="line">UNLOCK TABLES;                <span class="comment">-- 解锁</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 行锁（InnoDB 自动加锁，无需手动）</span></span><br><span class="line"><span class="comment">-- 在 SELECT 时加锁</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span> <span class="keyword">FOR</span> <span class="keyword">UPDATE</span>;  <span class="comment">-- 排他锁</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span> LOCK <span class="keyword">IN</span> SHARE MODE;  <span class="comment">-- 共享锁（8.0 语法已变更）</span></span><br></pre></td></tr></table></figure>

<p><strong>MySQL 8.0 新的锁语法</strong>：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 共享锁</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span> <span class="keyword">FOR</span> SHARE;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 排他锁</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span> <span class="keyword">FOR</span> <span class="keyword">UPDATE</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 跳过锁定的行</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span> <span class="keyword">FOR</span> <span class="keyword">UPDATE</span> <span class="keyword">SKIP</span> LOCKED;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 等待锁超时</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span> <span class="keyword">FOR</span> <span class="keyword">UPDATE</span> NOWAIT;</span><br></pre></td></tr></table></figure>

<h2 id="六、实战案例"><a href="#六、实战案例" class="headerlink" title="六、实战案例"></a>六、实战案例</h2><h3 id="6-1-创建应用数据库和用户"><a href="#6-1-创建应用数据库和用户" class="headerlink" title="6.1 创建应用数据库和用户"></a>6.1 创建应用数据库和用户</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 1. 创建数据库</span></span><br><span class="line"><span class="keyword">CREATE</span> DATABASE IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> webapp</span><br><span class="line"><span class="keyword">CHARACTER SET</span> utf8mb4</span><br><span class="line"><span class="keyword">COLLATE</span> utf8mb4_unicode_ci;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 2. 创建只读用户（用于报表查询）</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> <span class="string">&#x27;readonly&#x27;</span>@<span class="string">&#x27;%&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;readonly_pwd&#x27;</span>;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">SELECT</span> <span class="keyword">ON</span> webapp.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;readonly&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 3. 创建应用用户（用于日常操作）</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> <span class="string">&#x27;appuser&#x27;</span>@<span class="string">&#x27;%&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;app_pwd&#x27;</span>;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">SELECT</span>, <span class="keyword">INSERT</span>, <span class="keyword">UPDATE</span>, <span class="keyword">DELETE</span> <span class="keyword">ON</span> webapp.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;appuser&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 4. 创建管理员用户（拥有所有权限）</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> <span class="string">&#x27;admin&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;admin_pwd&#x27;</span>;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">ALL</span> PRIVILEGES <span class="keyword">ON</span> webapp.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;admin&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> <span class="keyword">WITH</span> <span class="keyword">GRANT</span> OPTION;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 5. 刷新权限</span></span><br><span class="line">FLUSH PRIVILEGES;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 6. 验证权限</span></span><br><span class="line"><span class="keyword">SHOW</span> GRANTS <span class="keyword">FOR</span> <span class="string">&#x27;readonly&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br><span class="line"><span class="keyword">SHOW</span> GRANTS <span class="keyword">FOR</span> <span class="string">&#x27;appuser&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br><span class="line"><span class="keyword">SHOW</span> GRANTS <span class="keyword">FOR</span> <span class="string">&#x27;admin&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h3 id="6-2-银行转账事务"><a href="#6-2-银行转账事务" class="headerlink" title="6.2 银行转账事务"></a>6.2 银行转账事务</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 创建账户表</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> accounts (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT,</span><br><span class="line">    account_no <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">UNIQUE</span> <span class="keyword">NOT NULL</span>,</span><br><span class="line">    balance <span class="type">DECIMAL</span>(<span class="number">12</span>, <span class="number">2</span>) <span class="keyword">DEFAULT</span> <span class="number">0</span>,</span><br><span class="line">    version <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>  <span class="comment">-- 乐观锁版本号</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT INTO</span> accounts (account_no, balance) <span class="keyword">VALUES</span></span><br><span class="line">(<span class="string">&#x27;ACC001&#x27;</span>, <span class="number">10000</span>),</span><br><span class="line">(<span class="string">&#x27;ACC002&#x27;</span>, <span class="number">5000</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 转账存储过程（带事务）</span></span><br><span class="line">DELIMITER <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> transfer_money(</span><br><span class="line">    <span class="keyword">IN</span> from_acc <span class="type">VARCHAR</span>(<span class="number">50</span>),</span><br><span class="line">    <span class="keyword">IN</span> to_acc <span class="type">VARCHAR</span>(<span class="number">50</span>),</span><br><span class="line">    <span class="keyword">IN</span> amount <span class="type">DECIMAL</span>(<span class="number">12</span>, <span class="number">2</span>)</span><br><span class="line">)</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">DECLARE</span> EXIT HANDLER <span class="keyword">FOR</span> <span class="keyword">SQLEXCEPTION</span></span><br><span class="line">    <span class="keyword">BEGIN</span></span><br><span class="line">        <span class="keyword">ROLLBACK</span>;  <span class="comment">-- 出错回滚</span></span><br><span class="line">        <span class="keyword">SELECT</span> <span class="string">&#x27;Transfer failed&#x27;</span> <span class="keyword">AS</span> <span class="keyword">result</span>;</span><br><span class="line">    <span class="keyword">END</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">START</span> TRANSACTION;</span><br><span class="line"></span><br><span class="line">    <span class="comment">-- 检查余额</span></span><br><span class="line">    IF (<span class="keyword">SELECT</span> balance <span class="keyword">FROM</span> accounts <span class="keyword">WHERE</span> account_no <span class="operator">=</span> from_acc) <span class="operator">&gt;=</span> amount <span class="keyword">THEN</span></span><br><span class="line">        <span class="comment">-- 扣款</span></span><br><span class="line">        <span class="keyword">UPDATE</span> accounts <span class="keyword">SET</span> balance <span class="operator">=</span> balance <span class="operator">-</span> amount</span><br><span class="line">        <span class="keyword">WHERE</span> account_no <span class="operator">=</span> from_acc;</span><br><span class="line"></span><br><span class="line">        <span class="comment">-- 收款</span></span><br><span class="line">        <span class="keyword">UPDATE</span> accounts <span class="keyword">SET</span> balance <span class="operator">=</span> balance <span class="operator">+</span> amount</span><br><span class="line">        <span class="keyword">WHERE</span> account_no <span class="operator">=</span> to_acc;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">COMMIT</span>;</span><br><span class="line">        <span class="keyword">SELECT</span> <span class="string">&#x27;Transfer success&#x27;</span> <span class="keyword">AS</span> <span class="keyword">result</span>;</span><br><span class="line">    <span class="keyword">ELSE</span></span><br><span class="line">        <span class="keyword">ROLLBACK</span>;</span><br><span class="line">        <span class="keyword">SELECT</span> <span class="string">&#x27;Insufficient balance&#x27;</span> <span class="keyword">AS</span> <span class="keyword">result</span>;</span><br><span class="line">    <span class="keyword">END</span> IF;</span><br><span class="line"><span class="keyword">END</span> <span class="operator">/</span><span class="operator">/</span></span><br><span class="line">DELIMITER ;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 调用转账</span></span><br><span class="line"><span class="keyword">CALL</span> transfer_money(<span class="string">&#x27;ACC001&#x27;</span>, <span class="string">&#x27;ACC002&#x27;</span>, <span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看结果</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> accounts;</span><br></pre></td></tr></table></figure>

<h3 id="6-3-使用乐观锁"><a href="#6-3-使用乐观锁" class="headerlink" title="6.3 使用乐观锁"></a>6.3 使用乐观锁</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 使用版本号实现乐观锁</span></span><br><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 读取当前版本</span></span><br><span class="line"><span class="keyword">SELECT</span> balance, version <span class="keyword">FROM</span> accounts <span class="keyword">WHERE</span> account_no <span class="operator">=</span> <span class="string">&#x27;ACC001&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 更新时检查版本号</span></span><br><span class="line"><span class="keyword">UPDATE</span> accounts</span><br><span class="line"><span class="keyword">SET</span> balance <span class="operator">=</span> balance <span class="operator">-</span> <span class="number">1000</span>, version <span class="operator">=</span> version <span class="operator">+</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">WHERE</span> account_no <span class="operator">=</span> <span class="string">&#x27;ACC001&#x27;</span> <span class="keyword">AND</span> version <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 检查影响行数，如果为 0 说明被其他事务修改过</span></span><br><span class="line"><span class="comment">-- 需要回滚重试</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br></pre></td></tr></table></figure>

<h2 id="七、安全管理最佳实践"><a href="#七、安全管理最佳实践" class="headerlink" title="七、安全管理最佳实践"></a>七、安全管理最佳实践</h2><h3 id="7-1-密码安全"><a href="#7-1-密码安全" class="headerlink" title="7.1 密码安全"></a>7.1 密码安全</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 设置密码复杂度验证插件</span></span><br><span class="line">INSTALL PLUGIN validate_password SONAME <span class="string">&#x27;validate_password.so&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看密码策略</span></span><br><span class="line"><span class="keyword">SHOW</span> VARIABLES <span class="keyword">LIKE</span> <span class="string">&#x27;validate_password%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 设置密码策略级别</span></span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span> validate_password.policy <span class="operator">=</span> MEDIUM;</span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span> validate_password.length <span class="operator">=</span> <span class="number">8</span>;</span><br></pre></td></tr></table></figure>

<h3 id="7-2-最小权限原则"><a href="#7-2-最小权限原则" class="headerlink" title="7.2 最小权限原则"></a>7.2 最小权限原则</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 错误：给应用用户授予过多权限</span></span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">ALL</span> PRIVILEGES <span class="keyword">ON</span> <span class="operator">*</span>.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;app&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 正确：只授予必要权限</span></span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">SELECT</span>, <span class="keyword">INSERT</span>, <span class="keyword">UPDATE</span>, <span class="keyword">DELETE</span> <span class="keyword">ON</span> mydb.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;app&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h3 id="7-3-限制主机访问"><a href="#7-3-限制主机访问" class="headerlink" title="7.3 限制主机访问"></a>7.3 限制主机访问</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 错误：允许任何主机连接</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> <span class="string">&#x27;app&#x27;</span>@<span class="string">&#x27;%&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;pwd&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 正确：限制特定主机或网段</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> <span class="string">&#x27;app&#x27;</span>@<span class="string">&#x27;192.168.1.%&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;pwd&#x27;</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> <span class="string">&#x27;app&#x27;</span>@<span class="string">&#x27;10.0.0.100&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;pwd&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h3 id="7-4-定期清理无用用户"><a href="#7-4-定期清理无用用户" class="headerlink" title="7.4 定期清理无用用户"></a>7.4 定期清理无用用户</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 查看长期未登录的用户</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">user</span>, host, password_last_changed</span><br><span class="line"><span class="keyword">FROM</span> mysql.user</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> password_last_changed;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 删除无用用户</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">USER</span> <span class="string">&#x27;old_user&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h3 id="7-5-审计和监控"><a href="#7-5-审计和监控" class="headerlink" title="7.5 审计和监控"></a>7.5 审计和监控</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 开启通用查询日志（生产环境慎用）</span></span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span> general_log <span class="operator">=</span> <span class="string">&#x27;ON&#x27;</span>;</span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span> general_log_file <span class="operator">=</span> <span class="string">&#x27;/var/log/mysql/general.log&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看当前连接</span></span><br><span class="line"><span class="keyword">SHOW</span> PROCESSLIST;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看慢查询日志</span></span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span> slow_query_log <span class="operator">=</span> <span class="string">&#x27;ON&#x27;</span>;</span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span> long_query_time <span class="operator">=</span> <span class="number">2</span>;  <span class="comment">-- 超过 2 秒的查询记入日志</span></span><br></pre></td></tr></table></figure>

<h2 id="八、小结"><a href="#八、小结" class="headerlink" title="八、小结"></a>八、小结</h2><h3 id="知识点回顾"><a href="#知识点回顾" class="headerlink" title="知识点回顾"></a>知识点回顾</h3><ol>
<li><p><strong>用户管理</strong></p>
<ul>
<li>CREATE USER、ALTER USER、DROP USER</li>
<li>用户名格式：‘user‘@’host’</li>
</ul>
</li>
<li><p><strong>权限管理</strong></p>
<ul>
<li>GRANT 授权、REVOKE 撤销</li>
<li>权限级别：全局、数据库、表、列</li>
<li>常用权限：SELECT、INSERT、UPDATE、DELETE、ALL PRIVILEGES</li>
</ul>
</li>
<li><p><strong>角色管理（MySQL 8.0+）</strong></p>
<ul>
<li>CREATE ROLE 创建角色</li>
<li>角色是一组权限的集合</li>
</ul>
</li>
<li><p><strong>事务控制</strong></p>
<ul>
<li>START TRANSACTION、COMMIT、ROLLBACK</li>
<li>SAVEPOINT 保存点</li>
<li>隔离级别：READ UNCOMMITTED、READ COMMITTED、REPEATABLE READ、SERIALIZABLE</li>
</ul>
</li>
</ol>
<h3 id="DCL-命令速查表"><a href="#DCL-命令速查表" class="headerlink" title="DCL 命令速查表"></a>DCL 命令速查表</h3><table>
<thead>
<tr>
<th>命令</th>
<th>语法</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>CREATE USER</td>
<td><code>CREATE USER &#39;u&#39;@&#39;h&#39; IDENTIFIED BY &#39;pwd&#39;</code></td>
<td>创建用户</td>
</tr>
<tr>
<td>DROP USER</td>
<td><code>DROP USER &#39;u&#39;@&#39;h&#39;</code></td>
<td>删除用户</td>
</tr>
<tr>
<td>GRANT</td>
<td><code>GRANT 权限 ON 库。表 TO &#39;u&#39;@&#39;h&#39;</code></td>
<td>授权</td>
</tr>
<tr>
<td>REVOKE</td>
<td><code>REVOKE 权限 ON 库。表 FROM &#39;u&#39;@&#39;h&#39;</code></td>
<td>撤销权限</td>
</tr>
<tr>
<td>SHOW GRANTS</td>
<td><code>SHOW GRANTS FOR &#39;u&#39;@&#39;h&#39;</code></td>
<td>查看权限</td>
</tr>
<tr>
<td>START TRANSACTION</td>
<td><code>START TRANSACTION</code></td>
<td>开启事务</td>
</tr>
<tr>
<td>COMMIT</td>
<td><code>COMMIT</code></td>
<td>提交事务</td>
</tr>
<tr>
<td>ROLLBACK</td>
<td><code>ROLLBACK</code></td>
<td>回滚事务</td>
</tr>
<tr>
<td>SAVEPOINT</td>
<td><code>SAVEPOINT sp_name</code></td>
<td>设置保存点</td>
</tr>
</tbody></table>
<h3 id="安全建议"><a href="#安全建议" class="headerlink" title="安全建议"></a>安全建议</h3><ol>
<li><strong>最小权限原则</strong>：只授予必要的权限</li>
<li><strong>限制主机</strong>：避免使用 <code>&#39;user&#39;@&#39;%&#39;</code></li>
<li><strong>强密码策略</strong>：使用密码复杂度验证</li>
<li><strong>定期审计</strong>：清理无用用户，检查权限分配</li>
<li><strong>生产环境</strong>：避免使用 root 用户连接应用</li>
</ol>
<hr>
<p><strong>上一篇</strong>：[MySQL 基础教程（四）DQL 数据查询语言详解（下）](&#x2F;2026&#x2F;02&#x2F;23&#x2F;MySQL 基础教程（四）DQL 数据查询语言详解（下）&#x2F;)</p>
<h2 id="MySQL-基础教程系列总结"><a href="#MySQL-基础教程系列总结" class="headerlink" title="MySQL 基础教程系列总结"></a>MySQL 基础教程系列总结</h2><p>至此，MySQL 基础教程系列全部完成！让我们回顾一下整个系列的内容：</p>
<h3 id="系列文章回顾"><a href="#系列文章回顾" class="headerlink" title="系列文章回顾"></a>系列文章回顾</h3><ol>
<li><p><strong>（一）数据库基础与环境搭建</strong></p>
<ul>
<li>数据库概念、MySQL 安装、数据模型、SQL 分类</li>
</ul>
</li>
<li><p><strong>（二）DDL 数据定义语言详解</strong></p>
<ul>
<li>数据库操作、表操作、数据类型、DataGrip 工具</li>
</ul>
</li>
<li><p><strong>（三）DML 数据操作语言详解</strong></p>
<ul>
<li>INSERT 插入、UPDATE 更新、DELETE 删除、事务基础</li>
</ul>
</li>
<li><p><strong>（四）DQL 数据查询语言详解</strong></p>
<ul>
<li>基础查询、条件查询、聚合函数、分组、排序、分页、连接查询、子查询</li>
</ul>
</li>
<li><p><strong>（五）DCL 数据控制语言详解</strong></p>
<ul>
<li>用户管理、权限控制、事务控制、安全管理</li>
</ul>
</li>
</ol>
<h3 id="学习建议"><a href="#学习建议" class="headerlink" title="学习建议"></a>学习建议</h3><ol>
<li><strong>多动手实践</strong>：SQL 是一门实践性很强的语言，建议边学边练</li>
<li><strong>理解原理</strong>：不仅要会写 SQL，还要理解执行顺序和原理</li>
<li><strong>注意性能</strong>：养成写高效 SQL 的习惯，避免全表扫描</li>
<li><strong>善用工具</strong>：使用 DataGrip 等工具提高开发效率</li>
<li><strong>持续学习</strong>：数据库知识博大精深，保持学习的热情</li>
</ol>
<p>希望本系列教程能帮助你系统地掌握 MySQL 基础！如有问题，欢迎留言讨论。</p>
]]></content>
      <categories>
        <category>MySQL 基础教程</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
        <tag>DCL</tag>
        <tag>权限管理</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQL 基础教程（三）DML 数据操作语言详解</title>
    <url>/2026/02/23/MySQL%20%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B%EF%BC%88%E4%B8%89%EF%BC%89DML%20%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C%E8%AF%AD%E8%A8%80%E8%AF%A6%E8%A7%A3/</url>
    <content><![CDATA[<h1 id="MySQL-基础教程（三）DML-数据操作语言详解"><a href="#MySQL-基础教程（三）DML-数据操作语言详解" class="headerlink" title="MySQL 基础教程（三）DML 数据操作语言详解"></a>MySQL 基础教程（三）DML 数据操作语言详解</h1><p>在上一篇文章中，我们学习了如何使用 DDL 创建和管理数据库表结构。本文我们将学习 <strong>DML（Data Manipulation Language）数据操作语言</strong>，掌握如何对表中的数据进行插入、更新和删除操作。</p>
<h2 id="一、DML-概述"><a href="#一、DML-概述" class="headerlink" title="一、DML 概述"></a>一、DML 概述</h2><p>DML 用于对数据库表中的数据进行操作，主要包括：</p>
<table>
<thead>
<tr>
<th>命令</th>
<th>功能</th>
<th>特点</th>
</tr>
</thead>
<tbody><tr>
<td>INSERT</td>
<td>插入数据</td>
<td>添加新记录</td>
</tr>
<tr>
<td>UPDATE</td>
<td>更新数据</td>
<td>修改现有记录</td>
</tr>
<tr>
<td>DELETE</td>
<td>删除数据</td>
<td>删除符合条件的记录</td>
</tr>
<tr>
<td>TRUNCATE</td>
<td>清空表</td>
<td>删除全部记录并重置自增</td>
</tr>
</tbody></table>
<p><strong>DML 的特点</strong>：</p>
<ul>
<li>操作的是数据内容，不影响表结构</li>
<li>在事务中可回滚（需要关闭自动提交）</li>
<li>可以配合 WHERE 子句进行条件操作</li>
</ul>
<h2 id="二、插入数据（INSERT）"><a href="#二、插入数据（INSERT）" class="headerlink" title="二、插入数据（INSERT）"></a>二、插入数据（INSERT）</h2><h3 id="2-1-基础插入语法"><a href="#2-1-基础插入语法" class="headerlink" title="2.1 基础插入语法"></a>2.1 基础插入语法</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 语法</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> 表名 (列 <span class="number">1</span>, 列 <span class="number">2</span>, ..., 列 n)</span><br><span class="line"><span class="keyword">VALUES</span> (值 <span class="number">1</span>, 值 <span class="number">2</span>, ..., 值 n);</span><br></pre></td></tr></table></figure>

<h3 id="2-2-插入单条记录"><a href="#2-2-插入单条记录" class="headerlink" title="2.2 插入单条记录"></a>2.2 插入单条记录</h3><p>首先创建测试表：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 创建测试表</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> employees (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT,</span><br><span class="line">    name <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">    dept <span class="type">VARCHAR</span>(<span class="number">50</span>),</span><br><span class="line">    salary <span class="type">DECIMAL</span>(<span class="number">10</span>, <span class="number">2</span>),</span><br><span class="line">    hire_date <span class="type">DATE</span>,</span><br><span class="line">    status TINYINT <span class="keyword">DEFAULT</span> <span class="number">1</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 方式一：指定列名插入（推荐）</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> employees (name, dept, salary, hire_date)</span><br><span class="line"><span class="keyword">VALUES</span> (<span class="string">&#x27;张三&#x27;</span>, <span class="string">&#x27;技术部&#x27;</span>, <span class="number">8000.00</span>, <span class="string">&#x27;2024-01-15&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 方式二：不指定列名（必须为所有列提供值）</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> employees <span class="keyword">VALUES</span></span><br><span class="line">(<span class="number">2</span>, <span class="string">&#x27;李四&#x27;</span>, <span class="string">&#x27;市场部&#x27;</span>, <span class="number">7500.00</span>, <span class="string">&#x27;2024-02-01&#x27;</span>, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 方式三：利用默认值</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> employees (name, dept, salary)</span><br><span class="line"><span class="keyword">VALUES</span> (<span class="string">&#x27;王五&#x27;</span>, <span class="string">&#x27;人事部&#x27;</span>, <span class="number">6500.00</span>);</span><br><span class="line"><span class="comment">-- hire_date 为 NULL，status 为默认值 1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 方式四：设置 NULL 值</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> employees (name, dept, salary, hire_date, status)</span><br><span class="line"><span class="keyword">VALUES</span> (<span class="string">&#x27;赵六&#x27;</span>, <span class="keyword">NULL</span>, <span class="number">5000.00</span>, <span class="keyword">NULL</span>, <span class="number">1</span>);</span><br></pre></td></tr></table></figure>

<p><strong>注意事项</strong>：</p>
<ol>
<li>字符串和日期类型需要用引号包裹</li>
<li>插入的值必须与列的数据类型兼容</li>
<li>NOT NULL 约束的列必须提供值（除非有 DEFAULT）</li>
<li>主键列如果是自增，可以传入 NULL 或 DEFAULT 让系统自动生成</li>
</ol>
<h3 id="2-3-批量插入"><a href="#2-3-批量插入" class="headerlink" title="2.3 批量插入"></a>2.3 批量插入</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 一次插入多条记录（推荐，效率高）</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> employees (name, dept, salary, hire_date) <span class="keyword">VALUES</span></span><br><span class="line">(<span class="string">&#x27;孙七&#x27;</span>, <span class="string">&#x27;技术部&#x27;</span>, <span class="number">9000.00</span>, <span class="string">&#x27;2023-06-01&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;周八&#x27;</span>, <span class="string">&#x27;技术部&#x27;</span>, <span class="number">9500.00</span>, <span class="string">&#x27;2023-03-15&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;吴九&#x27;</span>, <span class="string">&#x27;市场部&#x27;</span>, <span class="number">7000.00</span>, <span class="string">&#x27;2024-01-10&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;郑十&#x27;</span>, <span class="string">&#x27;财务部&#x27;</span>, <span class="number">8500.00</span>, <span class="string">&#x27;2023-09-01&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;王十一&#x27;</span>, <span class="string">&#x27;市场部&#x27;</span>, <span class="number">7200.00</span>, <span class="string">&#x27;2023-12-01&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 验证插入结果</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>

<h3 id="2-4-插入时处理重复"><a href="#2-4-插入时处理重复" class="headerlink" title="2.4 插入时处理重复"></a>2.4 插入时处理重复</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 创建带唯一约束的表</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> users (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT,</span><br><span class="line">    username <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">UNIQUE</span> <span class="keyword">NOT NULL</span>,</span><br><span class="line">    email <span class="type">VARCHAR</span>(<span class="number">100</span>),</span><br><span class="line">    password <span class="type">VARCHAR</span>(<span class="number">255</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT INTO</span> users (username, email, password) <span class="keyword">VALUES</span></span><br><span class="line">(<span class="string">&#x27;user1&#x27;</span>, <span class="string">&#x27;user1@example.com&#x27;</span>, <span class="string">&#x27;pwd123&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;user2&#x27;</span>, <span class="string">&#x27;user2@example.com&#x27;</span>, <span class="string">&#x27;pwd456&#x27;</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 方式一：INSERT IGNORE（忽略重复）</span></span><br><span class="line"><span class="keyword">INSERT</span> IGNORE <span class="keyword">INTO</span> users (username, email, password)</span><br><span class="line"><span class="keyword">VALUES</span> (<span class="string">&#x27;user1&#x27;</span>, <span class="string">&#x27;new@example.com&#x27;</span>, <span class="string">&#x27;newpwd&#x27;</span>);</span><br><span class="line"><span class="comment">-- user1 已存在，该条语句被忽略，不会报错</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 方式二：ON DUPLICATE KEY UPDATE（重复则更新）</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> users (username, email, password)</span><br><span class="line"><span class="keyword">VALUES</span> (<span class="string">&#x27;user1&#x27;</span>, <span class="string">&#x27;updated@example.com&#x27;</span>, <span class="string">&#x27;newpwd123&#x27;</span>)</span><br><span class="line"><span class="keyword">ON</span> DUPLICATE KEY <span class="keyword">UPDATE</span></span><br><span class="line">    email <span class="operator">=</span> <span class="keyword">VALUES</span>(email),</span><br><span class="line">    password <span class="operator">=</span> <span class="keyword">VALUES</span>(password);</span><br><span class="line"><span class="comment">-- 如果 user1 存在，则更新 email 和 password</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 方式三：REPLACE INTO（删除后重新插入）</span></span><br><span class="line">REPLACE <span class="keyword">INTO</span> users (username, email, password)</span><br><span class="line"><span class="keyword">VALUES</span> (<span class="string">&#x27;user1&#x27;</span>, <span class="string">&#x27;replaced@example.com&#x27;</span>, <span class="string">&#x27;replacepwd&#x27;</span>);</span><br><span class="line"><span class="comment">-- 如果存在则先删除再插入，id 会变化</span></span><br></pre></td></tr></table></figure>

<h3 id="2-5-从其他表插入数据"><a href="#2-5-从其他表插入数据" class="headerlink" title="2.5 从其他表插入数据"></a>2.5 从其他表插入数据</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 创建员工备份表</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> employees_backup <span class="keyword">LIKE</span> employees;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 方式一：INSERT ... SELECT</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> employees_backup (id, name, dept, salary, hire_date, status)</span><br><span class="line"><span class="keyword">SELECT</span> id, name, dept, salary, hire_date, status <span class="keyword">FROM</span> employees;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 方式二：CREATE TABLE ... AS SELECT（创建并插入）</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> employees_copy <span class="keyword">AS</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> dept <span class="operator">=</span> <span class="string">&#x27;技术部&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h3 id="2-6-INSERT-性能优化技巧"><a href="#2-6-INSERT-性能优化技巧" class="headerlink" title="2.6 INSERT 性能优化技巧"></a>2.6 INSERT 性能优化技巧</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 技巧 1：使用批量插入（比单条插入快得多）</span></span><br><span class="line"><span class="comment">-- 慢：</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> employees (name, dept) <span class="keyword">VALUES</span> (<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;技术部&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT INTO</span> employees (name, dept) <span class="keyword">VALUES</span> (<span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;技术部&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT INTO</span> employees (name, dept) <span class="keyword">VALUES</span> (<span class="string">&#x27;C&#x27;</span>, <span class="string">&#x27;技术部&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 快：</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> employees (name, dept) <span class="keyword">VALUES</span></span><br><span class="line">(<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;技术部&#x27;</span>), (<span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;技术部&#x27;</span>), (<span class="string">&#x27;C&#x27;</span>, <span class="string">&#x27;技术部&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 技巧 2：对于大量数据，可以先禁用索引再插入</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> employees DISABLE KEYS;</span><br><span class="line"><span class="comment">-- 执行批量插入</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> employees ENABLE KEYS;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 技巧 3：使用事务包装（减少自动提交）</span></span><br><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"><span class="comment">-- 多条 INSERT 语句</span></span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br></pre></td></tr></table></figure>

<h2 id="三、更新数据（UPDATE）"><a href="#三、更新数据（UPDATE）" class="headerlink" title="三、更新数据（UPDATE）"></a>三、更新数据（UPDATE）</h2><h3 id="3-1-基础更新语法"><a href="#3-1-基础更新语法" class="headerlink" title="3.1 基础更新语法"></a>3.1 基础更新语法</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 语法</span></span><br><span class="line"><span class="keyword">UPDATE</span> 表名</span><br><span class="line"><span class="keyword">SET</span> 列 <span class="number">1</span> <span class="operator">=</span> 值 <span class="number">1</span>, 列 <span class="number">2</span> <span class="operator">=</span> 值 <span class="number">2</span>, ...</span><br><span class="line">[<span class="keyword">WHERE</span> 条件];</span><br></pre></td></tr></table></figure>

<h3 id="3-2-更新指定记录"><a href="#3-2-更新指定记录" class="headerlink" title="3.2 更新指定记录"></a>3.2 更新指定记录</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 更新单条记录</span></span><br><span class="line"><span class="keyword">UPDATE</span> employees</span><br><span class="line"><span class="keyword">SET</span> salary <span class="operator">=</span> <span class="number">8500.00</span></span><br><span class="line"><span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 更新多列</span></span><br><span class="line"><span class="keyword">UPDATE</span> employees</span><br><span class="line"><span class="keyword">SET</span> salary <span class="operator">=</span> <span class="number">9000.00</span>, dept <span class="operator">=</span> <span class="string">&#x27;研发部&#x27;</span></span><br><span class="line"><span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 基于现有值更新</span></span><br><span class="line"><span class="keyword">UPDATE</span> employees</span><br><span class="line"><span class="keyword">SET</span> salary <span class="operator">=</span> salary <span class="operator">*</span> <span class="number">1.1</span>  <span class="comment">-- 加薪 10%</span></span><br><span class="line"><span class="keyword">WHERE</span> dept <span class="operator">=</span> <span class="string">&#x27;技术部&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 更新满足条件的多条记录</span></span><br><span class="line"><span class="keyword">UPDATE</span> employees</span><br><span class="line"><span class="keyword">SET</span> status <span class="operator">=</span> <span class="number">0</span>  <span class="comment">-- 设为离职状态</span></span><br><span class="line"><span class="keyword">WHERE</span> hire_date <span class="operator">&lt;</span> <span class="string">&#x27;2023-01-01&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p><strong>重要提醒</strong>：</p>
<blockquote>
<p>⚠️ <strong>UPDATE 语句一定要加 WHERE 子句！</strong> 否则整张表的所有记录都会被更新！</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 危险操作！会更新所有记录！</span></span><br><span class="line"><span class="keyword">UPDATE</span> employees <span class="keyword">SET</span> salary <span class="operator">=</span> <span class="number">5000</span>;  <span class="comment">-- 所有人的工资都变成 5000！</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 补救措施（如果开启了事务）</span></span><br><span class="line"><span class="keyword">ROLLBACK</span>;</span><br></pre></td></tr></table></figure>

<h3 id="3-3-更新时使用表达式"><a href="#3-3-更新时使用表达式" class="headerlink" title="3.3 更新时使用表达式"></a>3.3 更新时使用表达式</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 使用计算表达式</span></span><br><span class="line"><span class="keyword">UPDATE</span> employees</span><br><span class="line"><span class="keyword">SET</span> salary <span class="operator">=</span> salary <span class="operator">+</span> <span class="number">500</span>  <span class="comment">-- 每人加薪 500</span></span><br><span class="line"><span class="keyword">WHERE</span> status <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 使用函数</span></span><br><span class="line"><span class="keyword">UPDATE</span> employees</span><br><span class="line"><span class="keyword">SET</span> name <span class="operator">=</span> <span class="built_in">UPPER</span>(name)  <span class="comment">-- 姓名转大写</span></span><br><span class="line"><span class="keyword">WHERE</span> dept <span class="operator">=</span> <span class="string">&#x27;市场部&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 使用日期函数</span></span><br><span class="line"><span class="keyword">UPDATE</span> employees</span><br><span class="line"><span class="keyword">SET</span> hire_date <span class="operator">=</span> DATE_SUB(hire_date, <span class="type">INTERVAL</span> <span class="number">1</span> <span class="keyword">YEAR</span>)</span><br><span class="line"><span class="keyword">WHERE</span> id <span class="keyword">BETWEEN</span> <span class="number">1</span> <span class="keyword">AND</span> <span class="number">5</span>;</span><br></pre></td></tr></table></figure>

<h3 id="3-4-多表更新"><a href="#3-4-多表更新" class="headerlink" title="3.4 多表更新"></a>3.4 多表更新</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 创建部门表</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> departments (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT,</span><br><span class="line">    dept_name <span class="type">VARCHAR</span>(<span class="number">50</span>),</span><br><span class="line">    budget <span class="type">DECIMAL</span>(<span class="number">12</span>, <span class="number">2</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT INTO</span> departments (dept_name, budget) <span class="keyword">VALUES</span></span><br><span class="line">(<span class="string">&#x27;技术部&#x27;</span>, <span class="number">1000000</span>),</span><br><span class="line">(<span class="string">&#x27;市场部&#x27;</span>, <span class="number">500000</span>),</span><br><span class="line">(<span class="string">&#x27;财务部&#x27;</span>, <span class="number">300000</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 修改 employees 表，添加 dept_id</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> employees <span class="keyword">ADD</span> <span class="keyword">COLUMN</span> dept_id <span class="type">INT</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 多表关联更新</span></span><br><span class="line"><span class="keyword">UPDATE</span> employees e</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> departments d <span class="keyword">ON</span> e.dept <span class="operator">=</span> d.dept_name</span><br><span class="line"><span class="keyword">SET</span> e.dept_id <span class="operator">=</span> d.id;</span><br></pre></td></tr></table></figure>

<h3 id="3-5-更新-LIMIT"><a href="#3-5-更新-LIMIT" class="headerlink" title="3.5 更新 LIMIT"></a>3.5 更新 LIMIT</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 只更新前 N 条记录</span></span><br><span class="line"><span class="keyword">UPDATE</span> employees</span><br><span class="line"><span class="keyword">SET</span> salary <span class="operator">=</span> salary <span class="operator">+</span> <span class="number">100</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> salary <span class="keyword">ASC</span></span><br><span class="line">LIMIT <span class="number">5</span>;  <span class="comment">-- 工资最低的 5 个人加薪 100</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 结合 WHERE 和 LIMIT</span></span><br><span class="line"><span class="keyword">UPDATE</span> employees</span><br><span class="line"><span class="keyword">SET</span> status <span class="operator">=</span> <span class="number">0</span></span><br><span class="line"><span class="keyword">WHERE</span> dept <span class="operator">=</span> <span class="string">&#x27;市场部&#x27;</span></span><br><span class="line">LIMIT <span class="number">1</span>;  <span class="comment">-- 只更新 1 条市场部员工</span></span><br></pre></td></tr></table></figure>

<h2 id="四、删除数据（DELETE）"><a href="#四、删除数据（DELETE）" class="headerlink" title="四、删除数据（DELETE）"></a>四、删除数据（DELETE）</h2><h3 id="4-1-基础删除语法"><a href="#4-1-基础删除语法" class="headerlink" title="4.1 基础删除语法"></a>4.1 基础删除语法</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 语法</span></span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> 表名 [<span class="keyword">WHERE</span> 条件];</span><br></pre></td></tr></table></figure>

<h3 id="4-2-删除指定记录"><a href="#4-2-删除指定记录" class="headerlink" title="4.2 删除指定记录"></a>4.2 删除指定记录</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 删除单条记录</span></span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 删除多条记录</span></span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> dept <span class="operator">=</span> <span class="string">&#x27;市场部&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 使用 IN 删除</span></span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> id <span class="keyword">IN</span> (<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 使用条件删除</span></span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> salary <span class="operator">&lt;</span> <span class="number">6000</span> <span class="keyword">AND</span> status <span class="operator">=</span> <span class="number">0</span>;</span><br></pre></td></tr></table></figure>

<p><strong>重要提醒</strong>：</p>
<blockquote>
<p>⚠️ <strong>DELETE 语句一定要加 WHERE 子句！</strong> 否则会删除整张表的所有数据！</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 危险操作！会删除所有记录！</span></span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> employees;  <span class="comment">-- 表清空！</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 如果误操作且开启了事务</span></span><br><span class="line"><span class="keyword">ROLLBACK</span>;</span><br></pre></td></tr></table></figure>

<h3 id="4-3-删除-LIMIT"><a href="#4-3-删除-LIMIT" class="headerlink" title="4.3 删除 LIMIT"></a>4.3 删除 LIMIT</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 删除前 N 条符合条件的记录</span></span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> status <span class="operator">=</span> <span class="number">0</span></span><br><span class="line">LIMIT <span class="number">3</span>;  <span class="comment">-- 只删除 3 条离职员工</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 配合 ORDER BY</span></span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> dept <span class="operator">=</span> <span class="string">&#x27;市场部&#x27;</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> salary <span class="keyword">DESC</span></span><br><span class="line">LIMIT <span class="number">1</span>;  <span class="comment">-- 删除市场部工资最高的 1 人</span></span><br></pre></td></tr></table></figure>

<h3 id="4-4-多表删除"><a href="#4-4-多表删除" class="headerlink" title="4.4 多表删除"></a>4.4 多表删除</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 删除主表记录时级联删除子表</span></span><br><span class="line"><span class="keyword">DELETE</span> e <span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> departments d <span class="keyword">ON</span> e.dept_id <span class="operator">=</span> d.id</span><br><span class="line"><span class="keyword">WHERE</span> d.dept_name <span class="operator">=</span> <span class="string">&#x27;财务部&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 删除不存在的关联记录（左连接删除）</span></span><br><span class="line"><span class="keyword">DELETE</span> e <span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> departments d <span class="keyword">ON</span> e.dept_id <span class="operator">=</span> d.id</span><br><span class="line"><span class="keyword">WHERE</span> d.id <span class="keyword">IS</span> <span class="keyword">NULL</span>;  <span class="comment">-- 删除没有对应部门的员工</span></span><br></pre></td></tr></table></figure>

<h2 id="五、DELETE-vs-TRUNCATE-vs-DROP"><a href="#五、DELETE-vs-TRUNCATE-vs-DROP" class="headerlink" title="五、DELETE vs TRUNCATE vs DROP"></a>五、DELETE vs TRUNCATE vs DROP</h2><p>这三个命令都可以删除数据，但有本质区别：</p>
<table>
<thead>
<tr>
<th>对比项</th>
<th>DELETE</th>
<th>TRUNCATE</th>
<th>DROP</th>
</tr>
</thead>
<tbody><tr>
<td><strong>类型</strong></td>
<td>DML</td>
<td>DDL</td>
<td>DDL</td>
</tr>
<tr>
<td><strong>功能</strong></td>
<td>删除符合条件的行</td>
<td>清空整张表</td>
<td>删除整个表（结构和数据）</td>
</tr>
<tr>
<td><strong>WHERE 条件</strong></td>
<td>支持</td>
<td>不支持</td>
<td>不适用</td>
</tr>
<tr>
<td><strong>返回值</strong></td>
<td>删除的行数</td>
<td>无</td>
<td>无</td>
</tr>
<tr>
<td><strong>自增列重置</strong></td>
<td>否</td>
<td>是</td>
<td>不适用</td>
</tr>
<tr>
<td><strong>事务回滚</strong></td>
<td>支持</td>
<td>不支持</td>
<td>不支持</td>
</tr>
<tr>
<td><strong>触发器</strong></td>
<td>触发</td>
<td>不触发</td>
<td>不适用</td>
</tr>
<tr>
<td><strong>外键约束</strong></td>
<td>检查</td>
<td>检查</td>
<td>检查</td>
</tr>
<tr>
<td><strong>执行速度</strong></td>
<td>慢</td>
<td>快</td>
<td>快</td>
</tr>
<tr>
<td><strong>空间释放</strong></td>
<td>不释放</td>
<td>释放</td>
<td>释放</td>
</tr>
</tbody></table>
<h3 id="使用示例对比"><a href="#使用示例对比" class="headerlink" title="使用示例对比"></a>使用示例对比</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- DELETE：删除工资低于 7000 的员工</span></span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> salary <span class="operator">&lt;</span> <span class="number">7000</span>;</span><br><span class="line"><span class="comment">-- 自增 id 不会重置，下一个 id 继续递增</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- TRUNCATE：清空所有员工</span></span><br><span class="line"><span class="keyword">TRUNCATE</span> <span class="keyword">TABLE</span> employees;</span><br><span class="line"><span class="comment">-- 自增 id 重置为 1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- DROP：删除整个员工表（表结构也没了）</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> employees;</span><br><span class="line"><span class="comment">-- 再次查询会报错：Table doesn&#x27;t exist</span></span><br></pre></td></tr></table></figure>

<h2 id="六、DML-与事务"><a href="#六、DML-与事务" class="headerlink" title="六、DML 与事务"></a>六、DML 与事务</h2><h3 id="6-1-事务基础"><a href="#6-1-事务基础" class="headerlink" title="6.1 事务基础"></a>6.1 事务基础</h3><p>事务是一组原子性的 SQL 操作，要么全部成功，要么全部失败。</p>
<p><strong>事务的 ACID 特性</strong>：</p>
<ul>
<li><strong>原子性（Atomicity）</strong>：事务是不可分割的最小单位</li>
<li><strong>一致性（Consistency）</strong>：事务执行前后数据保持一致</li>
<li><strong>隔离性（Isolation）</strong>：并发事务互不干扰</li>
<li><strong>持久性（Durability）</strong>：事务提交后永久保存</li>
</ul>
<h3 id="6-2-事务操作"><a href="#6-2-事务操作" class="headerlink" title="6.2 事务操作"></a>6.2 事务操作</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 查看自动提交状态</span></span><br><span class="line"><span class="keyword">SELECT</span> @<span class="variable">@autocommit</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 关闭自动提交</span></span><br><span class="line"><span class="keyword">SET</span> autocommit <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 开始事务</span></span><br><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"><span class="comment">-- 或</span></span><br><span class="line"><span class="keyword">BEGIN</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 执行 DML 操作</span></span><br><span class="line"><span class="keyword">UPDATE</span> employees <span class="keyword">SET</span> salary <span class="operator">=</span> salary <span class="operator">+</span> <span class="number">500</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">UPDATE</span> employees <span class="keyword">SET</span> salary <span class="operator">=</span> salary <span class="operator">-</span> <span class="number">500</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 提交事务（使更改永久生效）</span></span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 回滚事务（撤销所有更改）</span></span><br><span class="line"><span class="keyword">ROLLBACK</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 设置保存点</span></span><br><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"><span class="keyword">UPDATE</span> employees <span class="keyword">SET</span> salary <span class="operator">=</span> <span class="number">8000</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">SAVEPOINT</span> sp1;</span><br><span class="line"><span class="keyword">UPDATE</span> employees <span class="keyword">SET</span> salary <span class="operator">=</span> <span class="number">9000</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line"><span class="comment">-- 回滚到保存点</span></span><br><span class="line"><span class="keyword">ROLLBACK</span> <span class="keyword">TO</span> sp1;  <span class="comment">-- id=2 的更新被撤销，id=1 的更新保留</span></span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br></pre></td></tr></table></figure>

<h3 id="6-3-实战案例：转账操作"><a href="#6-3-实战案例：转账操作" class="headerlink" title="6.3 实战案例：转账操作"></a>6.3 实战案例：转账操作</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 创建账户表</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> accounts (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT,</span><br><span class="line">    account_name <span class="type">VARCHAR</span>(<span class="number">50</span>),</span><br><span class="line">    balance <span class="type">DECIMAL</span>(<span class="number">12</span>, <span class="number">2</span>) <span class="keyword">DEFAULT</span> <span class="number">0</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT INTO</span> accounts (account_name, balance) <span class="keyword">VALUES</span></span><br><span class="line">(<span class="string">&#x27;张三&#x27;</span>, <span class="number">10000</span>),</span><br><span class="line">(<span class="string">&#x27;李四&#x27;</span>, <span class="number">5000</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 张三给李四转账 1000 元（使用事务保证原子性）</span></span><br><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 张三账户减 1000</span></span><br><span class="line"><span class="keyword">UPDATE</span> accounts <span class="keyword">SET</span> balance <span class="operator">=</span> balance <span class="operator">-</span> <span class="number">1000</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 李四账户加 1000</span></span><br><span class="line"><span class="keyword">UPDATE</span> accounts <span class="keyword">SET</span> balance <span class="operator">=</span> balance <span class="operator">+</span> <span class="number">1000</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 检查是否有异常（实际应用中的业务逻辑）</span></span><br><span class="line"><span class="comment">-- 这里可以添加余额检查等逻辑</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 提交事务</span></span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 如果中间出现错误</span></span><br><span class="line"><span class="comment">-- ROLLBACK;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看结果</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> accounts;</span><br></pre></td></tr></table></figure>

<h2 id="七、DML-实战练习"><a href="#七、DML-实战练习" class="headerlink" title="七、DML 实战练习"></a>七、DML 实战练习</h2><h3 id="7-1-员工管理系统练习"><a href="#7-1-员工管理系统练习" class="headerlink" title="7.1 员工管理系统练习"></a>7.1 员工管理系统练习</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 1. 初始化数据</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> employees (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT,</span><br><span class="line">    name <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">    dept <span class="type">VARCHAR</span>(<span class="number">50</span>),</span><br><span class="line">    salary <span class="type">DECIMAL</span>(<span class="number">10</span>, <span class="number">2</span>),</span><br><span class="line">    hire_date <span class="type">DATE</span>,</span><br><span class="line">    status TINYINT <span class="keyword">DEFAULT</span> <span class="number">1</span> COMMENT <span class="string">&#x27;1 在职 0 离职&#x27;</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT INTO</span> employees (name, dept, salary, hire_date, status) <span class="keyword">VALUES</span></span><br><span class="line">(<span class="string">&#x27;张三&#x27;</span>, <span class="string">&#x27;技术部&#x27;</span>, <span class="number">8000</span>, <span class="string">&#x27;2023-01-15&#x27;</span>, <span class="number">1</span>),</span><br><span class="line">(<span class="string">&#x27;李四&#x27;</span>, <span class="string">&#x27;技术部&#x27;</span>, <span class="number">9000</span>, <span class="string">&#x27;2022-06-01&#x27;</span>, <span class="number">1</span>),</span><br><span class="line">(<span class="string">&#x27;王五&#x27;</span>, <span class="string">&#x27;市场部&#x27;</span>, <span class="number">7500</span>, <span class="string">&#x27;2023-03-20&#x27;</span>, <span class="number">1</span>),</span><br><span class="line">(<span class="string">&#x27;赵六&#x27;</span>, <span class="string">&#x27;市场部&#x27;</span>, <span class="number">7000</span>, <span class="string">&#x27;2023-06-10&#x27;</span>, <span class="number">1</span>),</span><br><span class="line">(<span class="string">&#x27;孙七&#x27;</span>, <span class="string">&#x27;财务部&#x27;</span>, <span class="number">8500</span>, <span class="string">&#x27;2022-09-01&#x27;</span>, <span class="number">1</span>),</span><br><span class="line">(<span class="string">&#x27;周八&#x27;</span>, <span class="string">&#x27;技术部&#x27;</span>, <span class="number">9500</span>, <span class="string">&#x27;2021-12-01&#x27;</span>, <span class="number">1</span>),</span><br><span class="line">(<span class="string">&#x27;吴九&#x27;</span>, <span class="string">&#x27;人事部&#x27;</span>, <span class="number">6500</span>, <span class="string">&#x27;2023-07-01&#x27;</span>, <span class="number">1</span>),</span><br><span class="line">(<span class="string">&#x27;郑十&#x27;</span>, <span class="string">&#x27;财务部&#x27;</span>, <span class="number">8000</span>, <span class="string">&#x27;2023-02-15&#x27;</span>, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 练习 1：技术部所有员工加薪 500 元</span></span><br><span class="line"><span class="keyword">UPDATE</span> employees <span class="keyword">SET</span> salary <span class="operator">=</span> salary <span class="operator">+</span> <span class="number">500</span> <span class="keyword">WHERE</span> dept <span class="operator">=</span> <span class="string">&#x27;技术部&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 练习 2：插入一批新员工</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> employees (name, dept, salary, hire_date) <span class="keyword">VALUES</span></span><br><span class="line">(<span class="string">&#x27;刘备&#x27;</span>, <span class="string">&#x27;市场部&#x27;</span>, <span class="number">12000</span>, <span class="string">&#x27;2024-01-02&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;关羽&#x27;</span>, <span class="string">&#x27;技术部&#x27;</span>, <span class="number">11000</span>, <span class="string">&#x27;2024-01-02&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;张飞&#x27;</span>, <span class="string">&#x27;技术部&#x27;</span>, <span class="number">10000</span>, <span class="string">&#x27;2024-01-02&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 练习 3：删除所有离职员工（status=0）</span></span><br><span class="line"><span class="comment">-- 先模拟一些离职员工</span></span><br><span class="line"><span class="keyword">UPDATE</span> employees <span class="keyword">SET</span> status <span class="operator">=</span> <span class="number">0</span> <span class="keyword">WHERE</span> name <span class="keyword">IN</span> (<span class="string">&#x27;吴九&#x27;</span>, <span class="string">&#x27;郑十&#x27;</span>);</span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> status <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 练习 4：将市场部和财务部的工资统一上调 8%</span></span><br><span class="line"><span class="keyword">UPDATE</span> employees</span><br><span class="line"><span class="keyword">SET</span> salary <span class="operator">=</span> salary <span class="operator">*</span> <span class="number">1.08</span></span><br><span class="line"><span class="keyword">WHERE</span> dept <span class="keyword">IN</span> (<span class="string">&#x27;市场部&#x27;</span>, <span class="string">&#x27;财务部&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 练习 5：查询最终结果</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees <span class="keyword">ORDER</span> <span class="keyword">BY</span> dept, salary <span class="keyword">DESC</span>;</span><br></pre></td></tr></table></figure>

<h3 id="7-2-订单系统练习"><a href="#7-2-订单系统练习" class="headerlink" title="7.2 订单系统练习"></a>7.2 订单系统练习</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 创建订单表</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> orders (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT,</span><br><span class="line">    order_no <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">UNIQUE</span>,</span><br><span class="line">    customer_name <span class="type">VARCHAR</span>(<span class="number">50</span>),</span><br><span class="line">    amount <span class="type">DECIMAL</span>(<span class="number">10</span>, <span class="number">2</span>),</span><br><span class="line">    status <span class="type">VARCHAR</span>(<span class="number">20</span>) <span class="keyword">DEFAULT</span> <span class="string">&#x27;PENDING&#x27;</span>,</span><br><span class="line">    create_time DATETIME <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 插入订单数据</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> orders (order_no, customer_name, amount, status) <span class="keyword">VALUES</span></span><br><span class="line">(<span class="string">&#x27;ORD001&#x27;</span>, <span class="string">&#x27;张三&#x27;</span>, <span class="number">199.00</span>, <span class="string">&#x27;PENDING&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;ORD002&#x27;</span>, <span class="string">&#x27;李四&#x27;</span>, <span class="number">299.00</span>, <span class="string">&#x27;PAID&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;ORD003&#x27;</span>, <span class="string">&#x27;王五&#x27;</span>, <span class="number">399.00</span>, <span class="string">&#x27;PENDING&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;ORD004&#x27;</span>, <span class="string">&#x27;赵六&#x27;</span>, <span class="number">499.00</span>, <span class="string">&#x27;SHIPPED&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;ORD005&#x27;</span>, <span class="string">&#x27;孙七&#x27;</span>, <span class="number">599.00</span>, <span class="string">&#x27;PENDING&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 练习 1：将所有 PENDING 状态的订单改为 PAID</span></span><br><span class="line"><span class="keyword">UPDATE</span> orders <span class="keyword">SET</span> status <span class="operator">=</span> <span class="string">&#x27;PAID&#x27;</span> <span class="keyword">WHERE</span> status <span class="operator">=</span> <span class="string">&#x27;PENDING&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 练习 2：删除金额低于 300 的订单</span></span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> orders <span class="keyword">WHERE</span> amount <span class="operator">&lt;</span> <span class="number">300</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 练习 3：批量插入新订单</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> orders (order_no, customer_name, amount) <span class="keyword">VALUES</span></span><br><span class="line">(<span class="string">&#x27;ORD006&#x27;</span>, <span class="string">&#x27;周八&#x27;</span>, <span class="number">699.00</span>),</span><br><span class="line">(<span class="string">&#x27;ORD007&#x27;</span>, <span class="string">&#x27;吴九&#x27;</span>, <span class="number">799.00</span>),</span><br><span class="line">(<span class="string">&#x27;ORD008&#x27;</span>, <span class="string">&#x27;郑十&#x27;</span>, <span class="number">899.00</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 练习 4：给所有订单打 9 折促销</span></span><br><span class="line"><span class="keyword">UPDATE</span> orders <span class="keyword">SET</span> amount <span class="operator">=</span> amount <span class="operator">*</span> <span class="number">0.9</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看结果</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> orders;</span><br></pre></td></tr></table></figure>

<h2 id="八、DML-性能优化建议"><a href="#八、DML-性能优化建议" class="headerlink" title="八、DML 性能优化建议"></a>八、DML 性能优化建议</h2><h3 id="8-1-INSERT-优化"><a href="#8-1-INSERT-优化" class="headerlink" title="8.1 INSERT 优化"></a>8.1 INSERT 优化</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 1. 批量插入优于单条插入</span></span><br><span class="line"><span class="comment">-- 慢</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> employees (name, dept) <span class="keyword">VALUES</span> (<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;技术部&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT INTO</span> employees (name, dept) <span class="keyword">VALUES</span> (<span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;技术部&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 快</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> employees (name, dept) <span class="keyword">VALUES</span></span><br><span class="line">(<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;技术部&#x27;</span>), (<span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;技术部&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 2. 对于大量数据，禁用索引后插入再重建</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> employees DISABLE KEYS;</span><br><span class="line"><span class="comment">-- 批量插入...</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> employees ENABLE KEYS;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 3. 使用 LOAD DATA 导入文本文件（最快）</span></span><br><span class="line">LOAD DATA <span class="keyword">LOCAL</span> INFILE <span class="string">&#x27;/path/to/data.csv&#x27;</span></span><br><span class="line"><span class="keyword">INTO</span> <span class="keyword">TABLE</span> employees</span><br><span class="line">FIELDS TERMINATED <span class="keyword">BY</span> <span class="string">&#x27;,&#x27;</span></span><br><span class="line">LINES TERMINATED <span class="keyword">BY</span> <span class="string">&#x27;\n&#x27;</span></span><br><span class="line">(name, dept, salary);</span><br></pre></td></tr></table></figure>

<h3 id="8-2-UPDATE-优化"><a href="#8-2-UPDATE-优化" class="headerlink" title="8.2 UPDATE 优化"></a>8.2 UPDATE 优化</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 1. WHERE 条件使用索引列</span></span><br><span class="line"><span class="keyword">UPDATE</span> employees <span class="keyword">SET</span> salary <span class="operator">=</span> <span class="number">8000</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;  <span class="comment">-- id 是主键，有索引</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 2. 避免更新不必要的列</span></span><br><span class="line"><span class="keyword">UPDATE</span> employees <span class="keyword">SET</span> name <span class="operator">=</span> <span class="string">&#x27;新名字&#x27;</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;  <span class="comment">-- 只更新需要的列</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 3. 分批更新大表</span></span><br><span class="line"><span class="keyword">UPDATE</span> employees <span class="keyword">SET</span> status <span class="operator">=</span> <span class="number">0</span> <span class="keyword">WHERE</span> create_time <span class="operator">&lt;</span> <span class="string">&#x27;2023-01-01&#x27;</span> LIMIT <span class="number">1000</span>;</span><br><span class="line"><span class="comment">-- 多次执行直到影响行数为 0</span></span><br></pre></td></tr></table></figure>

<h3 id="8-3-DELETE-优化"><a href="#8-3-DELETE-优化" class="headerlink" title="8.3 DELETE 优化"></a>8.3 DELETE 优化</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 1. 分批删除大表</span></span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> logs <span class="keyword">WHERE</span> create_time <span class="operator">&lt;</span> <span class="string">&#x27;2023-01-01&#x27;</span> LIMIT <span class="number">1000</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 2. 对于清空表，使用 TRUNCATE 代替 DELETE</span></span><br><span class="line"><span class="keyword">TRUNCATE</span> <span class="keyword">TABLE</span> logs;  <span class="comment">-- 比 DELETE 快得多</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 3. 删除前备份重要数据</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> employees_backup <span class="keyword">AS</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> status <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> status <span class="operator">=</span> <span class="number">0</span>;</span><br></pre></td></tr></table></figure>

<h2 id="九、小结"><a href="#九、小结" class="headerlink" title="九、小结"></a>九、小结</h2><h3 id="知识点回顾"><a href="#知识点回顾" class="headerlink" title="知识点回顾"></a>知识点回顾</h3><ol>
<li><p><strong>INSERT 插入</strong></p>
<ul>
<li>单条插入、批量插入</li>
<li>INSERT IGNORE、ON DUPLICATE KEY UPDATE、REPLACE INTO</li>
<li>INSERT INTO … SELECT</li>
</ul>
</li>
<li><p><strong>UPDATE 更新</strong></p>
<ul>
<li>基础更新、表达式更新、多表更新</li>
<li>必须使用 WHERE 条件避免误更新</li>
</ul>
</li>
<li><p><strong>DELETE 删除</strong></p>
<ul>
<li>条件删除、LIMIT 删除、多表删除</li>
<li>DELETE vs TRUNCATE vs DROP 的区别</li>
</ul>
</li>
<li><p><strong>事务控制</strong></p>
<ul>
<li>START TRANSACTION、COMMIT、ROLLBACK</li>
<li>保存点 SAVEPOINT</li>
</ul>
</li>
</ol>
<h3 id="DML-命令速查表"><a href="#DML-命令速查表" class="headerlink" title="DML 命令速查表"></a>DML 命令速查表</h3><table>
<thead>
<tr>
<th>命令</th>
<th>语法</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>INSERT</td>
<td><code>INSERT INTO 表 (列) VALUES (值)</code></td>
<td>插入数据</td>
</tr>
<tr>
<td>UPDATE</td>
<td><code>UPDATE 表 SET 列=值 WHERE 条件</code></td>
<td>更新数据</td>
</tr>
<tr>
<td>DELETE</td>
<td><code>DELETE FROM 表 WHERE 条件</code></td>
<td>删除数据</td>
</tr>
<tr>
<td>TRUNCATE</td>
<td><code>TRUNCATE TABLE 表</code></td>
<td>清空表</td>
</tr>
</tbody></table>
<h3 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h3><p>⚠️ <strong>执行 DML 操作前务必</strong>：</p>
<ol>
<li>开启事务或确保可以回滚</li>
<li>先用 SELECT 验证 WHERE 条件是否正确</li>
<li>对重要数据进行备份</li>
<li>谨慎执行不带 WHERE 的 UPDATE&#x2F;DELETE</li>
</ol>
<hr>
<p><strong>下一篇</strong>：[MySQL 基础教程（四）：DQL 数据查询语言详解](&#x2F;2026&#x2F;02&#x2F;23&#x2F;MySQL 基础教程（四）DQL 数据查询语言详解&#x2F;)</p>
<p><strong>上一篇</strong>：[MySQL 基础教程（二）：DDL 数据定义语言详解](&#x2F;2026&#x2F;02&#x2F;23&#x2F;MySQL 基础教程（二）DDL 数据定义语言详解&#x2F;)</p>
]]></content>
      <categories>
        <category>MySQL 基础教程</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
        <tag>DML</tag>
        <tag>数据操作</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQL 基础教程（二）DDL 数据定义语言详解</title>
    <url>/2026/02/23/MySQL%20%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B%EF%BC%88%E4%BA%8C%EF%BC%89DDL%20%E6%95%B0%E6%8D%AE%E5%AE%9A%E4%B9%89%E8%AF%AD%E8%A8%80%E8%AF%A6%E8%A7%A3/</url>
    <content><![CDATA[<h1 id="MySQL-基础教程（二）DDL-数据定义语言详解"><a href="#MySQL-基础教程（二）DDL-数据定义语言详解" class="headerlink" title="MySQL 基础教程（二）DDL 数据定义语言详解"></a>MySQL 基础教程（二）DDL 数据定义语言详解</h1><p>在上一篇中，我们完成了 MySQL 的安装并了解了 SQL 的分类。本文我们将深入学习 <strong>DDL（Data Definition Language）数据定义语言</strong>，掌握如何创建和管理数据库与表。</p>
<h2 id="一、DDL-概述"><a href="#一、DDL-概述" class="headerlink" title="一、DDL 概述"></a>一、DDL 概述</h2><p>DDL 用于定义和管理数据库对象，包括：</p>
<ul>
<li><strong>数据库操作</strong>：CREATE DATABASE、DROP DATABASE、ALTER DATABASE、USE</li>
<li><strong>表操作</strong>：CREATE TABLE、ALTER TABLE、DROP TABLE、TRUNCATE、RENAME</li>
<li><strong>索引操作</strong>：CREATE INDEX、DROP INDEX</li>
<li><strong>视图操作</strong>：CREATE VIEW、DROP VIEW</li>
</ul>
<p><strong>DDL 的特点</strong>：</p>
<ul>
<li>操作会自动提交，无法回滚</li>
<li>操作的是数据库结构，而非数据内容</li>
</ul>
<h2 id="二、数据库操作"><a href="#二、数据库操作" class="headerlink" title="二、数据库操作"></a>二、数据库操作</h2><h3 id="2-1-创建数据库"><a href="#2-1-创建数据库" class="headerlink" title="2.1 创建数据库"></a>2.1 创建数据库</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 创建数据库（如果不存在）</span></span><br><span class="line"><span class="keyword">CREATE</span> DATABASE IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> mydb;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建数据库并指定字符集</span></span><br><span class="line"><span class="keyword">CREATE</span> DATABASE IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> mydb</span><br><span class="line"><span class="keyword">CHARACTER SET</span> utf8mb4</span><br><span class="line"><span class="keyword">COLLATE</span> utf8mb4_unicode_ci;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看所有数据库</span></span><br><span class="line"><span class="keyword">SHOW</span> DATABASES;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看创建数据库的语句</span></span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">CREATE</span> DATABASE mydb;</span><br></pre></td></tr></table></figure>

<p><strong>参数说明</strong>：</p>
<ul>
<li><code>IF NOT EXISTS</code>：如果数据库已存在则不创建，避免报错</li>
<li><code>CHARACTER SET</code>：指定字符集，推荐 <code>utf8mb4</code>（支持 emoji 等特殊字符）</li>
<li><code>COLLATE</code>：指定排序规则</li>
</ul>
<p><strong>常用字符集</strong>：</p>
<table>
<thead>
<tr>
<th>字符集</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>utf8mb4</td>
<td>UTF-8 完整实现，支持 emoji（推荐）</td>
</tr>
<tr>
<td>utf8</td>
<td>MySQL 中的 utf8 是阉割版，最多 3 字节</td>
</tr>
<tr>
<td>gbk</td>
<td>中文字符集，2 字节</td>
</tr>
<tr>
<td>latin1</td>
<td>单字节字符集，西文字符</td>
</tr>
</tbody></table>
<h3 id="2-2-查看和选择数据库"><a href="#2-2-查看和选择数据库" class="headerlink" title="2.2 查看和选择数据库"></a>2.2 查看和选择数据库</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 查看当前使用的数据库</span></span><br><span class="line"><span class="keyword">SELECT</span> DATABASE();</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 使用/切换数据库</span></span><br><span class="line">USE mydb;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看当前数据库中的所有表</span></span><br><span class="line"><span class="keyword">SHOW</span> TABLES;</span><br></pre></td></tr></table></figure>

<h3 id="2-3-修改数据库"><a href="#2-3-修改数据库" class="headerlink" title="2.3 修改数据库"></a>2.3 修改数据库</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 修改数据库字符集</span></span><br><span class="line"><span class="keyword">ALTER</span> DATABASE mydb</span><br><span class="line"><span class="keyword">CHARACTER SET</span> utf8mb4</span><br><span class="line"><span class="keyword">COLLATE</span> utf8mb4_general_ci;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看数据库定义</span></span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">CREATE</span> DATABASE mydb;</span><br></pre></td></tr></table></figure>

<h3 id="2-4-删除数据库"><a href="#2-4-删除数据库" class="headerlink" title="2.4 删除数据库"></a>2.4 删除数据库</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 删除数据库（如果存在）</span></span><br><span class="line"><span class="keyword">DROP</span> DATABASE IF <span class="keyword">EXISTS</span> mydb;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 删除数据库（不存在则报错）</span></span><br><span class="line"><span class="keyword">DROP</span> DATABASE mydb;</span><br></pre></td></tr></table></figure>

<p><strong>注意</strong>：<code>DROP</code> 操作会永久删除数据库及其所有数据，请谨慎操作！</p>
<h2 id="三、表操作-创建与查询"><a href="#三、表操作-创建与查询" class="headerlink" title="三、表操作 - 创建与查询"></a>三、表操作 - 创建与查询</h2><h3 id="3-1-创建表的基本语法"><a href="#3-1-创建表的基本语法" class="headerlink" title="3.1 创建表的基本语法"></a>3.1 创建表的基本语法</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> [IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span>] 表名 (</span><br><span class="line">    列名 <span class="number">1</span> 数据类型 [约束条件],</span><br><span class="line">    列名 <span class="number">2</span> 数据类型 [约束条件],</span><br><span class="line">    ...</span><br><span class="line">    列名 n 数据类型 [约束条件]</span><br><span class="line">) [表选项];</span><br></pre></td></tr></table></figure>

<h3 id="3-2-创建表示例"><a href="#3-2-创建表示例" class="headerlink" title="3.2 创建表示例"></a>3.2 创建表示例</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 创建学生表</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> students (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;学生 ID&#x27;</span>,</span><br><span class="line">    name <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">NOT NULL</span> COMMENT <span class="string">&#x27;姓名&#x27;</span>,</span><br><span class="line">    age <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">18</span> COMMENT <span class="string">&#x27;年龄&#x27;</span>,</span><br><span class="line">    gender ENUM(<span class="string">&#x27;男&#x27;</span>, <span class="string">&#x27;女&#x27;</span>) <span class="keyword">DEFAULT</span> <span class="string">&#x27;男&#x27;</span> COMMENT <span class="string">&#x27;性别&#x27;</span>,</span><br><span class="line">    email <span class="type">VARCHAR</span>(<span class="number">100</span>) COMMENT <span class="string">&#x27;邮箱&#x27;</span>,</span><br><span class="line">    phone <span class="type">VARCHAR</span>(<span class="number">20</span>) COMMENT <span class="string">&#x27;电话&#x27;</span>,</span><br><span class="line">    create_time DATETIME <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="string">&#x27;创建时间&#x27;</span></span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4 COMMENT<span class="operator">=</span><span class="string">&#x27;学生信息表&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h3 id="3-3-常用约束条件"><a href="#3-3-常用约束条件" class="headerlink" title="3.3 常用约束条件"></a>3.3 常用约束条件</h3><table>
<thead>
<tr>
<th>约束</th>
<th>说明</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td>PRIMARY KEY</td>
<td>主键，唯一且非空</td>
<td><code>id INT PRIMARY KEY</code></td>
</tr>
<tr>
<td>AUTO_INCREMENT</td>
<td>自增</td>
<td><code>id INT AUTO_INCREMENT</code></td>
</tr>
<tr>
<td>NOT NULL</td>
<td>非空</td>
<td><code>name VARCHAR(50) NOT NULL</code></td>
</tr>
<tr>
<td>UNIQUE</td>
<td>唯一</td>
<td><code>email VARCHAR(100) UNIQUE</code></td>
</tr>
<tr>
<td>DEFAULT</td>
<td>默认值</td>
<td><code>age INT DEFAULT 18</code></td>
</tr>
<tr>
<td>FOREIGN KEY</td>
<td>外键</td>
<td><code>FOREIGN KEY (dept_id) REFERENCES departments(id)</code></td>
</tr>
<tr>
<td>CHECK</td>
<td>检查条件（MySQL 8.0.16+ 支持）</td>
<td><code>age INT CHECK (age &gt;= 0)</code></td>
</tr>
</tbody></table>
<h3 id="3-4-表选项"><a href="#3-4-表选项" class="headerlink" title="3.4 表选项"></a>3.4 表选项</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 常用表选项</span></span><br><span class="line">ENGINE<span class="operator">=</span>InnoDB           <span class="comment">-- 存储引擎，默认 InnoDB</span></span><br><span class="line"><span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4 <span class="comment">-- 字符集</span></span><br><span class="line">AUTO_INCREMENT<span class="operator">=</span><span class="number">1</span>        <span class="comment">-- 自增起始值</span></span><br><span class="line">COMMENT<span class="operator">=</span><span class="string">&#x27;表注释&#x27;</span>         <span class="comment">-- 表注释</span></span><br></pre></td></tr></table></figure>

<h3 id="3-5-查询表信息"><a href="#3-5-查询表信息" class="headerlink" title="3.5 查询表信息"></a>3.5 查询表信息</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 查看当前数据库的所有表</span></span><br><span class="line"><span class="keyword">SHOW</span> TABLES;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看表结构</span></span><br><span class="line"><span class="keyword">DESC</span> students;</span><br><span class="line"><span class="keyword">DESCRIBE</span> students;  <span class="comment">-- 等价</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看详细表结构（包含更多信息）</span></span><br><span class="line"><span class="keyword">DESC</span> formatted students;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看创建表的语句</span></span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">CREATE TABLE</span> students;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看表的状态信息</span></span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">TABLE</span> STATUS <span class="keyword">LIKE</span> <span class="string">&#x27;students&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看表的索引信息</span></span><br><span class="line"><span class="keyword">SHOW</span> INDEX <span class="keyword">FROM</span> students;</span><br></pre></td></tr></table></figure>

<h3 id="3-6-创建表实战案例"><a href="#3-6-创建表实战案例" class="headerlink" title="3.6 创建表实战案例"></a>3.6 创建表实战案例</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 创建部门表</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> departments (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;部门 ID&#x27;</span>,</span><br><span class="line">    dept_name <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">NOT NULL</span> <span class="keyword">UNIQUE</span> COMMENT <span class="string">&#x27;部门名称&#x27;</span>,</span><br><span class="line">    dept_location <span class="type">VARCHAR</span>(<span class="number">100</span>) COMMENT <span class="string">&#x27;部门位置&#x27;</span>,</span><br><span class="line">    create_time DATETIME <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="string">&#x27;创建时间&#x27;</span></span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4 COMMENT<span class="operator">=</span><span class="string">&#x27;部门表&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建员工表（带外键）</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> employees (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;员工 ID&#x27;</span>,</span><br><span class="line">    emp_name <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">NOT NULL</span> COMMENT <span class="string">&#x27;姓名&#x27;</span>,</span><br><span class="line">    emp_no <span class="type">VARCHAR</span>(<span class="number">20</span>) <span class="keyword">NOT NULL</span> <span class="keyword">UNIQUE</span> COMMENT <span class="string">&#x27;员工编号&#x27;</span>,</span><br><span class="line">    gender ENUM(<span class="string">&#x27;男&#x27;</span>, <span class="string">&#x27;女&#x27;</span>) <span class="keyword">DEFAULT</span> <span class="string">&#x27;男&#x27;</span> COMMENT <span class="string">&#x27;性别&#x27;</span>,</span><br><span class="line">    salary <span class="type">DECIMAL</span>(<span class="number">10</span>, <span class="number">2</span>) <span class="keyword">DEFAULT</span> <span class="number">0</span> COMMENT <span class="string">&#x27;工资&#x27;</span>,</span><br><span class="line">    dept_id <span class="type">INT</span> COMMENT <span class="string">&#x27;部门 ID&#x27;</span>,</span><br><span class="line">    hire_date <span class="type">DATE</span> COMMENT <span class="string">&#x27;入职日期&#x27;</span>,</span><br><span class="line">    create_time DATETIME <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="string">&#x27;创建时间&#x27;</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment">-- 外键约束</span></span><br><span class="line">    <span class="keyword">CONSTRAINT</span> fk_emp_dept</span><br><span class="line">        <span class="keyword">FOREIGN KEY</span> (dept_id) <span class="keyword">REFERENCES</span> departments(id)</span><br><span class="line">        <span class="keyword">ON</span> <span class="keyword">DELETE</span> <span class="keyword">SET</span> <span class="keyword">NULL</span></span><br><span class="line">        <span class="keyword">ON</span> <span class="keyword">UPDATE</span> CASCADE</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4 COMMENT<span class="operator">=</span><span class="string">&#x27;员工表&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p><strong>外键选项说明</strong>：</p>
<ul>
<li><code>ON DELETE SET NULL</code>：删除父表记录时，子表外键设为 NULL</li>
<li><code>ON DELETE CASCADE</code>：删除父表记录时，级联删除子表记录</li>
<li><code>ON UPDATE CASCADE</code>：更新父表主键时，级联更新子表外键</li>
</ul>
<h2 id="四、MySQL-数据类型"><a href="#四、MySQL-数据类型" class="headerlink" title="四、MySQL 数据类型"></a>四、MySQL 数据类型</h2><p>MySQL 的数据类型分为三大类：<strong>数值类型</strong>、<strong>字符串类型</strong>、<strong>日期时间类型</strong>。</p>
<h3 id="4-1-数值类型"><a href="#4-1-数值类型" class="headerlink" title="4.1 数值类型"></a>4.1 数值类型</h3><h4 id="整数类型"><a href="#整数类型" class="headerlink" title="整数类型"></a>整数类型</h4><table>
<thead>
<tr>
<th>类型</th>
<th>字节</th>
<th>有符号范围</th>
<th>无符号范围</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>TINYINT</td>
<td>1</td>
<td>-128 ~ 127</td>
<td>0 ~ 255</td>
<td>适合状态、布尔值</td>
</tr>
<tr>
<td>SMALLINT</td>
<td>2</td>
<td>-32768 ~ 32767</td>
<td>0 ~ 65535</td>
<td>小整数</td>
</tr>
<tr>
<td>MEDIUMINT</td>
<td>3</td>
<td>-8388608 ~ 8388607</td>
<td>0 ~ 16777215</td>
<td>中等整数</td>
</tr>
<tr>
<td>INT&#x2F;INTEGER</td>
<td>4</td>
<td>-2³¹ ~ 2³¹-1</td>
<td>0 ~ 2³²-1</td>
<td>常用整数</td>
</tr>
<tr>
<td>BIGINT</td>
<td>8</td>
<td>-2⁶³ ~ 2⁶³-1</td>
<td>0 ~ 2⁶⁴-1</td>
<td>大整数，如金额</td>
</tr>
</tbody></table>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 整数示例</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> num_test (</span><br><span class="line">    tiny_int TINYINT COMMENT <span class="string">&#x27;微小整数&#x27;</span>,</span><br><span class="line">    small_int <span class="type">SMALLINT</span> COMMENT <span class="string">&#x27;小整数&#x27;</span>,</span><br><span class="line">    medium_int MEDIUMINT COMMENT <span class="string">&#x27;中等整数&#x27;</span>,</span><br><span class="line">    big_int <span class="type">BIGINT</span> COMMENT <span class="string">&#x27;大整数&#x27;</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment">-- 无符号整数（不能为负数）</span></span><br><span class="line">    unsigned_int <span class="type">INT</span> UNSIGNED COMMENT <span class="string">&#x27;无符号整数&#x27;</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 插入测试数据</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> num_test <span class="keyword">VALUES</span> (<span class="number">100</span>, <span class="number">30000</span>, <span class="number">5000000</span>, <span class="number">9000000000</span>, <span class="number">4000000000</span>);</span><br></pre></td></tr></table></figure>

<p><strong>Zerofill 属性</strong>（自动添加前导零）：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 创建 zerofill 列</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> zerofill_test (</span><br><span class="line">    id <span class="type">INT</span>(<span class="number">5</span>) ZEROFILL</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT INTO</span> zerofill_test <span class="keyword">VALUES</span> (<span class="number">1</span>), (<span class="number">23</span>), (<span class="number">456</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> zerofill_test;</span><br><span class="line"><span class="comment">-- 结果：00001, 00023, 00456</span></span><br></pre></td></tr></table></figure>

<h4 id="浮点类型"><a href="#浮点类型" class="headerlink" title="浮点类型"></a>浮点类型</h4><table>
<thead>
<tr>
<th>类型</th>
<th>字节</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>FLOAT</td>
<td>4</td>
<td>单精度浮点数</td>
</tr>
<tr>
<td>DOUBLE</td>
<td>8</td>
<td>双精度浮点数</td>
</tr>
<tr>
<td>DECIMAL(M,D)</td>
<td>可变</td>
<td>精确小数，适合金额</td>
</tr>
</tbody></table>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 浮点数示例</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> float_test (</span><br><span class="line">    f <span class="type">FLOAT</span>,</span><br><span class="line">    d <span class="keyword">DOUBLE</span>,</span><br><span class="line">    m <span class="type">DECIMAL</span>(<span class="number">10</span>, <span class="number">2</span>)  <span class="comment">-- 总共 10 位，小数 2 位</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- DECIMAL 更适合金额计算（精确）</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> float_test <span class="keyword">VALUES</span> (<span class="number">3.14</span>, <span class="number">3.1415926</span>, <span class="number">12345678.90</span>);</span><br></pre></td></tr></table></figure>

<p><strong>DECIMAL vs FLOAT&#x2F;DOUBLE</strong>：</p>
<ul>
<li><code>FLOAT/DOUBLE</code>：有精度损失，适合科学计算</li>
<li><code>DECIMAL</code>：精确无损失，<strong>适合金融、金额计算</strong></li>
</ul>
<h3 id="4-2-字符串类型"><a href="#4-2-字符串类型" class="headerlink" title="4.2 字符串类型"></a>4.2 字符串类型</h3><table>
<thead>
<tr>
<th>类型</th>
<th>说明</th>
<th>最大长度</th>
<th>特点</th>
</tr>
</thead>
<tbody><tr>
<td>CHAR(n)</td>
<td>固定长度</td>
<td>255 字符</td>
<td>不足补空格，查询快</td>
</tr>
<tr>
<td>VARCHAR(n)</td>
<td>可变长度</td>
<td>65535 字节</td>
<td>节省空间</td>
</tr>
<tr>
<td>TEXT</td>
<td>长文本</td>
<td>65535 字节</td>
<td>存储大文本</td>
</tr>
<tr>
<td>MEDIUMTEXT</td>
<td>大文本</td>
<td>16MB</td>
<td>更大文本</td>
</tr>
<tr>
<td>LONGTEXT</td>
<td>超长文本</td>
<td>4GB</td>
<td>极大文本</td>
</tr>
<tr>
<td>BLOB</td>
<td>二进制数据</td>
<td>65535 字节</td>
<td>图片、文件等</td>
</tr>
</tbody></table>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 字符串类型示例</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> string_test (</span><br><span class="line">    char_col <span class="type">CHAR</span>(<span class="number">10</span>) COMMENT <span class="string">&#x27;固定长度&#x27;</span>,</span><br><span class="line">    varchar_col <span class="type">VARCHAR</span>(<span class="number">10</span>) COMMENT <span class="string">&#x27;可变长度&#x27;</span>,</span><br><span class="line">    text_col TEXT COMMENT <span class="string">&#x27;长文本&#x27;</span>,</span><br><span class="line">    blob_col <span class="type">BLOB</span> COMMENT <span class="string">&#x27;二进制数据&#x27;</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 插入测试</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> string_test <span class="keyword">VALUES</span> (<span class="string">&#x27;abc&#x27;</span>, <span class="string">&#x27;abc&#x27;</span>, <span class="string">&#x27;这是一段较长的文本...&#x27;</span>, X<span class="string">&#x27;48454C4C4F&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- CHAR 会补足空格</span></span><br><span class="line"><span class="keyword">SELECT</span> char_col, LENGTH(char_col) <span class="keyword">FROM</span> string_test;  <span class="comment">-- &#x27;abc       &#x27;, 10</span></span><br></pre></td></tr></table></figure>

<p><strong>CHAR vs VARCHAR 选择</strong>：</p>
<ul>
<li><code>CHAR</code>：长度固定或差异小（如手机号、身份证号、MD5）</li>
<li><code>VARCHAR</code>：长度差异大（如姓名、地址）</li>
</ul>
<h3 id="4-3-日期时间类型"><a href="#4-3-日期时间类型" class="headerlink" title="4.3 日期时间类型"></a>4.3 日期时间类型</h3><table>
<thead>
<tr>
<th>类型</th>
<th>格式</th>
<th>范围</th>
<th>字节</th>
</tr>
</thead>
<tbody><tr>
<td>DATE</td>
<td>YYYY-MM-DD</td>
<td>1000-01-01 ~ 9999-12-31</td>
<td>3</td>
</tr>
<tr>
<td>TIME</td>
<td>HH:MM:SS</td>
<td>-838:59:59 ~ 838:59:59</td>
<td>3</td>
</tr>
<tr>
<td>DATETIME</td>
<td>YYYY-MM-DD HH:MM:SS</td>
<td>1000-01-01 00:00:00 ~ 9999-12-31 23:59:59</td>
<td>8</td>
</tr>
<tr>
<td>TIMESTAMP</td>
<td>YYYY-MM-DD HH:MM:SS</td>
<td>1970-01-01 00:00:00 ~ 2038-01-19 03:14:07</td>
<td>4</td>
</tr>
<tr>
<td>YEAR</td>
<td>YYYY</td>
<td>1901 ~ 2155</td>
<td>1</td>
</tr>
</tbody></table>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 日期时间类型示例</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> date_test (</span><br><span class="line">    d <span class="type">DATE</span> COMMENT <span class="string">&#x27;日期&#x27;</span>,</span><br><span class="line">    t <span class="type">TIME</span> COMMENT <span class="string">&#x27;时间&#x27;</span>,</span><br><span class="line">    dt DATETIME COMMENT <span class="string">&#x27;日期时间&#x27;</span>,</span><br><span class="line">    ts <span class="type">TIMESTAMP</span> COMMENT <span class="string">&#x27;时间戳&#x27;</span>,</span><br><span class="line">    y <span class="keyword">YEAR</span> COMMENT <span class="string">&#x27;年份&#x27;</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 插入当前时间</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> date_test <span class="keyword">VALUES</span> (</span><br><span class="line">    CURDATE(),      <span class="comment">-- 当前日期</span></span><br><span class="line">    CURTIME(),      <span class="comment">-- 当前时间</span></span><br><span class="line">    NOW(),          <span class="comment">-- 当前日期时间</span></span><br><span class="line">    <span class="built_in">CURRENT_TIMESTAMP</span>,  <span class="comment">-- 当前时间戳</span></span><br><span class="line">    <span class="keyword">YEAR</span>(NOW())     <span class="comment">-- 当前年份</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p><strong>DATETIME vs TIMESTAMP</strong>：</p>
<table>
<thead>
<tr>
<th>对比项</th>
<th>DATETIME</th>
<th>TIMESTAMP</th>
</tr>
</thead>
<tbody><tr>
<td>时区</td>
<td>无关</td>
<td>与时区相关</td>
</tr>
<tr>
<td>范围</td>
<td>1000~9999 年</td>
<td>1970~2038 年</td>
</tr>
<tr>
<td>空间</td>
<td>8 字节</td>
<td>4 字节</td>
</tr>
<tr>
<td>自动更新</td>
<td>不支持</td>
<td>支持 <code>ON UPDATE CURRENT_TIMESTAMP</code></td>
</tr>
</tbody></table>
<h3 id="4-4-数据类型选择建议"><a href="#4-4-数据类型选择建议" class="headerlink" title="4.4 数据类型选择建议"></a>4.4 数据类型选择建议</h3><ol>
<li><strong>整数优先于浮点数</strong>：能用整数就不用浮点数</li>
<li><strong>金额用 DECIMAL</strong>：避免精度损失</li>
<li><strong>字符串根据长度选择</strong>：固定长度用 CHAR，可变用 VARCHAR</li>
<li><strong>日期时间根据需求</strong>：需要时区用 TIMESTAMP，否则用 DATETIME</li>
<li><strong>预留适当空间</strong>：但不要过度浪费</li>
</ol>
<h2 id="五、表操作-修改与删除"><a href="#五、表操作-修改与删除" class="headerlink" title="五、表操作 - 修改与删除"></a>五、表操作 - 修改与删除</h2><h3 id="5-1-修改表结构（ALTER-TABLE）"><a href="#5-1-修改表结构（ALTER-TABLE）" class="headerlink" title="5.1 修改表结构（ALTER TABLE）"></a>5.1 修改表结构（ALTER TABLE）</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 添加列</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> students <span class="keyword">ADD</span> <span class="keyword">COLUMN</span> address <span class="type">VARCHAR</span>(<span class="number">200</span>) COMMENT <span class="string">&#x27;地址&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 添加列到指定位置</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> students <span class="keyword">ADD</span> <span class="keyword">COLUMN</span> birthday <span class="type">DATE</span> COMMENT <span class="string">&#x27;生日&#x27;</span> AFTER age;</span><br><span class="line"><span class="keyword">ALTER TABLE</span> students <span class="keyword">ADD</span> <span class="keyword">COLUMN</span> remark <span class="type">VARCHAR</span>(<span class="number">500</span>) COMMENT <span class="string">&#x27;备注&#x27;</span> <span class="keyword">LAST</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 修改列类型</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> students MODIFY <span class="keyword">COLUMN</span> age TINYINT COMMENT <span class="string">&#x27;年龄&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 修改列名和类型</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> students CHANGE <span class="keyword">COLUMN</span> remark comments TEXT COMMENT <span class="string">&#x27;备注&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 删除列</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> students <span class="keyword">DROP</span> <span class="keyword">COLUMN</span> address;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 添加约束</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> students <span class="keyword">ADD</span> <span class="keyword">UNIQUE</span> (email);</span><br><span class="line"><span class="keyword">ALTER TABLE</span> students <span class="keyword">ADD</span> INDEX idx_name (name);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 删除约束</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> students <span class="keyword">DROP</span> INDEX email;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 修改表名</span></span><br><span class="line">RENAME <span class="keyword">TABLE</span> students <span class="keyword">TO</span> student_info;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 修改表选项</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> student_info ENGINE<span class="operator">=</span>MyISAM;</span><br><span class="line"><span class="keyword">ALTER TABLE</span> student_info CHARSET<span class="operator">=</span>gbk;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 添加外键</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> employees</span><br><span class="line"><span class="keyword">ADD CONSTRAINT</span> fk_emp_dept</span><br><span class="line"><span class="keyword">FOREIGN KEY</span> (dept_id) <span class="keyword">REFERENCES</span> departments(id);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 删除外键</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> employees <span class="keyword">DROP</span> <span class="keyword">FOREIGN KEY</span> fk_emp_dept;</span><br></pre></td></tr></table></figure>

<h3 id="5-2-删除表"><a href="#5-2-删除表" class="headerlink" title="5.2 删除表"></a>5.2 删除表</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 删除表（如果存在）</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> students;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 删除多个表</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> students, departments;</span><br></pre></td></tr></table></figure>

<h3 id="5-3-清空表数据"><a href="#5-3-清空表数据" class="headerlink" title="5.3 清空表数据"></a>5.3 清空表数据</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- DELETE 方式（可回滚，可带 WHERE）</span></span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> students;</span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> students <span class="keyword">WHERE</span> age <span class="operator">&gt;</span> <span class="number">25</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- TRUNCATE 方式（不可回滚，清空全部）</span></span><br><span class="line"><span class="keyword">TRUNCATE</span> <span class="keyword">TABLE</span> students;</span><br></pre></td></tr></table></figure>

<p><strong>DELETE vs TRUNCATE</strong>：</p>
<table>
<thead>
<tr>
<th>对比项</th>
<th>DELETE</th>
<th>TRUNCATE</th>
</tr>
</thead>
<tbody><tr>
<td>类型</td>
<td>DML</td>
<td>DDL</td>
</tr>
<tr>
<td>WHERE 条件</td>
<td>支持</td>
<td>不支持</td>
</tr>
<tr>
<td>返回值</td>
<td>删除行数</td>
<td>无</td>
</tr>
<tr>
<td>自增重置</td>
<td>否</td>
<td>是</td>
</tr>
<tr>
<td>事务回滚</td>
<td>支持</td>
<td>不支持</td>
</tr>
<tr>
<td>速度</td>
<td>慢</td>
<td>快</td>
</tr>
<tr>
<td>触发器</td>
<td>触发</td>
<td>不触发</td>
</tr>
</tbody></table>
<h2 id="六、图形化工具-DataGrip"><a href="#六、图形化工具-DataGrip" class="headerlink" title="六、图形化工具 DataGrip"></a>六、图形化工具 DataGrip</h2><h3 id="6-1-DataGrip-简介"><a href="#6-1-DataGrip-简介" class="headerlink" title="6.1 DataGrip 简介"></a>6.1 DataGrip 简介</h3><p>DataGrip 是 JetBrains 出品的专业数据库管理工具，支持多种数据库：</p>
<ul>
<li>MySQL、PostgreSQL、Oracle</li>
<li>SQL Server、SQLite</li>
<li>Redis、MongoDB（部分支持）</li>
</ul>
<h3 id="6-2-DataGrip-安装"><a href="#6-2-DataGrip-安装" class="headerlink" title="6.2 DataGrip 安装"></a>6.2 DataGrip 安装</h3><ol>
<li>下载地址：<a href="https://www.jetbrains.com/datagrip/">https://www.jetbrains.com/datagrip/</a></li>
<li>选择操作系统版本下载</li>
<li>安装并启动（支持 30 天试用）</li>
<li>学生可使用教育许可免费使用</li>
</ol>
<h3 id="6-3-连接-MySQL-数据库"><a href="#6-3-连接-MySQL-数据库" class="headerlink" title="6.3 连接 MySQL 数据库"></a>6.3 连接 MySQL 数据库</h3><ol>
<li>点击 <strong>File → New → Data Source → MySQL</strong></li>
<li>填写连接信息：<ul>
<li>Host: <code>localhost</code></li>
<li>Port: <code>3306</code></li>
<li>User: <code>root</code></li>
<li>Password: 你的密码</li>
</ul>
</li>
<li>点击 <strong>Test Connection</strong> 测试</li>
<li>点击 <strong>OK</strong> 保存</li>
</ol>
<h3 id="6-4-DataGrip-主要功能"><a href="#6-4-DataGrip-主要功能" class="headerlink" title="6.4 DataGrip 主要功能"></a>6.4 DataGrip 主要功能</h3><h4 id="数据库浏览"><a href="#数据库浏览" class="headerlink" title="数据库浏览"></a>数据库浏览</h4><ul>
<li>左侧 Database 面板查看所有数据库、表、视图</li>
<li>双击表名查看数据</li>
<li>右键表名查看结构、索引、外键</li>
</ul>
<h4 id="SQL-编辑"><a href="#SQL-编辑" class="headerlink" title="SQL 编辑"></a>SQL 编辑</h4><ul>
<li>新建 SQL 文件：右键 → New → SQL File</li>
<li>智能代码补全（Ctrl+Space）</li>
<li>语法高亮和错误提示</li>
<li>格式化代码（Ctrl+Alt+L）</li>
</ul>
<h4 id="执行查询"><a href="#执行查询" class="headerlink" title="执行查询"></a>执行查询</h4><ul>
<li>执行 SQL：Ctrl+Enter 或点击绿色三角</li>
<li>查看执行计划：Ctrl+X</li>
<li>导出查询结果：右键 → Export Data</li>
</ul>
<h4 id="数据编辑"><a href="#数据编辑" class="headerlink" title="数据编辑"></a>数据编辑</h4><ul>
<li>直接在表格中增删改数据</li>
<li>点击 Commit 提交更改</li>
</ul>
<h4 id="版本控制"><a href="#版本控制" class="headerlink" title="版本控制"></a>版本控制</h4><ul>
<li>支持 Git 集成</li>
<li>SQL 文件可版本管理</li>
</ul>
<h3 id="6-5-DataGrip-实用技巧"><a href="#6-5-DataGrip-实用技巧" class="headerlink" title="6.5 DataGrip 实用技巧"></a>6.5 DataGrip 实用技巧</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">-- 常用快捷键</span><br><span class="line">Ctrl+Space      代码补全</span><br><span class="line">Ctrl+Enter      执行 SQL</span><br><span class="line">Alt+Enter       快速修复</span><br><span class="line">Ctrl+/          单行注释</span><br><span class="line">Ctrl+Shift+/    块注释</span><br><span class="line">Ctrl+Alt+L      格式化代码</span><br><span class="line">双击 Shift      搜索任意内容</span><br><span class="line">Ctrl+N          搜索表/视图</span><br></pre></td></tr></table></figure>

<h2 id="七、DDL-综合案例"><a href="#七、DDL-综合案例" class="headerlink" title="七、DDL 综合案例"></a>七、DDL 综合案例</h2><h3 id="7-1-电商数据库设计"><a href="#7-1-电商数据库设计" class="headerlink" title="7.1 电商数据库设计"></a>7.1 电商数据库设计</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 1. 创建数据库</span></span><br><span class="line"><span class="keyword">CREATE</span> DATABASE IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> ecommerce</span><br><span class="line"><span class="keyword">CHARACTER SET</span> utf8mb4</span><br><span class="line"><span class="keyword">COLLATE</span> utf8mb4_unicode_ci;</span><br><span class="line"></span><br><span class="line">USE ecommerce;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 2. 创建用户表</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> users (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT,</span><br><span class="line">    username <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">NOT NULL</span> <span class="keyword">UNIQUE</span> COMMENT <span class="string">&#x27;用户名&#x27;</span>,</span><br><span class="line">    password <span class="type">VARCHAR</span>(<span class="number">255</span>) <span class="keyword">NOT NULL</span> COMMENT <span class="string">&#x27;密码（加密存储）&#x27;</span>,</span><br><span class="line">    email <span class="type">VARCHAR</span>(<span class="number">100</span>) <span class="keyword">UNIQUE</span> COMMENT <span class="string">&#x27;邮箱&#x27;</span>,</span><br><span class="line">    phone <span class="type">VARCHAR</span>(<span class="number">20</span>) COMMENT <span class="string">&#x27;手机号&#x27;</span>,</span><br><span class="line">    avatar <span class="type">VARCHAR</span>(<span class="number">255</span>) COMMENT <span class="string">&#x27;头像 URL&#x27;</span>,</span><br><span class="line">    status TINYINT <span class="keyword">DEFAULT</span> <span class="number">1</span> COMMENT <span class="string">&#x27;状态：1 正常 0 禁用&#x27;</span>,</span><br><span class="line">    create_time DATETIME <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span>,</span><br><span class="line">    update_time DATETIME <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> <span class="keyword">ON</span> <span class="keyword">UPDATE</span> <span class="built_in">CURRENT_TIMESTAMP</span></span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4 COMMENT<span class="operator">=</span><span class="string">&#x27;用户表&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 3. 创建商品分类表</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> categories (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT,</span><br><span class="line">    name <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">NOT NULL</span> COMMENT <span class="string">&#x27;分类名称&#x27;</span>,</span><br><span class="line">    parent_id <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span> COMMENT <span class="string">&#x27;父分类 ID&#x27;</span>,</span><br><span class="line">    sort_order <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span> COMMENT <span class="string">&#x27;排序&#x27;</span>,</span><br><span class="line">    create_time DATETIME <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span>,</span><br><span class="line">    INDEX idx_parent (parent_id)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4 COMMENT<span class="operator">=</span><span class="string">&#x27;商品分类表&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 4. 创建商品表</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> products (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT,</span><br><span class="line">    name <span class="type">VARCHAR</span>(<span class="number">200</span>) <span class="keyword">NOT NULL</span> COMMENT <span class="string">&#x27;商品名称&#x27;</span>,</span><br><span class="line">    description TEXT COMMENT <span class="string">&#x27;商品描述&#x27;</span>,</span><br><span class="line">    category_id <span class="type">INT</span> COMMENT <span class="string">&#x27;分类 ID&#x27;</span>,</span><br><span class="line">    price <span class="type">DECIMAL</span>(<span class="number">10</span>, <span class="number">2</span>) <span class="keyword">NOT NULL</span> COMMENT <span class="string">&#x27;价格&#x27;</span>,</span><br><span class="line">    stock <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span> COMMENT <span class="string">&#x27;库存&#x27;</span>,</span><br><span class="line">    status TINYINT <span class="keyword">DEFAULT</span> <span class="number">1</span> COMMENT <span class="string">&#x27;状态：1 上架 0 下架&#x27;</span>,</span><br><span class="line">    main_image <span class="type">VARCHAR</span>(<span class="number">255</span>) COMMENT <span class="string">&#x27;主图&#x27;</span>,</span><br><span class="line">    create_time DATETIME <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span>,</span><br><span class="line">    update_time DATETIME <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> <span class="keyword">ON</span> <span class="keyword">UPDATE</span> <span class="built_in">CURRENT_TIMESTAMP</span>,</span><br><span class="line"></span><br><span class="line">    <span class="keyword">FOREIGN KEY</span> (category_id) <span class="keyword">REFERENCES</span> categories(id) <span class="keyword">ON</span> <span class="keyword">DELETE</span> <span class="keyword">SET</span> <span class="keyword">NULL</span>,</span><br><span class="line">    INDEX idx_category (category_id),</span><br><span class="line">    INDEX idx_status (status)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4 COMMENT<span class="operator">=</span><span class="string">&#x27;商品表&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 5. 创建订单表</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> orders (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT,</span><br><span class="line">    order_no <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">NOT NULL</span> <span class="keyword">UNIQUE</span> COMMENT <span class="string">&#x27;订单号&#x27;</span>,</span><br><span class="line">    user_id <span class="type">INT</span> <span class="keyword">NOT NULL</span> COMMENT <span class="string">&#x27;用户 ID&#x27;</span>,</span><br><span class="line">    total_amount <span class="type">DECIMAL</span>(<span class="number">10</span>, <span class="number">2</span>) <span class="keyword">NOT NULL</span> COMMENT <span class="string">&#x27;订单金额&#x27;</span>,</span><br><span class="line">    status TINYINT <span class="keyword">DEFAULT</span> <span class="number">0</span> COMMENT <span class="string">&#x27;状态：0 待支付 1 已支付 2 发货 3 完成 4 取消&#x27;</span>,</span><br><span class="line">    shipping_address TEXT COMMENT <span class="string">&#x27;收货地址&#x27;</span>,</span><br><span class="line">    create_time DATETIME <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span>,</span><br><span class="line">    update_time DATETIME <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> <span class="keyword">ON</span> <span class="keyword">UPDATE</span> <span class="built_in">CURRENT_TIMESTAMP</span>,</span><br><span class="line"></span><br><span class="line">    <span class="keyword">FOREIGN KEY</span> (user_id) <span class="keyword">REFERENCES</span> users(id),</span><br><span class="line">    INDEX idx_user (user_id),</span><br><span class="line">    INDEX idx_status (status)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4 COMMENT<span class="operator">=</span><span class="string">&#x27;订单表&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 6. 创建订单明细表</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> order_items (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT,</span><br><span class="line">    order_id <span class="type">INT</span> <span class="keyword">NOT NULL</span> COMMENT <span class="string">&#x27;订单 ID&#x27;</span>,</span><br><span class="line">    product_id <span class="type">INT</span> <span class="keyword">NOT NULL</span> COMMENT <span class="string">&#x27;商品 ID&#x27;</span>,</span><br><span class="line">    product_name <span class="type">VARCHAR</span>(<span class="number">200</span>) <span class="keyword">NOT NULL</span> COMMENT <span class="string">&#x27;商品名称（冗余）&#x27;</span>,</span><br><span class="line">    price <span class="type">DECIMAL</span>(<span class="number">10</span>, <span class="number">2</span>) <span class="keyword">NOT NULL</span> COMMENT <span class="string">&#x27;单价&#x27;</span>,</span><br><span class="line">    quantity <span class="type">INT</span> <span class="keyword">NOT NULL</span> <span class="keyword">DEFAULT</span> <span class="number">1</span> COMMENT <span class="string">&#x27;数量&#x27;</span>,</span><br><span class="line">    subtotal <span class="type">DECIMAL</span>(<span class="number">10</span>, <span class="number">2</span>) <span class="keyword">NOT NULL</span> COMMENT <span class="string">&#x27;小计&#x27;</span>,</span><br><span class="line"></span><br><span class="line">    <span class="keyword">FOREIGN KEY</span> (order_id) <span class="keyword">REFERENCES</span> orders(id) <span class="keyword">ON</span> <span class="keyword">DELETE</span> CASCADE,</span><br><span class="line">    <span class="keyword">FOREIGN KEY</span> (product_id) <span class="keyword">REFERENCES</span> products(id),</span><br><span class="line">    INDEX idx_order (order_id)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4 COMMENT<span class="operator">=</span><span class="string">&#x27;订单明细表&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h2 id="八、小结"><a href="#八、小结" class="headerlink" title="八、小结"></a>八、小结</h2><p>本文我们系统学习了 DDL 的各个方面：</p>
<h3 id="知识点回顾"><a href="#知识点回顾" class="headerlink" title="知识点回顾"></a>知识点回顾</h3><ol>
<li><p><strong>数据库操作</strong></p>
<ul>
<li>CREATE DATABASE &#x2F; DROP DATABASE &#x2F; ALTER DATABASE &#x2F; USE</li>
</ul>
</li>
<li><p><strong>表操作</strong></p>
<ul>
<li>CREATE TABLE &#x2F; ALTER TABLE &#x2F; DROP TABLE &#x2F; TRUNCATE &#x2F; RENAME</li>
</ul>
</li>
<li><p><strong>数据类型</strong></p>
<ul>
<li>数值类型：TINYINT、INT、BIGINT、DECIMAL、FLOAT、DOUBLE</li>
<li>字符串类型：CHAR、VARCHAR、TEXT、BLOB</li>
<li>日期时间类型：DATE、TIME、DATETIME、TIMESTAMP、YEAR</li>
</ul>
</li>
<li><p><strong>约束条件</strong></p>
<ul>
<li>PRIMARY KEY、AUTO_INCREMENT、NOT NULL、UNIQUE、DEFAULT、FOREIGN KEY</li>
</ul>
</li>
<li><p><strong>图形化工具</strong></p>
<ul>
<li>DataGrip 的安装、连接、主要功能和快捷键</li>
</ul>
</li>
</ol>
<h3 id="DDL-命令速查"><a href="#DDL-命令速查" class="headerlink" title="DDL 命令速查"></a>DDL 命令速查</h3><table>
<thead>
<tr>
<th>操作类型</th>
<th>命令</th>
</tr>
</thead>
<tbody><tr>
<td>数据库</td>
<td>CREATE DATABASE、DROP DATABASE、ALTER DATABASE、USE</td>
</tr>
<tr>
<td>表</td>
<td>CREATE TABLE、DROP TABLE、ALTER TABLE、RENAME TABLE、TRUNCATE TABLE</td>
</tr>
<tr>
<td>列</td>
<td>ADD COLUMN、MODIFY COLUMN、CHANGE COLUMN、DROP COLUMN</td>
</tr>
<tr>
<td>约束</td>
<td>ADD PRIMARY KEY、ADD UNIQUE、ADD FOREIGN KEY、DROP INDEX</td>
</tr>
</tbody></table>
<hr>
<p><strong>下一篇</strong>：[MySQL 基础教程（三）：DML 数据操作语言详解](&#x2F;2026&#x2F;02&#x2F;23&#x2F;MySQL 基础教程（三）DML 数据操作语言详解&#x2F;)</p>
<p><strong>上一篇</strong>：[MySQL 基础教程（一）：数据库基础与环境搭建](&#x2F;2026&#x2F;02&#x2F;23&#x2F;MySQL 基础教程（一）数据库基础与环境搭建&#x2F;)</p>
]]></content>
      <categories>
        <category>MySQL 基础教程</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
        <tag>DDL</tag>
        <tag>数据库操作</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQL 基础教程（四）DQL 数据查询语言详解（下）</title>
    <url>/2026/02/23/MySQL%20%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B%EF%BC%88%E5%9B%9B%EF%BC%89DQL%20%E6%95%B0%E6%8D%AE%E6%9F%A5%E8%AF%A2%E8%AF%AD%E8%A8%80%E8%AF%A6%E8%A7%A3%EF%BC%88%E4%B8%8B%EF%BC%89/</url>
    <content><![CDATA[<h1 id="MySQL-基础教程（四）DQL-数据查询语言详解（下）"><a href="#MySQL-基础教程（四）DQL-数据查询语言详解（下）" class="headerlink" title="MySQL 基础教程（四）DQL 数据查询语言详解（下）"></a>MySQL 基础教程（四）DQL 数据查询语言详解（下）</h1><p>承接上文，本文继续讲解 DQL 的排序查询、分页查询、综合案例以及 SQL 执行顺序。</p>
<h2 id="七、排序查询（ORDER-BY）"><a href="#七、排序查询（ORDER-BY）" class="headerlink" title="七、排序查询（ORDER BY）"></a>七、排序查询（ORDER BY）</h2><p>ORDER BY 用于对查询结果进行排序。</p>
<h3 id="7-1-基础排序"><a href="#7-1-基础排序" class="headerlink" title="7.1 基础排序"></a>7.1 基础排序</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 升序排序（ASC，默认）</span></span><br><span class="line"><span class="keyword">SELECT</span> name, salary <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> salary <span class="keyword">ASC</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 降序排序（DESC）</span></span><br><span class="line"><span class="keyword">SELECT</span> name, salary <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> salary <span class="keyword">DESC</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 按字符串排序</span></span><br><span class="line"><span class="keyword">SELECT</span> name <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> name <span class="keyword">ASC</span>;  <span class="comment">-- 按拼音排序</span></span><br></pre></td></tr></table></figure>

<h3 id="7-2-多列排序"><a href="#7-2-多列排序" class="headerlink" title="7.2 多列排序"></a>7.2 多列排序</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 先按部门排序，部门相同按工资降序</span></span><br><span class="line"><span class="keyword">SELECT</span> name, dept_id, salary</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> dept_id <span class="keyword">ASC</span>, salary <span class="keyword">DESC</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 先按在职状态排序，再按工资降序</span></span><br><span class="line"><span class="keyword">SELECT</span> name, status, salary</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> status <span class="keyword">DESC</span>, salary <span class="keyword">DESC</span>;</span><br></pre></td></tr></table></figure>

<h3 id="7-3-使用列别名排序"><a href="#7-3-使用列别名排序" class="headerlink" title="7.3 使用列别名排序"></a>7.3 使用列别名排序</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 使用别名排序</span></span><br><span class="line"><span class="keyword">SELECT</span> name, salary <span class="keyword">AS</span> monthly_salary</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> monthly_salary <span class="keyword">DESC</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 使用列位置排序（不推荐，易出错）</span></span><br><span class="line"><span class="keyword">SELECT</span> name, salary <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="number">2</span> <span class="keyword">DESC</span>;  <span class="comment">-- 2 表示第 2 列</span></span><br></pre></td></tr></table></figure>

<h3 id="7-4-使用表达式排序"><a href="#7-4-使用表达式排序" class="headerlink" title="7.4 使用表达式排序"></a>7.4 使用表达式排序</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 按年薪排序</span></span><br><span class="line"><span class="keyword">SELECT</span> name, salary, salary <span class="operator">*</span> <span class="number">12</span> <span class="keyword">AS</span> annual_salary</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> annual_salary <span class="keyword">DESC</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 按工龄排序（假设现在是 2026 年）</span></span><br><span class="line"><span class="keyword">SELECT</span> name, hire_date, <span class="number">2026</span> <span class="operator">-</span> <span class="keyword">YEAR</span>(hire_date) <span class="keyword">AS</span> work_years</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> work_years <span class="keyword">DESC</span>;</span><br></pre></td></tr></table></figure>

<h3 id="7-5-NULL-值排序"><a href="#7-5-NULL-值排序" class="headerlink" title="7.5 NULL 值排序"></a>7.5 NULL 值排序</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- NULL 值默认排在最前（升序）或最后（降序）</span></span><br><span class="line"><span class="keyword">SELECT</span> name, dept_id <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> dept_id <span class="keyword">ASC</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- MySQL 8.0.13+ 支持 NULLS FIRST/LAST</span></span><br><span class="line"><span class="keyword">SELECT</span> name, dept_id <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> dept_id <span class="keyword">ASC</span> <span class="keyword">NULLS LAST</span>;</span><br></pre></td></tr></table></figure>

<h3 id="7-6-自定义排序顺序"><a href="#7-6-自定义排序顺序" class="headerlink" title="7.6 自定义排序顺序"></a>7.6 自定义排序顺序</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 按指定顺序排序（FIELD 函数）</span></span><br><span class="line"><span class="keyword">SELECT</span> name, dept_id <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> FIELD(dept_id, <span class="number">2</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">4</span>);  <span class="comment">-- 按 2→1→3→4 的顺序</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 按特定顺序排序（CASE 表达式）</span></span><br><span class="line"><span class="keyword">SELECT</span> name, dept_id <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span></span><br><span class="line">    <span class="keyword">CASE</span> dept_id</span><br><span class="line">        <span class="keyword">WHEN</span> <span class="number">2</span> <span class="keyword">THEN</span> <span class="number">1</span></span><br><span class="line">        <span class="keyword">WHEN</span> <span class="number">1</span> <span class="keyword">THEN</span> <span class="number">2</span></span><br><span class="line">        <span class="keyword">WHEN</span> <span class="number">3</span> <span class="keyword">THEN</span> <span class="number">3</span></span><br><span class="line">        <span class="keyword">ELSE</span> <span class="number">4</span></span><br><span class="line">    <span class="keyword">END</span>;</span><br></pre></td></tr></table></figure>

<h2 id="八、分页查询（LIMIT）"><a href="#八、分页查询（LIMIT）" class="headerlink" title="八、分页查询（LIMIT）"></a>八、分页查询（LIMIT）</h2><p>LIMIT 用于限制返回的记录数，常用于分页场景。</p>
<h3 id="8-1-基础分页"><a href="#8-1-基础分页" class="headerlink" title="8.1 基础分页"></a>8.1 基础分页</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 返回前 5 条记录</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees LIMIT <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 从第 3 条开始，返回 5 条记录</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees LIMIT <span class="number">2</span>, <span class="number">5</span>;  <span class="comment">-- 从偏移量 2 开始（第 3 条）</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 等价写法：LIMIT offset, count</span></span><br><span class="line"><span class="comment">-- 偏移量从 0 开始</span></span><br></pre></td></tr></table></figure>

<h3 id="8-2-分页公式"><a href="#8-2-分页公式" class="headerlink" title="8.2 分页公式"></a>8.2 分页公式</h3><p>分页查询的通用公式：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">LIMIT (页码 <span class="operator">-</span> <span class="number">1</span>) <span class="operator">*</span> 每页条数，每页条数</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 第 1 页，每页 5 条</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees LIMIT <span class="number">0</span>, <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 第 2 页，每页 5 条</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees LIMIT <span class="number">5</span>, <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 第 3 页，每页 5 条</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees LIMIT <span class="number">10</span>, <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 第 n 页，每页 5 条</span></span><br><span class="line"><span class="comment">-- LIMIT (n-1)*5, 5</span></span><br></pre></td></tr></table></figure>

<h3 id="8-3-分页实战"><a href="#8-3-分页实战" class="headerlink" title="8.3 分页实战"></a>8.3 分页实战</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 按工资降序，分页显示员工</span></span><br><span class="line"><span class="comment">-- 第 1 页：工资最高的 5 人</span></span><br><span class="line"><span class="keyword">SELECT</span> name, salary <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> salary <span class="keyword">DESC</span></span><br><span class="line">LIMIT <span class="number">0</span>, <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 第 2 页：工资第 6-10 的人</span></span><br><span class="line"><span class="keyword">SELECT</span> name, salary <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> salary <span class="keyword">DESC</span></span><br><span class="line">LIMIT <span class="number">5</span>, <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 带条件的分页：查询技术部员工，分页显示</span></span><br><span class="line"><span class="keyword">SELECT</span> name, dept_id, salary <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> dept_id <span class="operator">=</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> salary <span class="keyword">DESC</span></span><br><span class="line">LIMIT <span class="number">0</span>, <span class="number">5</span>;</span><br></pre></td></tr></table></figure>

<h3 id="8-4-LIMIT-的另一种写法"><a href="#8-4-LIMIT-的另一种写法" class="headerlink" title="8.4 LIMIT 的另一种写法"></a>8.4 LIMIT 的另一种写法</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- LIMIT offset, count</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees LIMIT <span class="number">0</span>, <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 等价于 LIMIT count OFFSET offset</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees LIMIT <span class="number">5</span> <span class="keyword">OFFSET</span> <span class="number">0</span>;</span><br></pre></td></tr></table></figure>

<h3 id="8-5-大数据量分页优化"><a href="#8-5-大数据量分页优化" class="headerlink" title="8.5 大数据量分页优化"></a>8.5 大数据量分页优化</h3><p>当数据量很大时，传统的 <code>LIMIT 1000000, 10</code> 会很慢，因为 MySQL 需要扫描前 1000000 条记录。</p>
<p><strong>优化方案 1：延迟关联</strong></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 原始查询（慢）</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> id</span><br><span class="line">LIMIT <span class="number">1000000</span>, <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 优化后（快）</span></span><br><span class="line"><span class="keyword">SELECT</span> e.<span class="operator">*</span> <span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> id <span class="keyword">FROM</span> employees <span class="keyword">ORDER</span> <span class="keyword">BY</span> id LIMIT <span class="number">1000000</span>, <span class="number">10</span></span><br><span class="line">) tmp <span class="keyword">ON</span> e.id <span class="operator">=</span> tmp.id;</span><br></pre></td></tr></table></figure>

<p><strong>优化方案 2：利用覆盖索引</strong></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 如果只需查询 id 和 name</span></span><br><span class="line"><span class="keyword">SELECT</span> id, name <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> id <span class="operator">&gt;</span> <span class="number">1000000</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> id</span><br><span class="line">LIMIT <span class="number">10</span>;</span><br></pre></td></tr></table></figure>

<p><strong>优化方案 3：记录上次查询的最大 ID</strong></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 首次查询</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees <span class="keyword">ORDER</span> <span class="keyword">BY</span> id LIMIT <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 记录最后一条的 id = 10</span></span><br><span class="line"><span class="comment">-- 下次查询</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> id <span class="operator">&gt;</span> <span class="number">10</span> <span class="keyword">ORDER</span> <span class="keyword">BY</span> id LIMIT <span class="number">10</span>;</span><br></pre></td></tr></table></figure>

<h2 id="九、多表连接查询"><a href="#九、多表连接查询" class="headerlink" title="九、多表连接查询"></a>九、多表连接查询</h2><h3 id="9-1-内连接（INNER-JOIN）"><a href="#9-1-内连接（INNER-JOIN）" class="headerlink" title="9.1 内连接（INNER JOIN）"></a>9.1 内连接（INNER JOIN）</h3><p>内连接返回两个表中匹配的行。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 查询员工及其所属部门</span></span><br><span class="line"><span class="keyword">SELECT</span> e.name, e.salary, d.dept_name</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> departments d <span class="keyword">ON</span> e.dept_id <span class="operator">=</span> d.id;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 等价写法（INNER 可以省略）</span></span><br><span class="line"><span class="keyword">SELECT</span> e.name, d.dept_name</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">JOIN</span> departments d <span class="keyword">ON</span> e.dept_id <span class="operator">=</span> d.id;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 多表连接</span></span><br><span class="line"><span class="keyword">SELECT</span> e.name, d.dept_name, d.dept_location</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">JOIN</span> departments d <span class="keyword">ON</span> e.dept_id <span class="operator">=</span> d.id</span><br><span class="line"><span class="keyword">WHERE</span> e.salary <span class="operator">&gt;</span> <span class="number">8000</span>;</span><br></pre></td></tr></table></figure>

<h3 id="9-2-左连接（LEFT-JOIN）"><a href="#9-2-左连接（LEFT-JOIN）" class="headerlink" title="9.2 左连接（LEFT JOIN）"></a>9.2 左连接（LEFT JOIN）</h3><p>左连接返回左表的所有行，右表没有匹配的填充 NULL。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 查询所有部门及其员工（包括没有员工的部门）</span></span><br><span class="line"><span class="keyword">SELECT</span> d.dept_name, e.name, e.salary</span><br><span class="line"><span class="keyword">FROM</span> departments d</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> employees e <span class="keyword">ON</span> d.id <span class="operator">=</span> e.dept_id;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询没有员工的部门</span></span><br><span class="line"><span class="keyword">SELECT</span> d.dept_name</span><br><span class="line"><span class="keyword">FROM</span> departments d</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> employees e <span class="keyword">ON</span> d.id <span class="operator">=</span> e.dept_id</span><br><span class="line"><span class="keyword">WHERE</span> e.id <span class="keyword">IS</span> <span class="keyword">NULL</span>;</span><br></pre></td></tr></table></figure>

<h3 id="9-3-右连接（RIGHT-JOIN）"><a href="#9-3-右连接（RIGHT-JOIN）" class="headerlink" title="9.3 右连接（RIGHT JOIN）"></a>9.3 右连接（RIGHT JOIN）</h3><p>右连接返回右表的所有行，左表没有匹配的填充 NULL。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 查询所有员工及其部门（包括没有员工的部门）</span></span><br><span class="line"><span class="keyword">SELECT</span> e.name, d.dept_name</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">RIGHT</span> <span class="keyword">JOIN</span> departments d <span class="keyword">ON</span> e.dept_id <span class="operator">=</span> d.id;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 等价于</span></span><br><span class="line"><span class="keyword">SELECT</span> e.name, d.dept_name</span><br><span class="line"><span class="keyword">FROM</span> departments d</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> employees e <span class="keyword">ON</span> e.dept_id <span class="operator">=</span> d.id;</span><br></pre></td></tr></table></figure>

<h3 id="9-4-交叉连接（CROSS-JOIN）"><a href="#9-4-交叉连接（CROSS-JOIN）" class="headerlink" title="9.4 交叉连接（CROSS JOIN）"></a>9.4 交叉连接（CROSS JOIN）</h3><p>交叉连接返回两个表的笛卡尔积。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 交叉连接</span></span><br><span class="line"><span class="keyword">SELECT</span> e.name, d.dept_name</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">CROSS</span> <span class="keyword">JOIN</span> departments d;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 等价于（不写条件）</span></span><br><span class="line"><span class="keyword">SELECT</span> e.name, d.dept_name</span><br><span class="line"><span class="keyword">FROM</span> employees e, departments d;</span><br></pre></td></tr></table></figure>

<h3 id="9-5-自连接（SELF-JOIN）"><a href="#9-5-自连接（SELF-JOIN）" class="headerlink" title="9.5 自连接（SELF JOIN）"></a>9.5 自连接（SELF JOIN）</h3><p>表自己连接自己，常用于层级数据。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 创建带上级领导的员工表</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> employees_with_manager;</span><br><span class="line"><span class="keyword">CREATE TABLE</span> employees_with_manager (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span>,</span><br><span class="line">    name <span class="type">VARCHAR</span>(<span class="number">50</span>),</span><br><span class="line">    manager_id <span class="type">INT</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT INTO</span> employees_with_manager <span class="keyword">VALUES</span></span><br><span class="line">(<span class="number">1</span>, <span class="string">&#x27;张三&#x27;</span>, <span class="keyword">NULL</span>),</span><br><span class="line">(<span class="number">2</span>, <span class="string">&#x27;李四&#x27;</span>, <span class="number">1</span>),</span><br><span class="line">(<span class="number">3</span>, <span class="string">&#x27;王五&#x27;</span>, <span class="number">1</span>),</span><br><span class="line">(<span class="number">4</span>, <span class="string">&#x27;赵六&#x27;</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询员工及其上级领导</span></span><br><span class="line"><span class="keyword">SELECT</span> e.name <span class="keyword">AS</span> 员工，m.name <span class="keyword">AS</span> 上级领导</span><br><span class="line"><span class="keyword">FROM</span> employees_with_manager e</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> employees_with_manager m <span class="keyword">ON</span> e.manager_id <span class="operator">=</span> m.id;</span><br></pre></td></tr></table></figure>

<h2 id="十、子查询"><a href="#十、子查询" class="headerlink" title="十、子查询"></a>十、子查询</h2><p>子查询是嵌套在其他 SQL 语句中的查询。</p>
<h3 id="10-1-WHERE-子句中的子查询"><a href="#10-1-WHERE-子句中的子查询" class="headerlink" title="10.1 WHERE 子句中的子查询"></a>10.1 WHERE 子句中的子查询</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 查询工资高于平均工资的员工</span></span><br><span class="line"><span class="keyword">SELECT</span> name, salary <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> salary <span class="operator">&gt;</span> (<span class="keyword">SELECT</span> <span class="built_in">AVG</span>(salary) <span class="keyword">FROM</span> employees);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询工资最高的员工</span></span><br><span class="line"><span class="keyword">SELECT</span> name, salary <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> salary <span class="operator">=</span> (<span class="keyword">SELECT</span> <span class="built_in">MAX</span>(salary) <span class="keyword">FROM</span> employees);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询不在职的员工</span></span><br><span class="line"><span class="keyword">SELECT</span> name <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> id <span class="keyword">NOT</span> <span class="keyword">IN</span> (<span class="keyword">SELECT</span> id <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> status <span class="operator">=</span> <span class="number">1</span>);</span><br></pre></td></tr></table></figure>

<h3 id="10-2-FROM-子句中的子查询"><a href="#10-2-FROM-子句中的子查询" class="headerlink" title="10.2 FROM 子句中的子查询"></a>10.2 FROM 子句中的子查询</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 查询各部门平均工资及高于平均工资的员工</span></span><br><span class="line"><span class="keyword">SELECT</span> e.name, e.salary, d.avg_salary</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">JOIN</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> dept_id, <span class="built_in">AVG</span>(salary) <span class="keyword">AS</span> avg_salary</span><br><span class="line">    <span class="keyword">FROM</span> employees</span><br><span class="line">    <span class="keyword">GROUP</span> <span class="keyword">BY</span> dept_id</span><br><span class="line">) d <span class="keyword">ON</span> e.dept_id <span class="operator">=</span> d.dept_id</span><br><span class="line"><span class="keyword">WHERE</span> e.salary <span class="operator">&gt;</span> d.avg_salary;</span><br></pre></td></tr></table></figure>

<h3 id="10-3-SELECT-子句中的子查询"><a href="#10-3-SELECT-子句中的子查询" class="headerlink" title="10.3 SELECT 子句中的子查询"></a>10.3 SELECT 子句中的子查询</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 查询员工信息及公司平均工资</span></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    name,</span><br><span class="line">    salary,</span><br><span class="line">    (<span class="keyword">SELECT</span> <span class="built_in">AVG</span>(salary) <span class="keyword">FROM</span> employees) <span class="keyword">AS</span> 公司平均工资,</span><br><span class="line">    salary <span class="operator">-</span> (<span class="keyword">SELECT</span> <span class="built_in">AVG</span>(salary) <span class="keyword">FROM</span> employees) <span class="keyword">AS</span> 差异</span><br><span class="line"><span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>

<h3 id="10-4-EXISTS-子查询"><a href="#10-4-EXISTS-子查询" class="headerlink" title="10.4 EXISTS 子查询"></a>10.4 EXISTS 子查询</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 查询有员工的部门</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> departments d</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">EXISTS</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> <span class="number">1</span> <span class="keyword">FROM</span> employees e <span class="keyword">WHERE</span> e.dept_id <span class="operator">=</span> d.id</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 等价于</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> departments d</span><br><span class="line"><span class="keyword">WHERE</span> d.id <span class="keyword">IN</span> (<span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> dept_id <span class="keyword">FROM</span> employees);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询没有员工的部门</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> departments d</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> <span class="number">1</span> <span class="keyword">FROM</span> employees e <span class="keyword">WHERE</span> e.dept_id <span class="operator">=</span> d.id</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h2 id="十一、综合案例练习"><a href="#十一、综合案例练习" class="headerlink" title="十一、综合案例练习"></a>十一、综合案例练习</h2><h3 id="11-1-准备数据"><a href="#11-1-准备数据" class="headerlink" title="11.1 准备数据"></a>11.1 准备数据</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 学生表</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> students;</span><br><span class="line"><span class="keyword">CREATE TABLE</span> students (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT,</span><br><span class="line">    name <span class="type">VARCHAR</span>(<span class="number">50</span>),</span><br><span class="line">    gender ENUM(<span class="string">&#x27;男&#x27;</span>, <span class="string">&#x27;女&#x27;</span>),</span><br><span class="line">    class_id <span class="type">INT</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 课程表</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> courses;</span><br><span class="line"><span class="keyword">CREATE TABLE</span> courses (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT,</span><br><span class="line">    course_name <span class="type">VARCHAR</span>(<span class="number">50</span>),</span><br><span class="line">    credit <span class="type">INT</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 成绩表</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> scores;</span><br><span class="line"><span class="keyword">CREATE TABLE</span> scores (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT,</span><br><span class="line">    student_id <span class="type">INT</span>,</span><br><span class="line">    course_id <span class="type">INT</span>,</span><br><span class="line">    score <span class="type">DECIMAL</span>(<span class="number">5</span>, <span class="number">2</span>),</span><br><span class="line">    <span class="keyword">FOREIGN KEY</span> (student_id) <span class="keyword">REFERENCES</span> students(id),</span><br><span class="line">    <span class="keyword">FOREIGN KEY</span> (course_id) <span class="keyword">REFERENCES</span> courses(id)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 插入数据</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> students (name, gender, class_id) <span class="keyword">VALUES</span></span><br><span class="line">(<span class="string">&#x27;张三&#x27;</span>, <span class="string">&#x27;男&#x27;</span>, <span class="number">1</span>), (<span class="string">&#x27;李四&#x27;</span>, <span class="string">&#x27;女&#x27;</span>, <span class="number">1</span>), (<span class="string">&#x27;王五&#x27;</span>, <span class="string">&#x27;男&#x27;</span>, <span class="number">2</span>),</span><br><span class="line">(<span class="string">&#x27;赵六&#x27;</span>, <span class="string">&#x27;女&#x27;</span>, <span class="number">2</span>), (<span class="string">&#x27;孙七&#x27;</span>, <span class="string">&#x27;男&#x27;</span>, <span class="number">1</span>), (<span class="string">&#x27;周八&#x27;</span>, <span class="string">&#x27;女&#x27;</span>, <span class="number">3</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT INTO</span> courses (course_name, credit) <span class="keyword">VALUES</span></span><br><span class="line">(<span class="string">&#x27;MySQL 基础&#x27;</span>, <span class="number">3</span>), (<span class="string">&#x27;Java 编程&#x27;</span>, <span class="number">4</span>), (<span class="string">&#x27;数据结构&#x27;</span>, <span class="number">4</span>), (<span class="string">&#x27;操作系统&#x27;</span>, <span class="number">3</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT INTO</span> scores (student_id, course_id, score) <span class="keyword">VALUES</span></span><br><span class="line">(<span class="number">1</span>, <span class="number">1</span>, <span class="number">85</span>), (<span class="number">1</span>, <span class="number">2</span>, <span class="number">90</span>), (<span class="number">1</span>, <span class="number">3</span>, <span class="number">78</span>),</span><br><span class="line">(<span class="number">2</span>, <span class="number">1</span>, <span class="number">92</span>), (<span class="number">2</span>, <span class="number">2</span>, <span class="number">88</span>), (<span class="number">2</span>, <span class="number">4</span>, <span class="number">95</span>),</span><br><span class="line">(<span class="number">3</span>, <span class="number">1</span>, <span class="number">75</span>), (<span class="number">3</span>, <span class="number">3</span>, <span class="number">82</span>),</span><br><span class="line">(<span class="number">4</span>, <span class="number">2</span>, <span class="number">88</span>), (<span class="number">4</span>, <span class="number">4</span>, <span class="number">91</span>),</span><br><span class="line">(<span class="number">5</span>, <span class="number">1</span>, <span class="number">60</span>), (<span class="number">5</span>, <span class="number">2</span>, <span class="number">65</span>), (<span class="number">5</span>, <span class="number">3</span>, <span class="number">70</span>);</span><br></pre></td></tr></table></figure>

<h3 id="11-2-案例练习"><a href="#11-2-案例练习" class="headerlink" title="11.2 案例练习"></a>11.2 案例练习</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 练习 1：查询所有学生的姓名、性别、班级 ID</span></span><br><span class="line"><span class="keyword">SELECT</span> name, gender, class_id <span class="keyword">FROM</span> students;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 练习 2：查询女生名单</span></span><br><span class="line"><span class="keyword">SELECT</span> name <span class="keyword">FROM</span> students <span class="keyword">WHERE</span> gender <span class="operator">=</span> <span class="string">&#x27;女&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 练习 3：查询成绩大于 80 分的学生姓名和课程名</span></span><br><span class="line"><span class="keyword">SELECT</span> s.name, c.course_name, sc.score</span><br><span class="line"><span class="keyword">FROM</span> students s</span><br><span class="line"><span class="keyword">JOIN</span> scores sc <span class="keyword">ON</span> s.id <span class="operator">=</span> sc.student_id</span><br><span class="line"><span class="keyword">JOIN</span> courses c <span class="keyword">ON</span> sc.course_id <span class="operator">=</span> c.id</span><br><span class="line"><span class="keyword">WHERE</span> sc.score <span class="operator">&gt;</span> <span class="number">80</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 练习 4：查询每个学生的平均分</span></span><br><span class="line"><span class="keyword">SELECT</span> s.name, ROUND(<span class="built_in">AVG</span>(sc.score), <span class="number">2</span>) <span class="keyword">AS</span> 平均分</span><br><span class="line"><span class="keyword">FROM</span> students s</span><br><span class="line"><span class="keyword">JOIN</span> scores sc <span class="keyword">ON</span> s.id <span class="operator">=</span> sc.student_id</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> s.id, s.name;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 练习 5：查询平均分大于 80 的学生</span></span><br><span class="line"><span class="keyword">SELECT</span> s.name, ROUND(<span class="built_in">AVG</span>(sc.score), <span class="number">2</span>) <span class="keyword">AS</span> 平均分</span><br><span class="line"><span class="keyword">FROM</span> students s</span><br><span class="line"><span class="keyword">JOIN</span> scores sc <span class="keyword">ON</span> s.id <span class="operator">=</span> sc.student_id</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> s.id, s.name</span><br><span class="line"><span class="keyword">HAVING</span> <span class="built_in">AVG</span>(sc.score) <span class="operator">&gt;</span> <span class="number">80</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 练习 6：查询每门课程的平均分</span></span><br><span class="line"><span class="keyword">SELECT</span> c.course_name, ROUND(<span class="built_in">AVG</span>(sc.score), <span class="number">2</span>) <span class="keyword">AS</span> 平均分</span><br><span class="line"><span class="keyword">FROM</span> courses c</span><br><span class="line"><span class="keyword">JOIN</span> scores sc <span class="keyword">ON</span> c.id <span class="operator">=</span> sc.course_id</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> c.id, c.course_name;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 练习 7：查询成绩最高的学生姓名、课程名和分数</span></span><br><span class="line"><span class="keyword">SELECT</span> s.name, c.course_name, sc.score</span><br><span class="line"><span class="keyword">FROM</span> students s</span><br><span class="line"><span class="keyword">JOIN</span> scores sc <span class="keyword">ON</span> s.id <span class="operator">=</span> sc.student_id</span><br><span class="line"><span class="keyword">JOIN</span> courses c <span class="keyword">ON</span> sc.course_id <span class="operator">=</span> c.id</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> sc.score <span class="keyword">DESC</span></span><br><span class="line">LIMIT <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 练习 8：查询至少选修了 2 门课程的学生</span></span><br><span class="line"><span class="keyword">SELECT</span> s.name, <span class="built_in">COUNT</span>(sc.course_id) <span class="keyword">AS</span> 选课数</span><br><span class="line"><span class="keyword">FROM</span> students s</span><br><span class="line"><span class="keyword">JOIN</span> scores sc <span class="keyword">ON</span> s.id <span class="operator">=</span> sc.student_id</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> s.id, s.name</span><br><span class="line"><span class="keyword">HAVING</span> <span class="built_in">COUNT</span>(sc.course_id) <span class="operator">&gt;=</span> <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 练习 9：查询没有选课的学生</span></span><br><span class="line"><span class="keyword">SELECT</span> name <span class="keyword">FROM</span> students</span><br><span class="line"><span class="keyword">WHERE</span> id <span class="keyword">NOT</span> <span class="keyword">IN</span> (<span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> student_id <span class="keyword">FROM</span> scores);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 练习 10：查询每个班级的学生人数</span></span><br><span class="line"><span class="keyword">SELECT</span> class_id, <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">AS</span> 人数</span><br><span class="line"><span class="keyword">FROM</span> students</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> class_id;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 练习 11：查询班级平均成绩</span></span><br><span class="line"><span class="keyword">SELECT</span> s.class_id, ROUND(<span class="built_in">AVG</span>(sc.score), <span class="number">2</span>) <span class="keyword">AS</span> 班级平均分</span><br><span class="line"><span class="keyword">FROM</span> students s</span><br><span class="line"><span class="keyword">JOIN</span> scores sc <span class="keyword">ON</span> s.id <span class="operator">=</span> sc.student_id</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> s.class_id;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 练习 12：综合查询（分页）</span></span><br><span class="line"><span class="keyword">SELECT</span> s.name, c.course_name, sc.score</span><br><span class="line"><span class="keyword">FROM</span> students s</span><br><span class="line"><span class="keyword">JOIN</span> scores sc <span class="keyword">ON</span> s.id <span class="operator">=</span> sc.student_id</span><br><span class="line"><span class="keyword">JOIN</span> courses c <span class="keyword">ON</span> sc.course_id <span class="operator">=</span> c.id</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> sc.score <span class="keyword">DESC</span></span><br><span class="line">LIMIT <span class="number">0</span>, <span class="number">10</span>;</span><br></pre></td></tr></table></figure>

<h2 id="十二、DQL-执行顺序"><a href="#十二、DQL-执行顺序" class="headerlink" title="十二、DQL 执行顺序"></a>十二、DQL 执行顺序</h2><p>理解 SQL 的执行顺序对于编写高效查询至关重要。</p>
<h3 id="12-1-完整执行顺序"><a href="#12-1-完整执行顺序" class="headerlink" title="12.1 完整执行顺序"></a>12.1 完整执行顺序</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">FROM → JOIN → WHERE → GROUP BY → HAVING → SELECT → DISTINCT → ORDER BY → LIMIT</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">(1) FROM 表名</span><br><span class="line">(2) [JOIN 表名 ON 连接条件]</span><br><span class="line">(3) WHERE 条件</span><br><span class="line">(4) GROUP BY 分组列</span><br><span class="line">(5) HAVING 分组过滤</span><br><span class="line">(6) SELECT 列名</span><br><span class="line">(7) DISTINCT 去重</span><br><span class="line">(8) ORDER BY 排序</span><br><span class="line">(9) LIMIT 分页</span><br></pre></td></tr></table></figure>

<h3 id="12-2-执行顺序详解"><a href="#12-2-执行顺序详解" class="headerlink" title="12.2 执行顺序详解"></a>12.2 执行顺序详解</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 示例 SQL</span></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    d.dept_name,</span><br><span class="line">    <span class="built_in">COUNT</span>(e.id) <span class="keyword">AS</span> emp_count,</span><br><span class="line">    <span class="built_in">AVG</span>(e.salary) <span class="keyword">AS</span> avg_salary</span><br><span class="line"><span class="keyword">FROM</span> departments d</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> employees e <span class="keyword">ON</span> d.id <span class="operator">=</span> e.dept_id</span><br><span class="line"><span class="keyword">WHERE</span> e.status <span class="operator">=</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> d.id, d.dept_name</span><br><span class="line"><span class="keyword">HAVING</span> <span class="built_in">COUNT</span>(e.id) <span class="operator">&gt;</span> <span class="number">2</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> avg_salary <span class="keyword">DESC</span></span><br><span class="line">LIMIT <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 执行步骤：</span></span><br><span class="line"><span class="comment">-- 1. FROM departments: 读取部门表</span></span><br><span class="line"><span class="comment">-- 2. LEFT JOIN employees: 连接员工表</span></span><br><span class="line"><span class="comment">-- 3. WHERE e.status = 1: 过滤在职员工</span></span><br><span class="line"><span class="comment">-- 4. GROUP BY d.id, d.dept_name: 按部门分组</span></span><br><span class="line"><span class="comment">-- 5. HAVING COUNT(e.id) &gt; 2: 过滤人数大于 2 的部门</span></span><br><span class="line"><span class="comment">-- 6. SELECT: 计算 dept_name, emp_count, avg_salary</span></span><br><span class="line"><span class="comment">-- 7. ORDER BY avg_salary DESC: 按平均工资降序排序</span></span><br><span class="line"><span class="comment">-- 8. LIMIT 5: 只返回前 5 条</span></span><br></pre></td></tr></table></figure>

<h3 id="12-3-常见错误"><a href="#12-3-常见错误" class="headerlink" title="12.3 常见错误"></a>12.3 常见错误</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 错误 1：WHERE 中使用列别名</span></span><br><span class="line"><span class="keyword">SELECT</span> salary <span class="keyword">AS</span> monthly_salary <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> monthly_salary <span class="operator">&gt;</span> <span class="number">8000</span>;  <span class="comment">-- 错误！WHERE 在 SELECT 之前执行</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 正确写法</span></span><br><span class="line"><span class="keyword">SELECT</span> salary <span class="keyword">AS</span> monthly_salary <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> salary <span class="operator">&gt;</span> <span class="number">8000</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 错误 2：HAVING 中使用列位置</span></span><br><span class="line"><span class="keyword">SELECT</span> dept_id, <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> dept_id</span><br><span class="line"><span class="keyword">HAVING</span> <span class="number">2</span> <span class="operator">&gt;</span> <span class="number">2</span>;  <span class="comment">-- 某些数据库支持，但不推荐</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 正确写法</span></span><br><span class="line"><span class="keyword">SELECT</span> dept_id, <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">AS</span> cnt <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> dept_id</span><br><span class="line"><span class="keyword">HAVING</span> cnt <span class="operator">&gt;</span> <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 错误 3：WHERE 中使用聚合函数</span></span><br><span class="line"><span class="keyword">SELECT</span> dept_id <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="operator">&gt;</span> <span class="number">2</span>  <span class="comment">-- 错误！</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> dept_id;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 正确写法</span></span><br><span class="line"><span class="keyword">SELECT</span> dept_id <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> dept_id</span><br><span class="line"><span class="keyword">HAVING</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="operator">&gt;</span> <span class="number">2</span>;</span><br></pre></td></tr></table></figure>

<h3 id="12-4-性能优化建议"><a href="#12-4-性能优化建议" class="headerlink" title="12.4 性能优化建议"></a>12.4 性能优化建议</h3><p>基于执行顺序的优化：</p>
<ol>
<li><strong>WHERE 条件尽可能早地过滤数据</strong></li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 好：先过滤再连接</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">JOIN</span> departments d <span class="keyword">ON</span> e.dept_id <span class="operator">=</span> d.id</span><br><span class="line"><span class="keyword">WHERE</span> e.salary <span class="operator">&gt;</span> <span class="number">8000</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 差：连接后再过滤（某些情况下）</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> e.<span class="operator">*</span>, d.dept_name <span class="keyword">FROM</span> employees e</span><br><span class="line">    <span class="keyword">JOIN</span> departments d <span class="keyword">ON</span> e.dept_id <span class="operator">=</span> d.id</span><br><span class="line">) temp</span><br><span class="line"><span class="keyword">WHERE</span> salary <span class="operator">&gt;</span> <span class="number">8000</span>;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><strong>使用索引列进行连接和过滤</strong></li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 确保连接列和 WHERE 列有索引</span></span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_dept_id <span class="keyword">ON</span> employees(dept_id);</span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_salary <span class="keyword">ON</span> employees(salary);</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>**避免 SELECT ***</li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 只选择需要的列</span></span><br><span class="line"><span class="keyword">SELECT</span> name, salary <span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>

<h2 id="十三、小结（下）"><a href="#十三、小结（下）" class="headerlink" title="十三、小结（下）"></a>十三、小结（下）</h2><h3 id="知识点回顾"><a href="#知识点回顾" class="headerlink" title="知识点回顾"></a>知识点回顾</h3><ol>
<li><p><strong>排序查询（ORDER BY）</strong></p>
<ul>
<li>ASC&#x2F;DESC 升序降序</li>
<li>多列排序</li>
<li>自定义排序顺序</li>
</ul>
</li>
<li><p><strong>分页查询（LIMIT）</strong></p>
<ul>
<li>LIMIT offset, count</li>
<li>分页公式：(页码 -1) * 每页条数</li>
<li>大数据量分页优化</li>
</ul>
</li>
<li><p><strong>连接查询</strong></p>
<ul>
<li>INNER JOIN 内连接</li>
<li>LEFT JOIN 左连接</li>
<li>RIGHT JOIN 右连接</li>
<li>CROSS JOIN 交叉连接</li>
<li>自连接</li>
</ul>
</li>
<li><p><strong>子查询</strong></p>
<ul>
<li>WHERE 子查询</li>
<li>FROM 子查询</li>
<li>SELECT 子查询</li>
<li>EXISTS 子查询</li>
</ul>
</li>
<li><p><strong>执行顺序</strong></p>
<ul>
<li>FROM → JOIN → WHERE → GROUP BY → HAVING → SELECT → ORDER BY → LIMIT</li>
</ul>
</li>
</ol>
<h3 id="DQL-完整语法结构"><a href="#DQL-完整语法结构" class="headerlink" title="DQL 完整语法结构"></a>DQL 完整语法结构</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> [<span class="keyword">DISTINCT</span>] 列名 [<span class="keyword">AS</span> 别名], ...</span><br><span class="line"><span class="keyword">FROM</span> 表名 [<span class="keyword">AS</span> 别名]</span><br><span class="line">[<span class="keyword">INNER</span> <span class="operator">|</span> <span class="keyword">LEFT</span> <span class="operator">|</span> <span class="keyword">RIGHT</span> <span class="operator">|</span> <span class="keyword">FULL</span>] <span class="keyword">JOIN</span> 表名 <span class="keyword">ON</span> 连接条件</span><br><span class="line">[<span class="keyword">WHERE</span> 条件]</span><br><span class="line">[<span class="keyword">GROUP</span> <span class="keyword">BY</span> 分组列 [<span class="keyword">HAVING</span> 分组过滤条件]]</span><br><span class="line">[<span class="keyword">ORDER</span> <span class="keyword">BY</span> 排序列 [<span class="keyword">ASC</span> <span class="operator">|</span> <span class="keyword">DESC</span>]]</span><br><span class="line">[LIMIT [<span class="keyword">offset</span>,] count];</span><br></pre></td></tr></table></figure>

<hr>
<p><strong>下一篇</strong>：[MySQL 基础教程（五）：DCL 数据控制语言详解](&#x2F;2026&#x2F;02&#x2F;23&#x2F;MySQL 基础教程（五）DCL 数据控制语言详解&#x2F;)</p>
<p><strong>上一篇</strong>：[MySQL 基础教程（四）DQL 数据查询语言详解（上）](&#x2F;2026&#x2F;02&#x2F;23&#x2F;MySQL 基础教程（四）DQL 数据查询语言详解（上）&#x2F;)</p>
]]></content>
      <categories>
        <category>MySQL 基础教程</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
        <tag>DQL</tag>
        <tag>数据查询</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQL 基础教程（四）DQL 数据查询语言详解（上）</title>
    <url>/2026/02/23/MySQL%20%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B%EF%BC%88%E5%9B%9B%EF%BC%89DQL%20%E6%95%B0%E6%8D%AE%E6%9F%A5%E8%AF%A2%E8%AF%AD%E8%A8%80%E8%AF%A6%E8%A7%A3%EF%BC%88%E4%B8%8A%EF%BC%89/</url>
    <content><![CDATA[<h1 id="MySQL-基础教程（四）DQL-数据查询语言详解（上）"><a href="#MySQL-基础教程（四）DQL-数据查询语言详解（上）" class="headerlink" title="MySQL 基础教程（四）DQL 数据查询语言详解（上）"></a>MySQL 基础教程（四）DQL 数据查询语言详解（上）</h1><p>DQL（Data Query Language，数据查询语言）是 SQL 中使用频率最高的部分。本文将系统讲解 DQL 的各种查询技巧，由于内容较多，分为上下两部分。</p>
<p><strong>上半部分</strong>：基础查询、条件查询、聚合函数、分组查询<br><strong>下半部分</strong>：排序查询、分页查询、综合案例、执行顺序</p>
<h2 id="一、DQL-概述"><a href="#一、DQL-概述" class="headerlink" title="一、DQL 概述"></a>一、DQL 概述</h2><p>DQL 主要用于从数据库中查询数据，核心命令是 <code>SELECT</code>。</p>
<p>完整的 SELECT 语法结构：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> [<span class="keyword">DISTINCT</span>] 列名 <span class="number">1</span> [<span class="keyword">AS</span> 别名 <span class="number">1</span>], 列名 <span class="number">2</span> [<span class="keyword">AS</span> 别名 <span class="number">2</span>], ...</span><br><span class="line"><span class="keyword">FROM</span> 表名 <span class="number">1</span> [<span class="keyword">AS</span> 别名 <span class="number">1</span>]</span><br><span class="line">[<span class="keyword">INNER</span> <span class="operator">|</span> <span class="keyword">LEFT</span> <span class="operator">|</span> <span class="keyword">RIGHT</span> <span class="operator">|</span> <span class="keyword">FULL</span>] <span class="keyword">JOIN</span> 表名 <span class="number">2</span> <span class="keyword">ON</span> 连接条件</span><br><span class="line">[<span class="keyword">WHERE</span> 条件]</span><br><span class="line">[<span class="keyword">GROUP</span> <span class="keyword">BY</span> 分组列 [<span class="keyword">HAVING</span> 分组过滤]]</span><br><span class="line">[<span class="keyword">ORDER</span> <span class="keyword">BY</span> 排序列 [<span class="keyword">ASC</span> <span class="operator">|</span> <span class="keyword">DESC</span>]]</span><br><span class="line">[LIMIT 起始位置，返回条数];</span><br></pre></td></tr></table></figure>

<h2 id="二、基础查询"><a href="#二、基础查询" class="headerlink" title="二、基础查询"></a>二、基础查询</h2><h3 id="2-1-准备测试数据"><a href="#2-1-准备测试数据" class="headerlink" title="2.1 准备测试数据"></a>2.1 准备测试数据</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 创建数据库</span></span><br><span class="line"><span class="keyword">CREATE</span> DATABASE IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> sql_learning;</span><br><span class="line">USE sql_learning;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建员工表</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> employees;</span><br><span class="line"><span class="keyword">CREATE TABLE</span> employees (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;员工 ID&#x27;</span>,</span><br><span class="line">    emp_no <span class="type">VARCHAR</span>(<span class="number">20</span>) <span class="keyword">NOT NULL</span> <span class="keyword">UNIQUE</span> COMMENT <span class="string">&#x27;员工编号&#x27;</span>,</span><br><span class="line">    name <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">NOT NULL</span> COMMENT <span class="string">&#x27;姓名&#x27;</span>,</span><br><span class="line">    gender ENUM(<span class="string">&#x27;男&#x27;</span>, <span class="string">&#x27;女&#x27;</span>) <span class="keyword">DEFAULT</span> <span class="string">&#x27;男&#x27;</span> COMMENT <span class="string">&#x27;性别&#x27;</span>,</span><br><span class="line">    age TINYINT COMMENT <span class="string">&#x27;年龄&#x27;</span>,</span><br><span class="line">    dept_id <span class="type">INT</span> COMMENT <span class="string">&#x27;部门 ID&#x27;</span>,</span><br><span class="line">    salary <span class="type">DECIMAL</span>(<span class="number">10</span>, <span class="number">2</span>) COMMENT <span class="string">&#x27;工资&#x27;</span>,</span><br><span class="line">    hire_date <span class="type">DATE</span> COMMENT <span class="string">&#x27;入职日期&#x27;</span>,</span><br><span class="line">    status TINYINT <span class="keyword">DEFAULT</span> <span class="number">1</span> COMMENT <span class="string">&#x27;状态：1 在职 0 离职&#x27;</span></span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4 COMMENT<span class="operator">=</span><span class="string">&#x27;员工表&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建部门表</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> departments;</span><br><span class="line"><span class="keyword">CREATE TABLE</span> departments (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;部门 ID&#x27;</span>,</span><br><span class="line">    dept_name <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">NOT NULL</span> COMMENT <span class="string">&#x27;部门名称&#x27;</span>,</span><br><span class="line">    dept_location <span class="type">VARCHAR</span>(<span class="number">100</span>) COMMENT <span class="string">&#x27;部门位置&#x27;</span></span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4 COMMENT<span class="operator">=</span><span class="string">&#x27;部门表&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 插入部门数据</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> departments (dept_name, dept_location) <span class="keyword">VALUES</span></span><br><span class="line">(<span class="string">&#x27;技术部&#x27;</span>, <span class="string">&#x27;北京&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;市场部&#x27;</span>, <span class="string">&#x27;上海&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;财务部&#x27;</span>, <span class="string">&#x27;北京&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;人事部&#x27;</span>, <span class="string">&#x27;广州&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 插入员工数据</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> employees (emp_no, name, gender, age, dept_id, salary, hire_date, status) <span class="keyword">VALUES</span></span><br><span class="line">(<span class="string">&#x27;E001&#x27;</span>, <span class="string">&#x27;张三&#x27;</span>, <span class="string">&#x27;男&#x27;</span>, <span class="number">28</span>, <span class="number">1</span>, <span class="number">8000.00</span>, <span class="string">&#x27;2022-03-15&#x27;</span>, <span class="number">1</span>),</span><br><span class="line">(<span class="string">&#x27;E002&#x27;</span>, <span class="string">&#x27;李四&#x27;</span>, <span class="string">&#x27;女&#x27;</span>, <span class="number">32</span>, <span class="number">1</span>, <span class="number">9500.00</span>, <span class="string">&#x27;2021-06-01&#x27;</span>, <span class="number">1</span>),</span><br><span class="line">(<span class="string">&#x27;E003&#x27;</span>, <span class="string">&#x27;王五&#x27;</span>, <span class="string">&#x27;男&#x27;</span>, <span class="number">25</span>, <span class="number">1</span>, <span class="number">7000.00</span>, <span class="string">&#x27;2023-01-10&#x27;</span>, <span class="number">1</span>),</span><br><span class="line">(<span class="string">&#x27;E004&#x27;</span>, <span class="string">&#x27;赵六&#x27;</span>, <span class="string">&#x27;女&#x27;</span>, <span class="number">29</span>, <span class="number">2</span>, <span class="number">8500.00</span>, <span class="string">&#x27;2022-08-20&#x27;</span>, <span class="number">1</span>),</span><br><span class="line">(<span class="string">&#x27;E005&#x27;</span>, <span class="string">&#x27;孙七&#x27;</span>, <span class="string">&#x27;男&#x27;</span>, <span class="number">35</span>, <span class="number">2</span>, <span class="number">10000.00</span>, <span class="string">&#x27;2020-05-15&#x27;</span>, <span class="number">1</span>),</span><br><span class="line">(<span class="string">&#x27;E006&#x27;</span>, <span class="string">&#x27;周八&#x27;</span>, <span class="string">&#x27;女&#x27;</span>, <span class="number">27</span>, <span class="number">3</span>, <span class="number">7500.00</span>, <span class="string">&#x27;2022-11-01&#x27;</span>, <span class="number">1</span>),</span><br><span class="line">(<span class="string">&#x27;E007&#x27;</span>, <span class="string">&#x27;吴九&#x27;</span>, <span class="string">&#x27;男&#x27;</span>, <span class="number">31</span>, <span class="number">3</span>, <span class="number">9000.00</span>, <span class="string">&#x27;2021-09-10&#x27;</span>, <span class="number">1</span>),</span><br><span class="line">(<span class="string">&#x27;E008&#x27;</span>, <span class="string">&#x27;郑十&#x27;</span>, <span class="string">&#x27;女&#x27;</span>, <span class="number">24</span>, <span class="number">4</span>, <span class="number">6000.00</span>, <span class="string">&#x27;2023-06-01&#x27;</span>, <span class="number">1</span>),</span><br><span class="line">(<span class="string">&#x27;E009&#x27;</span>, <span class="string">&#x27;刘十一&#x27;</span>, <span class="string">&#x27;男&#x27;</span>, <span class="number">30</span>, <span class="number">1</span>, <span class="number">8800.00</span>, <span class="string">&#x27;2022-01-15&#x27;</span>, <span class="number">1</span>),</span><br><span class="line">(<span class="string">&#x27;E010&#x27;</span>, <span class="string">&#x27;陈十二&#x27;</span>, <span class="string">&#x27;女&#x27;</span>, <span class="number">26</span>, <span class="number">2</span>, <span class="number">7200.00</span>, <span class="string">&#x27;2023-03-20&#x27;</span>, <span class="number">0</span>);</span><br></pre></td></tr></table></figure>

<h3 id="2-2-查询所有列"><a href="#2-2-查询所有列" class="headerlink" title="2.2 查询所有列"></a>2.2 查询所有列</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 查询所有列（不推荐在生产环境使用 *）</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 推荐：明确指定需要的列</span></span><br><span class="line"><span class="keyword">SELECT</span> id, emp_no, name, salary <span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>

<h3 id="2-3-查询指定列"><a href="#2-3-查询指定列" class="headerlink" title="2.3 查询指定列"></a>2.3 查询指定列</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 查询部分列</span></span><br><span class="line"><span class="keyword">SELECT</span> name, salary, dept_id <span class="keyword">FROM</span> employees;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询单列</span></span><br><span class="line"><span class="keyword">SELECT</span> name <span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>

<h3 id="2-4-去除重复（DISTINCT）"><a href="#2-4-去除重复（DISTINCT）" class="headerlink" title="2.4 去除重复（DISTINCT）"></a>2.4 去除重复（DISTINCT）</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 查询有哪些部门（去重）</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> dept_id <span class="keyword">FROM</span> employees;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 多列去重（多列组合必须完全相同才算重复）</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> dept_id, gender <span class="keyword">FROM</span> employees;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- DISTINCT 必须放在所有列之前</span></span><br><span class="line"><span class="comment">-- 错误写法：SELECT dept_id, DISTINCT salary FROM employees;</span></span><br></pre></td></tr></table></figure>

<h3 id="2-5-列别名（AS）"><a href="#2-5-列别名（AS）" class="headerlink" title="2.5 列别名（AS）"></a>2.5 列别名（AS）</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 使用 AS 指定别名</span></span><br><span class="line"><span class="keyword">SELECT</span> name <span class="keyword">AS</span> 姓名，salary <span class="keyword">AS</span> 工资，hire_date <span class="keyword">AS</span> 入职日期</span><br><span class="line"><span class="keyword">FROM</span> employees;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- AS 可以省略</span></span><br><span class="line"><span class="keyword">SELECT</span> name 姓名，salary 工资 <span class="keyword">FROM</span> employees;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 别名可以包含空格（用引号包裹）</span></span><br><span class="line"><span class="keyword">SELECT</span> salary <span class="keyword">AS</span> <span class="string">&#x27;月工资 (元)&#x27;</span> <span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>

<h3 id="2-6-表别名"><a href="#2-6-表别名" class="headerlink" title="2.6 表别名"></a>2.6 表别名</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 给表指定别名</span></span><br><span class="line"><span class="keyword">SELECT</span> e.name, e.salary, d.dept_name</span><br><span class="line"><span class="keyword">FROM</span> employees <span class="keyword">AS</span> e</span><br><span class="line"><span class="keyword">JOIN</span> departments <span class="keyword">AS</span> d <span class="keyword">ON</span> e.dept_id <span class="operator">=</span> d.id;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- AS 可以省略</span></span><br><span class="line"><span class="keyword">SELECT</span> e.name, d.dept_name</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">JOIN</span> departments d <span class="keyword">ON</span> e.dept_id <span class="operator">=</span> d.id;</span><br></pre></td></tr></table></figure>

<h3 id="2-7-表达式查询"><a href="#2-7-表达式查询" class="headerlink" title="2.7 表达式查询"></a>2.7 表达式查询</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 算术表达式</span></span><br><span class="line"><span class="keyword">SELECT</span> name, salary, salary <span class="operator">*</span> <span class="number">12</span> <span class="keyword">AS</span> 年薪 <span class="keyword">FROM</span> employees;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 字符串拼接</span></span><br><span class="line"><span class="keyword">SELECT</span> CONCAT(name, <span class="string">&#x27; - &#x27;</span>, emp_no) <span class="keyword">AS</span> 员工信息 <span class="keyword">FROM</span> employees;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 函数计算</span></span><br><span class="line"><span class="keyword">SELECT</span> name, <span class="built_in">UPPER</span>(name) <span class="keyword">AS</span> 大写姓名，LENGTH(name) <span class="keyword">AS</span> 名字长度</span><br><span class="line"><span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>

<h3 id="2-8-NULL-值处理"><a href="#2-8-NULL-值处理" class="headerlink" title="2.8 NULL 值处理"></a>2.8 NULL 值处理</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- IFNULL 函数：如果为 NULL 则返回指定值</span></span><br><span class="line"><span class="keyword">SELECT</span> name, IFNULL(salary, <span class="number">0</span>) <span class="keyword">AS</span> 工资 <span class="keyword">FROM</span> employees;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- IF 函数：条件判断</span></span><br><span class="line"><span class="keyword">SELECT</span> name, salary, IF(salary <span class="operator">&gt;</span> <span class="number">8000</span>, <span class="string">&#x27;高薪&#x27;</span>, <span class="string">&#x27;普通&#x27;</span>) <span class="keyword">AS</span> 薪资水平</span><br><span class="line"><span class="keyword">FROM</span> employees;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- CASE 表达式</span></span><br><span class="line"><span class="keyword">SELECT</span> name, salary,</span><br><span class="line">    <span class="keyword">CASE</span></span><br><span class="line">        <span class="keyword">WHEN</span> salary <span class="operator">&gt;=</span> <span class="number">10000</span> <span class="keyword">THEN</span> <span class="string">&#x27;高收入&#x27;</span></span><br><span class="line">        <span class="keyword">WHEN</span> salary <span class="operator">&gt;=</span> <span class="number">8000</span> <span class="keyword">THEN</span> <span class="string">&#x27;中等收入&#x27;</span></span><br><span class="line">        <span class="keyword">ELSE</span> <span class="string">&#x27;低收入&#x27;</span></span><br><span class="line">    <span class="keyword">END</span> <span class="keyword">AS</span> 收入等级</span><br><span class="line"><span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>

<h2 id="三、条件查询（WHERE）"><a href="#三、条件查询（WHERE）" class="headerlink" title="三、条件查询（WHERE）"></a>三、条件查询（WHERE）</h2><p>WHERE 子句用于过滤记录，只返回满足条件的行。</p>
<h3 id="3-1-比较运算符"><a href="#3-1-比较运算符" class="headerlink" title="3.1 比较运算符"></a>3.1 比较运算符</h3><table>
<thead>
<tr>
<th>运算符</th>
<th>说明</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td>&#x3D;</td>
<td>等于</td>
<td><code>salary = 8000</code></td>
</tr>
<tr>
<td>!&#x3D; 或 &lt;&gt;</td>
<td>不等于</td>
<td><code>dept_id != 1</code></td>
</tr>
<tr>
<td>&gt;</td>
<td>大于</td>
<td><code>age &gt; 30</code></td>
</tr>
<tr>
<td>&lt;</td>
<td>小于</td>
<td><code>age &lt; 30</code></td>
</tr>
<tr>
<td>&gt;&#x3D;</td>
<td>大于等于</td>
<td><code>salary &gt;= 8000</code></td>
</tr>
<tr>
<td>&lt;&#x3D;</td>
<td>小于等于</td>
<td><code>salary &lt;= 10000</code></td>
</tr>
<tr>
<td>&lt;&#x3D;&gt;</td>
<td>安全等于（可比较 NULL）</td>
<td><code>dept_id &lt;=&gt; NULL</code></td>
</tr>
</tbody></table>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 等于</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> salary <span class="operator">=</span> <span class="number">8000</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 不等于</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> dept_id <span class="operator">!=</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 大于/小于</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> age <span class="operator">&gt;</span> <span class="number">30</span>;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> salary <span class="operator">&lt;</span> <span class="number">8000</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 大于等于/小于等于</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> salary <span class="operator">&gt;=</span> <span class="number">9000</span>;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> salary <span class="operator">&lt;=</span> <span class="number">7000</span>;</span><br></pre></td></tr></table></figure>

<h3 id="3-2-逻辑运算符"><a href="#3-2-逻辑运算符" class="headerlink" title="3.2 逻辑运算符"></a>3.2 逻辑运算符</h3><table>
<thead>
<tr>
<th>运算符</th>
<th>说明</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td>AND 或 &amp;&amp;</td>
<td>与</td>
<td><code>age &gt; 25 AND salary &gt; 8000</code></td>
</tr>
<tr>
<td>OR 或 ||</td>
<td>或</td>
<td><code>dept_id = 1 OR dept_id = 2</code></td>
</tr>
<tr>
<td>NOT 或 !</td>
<td>非</td>
<td><code>NOT gender = &#39;男&#39;</code></td>
</tr>
</tbody></table>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- AND：同时满足多个条件</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> dept_id <span class="operator">=</span> <span class="number">1</span> <span class="keyword">AND</span> salary <span class="operator">&gt;</span> <span class="number">8000</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- OR：满足任一条件</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> dept_id <span class="operator">=</span> <span class="number">1</span> <span class="keyword">OR</span> dept_id <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- NOT：取反</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">NOT</span> gender <span class="operator">=</span> <span class="string">&#x27;男&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 混合使用（注意优先级：NOT &gt; AND &gt; OR）</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> (dept_id <span class="operator">=</span> <span class="number">1</span> <span class="keyword">OR</span> dept_id <span class="operator">=</span> <span class="number">2</span>) <span class="keyword">AND</span> salary <span class="operator">&gt;</span> <span class="number">8000</span>;</span><br></pre></td></tr></table></figure>

<h3 id="3-3-范围查询"><a href="#3-3-范围查询" class="headerlink" title="3.3 范围查询"></a>3.3 范围查询</h3><h4 id="BETWEEN…AND"><a href="#BETWEEN…AND" class="headerlink" title="BETWEEN…AND"></a>BETWEEN…AND</h4><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 查询工资在 7000 到 9000 之间的员工（包含边界）</span></span><br><span class="line"><span class="keyword">SELECT</span> name, salary <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> salary <span class="keyword">BETWEEN</span> <span class="number">7000</span> <span class="keyword">AND</span> <span class="number">9000</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 等价于</span></span><br><span class="line"><span class="keyword">SELECT</span> name, salary <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> salary <span class="operator">&gt;=</span> <span class="number">7000</span> <span class="keyword">AND</span> salary <span class="operator">&lt;=</span> <span class="number">9000</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- NOT BETWEEN：不在范围内</span></span><br><span class="line"><span class="keyword">SELECT</span> name, salary <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> salary <span class="keyword">NOT</span> <span class="keyword">BETWEEN</span> <span class="number">7000</span> <span class="keyword">AND</span> <span class="number">9000</span>;</span><br></pre></td></tr></table></figure>

<h4 id="IN-NOT-IN"><a href="#IN-NOT-IN" class="headerlink" title="IN &#x2F; NOT IN"></a>IN &#x2F; NOT IN</h4><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 查询部门 ID 为 1、2、3 的员工</span></span><br><span class="line"><span class="keyword">SELECT</span> name, dept_id <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> dept_id <span class="keyword">IN</span> (<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 等价于</span></span><br><span class="line"><span class="keyword">SELECT</span> name, dept_id <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> dept_id <span class="operator">=</span> <span class="number">1</span> <span class="keyword">OR</span> dept_id <span class="operator">=</span> <span class="number">2</span> <span class="keyword">OR</span> dept_id <span class="operator">=</span> <span class="number">3</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- NOT IN：不在指定集合中</span></span><br><span class="line"><span class="keyword">SELECT</span> name, dept_id <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> dept_id <span class="keyword">NOT</span> <span class="keyword">IN</span> (<span class="number">1</span>, <span class="number">3</span>);</span><br></pre></td></tr></table></figure>

<h3 id="3-4-模糊查询（LIKE）"><a href="#3-4-模糊查询（LIKE）" class="headerlink" title="3.4 模糊查询（LIKE）"></a>3.4 模糊查询（LIKE）</h3><p>LIKE 用于字符串匹配，支持通配符：</p>
<ul>
<li><code>%</code>：匹配任意数量的字符（包括 0 个）</li>
<li><code>_</code>：匹配单个字符</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 以&#x27;张&#x27;开头的名字</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> name <span class="keyword">LIKE</span> <span class="string">&#x27;张%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 以&#x27;四&#x27;结尾的名字</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> name <span class="keyword">LIKE</span> <span class="string">&#x27;%四&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 包含&#x27;十&#x27;的名字</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> name <span class="keyword">LIKE</span> <span class="string">&#x27;%十%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 第二个字是&#x27;十&#x27;的名字（_匹配一个字符）</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> name <span class="keyword">LIKE</span> <span class="string">&#x27;_十%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 正好两个字的姓</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> name <span class="keyword">LIKE</span> <span class="string">&#x27;__&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 不以&#x27;张&#x27;开头的名字</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> name <span class="keyword">NOT</span> <span class="keyword">LIKE</span> <span class="string">&#x27;张%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 匹配特殊字符（使用转义）</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> name <span class="keyword">LIKE</span> <span class="string">&#x27;张\_%&#x27;</span>;  <span class="comment">-- 匹配&#x27;张_&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="3-5-NULL-值查询"><a href="#3-5-NULL-值查询" class="headerlink" title="3.5 NULL 值查询"></a>3.5 NULL 值查询</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 查询 dept_id 为 NULL 的员工</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> dept_id <span class="keyword">IS</span> <span class="keyword">NULL</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询 dept_id 不为 NULL 的员工</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> dept_id <span class="keyword">IS</span> <span class="keyword">NOT NULL</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 错误写法：不能用 = 判断 NULL</span></span><br><span class="line"><span class="comment">-- SELECT * FROM employees WHERE dept_id = NULL;  -- 不会返回任何结果</span></span><br></pre></td></tr></table></figure>

<h3 id="3-6-正则表达式（REGEXP）"><a href="#3-6-正则表达式（REGEXP）" class="headerlink" title="3.6 正则表达式（REGEXP）"></a>3.6 正则表达式（REGEXP）</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 以张或李开头</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> name REGEXP <span class="string">&#x27;^张 | ^李&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 包含数字</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> emp_no REGEXP <span class="string">&#x27;[0-9]&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 三个字的姓名</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> name REGEXP <span class="string">&#x27;^.&#123;3&#125;$&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h2 id="四、聚合函数"><a href="#四、聚合函数" class="headerlink" title="四、聚合函数"></a>四、聚合函数</h2><p>聚合函数对一组数据进行计算，返回单个值。</p>
<h3 id="4-1-常用聚合函数"><a href="#4-1-常用聚合函数" class="headerlink" title="4.1 常用聚合函数"></a>4.1 常用聚合函数</h3><table>
<thead>
<tr>
<th>函数</th>
<th>功能</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>COUNT()</td>
<td>计数</td>
<td>统计行数</td>
</tr>
<tr>
<td>SUM()</td>
<td>求和</td>
<td>计算总和</td>
</tr>
<tr>
<td>AVG()</td>
<td>平均值</td>
<td>计算平均数</td>
</tr>
<tr>
<td>MAX()</td>
<td>最大值</td>
<td>找出最大值</td>
</tr>
<tr>
<td>MIN()</td>
<td>最小值</td>
<td>找出最小值</td>
</tr>
</tbody></table>
<h3 id="4-2-COUNT-计数"><a href="#4-2-COUNT-计数" class="headerlink" title="4.2 COUNT 计数"></a>4.2 COUNT 计数</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 统计员工总数</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">FROM</span> employees;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 统计在职员工数</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> status <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- COUNT(列名) 忽略 NULL 值</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(salary) <span class="keyword">FROM</span> employees;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- COUNT(*) 包含 NULL 值</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">FROM</span> employees;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 统计不同部门数量</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="keyword">DISTINCT</span> dept_id) <span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>

<p><strong>COUNT(*) vs COUNT(列) vs COUNT(1)</strong>：</p>
<ul>
<li><code>COUNT(*)</code>：统计所有行（包括 NULL），推荐用于计数</li>
<li><code>COUNT(列)</code>：统计该列非 NULL 的行数</li>
<li><code>COUNT(1)</code>：效果同 COUNT(*)，但某些场景略慢</li>
</ul>
<h3 id="4-3-SUM-求和"><a href="#4-3-SUM-求和" class="headerlink" title="4.3 SUM 求和"></a>4.3 SUM 求和</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 计算工资总和</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">SUM</span>(salary) <span class="keyword">AS</span> 工资总额 <span class="keyword">FROM</span> employees;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 计算在职员工工资总和</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">SUM</span>(salary) <span class="keyword">AS</span> 在职员工工资总额</span><br><span class="line"><span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> status <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 计算各部门工资总和（配合 GROUP BY）</span></span><br><span class="line"><span class="keyword">SELECT</span> dept_id, <span class="built_in">SUM</span>(salary) <span class="keyword">AS</span> 部门工资总额</span><br><span class="line"><span class="keyword">FROM</span> employees <span class="keyword">GROUP</span> <span class="keyword">BY</span> dept_id;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- SUM 忽略 NULL 值</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">SUM</span>(salary) <span class="keyword">FROM</span> employees;  <span class="comment">-- NULL 值不参与计算</span></span><br></pre></td></tr></table></figure>

<h3 id="4-4-AVG-平均值"><a href="#4-4-AVG-平均值" class="headerlink" title="4.4 AVG 平均值"></a>4.4 AVG 平均值</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 计算平均工资</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">AVG</span>(salary) <span class="keyword">AS</span> 平均工资 <span class="keyword">FROM</span> employees;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 保留 2 位小数</span></span><br><span class="line"><span class="keyword">SELECT</span> ROUND(<span class="built_in">AVG</span>(salary), <span class="number">2</span>) <span class="keyword">AS</span> 平均工资 <span class="keyword">FROM</span> employees;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 计算在职员工平均工资</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">AVG</span>(salary) <span class="keyword">AS</span> 在职平均工资</span><br><span class="line"><span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> status <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- AVG 忽略 NULL 值</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">AVG</span>(salary) <span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>

<h3 id="4-5-MAX-MIN-最值"><a href="#4-5-MAX-MIN-最值" class="headerlink" title="4.5 MAX&#x2F;MIN 最值"></a>4.5 MAX&#x2F;MIN 最值</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 最高工资</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">MAX</span>(salary) <span class="keyword">AS</span> 最高工资 <span class="keyword">FROM</span> employees;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 最低工资</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">MIN</span>(salary) <span class="keyword">AS</span> 最低工资 <span class="keyword">FROM</span> employees;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 最大/最小年龄</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">MAX</span>(age) <span class="keyword">AS</span> 最大年龄，<span class="built_in">MIN</span>(age) <span class="keyword">AS</span> 最小年龄 <span class="keyword">FROM</span> employees;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 最早/最晚入职日期</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">MIN</span>(hire_date) <span class="keyword">AS</span> 最早入职，<span class="built_in">MAX</span>(hire_date) <span class="keyword">AS</span> 最晚入职</span><br><span class="line"><span class="keyword">FROM</span> employees;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 获取最高工资的员工信息（子查询）</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> salary <span class="operator">=</span> (<span class="keyword">SELECT</span> <span class="built_in">MAX</span>(salary) <span class="keyword">FROM</span> employees);</span><br></pre></td></tr></table></figure>

<h3 id="4-6-聚合函数组合使用"><a href="#4-6-聚合函数组合使用" class="headerlink" title="4.6 聚合函数组合使用"></a>4.6 聚合函数组合使用</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 同时查询多个聚合值</span></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">AS</span> 员工总数，</span><br><span class="line">    <span class="built_in">SUM</span>(salary) <span class="keyword">AS</span> 工资总额，</span><br><span class="line">    ROUND(<span class="built_in">AVG</span>(salary), <span class="number">2</span>) <span class="keyword">AS</span> 平均工资，</span><br><span class="line">    <span class="built_in">MAX</span>(salary) <span class="keyword">AS</span> 最高工资，</span><br><span class="line">    <span class="built_in">MIN</span>(salary) <span class="keyword">AS</span> 最低工资</span><br><span class="line"><span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>

<h2 id="五、分组查询（GROUP-BY）"><a href="#五、分组查询（GROUP-BY）" class="headerlink" title="五、分组查询（GROUP BY）"></a>五、分组查询（GROUP BY）</h2><p>GROUP BY 将数据按指定列分组，通常与聚合函数配合使用。</p>
<h3 id="5-1-基础分组"><a href="#5-1-基础分组" class="headerlink" title="5.1 基础分组"></a>5.1 基础分组</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 按部门分组，统计每组人数</span></span><br><span class="line"><span class="keyword">SELECT</span> dept_id, <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">AS</span> 人数</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> dept_id;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 按部门分组，统计工资总和</span></span><br><span class="line"><span class="keyword">SELECT</span> dept_id, <span class="built_in">SUM</span>(salary) <span class="keyword">AS</span> 工资总额</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> dept_id;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 按性别分组</span></span><br><span class="line"><span class="keyword">SELECT</span> gender, <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">AS</span> 人数，<span class="built_in">AVG</span>(salary) <span class="keyword">AS</span> 平均工资</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> gender;</span><br></pre></td></tr></table></figure>

<h3 id="5-2-多列分组"><a href="#5-2-多列分组" class="headerlink" title="5.2 多列分组"></a>5.2 多列分组</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 按部门和性别分组</span></span><br><span class="line"><span class="keyword">SELECT</span> dept_id, gender, <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">AS</span> 人数，<span class="built_in">AVG</span>(salary) <span class="keyword">AS</span> 平均工资</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> dept_id, gender</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> dept_id, gender;</span><br></pre></td></tr></table></figure>

<h3 id="5-3-分组与连接查询"><a href="#5-3-分组与连接查询" class="headerlink" title="5.3 分组与连接查询"></a>5.3 分组与连接查询</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 显示部门名称的分组统计</span></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    d.dept_name,</span><br><span class="line">    <span class="built_in">COUNT</span>(e.id) <span class="keyword">AS</span> 人数，</span><br><span class="line">    <span class="built_in">SUM</span>(e.salary) <span class="keyword">AS</span> 工资总额，</span><br><span class="line">    ROUND(<span class="built_in">AVG</span>(e.salary), <span class="number">2</span>) <span class="keyword">AS</span> 平均工资</span><br><span class="line"><span class="keyword">FROM</span> departments d</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> employees e <span class="keyword">ON</span> d.id <span class="operator">=</span> e.dept_id</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> d.id, d.dept_name;</span><br></pre></td></tr></table></figure>

<h3 id="5-4-HAVING-子句"><a href="#5-4-HAVING-子句" class="headerlink" title="5.4 HAVING 子句"></a>5.4 HAVING 子句</h3><p>HAVING 用于过滤分组后的结果，WHERE 过滤分组前的数据。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 查询人数大于 2 的部门</span></span><br><span class="line"><span class="keyword">SELECT</span> dept_id, <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">AS</span> 人数</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> dept_id</span><br><span class="line"><span class="keyword">HAVING</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="operator">&gt;</span> <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询平均工资大于 8000 的部门</span></span><br><span class="line"><span class="keyword">SELECT</span> dept_id, <span class="built_in">AVG</span>(salary) <span class="keyword">AS</span> 平均工资</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> dept_id</span><br><span class="line"><span class="keyword">HAVING</span> <span class="built_in">AVG</span>(salary) <span class="operator">&gt;</span> <span class="number">8000</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- WHERE 与 HAVING 的区别</span></span><br><span class="line"><span class="keyword">SELECT</span> dept_id, <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">AS</span> 人数</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> status <span class="operator">=</span> <span class="number">1</span>              <span class="comment">-- 过滤原始数据</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> dept_id</span><br><span class="line"><span class="keyword">HAVING</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="operator">&gt;</span> <span class="number">1</span>;          <span class="comment">-- 过滤分组结果</span></span><br></pre></td></tr></table></figure>

<p><strong>WHERE vs HAVING 对比</strong>：</p>
<table>
<thead>
<tr>
<th>对比项</th>
<th>WHERE</th>
<th>HAVING</th>
</tr>
</thead>
<tbody><tr>
<td>作用时机</td>
<td>分组前</td>
<td>分组后</td>
</tr>
<tr>
<td>可用位置</td>
<td>所有查询</td>
<td>GROUP BY 后</td>
</tr>
<tr>
<td>聚合函数</td>
<td>不支持</td>
<td>支持</td>
</tr>
<tr>
<td>执行顺序</td>
<td>先执行</td>
<td>后执行</td>
</tr>
</tbody></table>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 错误：WHERE 中不能使用聚合函数</span></span><br><span class="line"><span class="comment">-- SELECT dept_id FROM employees WHERE COUNT(*) &gt; 2 GROUP BY dept_id;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 正确：使用 HAVING</span></span><br><span class="line"><span class="keyword">SELECT</span> dept_id <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> dept_id</span><br><span class="line"><span class="keyword">HAVING</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="operator">&gt;</span> <span class="number">2</span>;</span><br></pre></td></tr></table></figure>

<h3 id="5-5-综合分组练习"><a href="#5-5-综合分组练习" class="headerlink" title="5.5 综合分组练习"></a>5.5 综合分组练习</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 练习 1：统计各部门在职员工的人数、平均工资</span></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    d.dept_name,</span><br><span class="line">    <span class="built_in">COUNT</span>(e.id) <span class="keyword">AS</span> 在职人数，</span><br><span class="line">    ROUND(<span class="built_in">AVG</span>(e.salary), <span class="number">2</span>) <span class="keyword">AS</span> 平均工资</span><br><span class="line"><span class="keyword">FROM</span> departments d</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> employees e <span class="keyword">ON</span> d.id <span class="operator">=</span> e.dept_id <span class="keyword">AND</span> e.status <span class="operator">=</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> d.id, d.dept_name;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 练习 2：统计各部门工资最高的员工</span></span><br><span class="line"><span class="keyword">SELECT</span> e.dept_id, e.name, e.salary</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> dept_id, <span class="built_in">MAX</span>(salary) <span class="keyword">AS</span> max_salary</span><br><span class="line">    <span class="keyword">FROM</span> employees</span><br><span class="line">    <span class="keyword">GROUP</span> <span class="keyword">BY</span> dept_id</span><br><span class="line">) m <span class="keyword">ON</span> e.dept_id <span class="operator">=</span> m.dept_id <span class="keyword">AND</span> e.salary <span class="operator">=</span> m.max_salary;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 练习 3：统计员工入职年份及人数</span></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    <span class="keyword">YEAR</span>(hire_date) <span class="keyword">AS</span> 入职年份，</span><br><span class="line">    <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">AS</span> 人数</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> <span class="keyword">YEAR</span>(hire_date)</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> 入职年份;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 练习 4：统计不同年龄段的员工数</span></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    <span class="keyword">CASE</span></span><br><span class="line">        <span class="keyword">WHEN</span> age <span class="operator">&lt;</span> <span class="number">25</span> <span class="keyword">THEN</span> <span class="string">&#x27;25 岁以下&#x27;</span></span><br><span class="line">        <span class="keyword">WHEN</span> age <span class="keyword">BETWEEN</span> <span class="number">25</span> <span class="keyword">AND</span> <span class="number">30</span> <span class="keyword">THEN</span> <span class="string">&#x27;25-30 岁&#x27;</span></span><br><span class="line">        <span class="keyword">WHEN</span> age <span class="keyword">BETWEEN</span> <span class="number">31</span> <span class="keyword">AND</span> <span class="number">35</span> <span class="keyword">THEN</span> <span class="string">&#x27;31-35 岁&#x27;</span></span><br><span class="line">        <span class="keyword">ELSE</span> <span class="string">&#x27;35 岁以上&#x27;</span></span><br><span class="line">    <span class="keyword">END</span> <span class="keyword">AS</span> 年龄段，</span><br><span class="line">    <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">AS</span> 人数</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> 年龄段</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> 年龄段;</span><br></pre></td></tr></table></figure>

<h2 id="六、小结（上）"><a href="#六、小结（上）" class="headerlink" title="六、小结（上）"></a>六、小结（上）</h2><p>本文上半部分讲解了：</p>
<ol>
<li><strong>基础查询</strong>：SELECT *、指定列、DISTINCT、别名、表达式</li>
<li><strong>条件查询</strong>：比较运算符、逻辑运算符、BETWEEN、IN、LIKE、NULL 判断</li>
<li><strong>聚合函数</strong>：COUNT、SUM、AVG、MAX、MIN</li>
<li><strong>分组查询</strong>：GROUP BY、HAVING</li>
</ol>
<p>下半部分将继续讲解：</p>
<ul>
<li>排序查询（ORDER BY）</li>
<li>分页查询（LIMIT）</li>
<li>综合案例练习</li>
<li>SQL 执行顺序</li>
</ul>
<hr>
<p><strong>下一篇</strong>：[MySQL 基础教程（四）DQL 数据查询语言详解（下）](&#x2F;2026&#x2F;02&#x2F;23&#x2F;MySQL 基础教程（四）DQL 数据查询语言详解（下）&#x2F;)</p>
<p><strong>上一篇</strong>：[MySQL 基础教程（三）：DML 数据操作语言详解](&#x2F;2026&#x2F;02&#x2F;23&#x2F;MySQL 基础教程（三）DML 数据操作语言详解&#x2F;)</p>
]]></content>
      <categories>
        <category>MySQL 基础教程</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
        <tag>DQL</tag>
        <tag>数据查询</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQL 进阶教程（一）常用函数详解</title>
    <url>/2026/02/23/MySQL%20%E8%BF%9B%E9%98%B6%E6%95%99%E7%A8%8B%EF%BC%88%E4%B8%80%EF%BC%89%E5%B8%B8%E7%94%A8%E5%87%BD%E6%95%B0%E8%AF%A6%E8%A7%A3/</url>
    <content><![CDATA[<h1 id="MySQL-进阶教程（一）常用函数详解"><a href="#MySQL-进阶教程（一）常用函数详解" class="headerlink" title="MySQL 进阶教程（一）常用函数详解"></a>MySQL 进阶教程（一）常用函数详解</h1><p>在基础教程中，我们学习了 SQL 的基本查询和操作。本文将系统讲解 MySQL 提供的常用内置函数，包括字符串函数、数值函数、日期函数和流程函数。</p>
<h2 id="一、函数概述"><a href="#一、函数概述" class="headerlink" title="一、函数概述"></a>一、函数概述</h2><p>MySQL 函数是对数据进行特定操作的预定义程序，可以简化 SQL 语句，提高开发效率。</p>
<p><strong>函数的分类</strong>：</p>
<ul>
<li><strong>字符串函数</strong>：处理字符串数据</li>
<li><strong>数值函数</strong>：处理数值数据</li>
<li><strong>日期时间函数</strong>：处理日期和时间</li>
<li><strong>流程函数</strong>：条件判断和流程控制</li>
<li><strong>聚合函数</strong>：对一组数据进行计算（已在 DQL 章节讲解）</li>
<li><strong>加密函数</strong>：数据加密和哈希</li>
<li><strong>其他函数</strong>：信息函数、加锁函数等</li>
</ul>
<h2 id="二、字符串函数"><a href="#二、字符串函数" class="headerlink" title="二、字符串函数"></a>二、字符串函数</h2><h3 id="2-1-字符串连接与长度"><a href="#2-1-字符串连接与长度" class="headerlink" title="2.1 字符串连接与长度"></a>2.1 字符串连接与长度</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- CONCAT(s1, s2, ...)：连接字符串</span></span><br><span class="line"><span class="keyword">SELECT</span> CONCAT(<span class="string">&#x27;Hello&#x27;</span>, <span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;World&#x27;</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- &#x27;Hello World&#x27;</span></span><br><span class="line"><span class="keyword">SELECT</span> CONCAT(<span class="string">&#x27;姓名：&#x27;</span>, name) <span class="keyword">FROM</span> employees;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- CONCAT_WS(separator, s1, s2, ...)：用分隔符连接</span></span><br><span class="line"><span class="keyword">SELECT</span> CONCAT_WS(<span class="string">&#x27;-&#x27;</span>, <span class="string">&#x27;2024&#x27;</span>, <span class="string">&#x27;02&#x27;</span>, <span class="string">&#x27;20&#x27;</span>) <span class="keyword">AS</span> <span class="type">date</span>;  <span class="comment">-- &#x27;2024-02-20&#x27;</span></span><br><span class="line"><span class="keyword">SELECT</span> CONCAT_WS(<span class="string">&#x27; &#x27;</span>, first_name, last_name) <span class="keyword">AS</span> full_name <span class="keyword">FROM</span> users;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- LENGTH(s)：返回字符串长度（字节）</span></span><br><span class="line"><span class="keyword">SELECT</span> LENGTH(<span class="string">&#x27;hello&#x27;</span>) <span class="keyword">AS</span> len;  <span class="comment">-- 5</span></span><br><span class="line"><span class="keyword">SELECT</span> LENGTH(<span class="string">&#x27;你好&#x27;</span>) <span class="keyword">AS</span> len;   <span class="comment">-- 6（UTF-8 中一个汉字 3 字节）</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- CHAR_LENGTH(s)：返回字符数</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">CHAR_LENGTH</span>(<span class="string">&#x27;hello&#x27;</span>) <span class="keyword">AS</span> len;  <span class="comment">-- 5</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">CHAR_LENGTH</span>(<span class="string">&#x27;你好&#x27;</span>) <span class="keyword">AS</span> len;    <span class="comment">-- 2</span></span><br></pre></td></tr></table></figure>

<h3 id="2-2-大小写转换"><a href="#2-2-大小写转换" class="headerlink" title="2.2 大小写转换"></a>2.2 大小写转换</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- UPPER(s) 或 UCASE(s)：转大写</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">UPPER</span>(<span class="string">&#x27;hello&#x27;</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- &#x27;HELLO&#x27;</span></span><br><span class="line"><span class="keyword">SELECT</span> name, <span class="built_in">UPPER</span>(name) <span class="keyword">AS</span> upper_name <span class="keyword">FROM</span> employees;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- LOWER(s) 或 LCASE(s)：转小写</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">LOWER</span>(<span class="string">&#x27;HELLO&#x27;</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- &#x27;hello&#x27;</span></span><br><span class="line"><span class="keyword">SELECT</span> email, <span class="built_in">LOWER</span>(email) <span class="keyword">AS</span> lower_email <span class="keyword">FROM</span> users;</span><br></pre></td></tr></table></figure>

<h3 id="2-3-字符串截取"><a href="#2-3-字符串截取" class="headerlink" title="2.3 字符串截取"></a>2.3 字符串截取</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- LEFT(s, n)：返回左边 n 个字符</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">LEFT</span>(<span class="string">&#x27;Hello World&#x27;</span>, <span class="number">5</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- &#x27;Hello&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- RIGHT(s, n)：返回右边 n 个字符</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">RIGHT</span>(<span class="string">&#x27;Hello World&#x27;</span>, <span class="number">5</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- &#x27;World&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- SUBSTRING(s, pos, len)：从位置 pos 开始截取 len 个字符</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">SUBSTRING</span>(<span class="string">&#x27;Hello World&#x27;</span>, <span class="number">1</span>, <span class="number">5</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- &#x27;Hello&#x27;</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">SUBSTRING</span>(<span class="string">&#x27;Hello World&#x27;</span>, <span class="number">7</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;     <span class="comment">-- &#x27;World&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- SUBSTRING(s, pos FROM len)：另一种语法</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">SUBSTRING</span>(<span class="string">&#x27;Hello World&#x27;</span> <span class="keyword">FROM</span> <span class="number">1</span> <span class="keyword">FOR</span> <span class="number">5</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- &#x27;Hello&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- MID(s, pos, len)：同 SUBSTRING</span></span><br><span class="line"><span class="keyword">SELECT</span> MID(<span class="string">&#x27;Hello World&#x27;</span>, <span class="number">7</span>, <span class="number">5</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- &#x27;World&#x27;</span></span><br></pre></td></tr></table></figure>

<p><strong>注意</strong>：MySQL 中字符串位置从 1 开始，不是从 0 开始！</p>
<h3 id="2-4-字符串查找与替换"><a href="#2-4-字符串查找与替换" class="headerlink" title="2.4 字符串查找与替换"></a>2.4 字符串查找与替换</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- INSTR(s, substr)：返回子串第一次出现的位置</span></span><br><span class="line"><span class="keyword">SELECT</span> INSTR(<span class="string">&#x27;Hello World&#x27;</span>, <span class="string">&#x27;o&#x27;</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- 5</span></span><br><span class="line"><span class="keyword">SELECT</span> INSTR(<span class="string">&#x27;Hello World&#x27;</span>, <span class="string">&#x27;xyz&#x27;</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- 0（未找到）</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- LOCATE(substr, s)：同 INSTR</span></span><br><span class="line"><span class="keyword">SELECT</span> LOCATE(<span class="string">&#x27;World&#x27;</span>, <span class="string">&#x27;Hello World&#x27;</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- 7</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- REPLACE(s, from_str, to_str)：替换字符串</span></span><br><span class="line"><span class="keyword">SELECT</span> REPLACE(<span class="string">&#x27;Hello World&#x27;</span>, <span class="string">&#x27;World&#x27;</span>, <span class="string">&#x27;MySQL&#x27;</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- &#x27;Hello MySQL&#x27;</span></span><br><span class="line"><span class="keyword">UPDATE</span> products <span class="keyword">SET</span> description <span class="operator">=</span> REPLACE(description, <span class="string">&#x27;旧版&#x27;</span>, <span class="string">&#x27;新版&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- INSERT(str, pos, len, newstr)：在指定位置插入/替换字符串</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">INSERT</span>(<span class="string">&#x27;Hello World&#x27;</span>, <span class="number">7</span>, <span class="number">5</span>, <span class="string">&#x27;MySQL&#x27;</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- &#x27;Hello MySQL&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="2-5-去除空格"><a href="#2-5-去除空格" class="headerlink" title="2.5 去除空格"></a>2.5 去除空格</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- TRIM(s)：去除两端空格</span></span><br><span class="line"><span class="keyword">SELECT</span> CONCAT(<span class="string">&#x27;[&#x27;</span>, <span class="built_in">TRIM</span>(<span class="string">&#x27;  hello  &#x27;</span>), <span class="string">&#x27;]&#x27;</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- &#x27;[hello]&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- LTRIM(s)：去除左边空格</span></span><br><span class="line"><span class="keyword">SELECT</span> CONCAT(<span class="string">&#x27;[&#x27;</span>, LTRIM(<span class="string">&#x27;  hello  &#x27;</span>), <span class="string">&#x27;]&#x27;</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- &#x27;[hello  ]&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- RTRIM(s)：去除右边空格</span></span><br><span class="line"><span class="keyword">SELECT</span> CONCAT(<span class="string">&#x27;[&#x27;</span>, RTRIM(<span class="string">&#x27;  hello  &#x27;</span>), <span class="string">&#x27;]&#x27;</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- &#x27;[  hello]&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 去除指定字符（MySQL 特有）</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">TRIM</span>(<span class="keyword">BOTH</span> <span class="string">&#x27;x&#x27;</span> <span class="keyword">FROM</span> <span class="string">&#x27;xxxhelloxxx&#x27;</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- &#x27;hello&#x27;</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">TRIM</span>(<span class="keyword">LEADING</span> <span class="string">&#x27;x&#x27;</span> <span class="keyword">FROM</span> <span class="string">&#x27;xxxhelloxxx&#x27;</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- &#x27;helloxxx&#x27;</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">TRIM</span>(<span class="keyword">TRAILING</span> <span class="string">&#x27;x&#x27;</span> <span class="keyword">FROM</span> <span class="string">&#x27;xxxhelloxxx&#x27;</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- &#x27;xxxhello&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="2-6-字符串填充"><a href="#2-6-字符串填充" class="headerlink" title="2.6 字符串填充"></a>2.6 字符串填充</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- LPAD(s, len, pad)：左填充</span></span><br><span class="line"><span class="keyword">SELECT</span> LPAD(<span class="string">&#x27;123&#x27;</span>, <span class="number">8</span>, <span class="string">&#x27;0&#x27;</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- &#x27;00000123&#x27;</span></span><br><span class="line"><span class="keyword">SELECT</span> LPAD(<span class="string">&#x27;123&#x27;</span>, <span class="number">2</span>, <span class="string">&#x27;0&#x27;</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- &#x27;12&#x27;（长度超过则截断）</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- RPAD(s, len, pad)：右填充</span></span><br><span class="line"><span class="keyword">SELECT</span> RPAD(<span class="string">&#x27;123&#x27;</span>, <span class="number">8</span>, <span class="string">&#x27;0&#x27;</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- &#x27;12300000&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- LPAD 实战：生成固定长度的编号</span></span><br><span class="line"><span class="keyword">SELECT</span> LPAD(id, <span class="number">6</span>, <span class="string">&#x27;0&#x27;</span>) <span class="keyword">AS</span> order_no <span class="keyword">FROM</span> orders;  <span class="comment">-- &#x27;000001&#x27;, &#x27;000002&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="2-7-字符串反转与重复"><a href="#2-7-字符串反转与重复" class="headerlink" title="2.7 字符串反转与重复"></a>2.7 字符串反转与重复</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- REVERSE(s)：反转字符串</span></span><br><span class="line"><span class="keyword">SELECT</span> REVERSE(<span class="string">&#x27;hello&#x27;</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- &#x27;olleh&#x27;</span></span><br><span class="line"><span class="keyword">SELECT</span> REVERSE(phone) <span class="keyword">AS</span> reversed_phone <span class="keyword">FROM</span> users;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- REPEAT(s, n)：重复字符串 n 次</span></span><br><span class="line"><span class="keyword">SELECT</span> REPEAT(<span class="string">&#x27;*&#x27;</span>, <span class="number">5</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- &#x27;*****&#x27;</span></span><br><span class="line"><span class="keyword">SELECT</span> REPEAT(<span class="string">&#x27;-&#x27;</span>, <span class="number">20</span>) <span class="keyword">AS</span> separator;  <span class="comment">-- &#x27;--------------------&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="2-8-字符串比较"><a href="#2-8-字符串比较" class="headerlink" title="2.8 字符串比较"></a>2.8 字符串比较</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- STRCMP(s1, s2)：比较字符串</span></span><br><span class="line"><span class="keyword">SELECT</span> STRCMP(<span class="string">&#x27;abc&#x27;</span>, <span class="string">&#x27;abc&#x27;</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- 0（相等）</span></span><br><span class="line"><span class="keyword">SELECT</span> STRCMP(<span class="string">&#x27;abc&#x27;</span>, <span class="string">&#x27;abd&#x27;</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- -1（s1 &lt; s2）</span></span><br><span class="line"><span class="keyword">SELECT</span> STRCMP(<span class="string">&#x27;abd&#x27;</span>, <span class="string">&#x27;abc&#x27;</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- 1（s1 &gt; s2）</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- FIELD(s, s1, s2, ...)：返回 s 在列表中的位置</span></span><br><span class="line"><span class="keyword">SELECT</span> FIELD(<span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;C&#x27;</span>, <span class="string">&#x27;D&#x27;</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- 2</span></span><br><span class="line"><span class="keyword">SELECT</span> FIELD(<span class="string">&#x27;X&#x27;</span>, <span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;C&#x27;</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- 0（未找到）</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- ELT(n, s1, s2, ...)：返回第 n 个位置的字符串</span></span><br><span class="line"><span class="keyword">SELECT</span> ELT(<span class="number">2</span>, <span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;C&#x27;</span>, <span class="string">&#x27;D&#x27;</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- &#x27;B&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="2-9-其他常用函数"><a href="#2-9-其他常用函数" class="headerlink" title="2.9 其他常用函数"></a>2.9 其他常用函数</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- SPACE(n)：返回 n 个空格</span></span><br><span class="line"><span class="keyword">SELECT</span> CONCAT(<span class="string">&#x27;[&#x27;</span>, SPACE(<span class="number">5</span>), <span class="string">&#x27;]&#x27;</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- &#x27;[     ]&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- ASCII(s)：返回最左边字符的 ASCII 码</span></span><br><span class="line"><span class="keyword">SELECT</span> ASCII(<span class="string">&#x27;A&#x27;</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- 65</span></span><br><span class="line"><span class="keyword">SELECT</span> ASCII(<span class="string">&#x27;你好&#x27;</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- 228（多字节字符返回第一个字节）</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- CHAR(n, n2, ...)：返回 ASCII 码对应的字符</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="type">CHAR</span>(<span class="number">65</span>, <span class="number">66</span>, <span class="number">67</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- &#x27;ABC&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- BIN(n)：十进制转二进制</span></span><br><span class="line"><span class="keyword">SELECT</span> BIN(<span class="number">10</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- &#x27;1010&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- HEX(n 或 s)：十进制转十六进制，或字符串转十六进制</span></span><br><span class="line"><span class="keyword">SELECT</span> HEX(<span class="number">255</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- &#x27;FF&#x27;</span></span><br><span class="line"><span class="keyword">SELECT</span> HEX(<span class="string">&#x27;abc&#x27;</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- &#x27;616263&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- UNHEX(s)：十六进制转字符串</span></span><br><span class="line"><span class="keyword">SELECT</span> UNHEX(<span class="string">&#x27;616263&#x27;</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- &#x27;abc&#x27;</span></span><br></pre></td></tr></table></figure>

<h2 id="三、数值函数"><a href="#三、数值函数" class="headerlink" title="三、数值函数"></a>三、数值函数</h2><h3 id="3-1-绝对值与符号"><a href="#3-1-绝对值与符号" class="headerlink" title="3.1 绝对值与符号"></a>3.1 绝对值与符号</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- ABS(n)：绝对值</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">ABS</span>(<span class="number">-10</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- 10</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">ABS</span>(<span class="number">10</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;   <span class="comment">-- 10</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- SIGN(n)：符号函数</span></span><br><span class="line"><span class="keyword">SELECT</span> SIGN(<span class="number">-10</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- -1</span></span><br><span class="line"><span class="keyword">SELECT</span> SIGN(<span class="number">0</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;    <span class="comment">-- 0</span></span><br><span class="line"><span class="keyword">SELECT</span> SIGN(<span class="number">10</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;   <span class="comment">-- 1</span></span><br></pre></td></tr></table></figure>

<h3 id="3-2-四舍五入与截断"><a href="#3-2-四舍五入与截断" class="headerlink" title="3.2 四舍五入与截断"></a>3.2 四舍五入与截断</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- ROUND(n, d)：四舍五入到 d 位小数</span></span><br><span class="line"><span class="keyword">SELECT</span> ROUND(<span class="number">3.14159</span>, <span class="number">2</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- 3.14</span></span><br><span class="line"><span class="keyword">SELECT</span> ROUND(<span class="number">3.145</span>, <span class="number">2</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;    <span class="comment">-- 3.15（四舍五入）</span></span><br><span class="line"><span class="keyword">SELECT</span> ROUND(<span class="number">1234.567</span>, <span class="number">-1</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- 1230（负数表示小数点左边）</span></span><br><span class="line"><span class="keyword">SELECT</span> ROUND(<span class="number">1234.567</span>, <span class="number">-2</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- 1200</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- TRUNCATE(n, d)：截断到 d 位小数</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">TRUNCATE</span>(<span class="number">3.14159</span>, <span class="number">2</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- 3.14</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">TRUNCATE</span>(<span class="number">3.149</span>, <span class="number">2</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;    <span class="comment">-- 3.14（直接截断，不四舍五入）</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">TRUNCATE</span>(<span class="number">1234.567</span>, <span class="number">-1</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- 1230</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- CEIL(n) 或 CEILING(n)：向上取整</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">CEIL</span>(<span class="number">3.14</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- 4</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">CEIL</span>(<span class="number">3.99</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- 4</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">CEIL</span>(<span class="number">-3.14</span>) <span class="keyword">AS</span> <span class="keyword">result</span>; <span class="comment">-- -3</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- FLOOR(n)：向下取整</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">FLOOR</span>(<span class="number">3.14</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- 3</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">FLOOR</span>(<span class="number">3.99</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- 3</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">FLOOR</span>(<span class="number">-3.14</span>) <span class="keyword">AS</span> <span class="keyword">result</span>; <span class="comment">-- -4</span></span><br></pre></td></tr></table></figure>

<h3 id="3-3-取模运算"><a href="#3-3-取模运算" class="headerlink" title="3.3 取模运算"></a>3.3 取模运算</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- MOD(n, m) 或 n % m：取模</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">MOD</span>(<span class="number">10</span>, <span class="number">3</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- 1</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="number">10</span> <span class="operator">%</span> <span class="number">3</span> <span class="keyword">AS</span> <span class="keyword">result</span>;      <span class="comment">-- 1</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">MOD</span>(<span class="number">-10</span>, <span class="number">3</span>) <span class="keyword">AS</span> <span class="keyword">result</span>; <span class="comment">-- -1</span></span><br></pre></td></tr></table></figure>

<h3 id="3-4-随机数"><a href="#3-4-随机数" class="headerlink" title="3.4 随机数"></a>3.4 随机数</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- RAND()：返回 0-1 之间的随机数</span></span><br><span class="line"><span class="keyword">SELECT</span> RAND() <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- 0.7234567890123456</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- RAND(n)：使用种子生成可重复的随机数</span></span><br><span class="line"><span class="keyword">SELECT</span> RAND(<span class="number">5</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- 每次使用相同种子得到相同结果</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 生成指定范围的随机整数</span></span><br><span class="line"><span class="comment">-- 公式：FLOOR(RAND() * (max - min + 1)) + min</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">FLOOR</span>(RAND() <span class="operator">*</span> <span class="number">10</span>) <span class="keyword">AS</span> random_0_9;       <span class="comment">-- 0-9</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">FLOOR</span>(RAND() <span class="operator">*</span> <span class="number">100</span>) <span class="operator">+</span> <span class="number">1</span> <span class="keyword">AS</span> random_1_100; <span class="comment">-- 1-100</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">FLOOR</span>(RAND() <span class="operator">*</span> <span class="number">6</span>) <span class="operator">+</span> <span class="number">1</span> <span class="keyword">AS</span> dice;           <span class="comment">-- 模拟骰子 1-6</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 随机排序（慎用，性能差）</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees <span class="keyword">ORDER</span> <span class="keyword">BY</span> RAND() LIMIT <span class="number">5</span>;  <span class="comment">-- 随机抽取 5 条</span></span><br></pre></td></tr></table></figure>

<h3 id="3-5-幂运算与开方"><a href="#3-5-幂运算与开方" class="headerlink" title="3.5 幂运算与开方"></a>3.5 幂运算与开方</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- POW(x, y) 或 POWER(x, y)：x 的 y 次幂</span></span><br><span class="line"><span class="keyword">SELECT</span> POW(<span class="number">2</span>, <span class="number">3</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;    <span class="comment">-- 8</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">POWER</span>(<span class="number">2</span>, <span class="number">3</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- 8</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- SQRT(n)：平方根</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">SQRT</span>(<span class="number">16</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- 4</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">SQRT</span>(<span class="number">2</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;   <span class="comment">-- 1.4142135623730951</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- EXP(n)：e 的 n 次幂</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">EXP</span>(<span class="number">1</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- 2.718281828459045</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- LN(n)：自然对数</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">LN</span>(<span class="number">2.718281828459045</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- 1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- LOG10(n)：以 10 为底的对数</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">LOG10</span>(<span class="number">100</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- 2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- LOG2(n)：以 2 为底的对数</span></span><br><span class="line"><span class="keyword">SELECT</span> LOG2(<span class="number">8</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- 3</span></span><br></pre></td></tr></table></figure>

<h3 id="3-6-角度与弧度"><a href="#3-6-角度与弧度" class="headerlink" title="3.6 角度与弧度"></a>3.6 角度与弧度</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- RADIANS(n)：角度转弧度</span></span><br><span class="line"><span class="keyword">SELECT</span> RADIANS(<span class="number">180</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- 3.141592653589793</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- DEGREES(n)：弧度转角度</span></span><br><span class="line"><span class="keyword">SELECT</span> DEGREES(<span class="number">3.141592653589793</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- 180</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- PI()：返回圆周率</span></span><br><span class="line"><span class="keyword">SELECT</span> PI() <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- 3.141592653589793</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- SIN(n)、COS(n)、TAN(n)：三角函数</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">SIN</span>(RADIANS(<span class="number">30</span>)) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- 0.5</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COS</span>(RADIANS(<span class="number">60</span>)) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- 0.5</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">TAN</span>(RADIANS(<span class="number">45</span>)) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- 1</span></span><br></pre></td></tr></table></figure>

<h3 id="3-7-其他数值函数"><a href="#3-7-其他数值函数" class="headerlink" title="3.7 其他数值函数"></a>3.7 其他数值函数</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- CRC32(s)：计算循环冗余校验码</span></span><br><span class="line"><span class="keyword">SELECT</span> CRC32(<span class="string">&#x27;hello&#x27;</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- 907060870</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 实战：生成简短的哈希值</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">LOWER</span>(HEX(CRC32(<span class="string">&#x27;hello&#x27;</span>))) <span class="keyword">AS</span> short_hash;  <span class="comment">-- &#x27;0567e1b5&#x27;</span></span><br></pre></td></tr></table></figure>

<h2 id="四、日期时间函数"><a href="#四、日期时间函数" class="headerlink" title="四、日期时间函数"></a>四、日期时间函数</h2><h3 id="4-1-获取当前日期时间"><a href="#4-1-获取当前日期时间" class="headerlink" title="4.1 获取当前日期时间"></a>4.1 获取当前日期时间</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- NOW()：当前日期和时间</span></span><br><span class="line"><span class="keyword">SELECT</span> NOW() <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- &#x27;2024-02-20 15:30:45&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- CURRENT_TIMESTAMP：同 NOW()</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">CURRENT_TIMESTAMP</span>() <span class="keyword">AS</span> <span class="keyword">result</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- SYSDATE()：函数执行时的时间（与 NOW 略有不同）</span></span><br><span class="line"><span class="keyword">SELECT</span> SYSDATE() <span class="keyword">AS</span> <span class="keyword">result</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- CURDATE() 或 CURRENT_DATE：当前日期</span></span><br><span class="line"><span class="keyword">SELECT</span> CURDATE() <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- &#x27;2024-02-20&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- CURTIME() 或 CURRENT_TIME：当前时间</span></span><br><span class="line"><span class="keyword">SELECT</span> CURTIME() <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- &#x27;15:30:45&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="4-2-日期时间提取"><a href="#4-2-日期时间提取" class="headerlink" title="4.2 日期时间提取"></a>4.2 日期时间提取</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- DATE(d)：提取日期部分</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="type">DATE</span>(NOW()) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- &#x27;2024-02-20&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- TIME(d)：提取时间部分</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="type">TIME</span>(NOW()) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- &#x27;15:30:45&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- YEAR(d)：年份</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">YEAR</span>(NOW()) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- 2024</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">YEAR</span>(hire_date) <span class="keyword">AS</span> hire_year <span class="keyword">FROM</span> employees;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- MONTH(d)：月份</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">MONTH</span>(NOW()) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- 2</span></span><br><span class="line"><span class="keyword">SELECT</span> MONTHNAME(NOW()) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- &#x27;February&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- DAY(d) 或 DAYOFMONTH(d)：日期（月中第几天）</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DAY</span>(NOW()) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- 20</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- DAYOFWEEK(d)：星期几（1=Sunday, 7=Saturday）</span></span><br><span class="line"><span class="keyword">SELECT</span> DAYOFWEEK(NOW()) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- 3（周二）</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- DAYOFYEAR(d)：一年中的第几天</span></span><br><span class="line"><span class="keyword">SELECT</span> DAYOFYEAR(NOW()) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- 51</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- WEEK(d)：一年中的第几周</span></span><br><span class="line"><span class="keyword">SELECT</span> WEEK(NOW()) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- 8</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- WEEKDAY(d)：工作日（0=Monday, 6=Sunday）</span></span><br><span class="line"><span class="keyword">SELECT</span> WEEKDAY(NOW()) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- 1（周二）</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- HOUR(t)、MINUTE(t)、SECOND(t)：时分秒</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">HOUR</span>(NOW()) <span class="keyword">AS</span> <span class="keyword">hour</span>, <span class="keyword">MINUTE</span>(NOW()) <span class="keyword">AS</span> <span class="keyword">minute</span>, <span class="keyword">SECOND</span>(NOW()) <span class="keyword">AS</span> <span class="keyword">second</span>;</span><br></pre></td></tr></table></figure>

<h3 id="4-3-日期时间格式化"><a href="#4-3-日期时间格式化" class="headerlink" title="4.3 日期时间格式化"></a>4.3 日期时间格式化</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- DATE_FORMAT(d, format)：格式化日期</span></span><br><span class="line"><span class="keyword">SELECT</span> DATE_FORMAT(NOW(), <span class="string">&#x27;%Y-%m-%d&#x27;</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- &#x27;2024-02-20&#x27;</span></span><br><span class="line"><span class="keyword">SELECT</span> DATE_FORMAT(NOW(), <span class="string">&#x27;%Y 年%m 月%d 日&#x27;</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- &#x27;2024 年 02 月 20 日&#x27;</span></span><br><span class="line"><span class="keyword">SELECT</span> DATE_FORMAT(NOW(), <span class="string">&#x27;%H:%i:%s&#x27;</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- &#x27;15:30:45&#x27;</span></span><br><span class="line"><span class="keyword">SELECT</span> DATE_FORMAT(NOW(), <span class="string">&#x27;%W, %M %d, %Y&#x27;</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- &#x27;Tuesday, February 20, 2024&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- TIME_FORMAT(t, format)：格式化时间</span></span><br><span class="line"><span class="keyword">SELECT</span> TIME_FORMAT(NOW(), <span class="string">&#x27;%H 时%i 分%s 秒&#x27;</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- &#x27;15 时 30 分 45 秒&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 常用格式符：</span></span><br><span class="line"><span class="comment">-- %Y：四位年份  | %y：两位年份</span></span><br><span class="line"><span class="comment">-- %m：月份 (01-12) | %c：月份 (1-12)</span></span><br><span class="line"><span class="comment">-- %d：日期 (01-31) | %e：日期 (1-31)</span></span><br><span class="line"><span class="comment">-- %H：小时 (00-23) | %h/%I：小时 (01-12)</span></span><br><span class="line"><span class="comment">-- %i：分钟 (00-59) | %s/%S：秒 (00-59)</span></span><br><span class="line"><span class="comment">-- %p：AM/PM | %W：星期名 | %a：星期缩写</span></span><br><span class="line"><span class="comment">-- %M：月份名 | %b：月份缩写</span></span><br></pre></td></tr></table></figure>

<h3 id="4-4-字符串转日期"><a href="#4-4-字符串转日期" class="headerlink" title="4.4 字符串转日期"></a>4.4 字符串转日期</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- STR_TO_DATE(s, format)：字符串转日期</span></span><br><span class="line"><span class="keyword">SELECT</span> STR_TO_DATE(<span class="string">&#x27;2024-02-20&#x27;</span>, <span class="string">&#x27;%Y-%m-%d&#x27;</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- &#x27;2024-02-20&#x27;</span></span><br><span class="line"><span class="keyword">SELECT</span> STR_TO_DATE(<span class="string">&#x27;02/20/2024&#x27;</span>, <span class="string">&#x27;%m/%d/%Y&#x27;</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- &#x27;2024-02-20&#x27;</span></span><br><span class="line"><span class="keyword">SELECT</span> STR_TO_DATE(<span class="string">&#x27;20240220&#x27;</span>, <span class="string">&#x27;%Y%m%d&#x27;</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- &#x27;2024-02-20&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="4-5-日期时间运算"><a href="#4-5-日期时间运算" class="headerlink" title="4.5 日期时间运算"></a>4.5 日期时间运算</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- DATE_ADD(d, INTERVAL expr unit)：日期增加</span></span><br><span class="line"><span class="keyword">SELECT</span> DATE_ADD(NOW(), <span class="type">INTERVAL</span> <span class="number">1</span> <span class="keyword">DAY</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- 明天</span></span><br><span class="line"><span class="keyword">SELECT</span> DATE_ADD(NOW(), <span class="type">INTERVAL</span> <span class="number">-1</span> <span class="keyword">DAY</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- 昨天</span></span><br><span class="line"><span class="keyword">SELECT</span> DATE_ADD(NOW(), <span class="type">INTERVAL</span> <span class="number">1</span> <span class="keyword">MONTH</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- 下个月</span></span><br><span class="line"><span class="keyword">SELECT</span> DATE_ADD(NOW(), <span class="type">INTERVAL</span> <span class="number">1</span> <span class="keyword">YEAR</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- 明年</span></span><br><span class="line"><span class="keyword">SELECT</span> DATE_ADD(NOW(), <span class="type">INTERVAL</span> <span class="number">1</span> <span class="keyword">HOUR</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- 1 小时后</span></span><br><span class="line"><span class="keyword">SELECT</span> DATE_ADD(NOW(), <span class="type">INTERVAL</span> <span class="number">30</span> <span class="keyword">MINUTE</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- 30 分钟后</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- DATE_SUB(d, INTERVAL expr unit)：日期减少</span></span><br><span class="line"><span class="keyword">SELECT</span> DATE_SUB(NOW(), <span class="type">INTERVAL</span> <span class="number">1</span> <span class="keyword">DAY</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- 昨天</span></span><br><span class="line"><span class="keyword">SELECT</span> DATE_SUB(CURDATE(), <span class="type">INTERVAL</span> <span class="number">1</span> <span class="keyword">MONTH</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- 上个月</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 使用 + 和 - 运算符（简化写法）</span></span><br><span class="line"><span class="keyword">SELECT</span> NOW() <span class="operator">+</span> <span class="type">INTERVAL</span> <span class="number">1</span> <span class="keyword">DAY</span> <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- 明天</span></span><br><span class="line"><span class="keyword">SELECT</span> NOW() <span class="operator">-</span> <span class="type">INTERVAL</span> <span class="number">1</span> <span class="keyword">HOUR</span> <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- 1 小时前</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- ADDDATE(d, n)：增加 n 天</span></span><br><span class="line"><span class="keyword">SELECT</span> ADDDATE(CURDATE(), <span class="number">7</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- 7 天后</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- SUBDATE(d, n)：减少 n 天</span></span><br><span class="line"><span class="keyword">SELECT</span> SUBDATE(CURDATE(), <span class="number">7</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- 7 天前</span></span><br></pre></td></tr></table></figure>

<h3 id="4-6-日期差值"><a href="#4-6-日期差值" class="headerlink" title="4.6 日期差值"></a>4.6 日期差值</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- DATEDIFF(d1, d2)：d1 - d2 的天数差</span></span><br><span class="line"><span class="keyword">SELECT</span> DATEDIFF(<span class="string">&#x27;2024-02-20&#x27;</span>, <span class="string">&#x27;2024-01-01&#x27;</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- 50</span></span><br><span class="line"><span class="keyword">SELECT</span> DATEDIFF(CURDATE(), hire_date) <span class="keyword">AS</span> work_days <span class="keyword">FROM</span> employees;  <span class="comment">-- 入职天数</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- TIMEDIFF(t1, t2)：时间差</span></span><br><span class="line"><span class="keyword">SELECT</span> TIMEDIFF(<span class="string">&#x27;15:30:00&#x27;</span>, <span class="string">&#x27;10:00:00&#x27;</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- &#x27;05:30:00&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- TIMESTAMPDIFF(unit, d1, d2)：指定单位的差值</span></span><br><span class="line"><span class="keyword">SELECT</span> TIMESTAMPDIFF(<span class="keyword">DAY</span>, <span class="string">&#x27;2024-01-01&#x27;</span>, <span class="string">&#x27;2024-02-20&#x27;</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- 50</span></span><br><span class="line"><span class="keyword">SELECT</span> TIMESTAMPDIFF(<span class="keyword">MONTH</span>, <span class="string">&#x27;2024-01-01&#x27;</span>, <span class="string">&#x27;2024-02-20&#x27;</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- 1</span></span><br><span class="line"><span class="keyword">SELECT</span> TIMESTAMPDIFF(<span class="keyword">YEAR</span>, <span class="string">&#x27;2020-01-01&#x27;</span>, <span class="string">&#x27;2024-02-20&#x27;</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- 4</span></span><br><span class="line"><span class="keyword">SELECT</span> TIMESTAMPDIFF(<span class="keyword">SECOND</span>, <span class="string">&#x27;10:00:00&#x27;</span>, <span class="string">&#x27;15:30:00&#x27;</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- 19800</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 计算年龄</span></span><br><span class="line"><span class="keyword">SELECT</span> name, TIMESTAMPDIFF(<span class="keyword">YEAR</span>, birth_date, CURDATE()) <span class="keyword">AS</span> age <span class="keyword">FROM</span> users;</span><br></pre></td></tr></table></figure>

<h3 id="4-7-日期边界函数"><a href="#4-7-日期边界函数" class="headerlink" title="4.7 日期边界函数"></a>4.7 日期边界函数</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- LAST_DAY(d)：返回当月最后一天</span></span><br><span class="line"><span class="keyword">SELECT</span> LAST_DAY(CURDATE()) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- &#x27;2024-02-29&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- DAYNAME(d)：星期几的英文名</span></span><br><span class="line"><span class="keyword">SELECT</span> DAYNAME(CURDATE()) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- &#x27;Tuesday&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- MAKEDATE(year, day)：根据年份和一年中的第几天创建日期</span></span><br><span class="line"><span class="keyword">SELECT</span> MAKEDATE(<span class="number">2024</span>, <span class="number">50</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- &#x27;2024-02-19&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- MAKETIME(hour, minute, second)：创建时间</span></span><br><span class="line"><span class="keyword">SELECT</span> MAKETIME(<span class="number">15</span>, <span class="number">30</span>, <span class="number">45</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- &#x27;15:30:45&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="4-8-日期函数实战案例"><a href="#4-8-日期函数实战案例" class="headerlink" title="4.8 日期函数实战案例"></a>4.8 日期函数实战案例</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 案例 1：查询本月入职的员工</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">MONTH</span>(hire_date) <span class="operator">=</span> <span class="keyword">MONTH</span>(CURDATE())</span><br><span class="line"><span class="keyword">AND</span> <span class="keyword">YEAR</span>(hire_date) <span class="operator">=</span> <span class="keyword">YEAR</span>(CURDATE());</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 案例 2：查询本周的数据</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> orders</span><br><span class="line"><span class="keyword">WHERE</span> YEARWEEK(order_date) <span class="operator">=</span> YEARWEEK(CURDATE());</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 案例 3：查询超过 30 天未登录的用户</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users</span><br><span class="line"><span class="keyword">WHERE</span> DATEDIFF(CURDATE(), last_login) <span class="operator">&gt;</span> <span class="number">30</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 案例 4：计算员工的工龄（年）</span></span><br><span class="line"><span class="keyword">SELECT</span> name, hire_date,</span><br><span class="line">       TIMESTAMPDIFF(<span class="keyword">YEAR</span>, hire_date, CURDATE()) <span class="keyword">AS</span> work_years</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> work_years <span class="keyword">DESC</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 案例 5：格式化显示订单时间</span></span><br><span class="line"><span class="keyword">SELECT</span> order_no,</span><br><span class="line">       DATE_FORMAT(create_time, <span class="string">&#x27;%Y-%m-%d %H:%i&#x27;</span>) <span class="keyword">AS</span> order_time,</span><br><span class="line">       DATE_FORMAT(create_time, <span class="string">&#x27;%W %M %d&#x27;</span>) <span class="keyword">AS</span> display_time</span><br><span class="line"><span class="keyword">FROM</span> orders;</span><br></pre></td></tr></table></figure>

<h2 id="五、流程函数"><a href="#五、流程函数" class="headerlink" title="五、流程函数"></a>五、流程函数</h2><h3 id="5-1-IF-函数"><a href="#5-1-IF-函数" class="headerlink" title="5.1 IF 函数"></a>5.1 IF 函数</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- IF(expr, v1, v2)：如果 expr 为真返回 v1，否则返回 v2</span></span><br><span class="line"><span class="keyword">SELECT</span> IF(<span class="number">1</span> <span class="operator">&gt;</span> <span class="number">2</span>, <span class="string">&#x27;对&#x27;</span>, <span class="string">&#x27;错&#x27;</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- &#x27;错&#x27;</span></span><br><span class="line"><span class="keyword">SELECT</span> IF(<span class="number">1</span> <span class="operator">&gt;</span> <span class="number">2</span>, <span class="string">&#x27;对&#x27;</span>, <span class="string">&#x27;错&#x27;</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- &#x27;错&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 实战：判断员工工资水平</span></span><br><span class="line"><span class="keyword">SELECT</span> name, salary,</span><br><span class="line">       IF(salary <span class="operator">&gt;</span> <span class="number">10000</span>, <span class="string">&#x27;高薪&#x27;</span>, <span class="string">&#x27;普通&#x27;</span>) <span class="keyword">AS</span> salary_level</span><br><span class="line"><span class="keyword">FROM</span> employees;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 实战：判断是否成年</span></span><br><span class="line"><span class="keyword">SELECT</span> name, age, IF(age <span class="operator">&gt;=</span> <span class="number">18</span>, <span class="string">&#x27;成年&#x27;</span>, <span class="string">&#x27;未成年&#x27;</span>) <span class="keyword">AS</span> status <span class="keyword">FROM</span> users;</span><br></pre></td></tr></table></figure>

<h3 id="5-2-IFNULL-函数"><a href="#5-2-IFNULL-函数" class="headerlink" title="5.2 IFNULL 函数"></a>5.2 IFNULL 函数</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- IFNULL(v1, v2)：如果 v1 不为 NULL 返回 v1，否则返回 v2</span></span><br><span class="line"><span class="keyword">SELECT</span> IFNULL(<span class="keyword">NULL</span>, <span class="string">&#x27;默认值&#x27;</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- &#x27;默认值&#x27;</span></span><br><span class="line"><span class="keyword">SELECT</span> IFNULL(<span class="string">&#x27;有值&#x27;</span>, <span class="string">&#x27;默认值&#x27;</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- &#x27;有值&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 实战：处理 NULL 值</span></span><br><span class="line"><span class="keyword">SELECT</span> name, IFNULL(salary, <span class="number">0</span>) <span class="keyword">AS</span> salary <span class="keyword">FROM</span> employees;</span><br><span class="line"><span class="keyword">SELECT</span> name, IFNULL(phone, <span class="string">&#x27;未填写&#x27;</span>) <span class="keyword">AS</span> phone <span class="keyword">FROM</span> users;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 实战：计算平均工资（避免除以 NULL）</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">SUM</span>(salary) <span class="operator">/</span> IFNULL(<span class="built_in">COUNT</span>(<span class="built_in">NULLIF</span>(salary, <span class="keyword">NULL</span>)), <span class="number">1</span>) <span class="keyword">AS</span> avg_salary</span><br><span class="line"><span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>

<h3 id="5-3-NULLIF-函数"><a href="#5-3-NULLIF-函数" class="headerlink" title="5.3 NULLIF 函数"></a>5.3 NULLIF 函数</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- NULLIF(v1, v2)：如果 v1 = v2 返回 NULL，否则返回 v1</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">NULLIF</span>(<span class="number">10</span>, <span class="number">10</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- NULL</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">NULLIF</span>(<span class="number">10</span>, <span class="number">20</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- 10</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 实战：避免除以零</span></span><br><span class="line"><span class="keyword">SELECT</span> salary <span class="operator">/</span> <span class="built_in">NULLIF</span>(commission, <span class="number">0</span>) <span class="keyword">AS</span> ratio <span class="keyword">FROM</span> employees;</span><br><span class="line"><span class="comment">-- 如果 commission 为 0，返回 NULL 而不是报错</span></span><br></pre></td></tr></table></figure>

<h3 id="5-4-CASE-表达式"><a href="#5-4-CASE-表达式" class="headerlink" title="5.4 CASE 表达式"></a>5.4 CASE 表达式</h3><h4 id="简单-CASE"><a href="#简单-CASE" class="headerlink" title="简单 CASE"></a>简单 CASE</h4><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- CASE value WHEN v1 THEN r1 WHEN v2 THEN r2 ... ELSE rn END</span></span><br><span class="line"><span class="keyword">SELECT</span> name, dept_id,</span><br><span class="line">       <span class="keyword">CASE</span> dept_id</span><br><span class="line">           <span class="keyword">WHEN</span> <span class="number">1</span> <span class="keyword">THEN</span> <span class="string">&#x27;技术部&#x27;</span></span><br><span class="line">           <span class="keyword">WHEN</span> <span class="number">2</span> <span class="keyword">THEN</span> <span class="string">&#x27;市场部&#x27;</span></span><br><span class="line">           <span class="keyword">WHEN</span> <span class="number">3</span> <span class="keyword">THEN</span> <span class="string">&#x27;财务部&#x27;</span></span><br><span class="line">           <span class="keyword">WHEN</span> <span class="number">4</span> <span class="keyword">THEN</span> <span class="string">&#x27;人事部&#x27;</span></span><br><span class="line">           <span class="keyword">ELSE</span> <span class="string">&#x27;其他&#x27;</span></span><br><span class="line">       <span class="keyword">END</span> <span class="keyword">AS</span> dept_name</span><br><span class="line"><span class="keyword">FROM</span> employees;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 实战：将数字转为中文星期</span></span><br><span class="line"><span class="keyword">SELECT</span> DAYNAME(CURDATE()) <span class="keyword">AS</span> weekday,</span><br><span class="line">       <span class="keyword">CASE</span> DAYOFWEEK(CURDATE())</span><br><span class="line">           <span class="keyword">WHEN</span> <span class="number">1</span> <span class="keyword">THEN</span> <span class="string">&#x27;星期日&#x27;</span></span><br><span class="line">           <span class="keyword">WHEN</span> <span class="number">2</span> <span class="keyword">THEN</span> <span class="string">&#x27;星期一&#x27;</span></span><br><span class="line">           <span class="keyword">WHEN</span> <span class="number">3</span> <span class="keyword">THEN</span> <span class="string">&#x27;星期二&#x27;</span></span><br><span class="line">           <span class="keyword">WHEN</span> <span class="number">4</span> <span class="keyword">THEN</span> <span class="string">&#x27;星期三&#x27;</span></span><br><span class="line">           <span class="keyword">WHEN</span> <span class="number">5</span> <span class="keyword">THEN</span> <span class="string">&#x27;星期四&#x27;</span></span><br><span class="line">           <span class="keyword">WHEN</span> <span class="number">6</span> <span class="keyword">THEN</span> <span class="string">&#x27;星期五&#x27;</span></span><br><span class="line">           <span class="keyword">WHEN</span> <span class="number">7</span> <span class="keyword">THEN</span> <span class="string">&#x27;星期六&#x27;</span></span><br><span class="line">       <span class="keyword">END</span> <span class="keyword">AS</span> weekday_cn;</span><br></pre></td></tr></table></figure>

<h4 id="搜索-CASE"><a href="#搜索-CASE" class="headerlink" title="搜索 CASE"></a>搜索 CASE</h4><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- CASE WHEN condition1 THEN r1 WHEN condition2 THEN r2 ... ELSE rn END</span></span><br><span class="line"><span class="keyword">SELECT</span> name, salary,</span><br><span class="line">       <span class="keyword">CASE</span></span><br><span class="line">           <span class="keyword">WHEN</span> salary <span class="operator">&gt;=</span> <span class="number">15000</span> <span class="keyword">THEN</span> <span class="string">&#x27;高收入&#x27;</span></span><br><span class="line">           <span class="keyword">WHEN</span> salary <span class="operator">&gt;=</span> <span class="number">10000</span> <span class="keyword">THEN</span> <span class="string">&#x27;中高收入&#x27;</span></span><br><span class="line">           <span class="keyword">WHEN</span> salary <span class="operator">&gt;=</span> <span class="number">7000</span> <span class="keyword">THEN</span> <span class="string">&#x27;中等收入&#x27;</span></span><br><span class="line">           <span class="keyword">WHEN</span> salary <span class="operator">&gt;=</span> <span class="number">5000</span> <span class="keyword">THEN</span> <span class="string">&#x27;中低收入&#x27;</span></span><br><span class="line">           <span class="keyword">ELSE</span> <span class="string">&#x27;低收入&#x27;</span></span><br><span class="line">       <span class="keyword">END</span> <span class="keyword">AS</span> income_level</span><br><span class="line"><span class="keyword">FROM</span> employees;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 实战：根据成绩评定等级</span></span><br><span class="line"><span class="keyword">SELECT</span> student_name, score,</span><br><span class="line">       <span class="keyword">CASE</span></span><br><span class="line">           <span class="keyword">WHEN</span> score <span class="operator">&gt;=</span> <span class="number">90</span> <span class="keyword">THEN</span> <span class="string">&#x27;A&#x27;</span></span><br><span class="line">           <span class="keyword">WHEN</span> score <span class="operator">&gt;=</span> <span class="number">80</span> <span class="keyword">THEN</span> <span class="string">&#x27;B&#x27;</span></span><br><span class="line">           <span class="keyword">WHEN</span> score <span class="operator">&gt;=</span> <span class="number">70</span> <span class="keyword">THEN</span> <span class="string">&#x27;C&#x27;</span></span><br><span class="line">           <span class="keyword">WHEN</span> score <span class="operator">&gt;=</span> <span class="number">60</span> <span class="keyword">THEN</span> <span class="string">&#x27;D&#x27;</span></span><br><span class="line">           <span class="keyword">ELSE</span> <span class="string">&#x27;F&#x27;</span></span><br><span class="line">       <span class="keyword">END</span> <span class="keyword">AS</span> grade</span><br><span class="line"><span class="keyword">FROM</span> scores;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 实战：计算奖金</span></span><br><span class="line"><span class="keyword">SELECT</span> name, salary,</span><br><span class="line">       <span class="keyword">CASE</span></span><br><span class="line">           <span class="keyword">WHEN</span> salary <span class="operator">&gt;=</span> <span class="number">15000</span> <span class="keyword">THEN</span> salary <span class="operator">*</span> <span class="number">0.2</span></span><br><span class="line">           <span class="keyword">WHEN</span> salary <span class="operator">&gt;=</span> <span class="number">10000</span> <span class="keyword">THEN</span> salary <span class="operator">*</span> <span class="number">0.15</span></span><br><span class="line">           <span class="keyword">WHEN</span> salary <span class="operator">&gt;=</span> <span class="number">7000</span> <span class="keyword">THEN</span> salary <span class="operator">*</span> <span class="number">0.1</span></span><br><span class="line">           <span class="keyword">ELSE</span> salary <span class="operator">*</span> <span class="number">0.05</span></span><br><span class="line">       <span class="keyword">END</span> <span class="keyword">AS</span> bonus</span><br><span class="line"><span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>

<h3 id="5-5-CASE-在-ORDER-BY-中的应用"><a href="#5-5-CASE-在-ORDER-BY-中的应用" class="headerlink" title="5.5 CASE 在 ORDER BY 中的应用"></a>5.5 CASE 在 ORDER BY 中的应用</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 自定义排序顺序</span></span><br><span class="line"><span class="keyword">SELECT</span> name, dept_id <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span></span><br><span class="line">    <span class="keyword">CASE</span> dept_id</span><br><span class="line">        <span class="keyword">WHEN</span> <span class="number">1</span> <span class="keyword">THEN</span> <span class="number">1</span></span><br><span class="line">        <span class="keyword">WHEN</span> <span class="number">3</span> <span class="keyword">THEN</span> <span class="number">2</span></span><br><span class="line">        <span class="keyword">WHEN</span> <span class="number">2</span> <span class="keyword">THEN</span> <span class="number">3</span></span><br><span class="line">        <span class="keyword">ELSE</span> <span class="number">4</span></span><br><span class="line">    <span class="keyword">END</span>;</span><br><span class="line"><span class="comment">-- 排序：技术部 → 财务部 → 市场部 → 其他</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 多条件排序</span></span><br><span class="line"><span class="keyword">SELECT</span> name, status, salary <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span></span><br><span class="line">    <span class="keyword">CASE</span> status <span class="keyword">WHEN</span> <span class="number">1</span> <span class="keyword">THEN</span> <span class="number">0</span> <span class="keyword">ELSE</span> <span class="number">1</span> <span class="keyword">END</span>,  <span class="comment">-- 在职优先</span></span><br><span class="line">    salary <span class="keyword">DESC</span>;  <span class="comment">-- 工资降序</span></span><br></pre></td></tr></table></figure>

<h2 id="六、其他实用函数"><a href="#六、其他实用函数" class="headerlink" title="六、其他实用函数"></a>六、其他实用函数</h2><h3 id="6-1-信息函数"><a href="#6-1-信息函数" class="headerlink" title="6.1 信息函数"></a>6.1 信息函数</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- VERSION()：MySQL 版本</span></span><br><span class="line"><span class="keyword">SELECT</span> VERSION();</span><br><span class="line"></span><br><span class="line"><span class="comment">-- DATABASE()：当前数据库名</span></span><br><span class="line"><span class="keyword">SELECT</span> DATABASE();</span><br><span class="line"></span><br><span class="line"><span class="comment">-- USER()：当前用户</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">USER</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">-- CONNECTION_ID()：当前连接 ID</span></span><br><span class="line"><span class="keyword">SELECT</span> CONNECTION_ID();</span><br><span class="line"></span><br><span class="line"><span class="comment">-- CHARSET(s)：返回字符串的字符集</span></span><br><span class="line"><span class="keyword">SELECT</span> CHARSET(<span class="string">&#x27;hello&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- COLLATION(s)：返回字符串的排序规则</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">COLLATION</span>(<span class="string">&#x27;hello&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="6-2-加锁函数"><a href="#6-2-加锁函数" class="headerlink" title="6.2 加锁函数"></a>6.2 加锁函数</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- GET_LOCK(name, timeout)：获取命名锁</span></span><br><span class="line"><span class="keyword">SELECT</span> GET_LOCK(<span class="string">&#x27;my_lock&#x27;</span>, <span class="number">10</span>);  <span class="comment">-- 等待最多 10 秒</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- RELEASE_LOCK(name)：释放命名锁</span></span><br><span class="line"><span class="keyword">SELECT</span> RELEASE_LOCK(<span class="string">&#x27;my_lock&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- IS_USED_LOCK(name)：检查锁是否被使用</span></span><br><span class="line"><span class="keyword">SELECT</span> IS_USED_LOCK(<span class="string">&#x27;my_lock&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- IS_FREE_LOCK(name)：检查锁是否空闲</span></span><br><span class="line"><span class="keyword">SELECT</span> IS_FREE_LOCK(<span class="string">&#x27;my_lock&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="6-3-加密函数"><a href="#6-3-加密函数" class="headerlink" title="6.3 加密函数"></a>6.3 加密函数</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- MD5(s)：MD5 哈希</span></span><br><span class="line"><span class="keyword">SELECT</span> MD5(<span class="string">&#x27;password&#x27;</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- &#x27;5f4dcc3b5aa765d61d8327deb882cf99&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- SHA1(s)：SHA-1 哈希</span></span><br><span class="line"><span class="keyword">SELECT</span> SHA1(<span class="string">&#x27;password&#x27;</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- SHA2(s, n)：SHA-2 哈希（n=224,256,384,512）</span></span><br><span class="line"><span class="keyword">SELECT</span> SHA2(<span class="string">&#x27;password&#x27;</span>, <span class="number">256</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- AES_ENCRYPT(s, key) / AES_DECRYPT(s, key)：AES 加密解密</span></span><br><span class="line"><span class="keyword">SELECT</span> AES_ENCRYPT(<span class="string">&#x27;secret&#x27;</span>, <span class="string">&#x27;key&#x27;</span>) <span class="keyword">AS</span> encrypted;</span><br><span class="line"><span class="keyword">SELECT</span> AES_DECRYPT(AES_ENCRYPT(<span class="string">&#x27;secret&#x27;</span>, <span class="string">&#x27;key&#x27;</span>), <span class="string">&#x27;key&#x27;</span>) <span class="keyword">AS</span> decrypted;</span><br></pre></td></tr></table></figure>

<h3 id="6-4-JSON-函数（MySQL-5-7-）"><a href="#6-4-JSON-函数（MySQL-5-7-）" class="headerlink" title="6.4 JSON 函数（MySQL 5.7+）"></a>6.4 JSON 函数（MySQL 5.7+）</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- JSON_EXTRACT(json_doc, path)：提取 JSON 值</span></span><br><span class="line"><span class="keyword">SELECT</span> JSON_EXTRACT(<span class="string">&#x27;&#123;&quot;name&quot;: &quot;张三&quot;, &quot;age&quot;: 25&#125;&#x27;</span>, <span class="string">&#x27;$.name&#x27;</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- &#x27;&quot;张三&quot;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- -&gt; 操作符（简化提取）</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="string">&#x27;&#123;&quot;name&quot;: &quot;张三&quot;, &quot;age&quot;: 25&#125;&#x27;</span><span class="operator">-</span><span class="operator">&gt;</span><span class="string">&#x27;$.name&#x27;</span> <span class="keyword">AS</span> <span class="keyword">result</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- JSON_INSERT、JSON_REPLACE、JSON_SET：修改 JSON</span></span><br><span class="line"><span class="keyword">SELECT</span> JSON_SET(<span class="string">&#x27;&#123;&quot;name&quot;: &quot;张三&quot;&#125;&#x27;</span>, <span class="string">&#x27;$.age&#x27;</span>, <span class="number">25</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- JSON_ARRAY、JSON_OBJECT：创建 JSON</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">JSON_ARRAY</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- &#x27;[1, 2, 3]&#x27;</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">JSON_OBJECT</span>(<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;张三&#x27;</span>, <span class="string">&#x27;age&#x27;</span>, <span class="number">25</span>) <span class="keyword">AS</span> <span class="keyword">result</span>;  <span class="comment">-- &#x27;&#123;&quot;name&quot;: &quot;张三&quot;, &quot;age&quot;: 25&#125;&#x27;</span></span><br></pre></td></tr></table></figure>

<h2 id="七、函数性能优化建议"><a href="#七、函数性能优化建议" class="headerlink" title="七、函数性能优化建议"></a>七、函数性能优化建议</h2><h3 id="7-1-避免在索引列上使用函数"><a href="#7-1-避免在索引列上使用函数" class="headerlink" title="7.1 避免在索引列上使用函数"></a>7.1 避免在索引列上使用函数</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 性能差：无法使用索引</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> <span class="keyword">YEAR</span>(hire_date) <span class="operator">=</span> <span class="number">2024</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 性能好：可以使用索引</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> hire_date <span class="operator">&gt;=</span> <span class="string">&#x27;2024-01-01&#x27;</span></span><br><span class="line"><span class="keyword">AND</span> hire_date <span class="operator">&lt;</span> <span class="string">&#x27;2025-01-01&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 性能差：无法使用索引</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> <span class="built_in">UPPER</span>(name) <span class="operator">=</span> <span class="string">&#x27;JOHN&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 性能好：可以使用索引</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> name <span class="operator">=</span> <span class="string">&#x27;John&#x27;</span>;</span><br><span class="line"><span class="comment">-- 或者使用大小写不敏感的排序规则</span></span><br></pre></td></tr></table></figure>

<h3 id="7-2-避免使用-ORDER-BY-RAND"><a href="#7-2-避免使用-ORDER-BY-RAND" class="headerlink" title="7.2 避免使用 ORDER BY RAND()"></a>7.2 避免使用 ORDER BY RAND()</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 性能差：全表排序</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees <span class="keyword">ORDER</span> <span class="keyword">BY</span> RAND() LIMIT <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 性能好：使用子查询</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> id <span class="operator">&gt;=</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> <span class="built_in">FLOOR</span>(RAND() <span class="operator">*</span> (<span class="keyword">SELECT</span> <span class="built_in">MAX</span>(id) <span class="keyword">FROM</span> employees))</span><br><span class="line">)</span><br><span class="line">LIMIT <span class="number">10</span>;</span><br></pre></td></tr></table></figure>

<h3 id="7-3-避免使用-SELECT"><a href="#7-3-避免使用-SELECT" class="headerlink" title="7.3 避免使用 SELECT *"></a>7.3 避免使用 SELECT *</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 只选择需要的列</span></span><br><span class="line"><span class="keyword">SELECT</span> name, salary, DATE_FORMAT(hire_date, <span class="string">&#x27;%Y-%m&#x27;</span>) <span class="keyword">AS</span> hire_month</span><br><span class="line"><span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>

<h2 id="八、小结"><a href="#八、小结" class="headerlink" title="八、小结"></a>八、小结</h2><h3 id="函数速查表"><a href="#函数速查表" class="headerlink" title="函数速查表"></a>函数速查表</h3><table>
<thead>
<tr>
<th>类型</th>
<th>函数</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><strong>字符串</strong></td>
<td>CONCAT, LENGTH, SUBSTRING, REPLACE, UPPER, LOWER, TRIM</td>
<td>字符串处理</td>
</tr>
<tr>
<td><strong>数值</strong></td>
<td>ABS, ROUND, CEIL, FLOOR, MOD, RAND</td>
<td>数值计算</td>
</tr>
<tr>
<td><strong>日期</strong></td>
<td>NOW, DATE_FORMAT, DATEDIFF, DATE_ADD</td>
<td>日期处理</td>
</tr>
<tr>
<td><strong>流程</strong></td>
<td>IF, IFNULL, NULLIF, CASE</td>
<td>条件判断</td>
</tr>
</tbody></table>
<h3 id="实用技巧"><a href="#实用技巧" class="headerlink" title="实用技巧"></a>实用技巧</h3><ol>
<li><strong>字符串处理</strong>：使用 CONCAT_WS 连接，使用 TRIM 去除空格</li>
<li><strong>数值处理</strong>：使用 ROUND 四舍五入，使用 TRUNCATE 截断</li>
<li><strong>日期处理</strong>：使用 DATE_FORMAT 格式化，使用 DATEDIFF 计算差值</li>
<li><strong>条件判断</strong>：简单条件用 IF，复杂条件用 CASE</li>
<li><strong>NULL 处理</strong>：使用 IFNULL 处理 NULL 值，使用 NULLIF 避免除以零</li>
</ol>
<h3 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h3><ol>
<li>函数可能影响索引使用，注意性能</li>
<li>日期函数中月份从 1 开始，星期函数注意返回值</li>
<li>字符串位置从 1 开始，不是从 0 开始</li>
<li>不同 MySQL 版本函数可能有差异</li>
</ol>
<hr>
<p><strong>下一篇</strong>：[MySQL 进阶教程（二）：数据库约束详解](&#x2F;2026&#x2F;02&#x2F;23&#x2F;MySQL 进阶教程（二）数据库约束详解&#x2F;)</p>
<p><strong>上一篇</strong>：[MySQL 基础教程（五）：DCL 数据控制语言详解](&#x2F;2026&#x2F;02&#x2F;23&#x2F;MySQL 基础教程（五）DCL 数据控制语言详解&#x2F;)</p>
]]></content>
      <categories>
        <category>MySQL 进阶教程</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
        <tag>函数</tag>
        <tag>内置函数</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQL 进阶教程（三）多表查询详解</title>
    <url>/2026/02/23/MySQL%20%E8%BF%9B%E9%98%B6%E6%95%99%E7%A8%8B%EF%BC%88%E4%B8%89%EF%BC%89%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A2%E8%AF%A6%E8%A7%A3/</url>
    <content><![CDATA[<h1 id="MySQL-进阶教程（三）多表查询详解"><a href="#MySQL-进阶教程（三）多表查询详解" class="headerlink" title="MySQL 进阶教程（三）多表查询详解"></a>MySQL 进阶教程（三）多表查询详解</h1><p>在实际应用中，数据通常分布在多个表中。多表查询是 SQL 中最重要、最实用的技能之一。本文将详细讲解多表关系、连接查询、联合查询和子查询。</p>
<h2 id="一、多表关系介绍"><a href="#一、多表关系介绍" class="headerlink" title="一、多表关系介绍"></a>一、多表关系介绍</h2><h3 id="1-1-表与表之间的关系"><a href="#1-1-表与表之间的关系" class="headerlink" title="1.1 表与表之间的关系"></a>1.1 表与表之间的关系</h3><p>数据库中的表不是孤立的，它们之间通过各种关系相互关联。主要有三种关系：</p>
<table>
<thead>
<tr>
<th>关系类型</th>
<th>说明</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td>一对一（1:1）</td>
<td>一个表的一条记录对应另一个表的一条记录</td>
<td>用户和用户详情</td>
</tr>
<tr>
<td>一对多（1:N）</td>
<td>一个表的一条记录对应另一个表的多条记录</td>
<td>部门和员工</td>
</tr>
<tr>
<td>多对多（N:M）</td>
<td>一个表的多条记录对应另一个表的多条记录</td>
<td>学生和课程</td>
</tr>
</tbody></table>
<h3 id="1-2-一对一关系（1-1）"><a href="#1-2-一对一关系（1-1）" class="headerlink" title="1.2 一对一关系（1:1）"></a>1.2 一对一关系（1:1）</h3><p><strong>特点</strong>：</p>
<ul>
<li>表 A 的一条记录对应表 B 的一条记录</li>
<li>通常用于拆分大表，提高性能</li>
<li>外键可以放在任意一方</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 用户表</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> users (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT,</span><br><span class="line">    username <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">    password <span class="type">VARCHAR</span>(<span class="number">255</span>) <span class="keyword">NOT NULL</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 用户详情表（一对一）</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> user_profiles (</span><br><span class="line">    user_id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span>,  <span class="comment">-- 也是主键，保证一对一</span></span><br><span class="line">    real_name <span class="type">VARCHAR</span>(<span class="number">50</span>),</span><br><span class="line">    phone <span class="type">VARCHAR</span>(<span class="number">20</span>),</span><br><span class="line">    address <span class="type">VARCHAR</span>(<span class="number">200</span>),</span><br><span class="line">    <span class="keyword">FOREIGN KEY</span> (user_id) <span class="keyword">REFERENCES</span> users(id) <span class="keyword">ON</span> <span class="keyword">DELETE</span> CASCADE</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询用户及其详情</span></span><br><span class="line"><span class="keyword">SELECT</span> u.username, p.real_name, p.phone, p.address</span><br><span class="line"><span class="keyword">FROM</span> users u</span><br><span class="line"><span class="keyword">JOIN</span> user_profiles p <span class="keyword">ON</span> u.id <span class="operator">=</span> p.user_id;</span><br></pre></td></tr></table></figure>

<h3 id="1-3-一对多关系（1-N）"><a href="#1-3-一对多关系（1-N）" class="headerlink" title="1.3 一对多关系（1:N）"></a>1.3 一对多关系（1:N）</h3><p><strong>特点</strong>：</p>
<ul>
<li>表 A 的一条记录对应表 B 的多条记录</li>
<li>外键放在”多”的一方</li>
<li>最常见表关系</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 部门表（一方）</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> departments (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT,</span><br><span class="line">    dept_name <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">NOT NULL</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 员工表（多方）</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> employees (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT,</span><br><span class="line">    name <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">    dept_id <span class="type">INT</span>,  <span class="comment">-- 外键指向部门表</span></span><br><span class="line">    <span class="keyword">FOREIGN KEY</span> (dept_id) <span class="keyword">REFERENCES</span> departments(id)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 一个部门有多个员工</span></span><br><span class="line"><span class="comment">-- 一个员工只属于一个部门</span></span><br></pre></td></tr></table></figure>

<h3 id="1-4-多对多关系（N-M）"><a href="#1-4-多对多关系（N-M）" class="headerlink" title="1.4 多对多关系（N:M）"></a>1.4 多对多关系（N:M）</h3><p><strong>特点</strong>：</p>
<ul>
<li>表 A 的多条记录对应表 B 的多条记录</li>
<li>需要第三张关联表（中间表）</li>
<li>关联表包含两个外键</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 学生表</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> students (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT,</span><br><span class="line">    name <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">NOT NULL</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 课程表</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> courses (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT,</span><br><span class="line">    course_name <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">NOT NULL</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 选课表（中间表）</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> enrollments (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT,</span><br><span class="line">    student_id <span class="type">INT</span> <span class="keyword">NOT NULL</span>,</span><br><span class="line">    course_id <span class="type">INT</span> <span class="keyword">NOT NULL</span>,</span><br><span class="line">    enroll_date <span class="type">DATE</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_DATE</span>,</span><br><span class="line">    <span class="keyword">FOREIGN KEY</span> (student_id) <span class="keyword">REFERENCES</span> students(id),</span><br><span class="line">    <span class="keyword">FOREIGN KEY</span> (course_id) <span class="keyword">REFERENCES</span> courses(id),</span><br><span class="line">    <span class="keyword">UNIQUE</span> KEY uk_student_course (student_id, course_id)  <span class="comment">-- 防止重复选课</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 一个学生可以选多门课</span></span><br><span class="line"><span class="comment">-- 一门课可以被多个学生选</span></span><br></pre></td></tr></table></figure>

<h2 id="二、多表查询概述"><a href="#二、多表查询概述" class="headerlink" title="二、多表查询概述"></a>二、多表查询概述</h2><h3 id="2-1-多表查询的方式"><a href="#2-1-多表查询的方式" class="headerlink" title="2.1 多表查询的方式"></a>2.1 多表查询的方式</h3><table>
<thead>
<tr>
<th>查询方式</th>
<th>说明</th>
<th>关键字</th>
</tr>
</thead>
<tbody><tr>
<td>连接查询</td>
<td>通过连接条件将多个表关联</td>
<td>JOIN</td>
</tr>
<tr>
<td>联合查询</td>
<td>将多个查询结果合并</td>
<td>UNION</td>
</tr>
<tr>
<td>子查询</td>
<td>在一个查询中嵌套另一个查询</td>
<td>子 SELECT</td>
</tr>
</tbody></table>
<h3 id="2-2-笛卡尔积"><a href="#2-2-笛卡尔积" class="headerlink" title="2.2 笛卡尔积"></a>2.2 笛卡尔积</h3><p>当两个表进行连接时，如果没有连接条件，会得到笛卡尔积。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 表 A 有 3 条记录，表 B 有 4 条记录</span></span><br><span class="line"><span class="comment">-- 笛卡尔积结果：3 × 4 = 12 条记录</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 笛卡尔积（不推荐，数据量大会爆炸）</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> table_a, table_b;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 正确做法：添加连接条件</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> table_a, table_b <span class="keyword">WHERE</span> table_a.id <span class="operator">=</span> table_b.a_id;</span><br></pre></td></tr></table></figure>

<h3 id="2-3-准备测试数据"><a href="#2-3-准备测试数据" class="headerlink" title="2.3 准备测试数据"></a>2.3 准备测试数据</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 部门表</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> departments;</span><br><span class="line"><span class="keyword">CREATE TABLE</span> departments (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT,</span><br><span class="line">    dept_name <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">    dept_location <span class="type">VARCHAR</span>(<span class="number">100</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 员工表</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> employees;</span><br><span class="line"><span class="keyword">CREATE TABLE</span> employees (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT,</span><br><span class="line">    emp_no <span class="type">VARCHAR</span>(<span class="number">20</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">    name <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">    gender ENUM(<span class="string">&#x27;男&#x27;</span>, <span class="string">&#x27;女&#x27;</span>),</span><br><span class="line">    dept_id <span class="type">INT</span>,</span><br><span class="line">    salary <span class="type">DECIMAL</span>(<span class="number">10</span>, <span class="number">2</span>),</span><br><span class="line">    manager_id <span class="type">INT</span>,</span><br><span class="line">    <span class="keyword">FOREIGN KEY</span> (dept_id) <span class="keyword">REFERENCES</span> departments(id),</span><br><span class="line">    <span class="keyword">FOREIGN KEY</span> (manager_id) <span class="keyword">REFERENCES</span> employees(id)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 插入部门</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> departments (dept_name, dept_location) <span class="keyword">VALUES</span></span><br><span class="line">(<span class="string">&#x27;技术部&#x27;</span>, <span class="string">&#x27;北京&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;市场部&#x27;</span>, <span class="string">&#x27;上海&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;财务部&#x27;</span>, <span class="string">&#x27;北京&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;人事部&#x27;</span>, <span class="string">&#x27;广州&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 插入员工</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> employees (emp_no, name, gender, dept_id, salary, manager_id) <span class="keyword">VALUES</span></span><br><span class="line">(<span class="string">&#x27;E001&#x27;</span>, <span class="string">&#x27;张三&#x27;</span>, <span class="string">&#x27;男&#x27;</span>, <span class="number">1</span>, <span class="number">10000</span>, <span class="keyword">NULL</span>),      <span class="comment">-- 技术部经理</span></span><br><span class="line">(<span class="string">&#x27;E002&#x27;</span>, <span class="string">&#x27;李四&#x27;</span>, <span class="string">&#x27;女&#x27;</span>, <span class="number">1</span>, <span class="number">8000</span>, <span class="number">1</span>),          <span class="comment">-- 技术部员工</span></span><br><span class="line">(<span class="string">&#x27;E003&#x27;</span>, <span class="string">&#x27;王五&#x27;</span>, <span class="string">&#x27;男&#x27;</span>, <span class="number">1</span>, <span class="number">9000</span>, <span class="number">1</span>),          <span class="comment">-- 技术部员工</span></span><br><span class="line">(<span class="string">&#x27;E004&#x27;</span>, <span class="string">&#x27;赵六&#x27;</span>, <span class="string">&#x27;女&#x27;</span>, <span class="number">2</span>, <span class="number">8500</span>, <span class="keyword">NULL</span>),       <span class="comment">-- 市场部经理</span></span><br><span class="line">(<span class="string">&#x27;E005&#x27;</span>, <span class="string">&#x27;孙七&#x27;</span>, <span class="string">&#x27;男&#x27;</span>, <span class="number">2</span>, <span class="number">7500</span>, <span class="number">4</span>),          <span class="comment">-- 市场部员工</span></span><br><span class="line">(<span class="string">&#x27;E006&#x27;</span>, <span class="string">&#x27;周八&#x27;</span>, <span class="string">&#x27;女&#x27;</span>, <span class="number">3</span>, <span class="number">9000</span>, <span class="keyword">NULL</span>),       <span class="comment">-- 财务部经理</span></span><br><span class="line">(<span class="string">&#x27;E007&#x27;</span>, <span class="string">&#x27;吴九&#x27;</span>, <span class="string">&#x27;男&#x27;</span>, <span class="keyword">NULL</span>, <span class="number">6000</span>, <span class="keyword">NULL</span>);    <span class="comment">-- 暂无部门</span></span><br></pre></td></tr></table></figure>

<h2 id="三、内连接（INNER-JOIN）"><a href="#三、内连接（INNER-JOIN）" class="headerlink" title="三、内连接（INNER JOIN）"></a>三、内连接（INNER JOIN）</h2><h3 id="3-1-内连接概述"><a href="#3-1-内连接概述" class="headerlink" title="3.1 内连接概述"></a>3.1 内连接概述</h3><p><strong>内连接</strong> 返回两个表中满足连接条件的记录。</p>
<p><strong>特点</strong>：</p>
<ul>
<li>只返回匹配的记录</li>
<li>不匹配的记录不会出现在结果中</li>
<li>最常用的连接方式</li>
</ul>
<h3 id="3-2-内连接语法"><a href="#3-2-内连接语法" class="headerlink" title="3.2 内连接语法"></a>3.2 内连接语法</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 标准语法（推荐）</span></span><br><span class="line"><span class="keyword">SELECT</span> 列名</span><br><span class="line"><span class="keyword">FROM</span> 表 <span class="number">1</span></span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> 表 <span class="number">2</span> <span class="keyword">ON</span> 连接条件</span><br><span class="line">[<span class="keyword">WHERE</span> 条件]</span><br><span class="line">[<span class="keyword">GROUP</span> <span class="keyword">BY</span> 分组列]</span><br><span class="line">[<span class="keyword">ORDER</span> <span class="keyword">BY</span> 排序列]</span><br><span class="line">[LIMIT 数量];</span><br><span class="line"></span><br><span class="line"><span class="comment">-- INNER 可以省略</span></span><br><span class="line"><span class="keyword">SELECT</span> 列名</span><br><span class="line"><span class="keyword">FROM</span> 表 <span class="number">1</span></span><br><span class="line"><span class="keyword">JOIN</span> 表 <span class="number">2</span> <span class="keyword">ON</span> 连接条件;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 多表连接</span></span><br><span class="line"><span class="keyword">SELECT</span> 列名</span><br><span class="line"><span class="keyword">FROM</span> 表 <span class="number">1</span></span><br><span class="line"><span class="keyword">JOIN</span> 表 <span class="number">2</span> <span class="keyword">ON</span> 表 <span class="number">1.</span>id <span class="operator">=</span> 表 <span class="number">2.</span>表 <span class="number">1</span>_id</span><br><span class="line"><span class="keyword">JOIN</span> 表 <span class="number">3</span> <span class="keyword">ON</span> 表 <span class="number">2.</span>id <span class="operator">=</span> 表 <span class="number">3.</span>表 <span class="number">2</span>_id;</span><br></pre></td></tr></table></figure>

<h3 id="3-3-内连接示例"><a href="#3-3-内连接示例" class="headerlink" title="3.3 内连接示例"></a>3.3 内连接示例</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 查询员工及其所属部门</span></span><br><span class="line"><span class="keyword">SELECT</span> e.name, e.salary, d.dept_name</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> departments d <span class="keyword">ON</span> e.dept_id <span class="operator">=</span> d.id;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询技术部员工</span></span><br><span class="line"><span class="keyword">SELECT</span> e.name, e.salary, d.dept_name</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">JOIN</span> departments d <span class="keyword">ON</span> e.dept_id <span class="operator">=</span> d.id</span><br><span class="line"><span class="keyword">WHERE</span> d.dept_name <span class="operator">=</span> <span class="string">&#x27;技术部&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询工资高于 8000 的员工及部门</span></span><br><span class="line"><span class="keyword">SELECT</span> e.name, e.salary, d.dept_name, d.dept_location</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">JOIN</span> departments d <span class="keyword">ON</span> e.dept_id <span class="operator">=</span> d.id</span><br><span class="line"><span class="keyword">WHERE</span> e.salary <span class="operator">&gt;</span> <span class="number">8000</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 多条件连接</span></span><br><span class="line"><span class="keyword">SELECT</span> e.name, d.dept_name</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">JOIN</span> departments d <span class="keyword">ON</span> e.dept_id <span class="operator">=</span> d.id</span><br><span class="line"><span class="keyword">WHERE</span> e.gender <span class="operator">=</span> <span class="string">&#x27;男&#x27;</span> <span class="keyword">AND</span> d.dept_location <span class="operator">=</span> <span class="string">&#x27;北京&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h3 id="3-4-隐式内连接"><a href="#3-4-隐式内连接" class="headerlink" title="3.4 隐式内连接"></a>3.4 隐式内连接</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 隐式内连接（旧语法，不推荐）</span></span><br><span class="line"><span class="keyword">SELECT</span> e.name, d.dept_name</span><br><span class="line"><span class="keyword">FROM</span> employees e, departments d</span><br><span class="line"><span class="keyword">WHERE</span> e.dept_id <span class="operator">=</span> d.id;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 等价于显式内连接</span></span><br><span class="line"><span class="keyword">SELECT</span> e.name, d.dept_name</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">JOIN</span> departments d <span class="keyword">ON</span> e.dept_id <span class="operator">=</span> d.id;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 注意：隐式连接容易遗漏 WHERE 条件导致笛卡尔积</span></span><br></pre></td></tr></table></figure>

<h3 id="3-5-多表内连接"><a href="#3-5-多表内连接" class="headerlink" title="3.5 多表内连接"></a>3.5 多表内连接</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 查询员工、部门及其上级领导</span></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    e.name <span class="keyword">AS</span> 员工，</span><br><span class="line">    d.dept_name <span class="keyword">AS</span> 部门，</span><br><span class="line">    m.name <span class="keyword">AS</span> 上级领导</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">JOIN</span> departments d <span class="keyword">ON</span> e.dept_id <span class="operator">=</span> d.id</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> employees m <span class="keyword">ON</span> e.manager_id <span class="operator">=</span> m.id;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 三表连接示例：学生 - 选课 - 课程</span></span><br><span class="line"><span class="keyword">SELECT</span> s.name <span class="keyword">AS</span> 学生，c.course_name <span class="keyword">AS</span> 课程，e.score <span class="keyword">AS</span> 成绩</span><br><span class="line"><span class="keyword">FROM</span> students s</span><br><span class="line"><span class="keyword">JOIN</span> enrollments e <span class="keyword">ON</span> s.id <span class="operator">=</span> e.student_id</span><br><span class="line"><span class="keyword">JOIN</span> courses c <span class="keyword">ON</span> e.course_id <span class="operator">=</span> c.id;</span><br></pre></td></tr></table></figure>

<h2 id="四、外连接（OUTER-JOIN）"><a href="#四、外连接（OUTER-JOIN）" class="headerlink" title="四、外连接（OUTER JOIN）"></a>四、外连接（OUTER JOIN）</h2><h3 id="4-1-外连接概述"><a href="#4-1-外连接概述" class="headerlink" title="4.1 外连接概述"></a>4.1 外连接概述</h3><p><strong>外连接</strong> 返回一个表的所有记录，另一个表只返回匹配的记录。</p>
<table>
<thead>
<tr>
<th>类型</th>
<th>说明</th>
<th>返回</th>
</tr>
</thead>
<tbody><tr>
<td>左连接（LEFT JOIN）</td>
<td>返回左表所有记录</td>
<td>左表全部 + 右表匹配</td>
</tr>
<tr>
<td>右连接（RIGHT JOIN）</td>
<td>返回右表所有记录</td>
<td>右表全部 + 左表匹配</td>
</tr>
<tr>
<td>全外连接（FULL JOIN）</td>
<td>返回两个表所有记录</td>
<td>MySQL 不支持</td>
</tr>
</tbody></table>
<h3 id="4-2-左连接（LEFT-JOIN）"><a href="#4-2-左连接（LEFT-JOIN）" class="headerlink" title="4.2 左连接（LEFT JOIN）"></a>4.2 左连接（LEFT JOIN）</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 查询所有员工及其部门（包括没有部门的员工）</span></span><br><span class="line"><span class="keyword">SELECT</span> e.name, e.dept_id, d.dept_name</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> departments d <span class="keyword">ON</span> e.dept_id <span class="operator">=</span> d.id;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 结果：吴九（dept_id=NULL）也会显示，dept_name 为 NULL</span></span><br></pre></td></tr></table></figure>

<p><strong>左连接特点</strong>：</p>
<ul>
<li>左表的所有记录都会返回</li>
<li>右表没有匹配的记录填充 NULL</li>
</ul>
<h3 id="4-3-右连接（RIGHT-JOIN）"><a href="#4-3-右连接（RIGHT-JOIN）" class="headerlink" title="4.3 右连接（RIGHT JOIN）"></a>4.3 右连接（RIGHT JOIN）</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 查询所有部门及其员工（包括没有员工的部门）</span></span><br><span class="line"><span class="keyword">SELECT</span> d.dept_name, e.name</span><br><span class="line"><span class="keyword">FROM</span> departments d</span><br><span class="line"><span class="keyword">RIGHT</span> <span class="keyword">JOIN</span> employees e <span class="keyword">ON</span> d.id <span class="operator">=</span> e.dept_id;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 等价于（推荐）</span></span><br><span class="line"><span class="keyword">SELECT</span> d.dept_name, e.name</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> departments d <span class="keyword">ON</span> d.id <span class="operator">=</span> e.dept_id;</span><br></pre></td></tr></table></figure>

<p><strong>右连接特点</strong>：</p>
<ul>
<li>右表的所有记录都会返回</li>
<li>左表没有匹配的记录填充 NULL</li>
<li>可以用左连接替代</li>
</ul>
<h3 id="4-4-左连接-vs-内连接"><a href="#4-4-左连接-vs-内连接" class="headerlink" title="4.4 左连接 vs 内连接"></a>4.4 左连接 vs 内连接</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 内连接：只返回有部门的员工</span></span><br><span class="line"><span class="keyword">SELECT</span> e.name, d.dept_name</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">JOIN</span> departments d <span class="keyword">ON</span> e.dept_id <span class="operator">=</span> d.id;</span><br><span class="line"><span class="comment">-- 吴九不会出现在结果中</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 左连接：返回所有员工</span></span><br><span class="line"><span class="keyword">SELECT</span> e.name, d.dept_name</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> departments d <span class="keyword">ON</span> e.dept_id <span class="operator">=</span> d.id;</span><br><span class="line"><span class="comment">-- 吴九会显示，dept_name 为 NULL</span></span><br></pre></td></tr></table></figure>

<h3 id="4-5-外连接查询不匹配记录"><a href="#4-5-外连接查询不匹配记录" class="headerlink" title="4.5 外连接查询不匹配记录"></a>4.5 外连接查询不匹配记录</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 查询没有员工的部门</span></span><br><span class="line"><span class="keyword">SELECT</span> d.dept_name</span><br><span class="line"><span class="keyword">FROM</span> departments d</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> employees e <span class="keyword">ON</span> d.id <span class="operator">=</span> e.dept_id</span><br><span class="line"><span class="keyword">WHERE</span> e.id <span class="keyword">IS</span> <span class="keyword">NULL</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询没有部门的员工</span></span><br><span class="line"><span class="keyword">SELECT</span> e.name</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> departments d <span class="keyword">ON</span> e.dept_id <span class="operator">=</span> d.id</span><br><span class="line"><span class="keyword">WHERE</span> d.id <span class="keyword">IS</span> <span class="keyword">NULL</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询没有选课的学生</span></span><br><span class="line"><span class="keyword">SELECT</span> s.name</span><br><span class="line"><span class="keyword">FROM</span> students s</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> enrollments e <span class="keyword">ON</span> s.id <span class="operator">=</span> e.student_id</span><br><span class="line"><span class="keyword">WHERE</span> e.course_id <span class="keyword">IS</span> <span class="keyword">NULL</span>;</span><br></pre></td></tr></table></figure>

<h3 id="4-6-外连接条件位置"><a href="#4-6-外连接条件位置" class="headerlink" title="4.6 外连接条件位置"></a>4.6 外连接条件位置</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 连接条件在 ON 子句</span></span><br><span class="line"><span class="keyword">SELECT</span> e.name, d.dept_name</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> departments d <span class="keyword">ON</span> e.dept_id <span class="operator">=</span> d.id;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 过滤条件在 WHERE 子句</span></span><br><span class="line"><span class="keyword">SELECT</span> e.name, d.dept_name</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> departments d <span class="keyword">ON</span> e.dept_id <span class="operator">=</span> d.id</span><br><span class="line"><span class="keyword">WHERE</span> d.dept_location <span class="operator">=</span> <span class="string">&#x27;北京&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 注意：ON 和 WHERE 的区别</span></span><br><span class="line"><span class="comment">-- ON 在连接时过滤，WHERE 在连接后过滤</span></span><br></pre></td></tr></table></figure>

<h2 id="五、自连接（SELF-JOIN）"><a href="#五、自连接（SELF-JOIN）" class="headerlink" title="五、自连接（SELF JOIN）"></a>五、自连接（SELF JOIN）</h2><h3 id="5-1-自连接概述"><a href="#5-1-自连接概述" class="headerlink" title="5.1 自连接概述"></a>5.1 自连接概述</h3><p><strong>自连接</strong> 是表自己与自己连接，用于查询具有层级关系的数据。</p>
<p><strong>特点</strong>：</p>
<ul>
<li>同一张表使用不同的别名</li>
<li>常用于组织架构、分类层级等</li>
</ul>
<h3 id="5-2-自连接示例"><a href="#5-2-自连接示例" class="headerlink" title="5.2 自连接示例"></a>5.2 自连接示例</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 查询员工及其上级领导</span></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    e.name <span class="keyword">AS</span> 员工，</span><br><span class="line">    e.emp_no <span class="keyword">AS</span> 员工编号，</span><br><span class="line">    m.name <span class="keyword">AS</span> 上级领导，</span><br><span class="line">    m.emp_no <span class="keyword">AS</span> 领导编号</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> employees m <span class="keyword">ON</span> e.manager_id <span class="operator">=</span> m.id;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询所有领导（带下属的员工）</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> m.id, m.name</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">JOIN</span> employees m <span class="keyword">ON</span> e.manager_id <span class="operator">=</span> m.id;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询没有下属的员工（普通员工）</span></span><br><span class="line"><span class="keyword">SELECT</span> e.name</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> employees sub <span class="keyword">ON</span> sub.manager_id <span class="operator">=</span> e.id</span><br><span class="line"><span class="keyword">WHERE</span> sub.id <span class="keyword">IS</span> <span class="keyword">NULL</span>;</span><br></pre></td></tr></table></figure>

<h3 id="5-3-层级查询"><a href="#5-3-层级查询" class="headerlink" title="5.3 层级查询"></a>5.3 层级查询</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 查询员工的完整汇报链（需要递归，MySQL 8.0+ 使用 CTE）</span></span><br><span class="line"><span class="keyword">WITH</span> <span class="keyword">RECURSIVE</span> emp_hierarchy <span class="keyword">AS</span> (</span><br><span class="line">    <span class="comment">-- 基础查询：顶级领导（没有上级）</span></span><br><span class="line">    <span class="keyword">SELECT</span> id, name, manager_id, <span class="number">0</span> <span class="keyword">AS</span> level</span><br><span class="line">    <span class="keyword">FROM</span> employees</span><br><span class="line">    <span class="keyword">WHERE</span> manager_id <span class="keyword">IS</span> <span class="keyword">NULL</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">UNION</span> <span class="keyword">ALL</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">-- 递归查询：下属</span></span><br><span class="line">    <span class="keyword">SELECT</span> e.id, e.name, e.manager_id, eh.level <span class="operator">+</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">FROM</span> employees e</span><br><span class="line">    <span class="keyword">JOIN</span> emp_hierarchy eh <span class="keyword">ON</span> e.manager_id <span class="operator">=</span> eh.id</span><br><span class="line">)</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> emp_hierarchy;</span><br></pre></td></tr></table></figure>

<h3 id="5-4-自连接其他应用"><a href="#5-4-自连接其他应用" class="headerlink" title="5.4 自连接其他应用"></a>5.4 自连接其他应用</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 查询同一部门的员工对</span></span><br><span class="line"><span class="keyword">SELECT</span> e1.name <span class="keyword">AS</span> 员工 <span class="number">1</span>, e2.name <span class="keyword">AS</span> 员工 <span class="number">2</span>, e1.dept_id</span><br><span class="line"><span class="keyword">FROM</span> employees e1</span><br><span class="line"><span class="keyword">JOIN</span> employees e2 <span class="keyword">ON</span> e1.dept_id <span class="operator">=</span> e2.dept_id <span class="keyword">AND</span> e1.id <span class="operator">&lt;</span> e2.id;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询工资比同事高的员工</span></span><br><span class="line"><span class="keyword">SELECT</span> e1.name, e1.salary, e2.name <span class="keyword">AS</span> 同事，e2.salary <span class="keyword">AS</span> 同事工资</span><br><span class="line"><span class="keyword">FROM</span> employees e1</span><br><span class="line"><span class="keyword">JOIN</span> employees e2 <span class="keyword">ON</span> e1.dept_id <span class="operator">=</span> e2.dept_id</span><br><span class="line"><span class="keyword">WHERE</span> e1.salary <span class="operator">&gt;</span> e2.salary <span class="keyword">AND</span> e1.id <span class="operator">!=</span> e2.id;</span><br></pre></td></tr></table></figure>

<h2 id="六、联合查询（UNION）"><a href="#六、联合查询（UNION）" class="headerlink" title="六、联合查询（UNION）"></a>六、联合查询（UNION）</h2><h3 id="6-1-UNION-概述"><a href="#6-1-UNION-概述" class="headerlink" title="6.1 UNION 概述"></a>6.1 UNION 概述</h3><p><strong>UNION</strong> 用于将多个 SELECT 查询的结果合并为一个结果集。</p>
<p><strong>特点</strong>：</p>
<ul>
<li>自动去重（UNION ALL 不去重）</li>
<li>所有查询的列数必须相同</li>
<li>对应列的数据类型必须兼容</li>
</ul>
<h3 id="6-2-UNION-语法"><a href="#6-2-UNION-语法" class="headerlink" title="6.2 UNION 语法"></a>6.2 UNION 语法</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> 列 <span class="number">1</span>, 列 <span class="number">2</span> <span class="keyword">FROM</span> 表 <span class="number">1</span></span><br><span class="line"><span class="keyword">UNION</span> [<span class="keyword">ALL</span>]</span><br><span class="line"><span class="keyword">SELECT</span> 列 <span class="number">1</span>, 列 <span class="number">2</span> <span class="keyword">FROM</span> 表 <span class="number">2</span></span><br><span class="line">[<span class="keyword">UNION</span> [<span class="keyword">ALL</span>]</span><br><span class="line"><span class="keyword">SELECT</span> 列 <span class="number">1</span>, 列 <span class="number">2</span> <span class="keyword">FROM</span> 表 <span class="number">3</span>];</span><br></pre></td></tr></table></figure>

<h3 id="6-3-UNION-示例"><a href="#6-3-UNION-示例" class="headerlink" title="6.3 UNION 示例"></a>6.3 UNION 示例</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- UNION：合并两个查询结果并去重</span></span><br><span class="line"><span class="keyword">SELECT</span> name, dept_id <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> salary <span class="operator">&gt;</span> <span class="number">9000</span></span><br><span class="line"><span class="keyword">UNION</span></span><br><span class="line"><span class="keyword">SELECT</span> name, dept_id <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> dept_id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- UNION ALL：合并但保留重复（性能更好）</span></span><br><span class="line"><span class="keyword">SELECT</span> name <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> gender <span class="operator">=</span> <span class="string">&#x27;男&#x27;</span></span><br><span class="line"><span class="keyword">UNION</span> <span class="keyword">ALL</span></span><br><span class="line"><span class="keyword">SELECT</span> name <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> dept_id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 多个查询合并</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="string">&#x27;高工资&#x27;</span> <span class="keyword">AS</span> 类型，name <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> salary <span class="operator">&gt;</span> <span class="number">9000</span></span><br><span class="line"><span class="keyword">UNION</span> <span class="keyword">ALL</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="string">&#x27;北京部门&#x27;</span> <span class="keyword">AS</span> 类型，name</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">JOIN</span> departments d <span class="keyword">ON</span> e.dept_id <span class="operator">=</span> d.id</span><br><span class="line"><span class="keyword">WHERE</span> d.dept_location <span class="operator">=</span> <span class="string">&#x27;北京&#x27;</span></span><br><span class="line"><span class="keyword">UNION</span> <span class="keyword">ALL</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="string">&#x27;经理&#x27;</span> <span class="keyword">AS</span> 类型，name <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> manager_id <span class="keyword">IS</span> <span class="keyword">NULL</span>;</span><br></pre></td></tr></table></figure>

<h3 id="6-4-UNION-vs-OR"><a href="#6-4-UNION-vs-OR" class="headerlink" title="6.4 UNION vs OR"></a>6.4 UNION vs OR</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 使用 UNION（推荐，可以利用索引）</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> dept_id <span class="operator">=</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">UNION</span> <span class="keyword">ALL</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> dept_id <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 使用 OR（可能影响索引使用）</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> dept_id <span class="operator">=</span> <span class="number">1</span> <span class="keyword">OR</span> dept_id <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- UNION 适用场景：</span></span><br><span class="line"><span class="comment">-- 1. 查询不同表的数据合并</span></span><br><span class="line"><span class="comment">-- 2. 复杂 OR 条件优化</span></span><br></pre></td></tr></table></figure>

<h3 id="6-5-UNION-排序和分页"><a href="#6-5-UNION-排序和分页" class="headerlink" title="6.5 UNION 排序和分页"></a>6.5 UNION 排序和分页</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- UNION 后排序（对整个结果集排序）</span></span><br><span class="line">(<span class="keyword">SELECT</span> name, salary <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> dept_id <span class="operator">=</span> <span class="number">1</span>)</span><br><span class="line"><span class="keyword">UNION</span> <span class="keyword">ALL</span></span><br><span class="line">(<span class="keyword">SELECT</span> name, salary <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> dept_id <span class="operator">=</span> <span class="number">2</span>)</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> salary <span class="keyword">DESC</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- UNION 后分页</span></span><br><span class="line">(<span class="keyword">SELECT</span> name, salary <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> dept_id <span class="operator">=</span> <span class="number">1</span>)</span><br><span class="line"><span class="keyword">UNION</span> <span class="keyword">ALL</span></span><br><span class="line">(<span class="keyword">SELECT</span> name, salary <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> dept_id <span class="operator">=</span> <span class="number">2</span>)</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> salary <span class="keyword">DESC</span></span><br><span class="line">LIMIT <span class="number">5</span>, <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 注意：每个 SELECT 单独加 ORDER BY 需要使用括号</span></span><br><span class="line">(<span class="keyword">SELECT</span> name, salary <span class="keyword">FROM</span> employees <span class="keyword">ORDER</span> <span class="keyword">BY</span> salary <span class="keyword">DESC</span> LIMIT <span class="number">3</span>)</span><br><span class="line"><span class="keyword">UNION</span> <span class="keyword">ALL</span></span><br><span class="line">(<span class="keyword">SELECT</span> name, salary <span class="keyword">FROM</span> employees <span class="keyword">ORDER</span> <span class="keyword">BY</span> salary <span class="keyword">ASC</span> LIMIT <span class="number">3</span>);</span><br></pre></td></tr></table></figure>

<h2 id="七、子查询介绍"><a href="#七、子查询介绍" class="headerlink" title="七、子查询介绍"></a>七、子查询介绍</h2><h3 id="7-1-子查询概述"><a href="#7-1-子查询概述" class="headerlink" title="7.1 子查询概述"></a>7.1 子查询概述</h3><p><strong>子查询</strong> 是嵌套在其他 SQL 语句中的 SELECT 查询。</p>
<p><strong>子查询的位置</strong>：</p>
<ul>
<li>WHERE 子句中</li>
<li>FROM 子句中</li>
<li>SELECT 子句中</li>
<li>HAVING 子句中</li>
</ul>
<p><strong>子查询的分类</strong>：</p>
<ul>
<li>标量子查询：返回单个值</li>
<li>列子查询：返回单列多行</li>
<li>行子查询：返回单行多列</li>
<li>表子查询：返回多行多列</li>
</ul>
<h3 id="7-2-子查询基本语法"><a href="#7-2-子查询基本语法" class="headerlink" title="7.2 子查询基本语法"></a>7.2 子查询基本语法</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- WHERE 子句中的子查询</span></span><br><span class="line"><span class="keyword">SELECT</span> name <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> salary <span class="operator">&gt;</span> (<span class="keyword">SELECT</span> <span class="built_in">AVG</span>(salary) <span class="keyword">FROM</span> employees);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- FROM 子句中的子查询（派生表）</span></span><br><span class="line"><span class="keyword">SELECT</span> dept_name, avg_salary</span><br><span class="line"><span class="keyword">FROM</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> d.dept_name, <span class="built_in">AVG</span>(e.salary) <span class="keyword">AS</span> avg_salary</span><br><span class="line">    <span class="keyword">FROM</span> departments d</span><br><span class="line">    <span class="keyword">JOIN</span> employees e <span class="keyword">ON</span> d.id <span class="operator">=</span> e.dept_id</span><br><span class="line">    <span class="keyword">GROUP</span> <span class="keyword">BY</span> d.id</span><br><span class="line">) <span class="keyword">AS</span> dept_stats;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- SELECT 子句中的子查询（标量）</span></span><br><span class="line"><span class="keyword">SELECT</span> name, salary,</span><br><span class="line">       (<span class="keyword">SELECT</span> <span class="built_in">AVG</span>(salary) <span class="keyword">FROM</span> employees) <span class="keyword">AS</span> 公司平均工资</span><br><span class="line"><span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>

<h2 id="八、标量子查询"><a href="#八、标量子查询" class="headerlink" title="八、标量子查询"></a>八、标量子查询</h2><h3 id="8-1-标量子查询概述"><a href="#8-1-标量子查询概述" class="headerlink" title="8.1 标量子查询概述"></a>8.1 标量子查询概述</h3><p><strong>标量子查询</strong> 返回单个值（一行一列），通常用于比较。</p>
<h3 id="8-2-标量子查询示例"><a href="#8-2-标量子查询示例" class="headerlink" title="8.2 标量子查询示例"></a>8.2 标量子查询示例</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 查询工资高于平均工资的员工</span></span><br><span class="line"><span class="keyword">SELECT</span> name, salary <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> salary <span class="operator">&gt;</span> (<span class="keyword">SELECT</span> <span class="built_in">AVG</span>(salary) <span class="keyword">FROM</span> employees);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询工资最高的员工</span></span><br><span class="line"><span class="keyword">SELECT</span> name, salary <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> salary <span class="operator">=</span> (<span class="keyword">SELECT</span> <span class="built_in">MAX</span>(salary) <span class="keyword">FROM</span> employees);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询入职最早的员工</span></span><br><span class="line"><span class="keyword">SELECT</span> name, hire_date <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> hire_date <span class="operator">=</span> (<span class="keyword">SELECT</span> <span class="built_in">MIN</span>(hire_date) <span class="keyword">FROM</span> employees);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询低于本部门平均工资的员工</span></span><br><span class="line"><span class="keyword">SELECT</span> e1.name, e1.dept_id, e1.salary</span><br><span class="line"><span class="keyword">FROM</span> employees e1</span><br><span class="line"><span class="keyword">WHERE</span> e1.salary <span class="operator">&lt;</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> <span class="built_in">AVG</span>(e2.salary)</span><br><span class="line">    <span class="keyword">FROM</span> employees e2</span><br><span class="line">    <span class="keyword">WHERE</span> e2.dept_id <span class="operator">=</span> e1.dept_id</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 在 SELECT 中使用标量子查询</span></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    name,</span><br><span class="line">    salary,</span><br><span class="line">    (<span class="keyword">SELECT</span> <span class="built_in">AVG</span>(salary) <span class="keyword">FROM</span> employees) <span class="keyword">AS</span> 公司平均工资，</span><br><span class="line">    (<span class="keyword">SELECT</span> <span class="built_in">AVG</span>(e2.salary) <span class="keyword">FROM</span> employees e2 <span class="keyword">WHERE</span> e2.dept_id <span class="operator">=</span> e.dept_id) <span class="keyword">AS</span> 部门平均工资</span><br><span class="line"><span class="keyword">FROM</span> employees e;</span><br></pre></td></tr></table></figure>

<h2 id="九、列子查询"><a href="#九、列子查询" class="headerlink" title="九、列子查询"></a>九、列子查询</h2><h3 id="9-1-列子查询概述"><a href="#9-1-列子查询概述" class="headerlink" title="9.1 列子查询概述"></a>9.1 列子查询概述</h3><p><strong>列子查询</strong> 返回单列多行，通常与 IN、NOT IN、ANY、ALL 配合使用。</p>
<h3 id="9-2-IN-NOT-IN"><a href="#9-2-IN-NOT-IN" class="headerlink" title="9.2 IN &#x2F; NOT IN"></a>9.2 IN &#x2F; NOT IN</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 查询技术部和市场部的员工</span></span><br><span class="line"><span class="keyword">SELECT</span> name, dept_id <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> dept_id <span class="keyword">IN</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> id <span class="keyword">FROM</span> departments <span class="keyword">WHERE</span> dept_name <span class="keyword">IN</span> (<span class="string">&#x27;技术部&#x27;</span>, <span class="string">&#x27;市场部&#x27;</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询没有员工的部门</span></span><br><span class="line"><span class="keyword">SELECT</span> dept_name <span class="keyword">FROM</span> departments</span><br><span class="line"><span class="keyword">WHERE</span> id <span class="keyword">NOT</span> <span class="keyword">IN</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> dept_id <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> dept_id <span class="keyword">IS</span> <span class="keyword">NOT NULL</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询选了某门课程的学生</span></span><br><span class="line"><span class="keyword">SELECT</span> name <span class="keyword">FROM</span> students</span><br><span class="line"><span class="keyword">WHERE</span> id <span class="keyword">IN</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> student_id <span class="keyword">FROM</span> enrollments <span class="keyword">WHERE</span> course_id <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h3 id="9-3-ANY-SOME"><a href="#9-3-ANY-SOME" class="headerlink" title="9.3 ANY &#x2F; SOME"></a>9.3 ANY &#x2F; SOME</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 查询工资比任一技术部员工高的员工</span></span><br><span class="line"><span class="keyword">SELECT</span> name, salary <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> salary <span class="operator">&gt;</span> <span class="keyword">ANY</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> salary <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> dept_id <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 等价于（使用 MIN）</span></span><br><span class="line"><span class="keyword">SELECT</span> name, salary <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> salary <span class="operator">&gt;</span> (<span class="keyword">SELECT</span> <span class="built_in">MIN</span>(salary) <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> dept_id <span class="operator">=</span> <span class="number">1</span>);</span><br></pre></td></tr></table></figure>

<h3 id="9-4-ALL"><a href="#9-4-ALL" class="headerlink" title="9.4 ALL"></a>9.4 ALL</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 查询工资比所有技术部员工都高的员工</span></span><br><span class="line"><span class="keyword">SELECT</span> name, salary <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> salary <span class="operator">&gt;</span> <span class="keyword">ALL</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> salary <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> dept_id <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 等价于（使用 MAX）</span></span><br><span class="line"><span class="keyword">SELECT</span> name, salary <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> salary <span class="operator">&gt;</span> (<span class="keyword">SELECT</span> <span class="built_in">MAX</span>(salary) <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> dept_id <span class="operator">=</span> <span class="number">1</span>);</span><br></pre></td></tr></table></figure>

<h2 id="十、行子查询"><a href="#十、行子查询" class="headerlink" title="十、行子查询"></a>十、行子查询</h2><h3 id="10-1-行子查询概述"><a href="#10-1-行子查询概述" class="headerlink" title="10.1 行子查询概述"></a>10.1 行子查询概述</h3><p><strong>行子查询</strong> 返回单行多列，可以与行构造符配合使用。</p>
<h3 id="10-2-行子查询示例"><a href="#10-2-行子查询示例" class="headerlink" title="10.2 行子查询示例"></a>10.2 行子查询示例</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 查询工资和部门都与张三相同的员工</span></span><br><span class="line"><span class="keyword">SELECT</span> name, dept_id, salary <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> (salary, dept_id) <span class="operator">=</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> salary, dept_id <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> name <span class="operator">=</span> <span class="string">&#x27;张三&#x27;</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 使用行构造符比较</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> (dept_id, salary) <span class="operator">&gt;</span> (<span class="number">1</span>, <span class="number">8000</span>);  <span class="comment">-- dept_id&gt;1 或 (dept_id=1 且 salary&gt;8000)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询工资最高的前几名员工</span></span><br><span class="line"><span class="keyword">SELECT</span> name, salary <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> (salary, id) <span class="keyword">IN</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> salary, id <span class="keyword">FROM</span> employees <span class="keyword">ORDER</span> <span class="keyword">BY</span> salary <span class="keyword">DESC</span> LIMIT <span class="number">3</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h2 id="十一、表子查询"><a href="#十一、表子查询" class="headerlink" title="十一、表子查询"></a>十一、表子查询</h2><h3 id="11-1-表子查询概述"><a href="#11-1-表子查询概述" class="headerlink" title="11.1 表子查询概述"></a>11.1 表子查询概述</h3><p><strong>表子查询</strong> 返回多行多列，通常用作派生表（FROM 子句中的子查询）。</p>
<h3 id="11-2-FROM-子句中的子查询"><a href="#11-2-FROM-子句中的子查询" class="headerlink" title="11.2 FROM 子句中的子查询"></a>11.2 FROM 子句中的子查询</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 查询各部门平均工资及高于平均工资的员工</span></span><br><span class="line"><span class="keyword">SELECT</span> e.name, e.salary, d.dept_name, d.avg_salary</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">JOIN</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> dept_id, <span class="built_in">AVG</span>(salary) <span class="keyword">AS</span> avg_salary</span><br><span class="line">    <span class="keyword">FROM</span> employees</span><br><span class="line">    <span class="keyword">GROUP</span> <span class="keyword">BY</span> dept_id</span><br><span class="line">) d <span class="keyword">ON</span> e.dept_id <span class="operator">=</span> d.dept_id</span><br><span class="line"><span class="keyword">WHERE</span> e.salary <span class="operator">&gt;</span> d.avg_salary;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询员工数超过 2 人的部门</span></span><br><span class="line"><span class="keyword">SELECT</span> d.dept_name, dept_stats.emp_count</span><br><span class="line"><span class="keyword">FROM</span> departments d</span><br><span class="line"><span class="keyword">JOIN</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> dept_id, <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">AS</span> emp_count</span><br><span class="line">    <span class="keyword">FROM</span> employees</span><br><span class="line">    <span class="keyword">GROUP</span> <span class="keyword">BY</span> dept_id</span><br><span class="line">    <span class="keyword">HAVING</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="operator">&gt;</span> <span class="number">2</span></span><br><span class="line">) dept_stats <span class="keyword">ON</span> d.id <span class="operator">=</span> dept_stats.dept_id;</span><br></pre></td></tr></table></figure>

<h3 id="11-3-相关子查询（EXISTS）"><a href="#11-3-相关子查询（EXISTS）" class="headerlink" title="11.3 相关子查询（EXISTS）"></a>11.3 相关子查询（EXISTS）</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 查询有员工的部门（使用 EXISTS）</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> departments d</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">EXISTS</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> <span class="number">1</span> <span class="keyword">FROM</span> employees e <span class="keyword">WHERE</span> e.dept_id <span class="operator">=</span> d.id</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询没有员工的部门</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> departments d</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> <span class="number">1</span> <span class="keyword">FROM</span> employees e <span class="keyword">WHERE</span> e.dept_id <span class="operator">=</span> d.id</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询至少选了 2 门课的学生</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> students s</span><br><span class="line"><span class="keyword">WHERE</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">FROM</span> enrollments e <span class="keyword">WHERE</span> e.student_id <span class="operator">=</span> s.id</span><br><span class="line">) <span class="operator">&gt;=</span> <span class="number">2</span>;</span><br></pre></td></tr></table></figure>

<h2 id="十二、多表查询综合练习"><a href="#十二、多表查询综合练习" class="headerlink" title="十二、多表查询综合练习"></a>十二、多表查询综合练习</h2><h3 id="练习-1：基础查询"><a href="#练习-1：基础查询" class="headerlink" title="练习 1：基础查询"></a>练习 1：基础查询</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 1. 查询所有员工姓名、工资、部门名称</span></span><br><span class="line"><span class="keyword">SELECT</span> e.name, e.salary, d.dept_name</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> departments d <span class="keyword">ON</span> e.dept_id <span class="operator">=</span> d.id;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 2. 查询北京部门的员工</span></span><br><span class="line"><span class="keyword">SELECT</span> e.name, d.dept_name, d.dept_location</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">JOIN</span> departments d <span class="keyword">ON</span> e.dept_id <span class="operator">=</span> d.id</span><br><span class="line"><span class="keyword">WHERE</span> d.dept_location <span class="operator">=</span> <span class="string">&#x27;北京&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 3. 查询工资高于公司平均工资的员工</span></span><br><span class="line"><span class="keyword">SELECT</span> name, salary</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> salary <span class="operator">&gt;</span> (<span class="keyword">SELECT</span> <span class="built_in">AVG</span>(salary) <span class="keyword">FROM</span> employees);</span><br></pre></td></tr></table></figure>

<h3 id="练习-2：分组统计"><a href="#练习-2：分组统计" class="headerlink" title="练习 2：分组统计"></a>练习 2：分组统计</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 4. 查询各部门人数</span></span><br><span class="line"><span class="keyword">SELECT</span> d.dept_name, <span class="built_in">COUNT</span>(e.id) <span class="keyword">AS</span> emp_count</span><br><span class="line"><span class="keyword">FROM</span> departments d</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> employees e <span class="keyword">ON</span> d.id <span class="operator">=</span> e.dept_id</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> d.id, d.dept_name;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 5. 查询各部门平均工资</span></span><br><span class="line"><span class="keyword">SELECT</span> d.dept_name, ROUND(<span class="built_in">AVG</span>(e.salary), <span class="number">2</span>) <span class="keyword">AS</span> avg_salary</span><br><span class="line"><span class="keyword">FROM</span> departments d</span><br><span class="line"><span class="keyword">JOIN</span> employees e <span class="keyword">ON</span> d.id <span class="operator">=</span> e.dept_id</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> d.id, d.dept_name;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 6. 查询平均工资高于 8000 的部门</span></span><br><span class="line"><span class="keyword">SELECT</span> d.dept_name, ROUND(<span class="built_in">AVG</span>(e.salary), <span class="number">2</span>) <span class="keyword">AS</span> avg_salary</span><br><span class="line"><span class="keyword">FROM</span> departments d</span><br><span class="line"><span class="keyword">JOIN</span> employees e <span class="keyword">ON</span> d.id <span class="operator">=</span> e.dept_id</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> d.id, d.dept_name</span><br><span class="line"><span class="keyword">HAVING</span> <span class="built_in">AVG</span>(e.salary) <span class="operator">&gt;</span> <span class="number">8000</span>;</span><br></pre></td></tr></table></figure>

<h3 id="练习-3：复杂查询"><a href="#练习-3：复杂查询" class="headerlink" title="练习 3：复杂查询"></a>练习 3：复杂查询</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 7. 查询工资最高的前 3 名员工</span></span><br><span class="line"><span class="keyword">SELECT</span> e.name, e.salary, d.dept_name</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">JOIN</span> departments d <span class="keyword">ON</span> e.dept_id <span class="operator">=</span> d.id</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> e.salary <span class="keyword">DESC</span></span><br><span class="line">LIMIT <span class="number">3</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 8. 查询每个部门工资最高的员工</span></span><br><span class="line"><span class="keyword">SELECT</span> e.name, e.dept_id, e.salary</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">WHERE</span> e.salary <span class="operator">=</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> <span class="built_in">MAX</span>(e2.salary)</span><br><span class="line">    <span class="keyword">FROM</span> employees e2</span><br><span class="line">    <span class="keyword">WHERE</span> e2.dept_id <span class="operator">=</span> e.dept_id</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 9. 查询员工及其上级领导（自连接）</span></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    e.name <span class="keyword">AS</span> 员工，</span><br><span class="line">    m.name <span class="keyword">AS</span> 上级领导</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> employees m <span class="keyword">ON</span> e.manager_id <span class="operator">=</span> m.id;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 10. 查询没有下属的领导</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> m.name</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">JOIN</span> employees m <span class="keyword">ON</span> e.manager_id <span class="operator">=</span> m.id</span><br><span class="line"><span class="keyword">WHERE</span> m.id <span class="keyword">NOT</span> <span class="keyword">IN</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> manager_id <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> manager_id <span class="keyword">IS</span> <span class="keyword">NOT NULL</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h2 id="十三、小结"><a href="#十三、小结" class="headerlink" title="十三、小结"></a>十三、小结</h2><h3 id="连接查询总结"><a href="#连接查询总结" class="headerlink" title="连接查询总结"></a>连接查询总结</h3><table>
<thead>
<tr>
<th>连接类型</th>
<th>关键字</th>
<th>返回结果</th>
</tr>
</thead>
<tbody><tr>
<td>内连接</td>
<td>INNER JOIN</td>
<td>只返回匹配记录</td>
</tr>
<tr>
<td>左连接</td>
<td>LEFT JOIN</td>
<td>左表全部 + 右表匹配</td>
</tr>
<tr>
<td>右连接</td>
<td>RIGHT JOIN</td>
<td>右表全部 + 左表匹配</td>
</tr>
<tr>
<td>自连接</td>
<td>表别名</td>
<td>表自己连接自己</td>
</tr>
<tr>
<td>交叉连接</td>
<td>CROSS JOIN</td>
<td>笛卡尔积</td>
</tr>
</tbody></table>
<h3 id="子查询总结"><a href="#子查询总结" class="headerlink" title="子查询总结"></a>子查询总结</h3><table>
<thead>
<tr>
<th>子查询类型</th>
<th>返回值</th>
<th>常用位置</th>
</tr>
</thead>
<tbody><tr>
<td>标量子查询</td>
<td>单个值</td>
<td>WHERE、SELECT</td>
</tr>
<tr>
<td>列子查询</td>
<td>单列多行</td>
<td>WHERE (IN&#x2F;NOT IN)</td>
</tr>
<tr>
<td>行子查询</td>
<td>单行多列</td>
<td>WHERE</td>
</tr>
<tr>
<td>表子查询</td>
<td>多行多列</td>
<td>FROM</td>
</tr>
</tbody></table>
<h3 id="最佳实践"><a href="#最佳实践" class="headerlink" title="最佳实践"></a>最佳实践</h3><ol>
<li><strong>优先使用连接</strong>：大多数子查询可以用连接改写</li>
<li><strong>EXISTS vs IN</strong>： EXISTS 通常在子查询结果集大时性能更好</li>
<li>**避免 SELECT ***：只选择需要的列</li>
<li><strong>使用表别名</strong>：简化 SQL 语句</li>
<li><strong>注意 NULL 值</strong>：NOT IN 遇到 NULL 可能返回空结果</li>
</ol>
<hr>
<p><strong>下一篇</strong>：[MySQL 进阶教程（四）：事务详解](&#x2F;2026&#x2F;02&#x2F;23&#x2F;MySQL 进阶教程（四）事务详解&#x2F;)</p>
<p><strong>上一篇</strong>：[MySQL 进阶教程（二）：数据库约束详解](&#x2F;2026&#x2F;02&#x2F;23&#x2F;MySQL 进阶教程（二）数据库约束详解&#x2F;)</p>
]]></content>
      <categories>
        <category>MySQL 进阶教程</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
        <tag>多表查询</tag>
        <tag>连接查询</tag>
        <tag>子查询</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQL 进阶教程（二）数据库约束详解</title>
    <url>/2026/02/23/MySQL%20%E8%BF%9B%E9%98%B6%E6%95%99%E7%A8%8B%EF%BC%88%E4%BA%8C%EF%BC%89%E6%95%B0%E6%8D%AE%E5%BA%93%E7%BA%A6%E6%9D%9F%E8%AF%A6%E8%A7%A3/</url>
    <content><![CDATA[<h1 id="MySQL-进阶教程（二）数据库约束详解"><a href="#MySQL-进阶教程（二）数据库约束详解" class="headerlink" title="MySQL 进阶教程（二）数据库约束详解"></a>MySQL 进阶教程（二）数据库约束详解</h1><p>数据库约束用于保证数据的完整性、一致性和有效性。本文将详细讲解 MySQL 中的各种约束类型及其使用方法。</p>
<h2 id="一、约束概述"><a href="#一、约束概述" class="headerlink" title="一、约束概述"></a>一、约束概述</h2><h3 id="1-1-什么是约束？"><a href="#1-1-什么是约束？" class="headerlink" title="1.1 什么是约束？"></a>1.1 什么是约束？</h3><p><strong>约束（Constraint）</strong> 是施加在数据库表上的规则，用于限制可以存储在表中的数据，确保数据的准确性和可靠性。</p>
<h3 id="1-2-约束的作用"><a href="#1-2-约束的作用" class="headerlink" title="1.2 约束的作用"></a>1.2 约束的作用</h3><ol>
<li><strong>保证数据完整性</strong>：防止无效或不一致的数据</li>
<li><strong>维护数据一致性</strong>：确保相关表之间的数据关系正确</li>
<li><strong>提高数据质量</strong>：强制执行业务规则</li>
<li><strong>减少应用层验证</strong>：在数据库层面进行数据验证</li>
</ol>
<h3 id="1-3-约束的分类"><a href="#1-3-约束的分类" class="headerlink" title="1.3 约束的分类"></a>1.3 约束的分类</h3><table>
<thead>
<tr>
<th>约束类型</th>
<th>关键字</th>
<th>说明</th>
<th>列级&#x2F;表级</th>
</tr>
</thead>
<tbody><tr>
<td>主键约束</td>
<td>PRIMARY KEY</td>
<td>唯一标识每条记录</td>
<td>两者</td>
</tr>
<tr>
<td>外键约束</td>
<td>FOREIGN KEY</td>
<td>建立表与表之间的关系</td>
<td>表级</td>
</tr>
<tr>
<td>唯一约束</td>
<td>UNIQUE</td>
<td>列值必须唯一</td>
<td>两者</td>
</tr>
<tr>
<td>非空约束</td>
<td>NOT NULL</td>
<td>列值不能为空</td>
<td>列级</td>
</tr>
<tr>
<td>默认约束</td>
<td>DEFAULT</td>
<td>列的默认值</td>
<td>列级</td>
</tr>
<tr>
<td>检查约束</td>
<td>CHECK</td>
<td>满足指定条件</td>
<td>表级</td>
</tr>
</tbody></table>
<h3 id="1-4-约束的定义时机"><a href="#1-4-约束的定义时机" class="headerlink" title="1.4 约束的定义时机"></a>1.4 约束的定义时机</h3><ul>
<li><strong>列级约束</strong>：在定义列时指定，直接跟在列名后面</li>
<li><strong>表级约束</strong>：在所有列定义完成后，在表末尾指定</li>
</ul>
<h2 id="二、约束演示"><a href="#二、约束演示" class="headerlink" title="二、约束演示"></a>二、约束演示</h2><h3 id="2-1-创建表时添加约束"><a href="#2-1-创建表时添加约束" class="headerlink" title="2.1 创建表时添加约束"></a>2.1 创建表时添加约束</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 完整示例：员工表</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> employees (</span><br><span class="line">    <span class="comment">-- 主键约束</span></span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;员工 ID&#x27;</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment">-- 非空约束</span></span><br><span class="line">    emp_no <span class="type">VARCHAR</span>(<span class="number">20</span>) <span class="keyword">NOT NULL</span> COMMENT <span class="string">&#x27;员工编号&#x27;</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment">-- 非空 + 唯一约束</span></span><br><span class="line">    name <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">NOT NULL</span> COMMENT <span class="string">&#x27;姓名&#x27;</span>,</span><br><span class="line">    email <span class="type">VARCHAR</span>(<span class="number">100</span>) <span class="keyword">UNIQUE</span> COMMENT <span class="string">&#x27;邮箱&#x27;</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment">-- 默认约束</span></span><br><span class="line">    gender ENUM(<span class="string">&#x27;男&#x27;</span>, <span class="string">&#x27;女&#x27;</span>) <span class="keyword">DEFAULT</span> <span class="string">&#x27;男&#x27;</span> COMMENT <span class="string">&#x27;性别&#x27;</span>,</span><br><span class="line">    status TINYINT <span class="keyword">DEFAULT</span> <span class="number">1</span> COMMENT <span class="string">&#x27;状态：1 在职 0 离职&#x27;</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment">-- 检查约束（MySQL 8.0.16+ 支持）</span></span><br><span class="line">    age TINYINT <span class="keyword">CHECK</span> (age <span class="operator">&gt;=</span> <span class="number">18</span> <span class="keyword">AND</span> age <span class="operator">&lt;=</span> <span class="number">65</span>) COMMENT <span class="string">&#x27;年龄&#x27;</span>,</span><br><span class="line">    salary <span class="type">DECIMAL</span>(<span class="number">10</span>, <span class="number">2</span>) <span class="keyword">CHECK</span> (salary <span class="operator">&gt;=</span> <span class="number">0</span>) COMMENT <span class="string">&#x27;工资&#x27;</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment">-- 日期约束</span></span><br><span class="line">    hire_date <span class="type">DATE</span> <span class="keyword">NOT NULL</span> COMMENT <span class="string">&#x27;入职日期&#x27;</span></span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4 COMMENT<span class="operator">=</span><span class="string">&#x27;员工表&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h3 id="2-2-表级约束语法"><a href="#2-2-表级约束语法" class="headerlink" title="2.2 表级约束语法"></a>2.2 表级约束语法</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> employees (</span><br><span class="line">    id <span class="type">INT</span> AUTO_INCREMENT,</span><br><span class="line">    emp_no <span class="type">VARCHAR</span>(<span class="number">20</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">    name <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">    email <span class="type">VARCHAR</span>(<span class="number">100</span>),</span><br><span class="line">    dept_id <span class="type">INT</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment">-- 表级约束（使用 CONSTRAINT 命名）</span></span><br><span class="line">    <span class="keyword">CONSTRAINT</span> pk_employees <span class="keyword">PRIMARY KEY</span> (id),</span><br><span class="line">    <span class="keyword">CONSTRAINT</span> uk_employees_emp_no <span class="keyword">UNIQUE</span> (emp_no),</span><br><span class="line">    <span class="keyword">CONSTRAINT</span> uk_employees_email <span class="keyword">UNIQUE</span> (email),</span><br><span class="line">    <span class="keyword">CONSTRAINT</span> chk_employees_age <span class="keyword">CHECK</span> (age <span class="operator">&gt;=</span> <span class="number">18</span> <span class="keyword">AND</span> age <span class="operator">&lt;=</span> <span class="number">65</span>),</span><br><span class="line">    <span class="keyword">CONSTRAINT</span> chk_employees_salary <span class="keyword">CHECK</span> (salary <span class="operator">&gt;=</span> <span class="number">0</span>)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4;</span><br></pre></td></tr></table></figure>

<p><strong>约束命名规范</strong>：</p>
<ul>
<li>主键约束：<code>pk_表名</code> 或 <code>pk_表名_列名</code></li>
<li>外键约束：<code>fk_表名_关联表名</code> 或 <code>fk_表名_列名</code></li>
<li>唯一约束：<code>uk_表名_列名</code></li>
<li>检查约束：<code>chk_表名_列名</code></li>
</ul>
<h3 id="2-3-修改表添加约束"><a href="#2-3-修改表添加约束" class="headerlink" title="2.3 修改表添加约束"></a>2.3 修改表添加约束</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 添加主键约束</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> employees <span class="keyword">ADD</span> <span class="keyword">PRIMARY KEY</span> (id);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 添加唯一约束</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> employees <span class="keyword">ADD</span> <span class="keyword">UNIQUE</span> (emp_no);</span><br><span class="line"><span class="keyword">ALTER TABLE</span> employees <span class="keyword">ADD CONSTRAINT</span> uk_email <span class="keyword">UNIQUE</span> (email);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 添加非空约束</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> employees MODIFY <span class="keyword">COLUMN</span> name <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">NOT NULL</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 添加默认约束</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> employees <span class="keyword">ALTER</span> <span class="keyword">COLUMN</span> status <span class="keyword">SET</span> <span class="keyword">DEFAULT</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">ALTER TABLE</span> employees <span class="keyword">ALTER</span> <span class="keyword">COLUMN</span> status <span class="keyword">DROP</span> <span class="keyword">DEFAULT</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 添加检查约束（MySQL 8.0.16+）</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> employees <span class="keyword">ADD CONSTRAINT</span> chk_age <span class="keyword">CHECK</span> (age <span class="operator">&gt;=</span> <span class="number">18</span> <span class="keyword">AND</span> age <span class="operator">&lt;=</span> <span class="number">65</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 删除约束</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> employees <span class="keyword">DROP</span> <span class="keyword">PRIMARY KEY</span>;</span><br><span class="line"><span class="keyword">ALTER TABLE</span> employees <span class="keyword">DROP</span> INDEX uk_email;</span><br><span class="line"><span class="keyword">ALTER TABLE</span> employees <span class="keyword">DROP</span> <span class="keyword">CHECK</span> chk_age;</span><br></pre></td></tr></table></figure>

<h3 id="2-4-查看约束信息"><a href="#2-4-查看约束信息" class="headerlink" title="2.4 查看约束信息"></a>2.4 查看约束信息</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 查看表结构（显示约束）</span></span><br><span class="line"><span class="keyword">DESC</span> employees;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看详细表结构</span></span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">CREATE TABLE</span> employees;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看表的所有约束</span></span><br><span class="line"><span class="keyword">SELECT</span> CONSTRAINT_NAME, CONSTRAINT_TYPE, TABLE_NAME</span><br><span class="line"><span class="keyword">FROM</span> information_schema.TABLE_CONSTRAINTS</span><br><span class="line"><span class="keyword">WHERE</span> TABLE_SCHEMA <span class="operator">=</span> <span class="string">&#x27;your_database&#x27;</span> <span class="keyword">AND</span> TABLE_NAME <span class="operator">=</span> <span class="string">&#x27;employees&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看外键约束</span></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    CONSTRAINT_NAME,</span><br><span class="line">    TABLE_NAME,</span><br><span class="line">    COLUMN_NAME,</span><br><span class="line">    REFERENCED_TABLE_NAME,</span><br><span class="line">    REFERENCED_COLUMN_NAME</span><br><span class="line"><span class="keyword">FROM</span> information_schema.KEY_COLUMN_USAGE</span><br><span class="line"><span class="keyword">WHERE</span> TABLE_SCHEMA <span class="operator">=</span> <span class="string">&#x27;your_database&#x27;</span> <span class="keyword">AND</span> TABLE_NAME <span class="operator">=</span> <span class="string">&#x27;employees&#x27;</span></span><br><span class="line"><span class="keyword">AND</span> REFERENCED_TABLE_NAME <span class="keyword">IS</span> <span class="keyword">NOT NULL</span>;</span><br></pre></td></tr></table></figure>

<h2 id="三、主键约束（PRIMARY-KEY）"><a href="#三、主键约束（PRIMARY-KEY）" class="headerlink" title="三、主键约束（PRIMARY KEY）"></a>三、主键约束（PRIMARY KEY）</h2><h3 id="3-1-主键的特点"><a href="#3-1-主键的特点" class="headerlink" title="3.1 主键的特点"></a>3.1 主键的特点</h3><ol>
<li><strong>唯一性</strong>：主键值必须唯一</li>
<li><strong>非空性</strong>：主键值不能为 NULL</li>
<li><strong>单一性</strong>：一张表只能有一个主键</li>
<li><strong>可组合</strong>：主键可以由多列组成（复合主键）</li>
</ol>
<h3 id="3-2-创建主键"><a href="#3-2-创建主键" class="headerlink" title="3.2 创建主键"></a>3.2 创建主键</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 单列主键</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> users (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span>,</span><br><span class="line">    name <span class="type">VARCHAR</span>(<span class="number">50</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 使用 CONSTRAINT 命名</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> users (</span><br><span class="line">    id <span class="type">INT</span>,</span><br><span class="line">    name <span class="type">VARCHAR</span>(<span class="number">50</span>),</span><br><span class="line">    <span class="keyword">CONSTRAINT</span> pk_users <span class="keyword">PRIMARY KEY</span> (id)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 复合主键（不推荐，建议使用单列主键）</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> order_items (</span><br><span class="line">    order_id <span class="type">INT</span>,</span><br><span class="line">    product_id <span class="type">INT</span>,</span><br><span class="line">    quantity <span class="type">INT</span>,</span><br><span class="line">    <span class="keyword">PRIMARY KEY</span> (order_id, product_id)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 自增主键（最常用）</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> users (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT,</span><br><span class="line">    name <span class="type">VARCHAR</span>(<span class="number">50</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h3 id="3-3-修改主键"><a href="#3-3-修改主键" class="headerlink" title="3.3 修改主键"></a>3.3 修改主键</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 添加主键</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> users <span class="keyword">ADD</span> <span class="keyword">PRIMARY KEY</span> (id);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 删除主键</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> users <span class="keyword">DROP</span> <span class="keyword">PRIMARY KEY</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 修改主键（先删除再添加）</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> users <span class="keyword">DROP</span> <span class="keyword">PRIMARY KEY</span>;</span><br><span class="line"><span class="keyword">ALTER TABLE</span> users <span class="keyword">ADD</span> <span class="keyword">PRIMARY KEY</span> (new_id);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 修改为复合主键</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> order_items</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">PRIMARY KEY</span>,</span><br><span class="line"><span class="keyword">ADD</span> <span class="keyword">PRIMARY KEY</span> (order_id, product_id);</span><br></pre></td></tr></table></figure>

<h3 id="3-4-主键选择建议"><a href="#3-4-主键选择建议" class="headerlink" title="3.4 主键选择建议"></a>3.4 主键选择建议</h3><ol>
<li><strong>使用无业务意义的列</strong>：如自增 ID、UUID</li>
<li><strong>避免使用业务字段</strong>：如身份证号、手机号可能变化</li>
<li><strong>优先使用单列主键</strong>：简化外键引用</li>
<li><strong>避免使用过长主键</strong>：影响索引性能</li>
</ol>
<h2 id="四、唯一约束（UNIQUE）"><a href="#四、唯一约束（UNIQUE）" class="headerlink" title="四、唯一约束（UNIQUE）"></a>四、唯一约束（UNIQUE）</h2><h3 id="4-1-唯一约束的特点"><a href="#4-1-唯一约束的特点" class="headerlink" title="4.1 唯一约束的特点"></a>4.1 唯一约束的特点</h3><ol>
<li><strong>唯一性</strong>：列值必须唯一</li>
<li><strong>允许 NULL</strong>：可以有多个 NULL 值（但有些数据库只允许一个）</li>
<li><strong>多列唯一</strong>：可以创建复合唯一索引</li>
</ol>
<h3 id="4-2-创建唯一约束"><a href="#4-2-创建唯一约束" class="headerlink" title="4.2 创建唯一约束"></a>4.2 创建唯一约束</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 列级唯一约束</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> users (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span>,</span><br><span class="line">    username <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">UNIQUE</span>,</span><br><span class="line">    email <span class="type">VARCHAR</span>(<span class="number">100</span>) <span class="keyword">UNIQUE</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 表级唯一约束</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> users (</span><br><span class="line">    id <span class="type">INT</span>,</span><br><span class="line">    username <span class="type">VARCHAR</span>(<span class="number">50</span>),</span><br><span class="line">    email <span class="type">VARCHAR</span>(<span class="number">100</span>),</span><br><span class="line">    <span class="keyword">UNIQUE</span> (username),</span><br><span class="line">    <span class="keyword">UNIQUE</span> (email)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 命名唯一约束</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> users (</span><br><span class="line">    id <span class="type">INT</span>,</span><br><span class="line">    username <span class="type">VARCHAR</span>(<span class="number">50</span>),</span><br><span class="line">    email <span class="type">VARCHAR</span>(<span class="number">100</span>),</span><br><span class="line">    <span class="keyword">CONSTRAINT</span> uk_username <span class="keyword">UNIQUE</span> (username),</span><br><span class="line">    <span class="keyword">CONSTRAINT</span> uk_email <span class="keyword">UNIQUE</span> (email)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 复合唯一约束（多列组合唯一）</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> user_roles (</span><br><span class="line">    user_id <span class="type">INT</span>,</span><br><span class="line">    role_id <span class="type">INT</span>,</span><br><span class="line">    <span class="keyword">CONSTRAINT</span> uk_user_role <span class="keyword">UNIQUE</span> (user_id, role_id)</span><br><span class="line">);</span><br><span class="line"><span class="comment">-- 同一个用户不能有相同的角色，但不同用户可以有相同角色</span></span><br></pre></td></tr></table></figure>

<h3 id="4-3-唯一约束与主键的区别"><a href="#4-3-唯一约束与主键的区别" class="headerlink" title="4.3 唯一约束与主键的区别"></a>4.3 唯一约束与主键的区别</h3><table>
<thead>
<tr>
<th>对比项</th>
<th>主键约束</th>
<th>唯一约束</th>
</tr>
</thead>
<tbody><tr>
<td>NULL 值</td>
<td>不允许</td>
<td>允许（可以有多个 NULL）</td>
</tr>
<tr>
<td>数量</td>
<td>一张表只能有一个</td>
<td>一张表可以有多个</td>
</tr>
<tr>
<td>索引类型</td>
<td>创建聚簇索引（InnoDB）</td>
<td>创建唯一索引</td>
</tr>
<tr>
<td>用途</td>
<td>唯一标识记录</td>
<td>保证列值唯一</td>
</tr>
</tbody></table>
<h2 id="五、非空约束（NOT-NULL）"><a href="#五、非空约束（NOT-NULL）" class="headerlink" title="五、非空约束（NOT NULL）"></a>五、非空约束（NOT NULL）</h2><h3 id="5-1-非空约束的特点"><a href="#5-1-非空约束的特点" class="headerlink" title="5.1 非空约束的特点"></a>5.1 非空约束的特点</h3><ul>
<li>列值不能为 NULL</li>
<li>只能在列级定义，不能在表级定义</li>
<li>插入或更新时必须提供值</li>
</ul>
<h3 id="5-2-创建非空约束"><a href="#5-2-创建非空约束" class="headerlink" title="5.2 创建非空约束"></a>5.2 创建非空约束</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 创建时指定非空</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> users (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span>,</span><br><span class="line">    username <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">    email <span class="type">VARCHAR</span>(<span class="number">100</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">    phone <span class="type">VARCHAR</span>(<span class="number">20</span>),  <span class="comment">-- 允许 NULL</span></span><br><span class="line">    age <span class="type">INT</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 修改为非空</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> users MODIFY <span class="keyword">COLUMN</span> age <span class="type">INT</span> <span class="keyword">NOT NULL</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 修改为允许 NULL</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> users MODIFY <span class="keyword">COLUMN</span> age <span class="type">INT</span>;</span><br></pre></td></tr></table></figure>

<h3 id="5-3-非空约束实战"><a href="#5-3-非空约束实战" class="headerlink" title="5.3 非空约束实战"></a>5.3 非空约束实战</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 尝试插入 NULL 值（会报错）</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> users (id, username) <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="keyword">NULL</span>);</span><br><span class="line"><span class="comment">-- ERROR: Column &#x27;username&#x27; cannot be null</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 正确插入</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> users (id, username, email) <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="string">&#x27;john&#x27;</span>, <span class="string">&#x27;john@example.com&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 使用 IFNULL 处理可能为 NULL 的查询</span></span><br><span class="line"><span class="keyword">SELECT</span> username, IFNULL(phone, <span class="string">&#x27;未填写&#x27;</span>) <span class="keyword">AS</span> phone <span class="keyword">FROM</span> users;</span><br></pre></td></tr></table></figure>

<h2 id="六、默认约束（DEFAULT）"><a href="#六、默认约束（DEFAULT）" class="headerlink" title="六、默认约束（DEFAULT）"></a>六、默认约束（DEFAULT）</h2><h3 id="6-1-默认约束的特点"><a href="#6-1-默认约束的特点" class="headerlink" title="6.1 默认约束的特点"></a>6.1 默认约束的特点</h3><ul>
<li>插入数据时如果不指定该列，则使用默认值</li>
<li>默认值可以是常量、表达式或函数</li>
</ul>
<h3 id="6-2-创建默认约束"><a href="#6-2-创建默认约束" class="headerlink" title="6.2 创建默认约束"></a>6.2 创建默认约束</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> users (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span>,</span><br><span class="line">    username <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment">-- 常量默认值</span></span><br><span class="line">    status TINYINT <span class="keyword">DEFAULT</span> <span class="number">1</span>,</span><br><span class="line">    gender ENUM(<span class="string">&#x27;男&#x27;</span>, <span class="string">&#x27;女&#x27;</span>) <span class="keyword">DEFAULT</span> <span class="string">&#x27;男&#x27;</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment">-- 函数默认值</span></span><br><span class="line">    create_time DATETIME <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span>,</span><br><span class="line">    update_time DATETIME <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> <span class="keyword">ON</span> <span class="keyword">UPDATE</span> <span class="built_in">CURRENT_TIMESTAMP</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment">-- NULL 默认值（显式指定）</span></span><br><span class="line">    remark <span class="type">VARCHAR</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h3 id="6-3-默认约束实战"><a href="#6-3-默认约束实战" class="headerlink" title="6.3 默认约束实战"></a>6.3 默认约束实战</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 使用默认值插入</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> users (id, username) <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="string">&#x27;john&#x27;</span>);</span><br><span class="line"><span class="comment">-- status=1, gender=&#x27;男&#x27;, create_time=当前时间</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 显式指定值</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> users (id, username, status, gender)</span><br><span class="line"><span class="keyword">VALUES</span> (<span class="number">2</span>, <span class="string">&#x27;jane&#x27;</span>, <span class="number">0</span>, <span class="string">&#x27;女&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 使用 DEFAULT 关键字显式使用默认值</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> users (id, username, status)</span><br><span class="line"><span class="keyword">VALUES</span> (<span class="number">3</span>, <span class="string">&#x27;bob&#x27;</span>, <span class="keyword">DEFAULT</span>);</span><br></pre></td></tr></table></figure>

<h3 id="6-4-修改默认约束"><a href="#6-4-修改默认约束" class="headerlink" title="6.4 修改默认约束"></a>6.4 修改默认约束</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 添加默认约束</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> users <span class="keyword">ALTER</span> <span class="keyword">COLUMN</span> status <span class="keyword">SET</span> <span class="keyword">DEFAULT</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 删除默认约束</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> users <span class="keyword">ALTER</span> <span class="keyword">COLUMN</span> status <span class="keyword">DROP</span> <span class="keyword">DEFAULT</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 修改默认值（先删除再添加）</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> users <span class="keyword">ALTER</span> <span class="keyword">COLUMN</span> status <span class="keyword">DROP</span> <span class="keyword">DEFAULT</span>;</span><br><span class="line"><span class="keyword">ALTER TABLE</span> users <span class="keyword">ALTER</span> <span class="keyword">COLUMN</span> status <span class="keyword">SET</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>;</span><br></pre></td></tr></table></figure>

<h2 id="七、检查约束（CHECK）"><a href="#七、检查约束（CHECK）" class="headerlink" title="七、检查约束（CHECK）"></a>七、检查约束（CHECK）</h2><h3 id="7-1-检查约束的特点"><a href="#7-1-检查约束的特点" class="headerlink" title="7.1 检查约束的特点"></a>7.1 检查约束的特点</h3><ul>
<li><strong>MySQL 8.0.16+</strong> 才开始支持 CHECK 约束</li>
<li>旧版本会忽略 CHECK 约束（不报错但不生效）</li>
<li>用于确保列值满足特定条件</li>
</ul>
<h3 id="7-2-创建检查约束"><a href="#7-2-创建检查约束" class="headerlink" title="7.2 创建检查约束"></a>7.2 创建检查约束</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 创建时添加检查约束</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> employees (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span>,</span><br><span class="line">    name <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">    age <span class="type">INT</span> <span class="keyword">CHECK</span> (age <span class="operator">&gt;=</span> <span class="number">18</span> <span class="keyword">AND</span> age <span class="operator">&lt;=</span> <span class="number">65</span>),</span><br><span class="line">    salary <span class="type">DECIMAL</span>(<span class="number">10</span>, <span class="number">2</span>) <span class="keyword">CHECK</span> (salary <span class="operator">&gt;=</span> <span class="number">0</span>),</span><br><span class="line">    gender ENUM(<span class="string">&#x27;男&#x27;</span>, <span class="string">&#x27;女&#x27;</span>),</span><br><span class="line">    hire_date <span class="type">DATE</span>,</span><br><span class="line">    <span class="keyword">CONSTRAINT</span> chk_hire_date <span class="keyword">CHECK</span> (hire_date <span class="operator">&lt;=</span> CURDATE())</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 使用多条件检查约束</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> orders (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span>,</span><br><span class="line">    amount <span class="type">DECIMAL</span>(<span class="number">10</span>, <span class="number">2</span>) <span class="keyword">CHECK</span> (amount <span class="operator">&gt;</span> <span class="number">0</span>),</span><br><span class="line">    status <span class="type">VARCHAR</span>(<span class="number">20</span>) <span class="keyword">CHECK</span> (status <span class="keyword">IN</span> (<span class="string">&#x27;PENDING&#x27;</span>, <span class="string">&#x27;PAID&#x27;</span>, <span class="string">&#x27;SHIPPED&#x27;</span>, <span class="string">&#x27;CANCELLED&#x27;</span>)),</span><br><span class="line">    discount <span class="type">DECIMAL</span>(<span class="number">5</span>, <span class="number">2</span>) <span class="keyword">CHECK</span> (discount <span class="operator">&gt;=</span> <span class="number">0</span> <span class="keyword">AND</span> discount <span class="operator">&lt;=</span> <span class="number">100</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h3 id="7-3-修改检查约束"><a href="#7-3-修改检查约束" class="headerlink" title="7.3 修改检查约束"></a>7.3 修改检查约束</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 添加检查约束</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> employees</span><br><span class="line"><span class="keyword">ADD CONSTRAINT</span> chk_age <span class="keyword">CHECK</span> (age <span class="operator">&gt;=</span> <span class="number">18</span> <span class="keyword">AND</span> age <span class="operator">&lt;=</span> <span class="number">65</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 删除检查约束</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> employees</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">CHECK</span> chk_age;</span><br></pre></td></tr></table></figure>

<h3 id="7-4-检查约束实战"><a href="#7-4-检查约束实战" class="headerlink" title="7.4 检查约束实战"></a>7.4 检查约束实战</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 尝试插入违反约束的数据（会报错）</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> employees (id, name, age, salary) <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="string">&#x27;张三&#x27;</span>, <span class="number">17</span>, <span class="number">8000</span>);</span><br><span class="line"><span class="comment">-- ERROR: CHECK constraint &#x27;chk_age&#x27; is violated</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT INTO</span> employees (id, name, age, salary) <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="string">&#x27;张三&#x27;</span>, <span class="number">30</span>, <span class="number">-5000</span>);</span><br><span class="line"><span class="comment">-- ERROR: CHECK constraint &#x27;chk_salary&#x27; is violated</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 正确插入</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> employees (id, name, age, salary) <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="string">&#x27;张三&#x27;</span>, <span class="number">30</span>, <span class="number">8000</span>);</span><br></pre></td></tr></table></figure>

<h2 id="八、外键约束（FOREIGN-KEY）"><a href="#八、外键约束（FOREIGN-KEY）" class="headerlink" title="八、外键约束（FOREIGN KEY）"></a>八、外键约束（FOREIGN KEY）</h2><h3 id="8-1-外键概述"><a href="#8-1-外键概述" class="headerlink" title="8.1 外键概述"></a>8.1 外键概述</h3><p><strong>外键（Foreign Key）</strong> 用于建立两个表之间的链接，保证数据的参照完整性。</p>
<p><strong>外键的特点</strong>：</p>
<ol>
<li>外键列的值必须存在于被引用表的主键列中，或者为 NULL</li>
<li>外键约束可以防止无效的数据插入</li>
<li>外键约束可以级联更新和删除</li>
</ol>
<h3 id="8-2-创建外键约束"><a href="#8-2-创建外键约束" class="headerlink" title="8.2 创建外键约束"></a>8.2 创建外键约束</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 创建部门表</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> departments (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT,</span><br><span class="line">    dept_name <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">NOT NULL</span> <span class="keyword">UNIQUE</span>,</span><br><span class="line">    dept_location <span class="type">VARCHAR</span>(<span class="number">100</span>)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建员工表（带外键）</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> employees (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT,</span><br><span class="line">    emp_no <span class="type">VARCHAR</span>(<span class="number">20</span>) <span class="keyword">NOT NULL</span> <span class="keyword">UNIQUE</span>,</span><br><span class="line">    name <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">    dept_id <span class="type">INT</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment">-- 外键约束</span></span><br><span class="line">    <span class="keyword">CONSTRAINT</span> fk_emp_dept</span><br><span class="line">        <span class="keyword">FOREIGN KEY</span> (dept_id)</span><br><span class="line">        <span class="keyword">REFERENCES</span> departments(id)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 简写形式（不命名）</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> employees (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span>,</span><br><span class="line">    name <span class="type">VARCHAR</span>(<span class="number">50</span>),</span><br><span class="line">    dept_id <span class="type">INT</span>,</span><br><span class="line">    <span class="keyword">FOREIGN KEY</span> (dept_id) <span class="keyword">REFERENCES</span> departments(id)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB;</span><br></pre></td></tr></table></figure>

<p><strong>重要提示</strong>：</p>
<ul>
<li>外键约束只在 InnoDB 引擎中生效</li>
<li>外键列和被引用列的数据类型必须相同</li>
<li>被引用列必须是主键或唯一索引</li>
</ul>
<h3 id="8-3-外键约束的参照完整性"><a href="#8-3-外键约束的参照完整性" class="headerlink" title="8.3 外键约束的参照完整性"></a>8.3 外键约束的参照完整性</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 插入部门</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> departments (dept_name, dept_location) <span class="keyword">VALUES</span></span><br><span class="line">(<span class="string">&#x27;技术部&#x27;</span>, <span class="string">&#x27;北京&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;市场部&#x27;</span>, <span class="string">&#x27;上海&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 插入员工（有效的外键值）</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> employees (emp_no, name, dept_id) <span class="keyword">VALUES</span></span><br><span class="line">(<span class="string">&#x27;E001&#x27;</span>, <span class="string">&#x27;张三&#x27;</span>, <span class="number">1</span>),  <span class="comment">-- 有效</span></span><br><span class="line">(<span class="string">&#x27;E002&#x27;</span>, <span class="string">&#x27;李四&#x27;</span>, <span class="number">2</span>);  <span class="comment">-- 有效</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 插入员工（无效的外键值，会报错）</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> employees (emp_no, name, dept_id) <span class="keyword">VALUES</span></span><br><span class="line">(<span class="string">&#x27;E003&#x27;</span>, <span class="string">&#x27;王五&#x27;</span>, <span class="number">99</span>);  <span class="comment">-- ERROR: 部门 99 不存在</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 插入员工（NULL 值，允许）</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> employees (emp_no, name, dept_id) <span class="keyword">VALUES</span></span><br><span class="line">(<span class="string">&#x27;E003&#x27;</span>, <span class="string">&#x27;王五&#x27;</span>, <span class="keyword">NULL</span>);  <span class="comment">-- 允许，表示该员工暂无部门</span></span><br></pre></td></tr></table></figure>

<h3 id="8-4-添加和删除外键"><a href="#8-4-添加和删除外键" class="headerlink" title="8.4 添加和删除外键"></a>8.4 添加和删除外键</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 添加外键约束</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> employees</span><br><span class="line"><span class="keyword">ADD CONSTRAINT</span> fk_emp_dept</span><br><span class="line"><span class="keyword">FOREIGN KEY</span> (dept_id) <span class="keyword">REFERENCES</span> departments(id);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 删除外键约束</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> employees</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">FOREIGN KEY</span> fk_emp_dept;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 删除外键后，还需要删除对应的外键索引</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> employees <span class="keyword">DROP</span> INDEX dept_id;</span><br></pre></td></tr></table></figure>

<h3 id="8-5-查看外键信息"><a href="#8-5-查看外键信息" class="headerlink" title="8.5 查看外键信息"></a>8.5 查看外键信息</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 查看表的外键</span></span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">CREATE TABLE</span> employees;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 从 information_schema 查询外键</span></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    TABLE_NAME,</span><br><span class="line">    COLUMN_NAME,</span><br><span class="line">    CONSTRAINT_NAME,</span><br><span class="line">    REFERENCED_TABLE_NAME,</span><br><span class="line">    REFERENCED_COLUMN_NAME</span><br><span class="line"><span class="keyword">FROM</span> information_schema.KEY_COLUMN_USAGE</span><br><span class="line"><span class="keyword">WHERE</span> TABLE_SCHEMA <span class="operator">=</span> <span class="string">&#x27;your_database&#x27;</span></span><br><span class="line"><span class="keyword">AND</span> TABLE_NAME <span class="operator">=</span> <span class="string">&#x27;employees&#x27;</span></span><br><span class="line"><span class="keyword">AND</span> REFERENCED_TABLE_NAME <span class="keyword">IS</span> <span class="keyword">NOT NULL</span>;</span><br></pre></td></tr></table></figure>

<h2 id="九、外键的删除和更新行为"><a href="#九、外键的删除和更新行为" class="headerlink" title="九、外键的删除和更新行为"></a>九、外键的删除和更新行为</h2><h3 id="9-1-外键行为选项"><a href="#9-1-外键行为选项" class="headerlink" title="9.1 外键行为选项"></a>9.1 外键行为选项</h3><p>当父表（被引用表）的记录被更新或删除时，子表（引用表）如何处理？</p>
<table>
<thead>
<tr>
<th>行为</th>
<th>说明</th>
<th>适用场景</th>
</tr>
</thead>
<tbody><tr>
<td>RESTRICT</td>
<td>拒绝删除&#x2F;更新父表记录（默认）</td>
<td>严格参照完整性</td>
</tr>
<tr>
<td>NO ACTION</td>
<td>同 RESTRICT（在 MySQL 中）</td>
<td>严格参照完整性</td>
</tr>
<tr>
<td>CASCADE</td>
<td>级联删除&#x2F;更新</td>
<td>强关联数据</td>
</tr>
<tr>
<td>SET NULL</td>
<td>将外键设为 NULL</td>
<td>可选关联</td>
</tr>
<tr>
<td>SET DEFAULT</td>
<td>设为默认值（MySQL 不支持）</td>
<td>-</td>
</tr>
</tbody></table>
<h3 id="9-2-CASCADE（级联）"><a href="#9-2-CASCADE（级联）" class="headerlink" title="9.2 CASCADE（级联）"></a>9.2 CASCADE（级联）</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 创建带级联删除/更新的外键</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> employees (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span>,</span><br><span class="line">    name <span class="type">VARCHAR</span>(<span class="number">50</span>),</span><br><span class="line">    dept_id <span class="type">INT</span>,</span><br><span class="line">    <span class="keyword">CONSTRAINT</span> fk_emp_dept</span><br><span class="line">        <span class="keyword">FOREIGN KEY</span> (dept_id)</span><br><span class="line">        <span class="keyword">REFERENCES</span> departments(id)</span><br><span class="line">        <span class="keyword">ON</span> <span class="keyword">DELETE</span> CASCADE    <span class="comment">-- 删除部门时，级联删除员工</span></span><br><span class="line">        <span class="keyword">ON</span> <span class="keyword">UPDATE</span> CASCADE    <span class="comment">-- 更新部门 ID 时，级联更新员工</span></span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 演示级联删除</span></span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> departments <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="comment">-- 所有 dept_id=1  的员工也会被删除</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 演示级联更新</span></span><br><span class="line"><span class="keyword">UPDATE</span> departments <span class="keyword">SET</span> id <span class="operator">=</span> <span class="number">10</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="comment">-- 所有 dept_id=1 的员工，dept_id 会更新为 10</span></span><br></pre></td></tr></table></figure>

<h3 id="9-3-SET-NULL（设为空）"><a href="#9-3-SET-NULL（设为空）" class="headerlink" title="9.3 SET NULL（设为空）"></a>9.3 SET NULL（设为空）</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 创建带 SET NULL 的外键</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> employees (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span>,</span><br><span class="line">    name <span class="type">VARCHAR</span>(<span class="number">50</span>),</span><br><span class="line">    dept_id <span class="type">INT</span> <span class="keyword">NULL</span>,  <span class="comment">-- 必须允许 NULL</span></span><br><span class="line">    <span class="keyword">CONSTRAINT</span> fk_emp_dept</span><br><span class="line">        <span class="keyword">FOREIGN KEY</span> (dept_id)</span><br><span class="line">        <span class="keyword">REFERENCES</span> departments(id)</span><br><span class="line">        <span class="keyword">ON</span> <span class="keyword">DELETE</span> <span class="keyword">SET</span> <span class="keyword">NULL</span>  <span class="comment">-- 删除部门时，员工的 dept_id 设为 NULL</span></span><br><span class="line">        <span class="keyword">ON</span> <span class="keyword">UPDATE</span> <span class="keyword">SET</span> <span class="keyword">NULL</span></span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 演示 SET NULL 删除</span></span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> departments <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="comment">-- 所有 dept_id=1 的员工，dept_id 会被设为 NULL</span></span><br></pre></td></tr></table></figure>

<h3 id="9-4-RESTRICT-NO-ACTION（限制）"><a href="#9-4-RESTRICT-NO-ACTION（限制）" class="headerlink" title="9.4 RESTRICT &#x2F; NO ACTION（限制）"></a>9.4 RESTRICT &#x2F; NO ACTION（限制）</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 创建带 RESTRICT 的外键（默认行为）</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> employees (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span>,</span><br><span class="line">    name <span class="type">VARCHAR</span>(<span class="number">50</span>),</span><br><span class="line">    dept_id <span class="type">INT</span>,</span><br><span class="line">    <span class="keyword">CONSTRAINT</span> fk_emp_dept</span><br><span class="line">        <span class="keyword">FOREIGN KEY</span> (dept_id)</span><br><span class="line">        <span class="keyword">REFERENCES</span> departments(id)</span><br><span class="line">        <span class="keyword">ON</span> <span class="keyword">DELETE</span> RESTRICT  <span class="comment">-- 或直接省略，默认就是 RESTRICT</span></span><br><span class="line">        <span class="keyword">ON</span> <span class="keyword">UPDATE</span> RESTRICT</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 尝试删除有员工关联的部门（会报错）</span></span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> departments <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="comment">-- ERROR: Cannot delete or update a parent row:</span></span><br><span class="line"><span class="comment">-- a foreign key constraint fails</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 必须先删除或更新子表记录</span></span><br><span class="line"><span class="keyword">UPDATE</span> employees <span class="keyword">SET</span> dept_id <span class="operator">=</span> <span class="keyword">NULL</span> <span class="keyword">WHERE</span> dept_id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="comment">-- 或者</span></span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> dept_id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 然后才能删除部门</span></span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> departments <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<h3 id="9-5-外键行为选择建议"><a href="#9-5-外键行为选择建议" class="headerlink" title="9.5 外键行为选择建议"></a>9.5 外键行为选择建议</h3><table>
<thead>
<tr>
<th>关系类型</th>
<th>推荐行为</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td>强依赖关系</td>
<td>CASCADE</td>
<td>订单和订单明细</td>
</tr>
<tr>
<td>可选关联</td>
<td>SET NULL</td>
<td>员工和部门（允许暂无部门）</td>
</tr>
<tr>
<td>严格参照</td>
<td>RESTRICT</td>
<td>用户和账户（不允许删除有账户的用户）</td>
</tr>
<tr>
<td>历史数据</td>
<td>RESTRICT + 逻辑删除</td>
<td>不允许物理删除，只标记状态</td>
</tr>
</tbody></table>
<h3 id="9-6-外键实战案例"><a href="#9-6-外键实战案例" class="headerlink" title="9.6 外键实战案例"></a>9.6 外键实战案例</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 案例 1：订单系统（级联删除）</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> orders (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span>,</span><br><span class="line">    user_id <span class="type">INT</span> <span class="keyword">NOT NULL</span>,</span><br><span class="line">    order_no <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">UNIQUE</span>,</span><br><span class="line">    <span class="keyword">CONSTRAINT</span> fk_orders_user</span><br><span class="line">        <span class="keyword">FOREIGN KEY</span> (user_id)</span><br><span class="line">        <span class="keyword">REFERENCES</span> users(id)</span><br><span class="line">        <span class="keyword">ON</span> <span class="keyword">DELETE</span> CASCADE</span><br><span class="line">        <span class="keyword">ON</span> <span class="keyword">UPDATE</span> CASCADE</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE TABLE</span> order_items (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span>,</span><br><span class="line">    order_id <span class="type">INT</span> <span class="keyword">NOT NULL</span>,</span><br><span class="line">    product_id <span class="type">INT</span> <span class="keyword">NOT NULL</span>,</span><br><span class="line">    quantity <span class="type">INT</span>,</span><br><span class="line">    <span class="keyword">CONSTRAINT</span> fk_items_order</span><br><span class="line">        <span class="keyword">FOREIGN KEY</span> (order_id)</span><br><span class="line">        <span class="keyword">REFERENCES</span> orders(id)</span><br><span class="line">        <span class="keyword">ON</span> <span class="keyword">DELETE</span> CASCADE</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 删除用户时，自动删除其所有订单和订单明细</span></span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 案例 2：文章评论系统（SET NULL）</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> articles (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span>,</span><br><span class="line">    title <span class="type">VARCHAR</span>(<span class="number">200</span>),</span><br><span class="line">    author_id <span class="type">INT</span>,</span><br><span class="line">    <span class="keyword">CONSTRAINT</span> fk_articles_author</span><br><span class="line">        <span class="keyword">FOREIGN KEY</span> (author_id)</span><br><span class="line">        <span class="keyword">REFERENCES</span> users(id)</span><br><span class="line">        <span class="keyword">ON</span> <span class="keyword">DELETE</span> <span class="keyword">SET</span> <span class="keyword">NULL</span>  <span class="comment">-- 作者删除后，文章保留但作者为空</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 案例 3：学生选课系统（限制删除）</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> enrollments (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span>,</span><br><span class="line">    student_id <span class="type">INT</span> <span class="keyword">NOT NULL</span>,</span><br><span class="line">    course_id <span class="type">INT</span> <span class="keyword">NOT NULL</span>,</span><br><span class="line">    <span class="keyword">CONSTRAINT</span> fk_enroll_student</span><br><span class="line">        <span class="keyword">FOREIGN KEY</span> (student_id)</span><br><span class="line">        <span class="keyword">REFERENCES</span> students(id)</span><br><span class="line">        <span class="keyword">ON</span> <span class="keyword">DELETE</span> RESTRICT,  <span class="comment">-- 有选课记录时不能删除学生</span></span><br><span class="line">    <span class="keyword">CONSTRAINT</span> fk_enroll_course</span><br><span class="line">        <span class="keyword">FOREIGN KEY</span> (course_id)</span><br><span class="line">        <span class="keyword">REFERENCES</span> courses(id)</span><br><span class="line">        <span class="keyword">ON</span> <span class="keyword">DELETE</span> RESTRICT   <span class="comment">-- 有选课记录时不能删除课程</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h2 id="十、约束综合实战"><a href="#十、约束综合实战" class="headerlink" title="十、约束综合实战"></a>十、约束综合实战</h2><h3 id="10-1-电商数据库设计"><a href="#10-1-电商数据库设计" class="headerlink" title="10.1 电商数据库设计"></a>10.1 电商数据库设计</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 用户表</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> users (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT,</span><br><span class="line">    username <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">NOT NULL</span> <span class="keyword">UNIQUE</span>,</span><br><span class="line">    password <span class="type">VARCHAR</span>(<span class="number">255</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">    email <span class="type">VARCHAR</span>(<span class="number">100</span>) <span class="keyword">NOT NULL</span> <span class="keyword">UNIQUE</span>,</span><br><span class="line">    phone <span class="type">VARCHAR</span>(<span class="number">20</span>) <span class="keyword">UNIQUE</span>,</span><br><span class="line">    status TINYINT <span class="keyword">DEFAULT</span> <span class="number">1</span>,</span><br><span class="line">    create_time DATETIME <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span>,</span><br><span class="line">    <span class="keyword">CONSTRAINT</span> chk_status <span class="keyword">CHECK</span> (status <span class="keyword">IN</span> (<span class="number">0</span>, <span class="number">1</span>))</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 商品分类表</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> categories (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT,</span><br><span class="line">    name <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">NOT NULL</span> <span class="keyword">UNIQUE</span>,</span><br><span class="line">    parent_id <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>,</span><br><span class="line">    sort_order <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>,</span><br><span class="line">    <span class="keyword">CONSTRAINT</span> chk_sort <span class="keyword">CHECK</span> (sort_order <span class="operator">&gt;=</span> <span class="number">0</span>)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 商品表</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> products (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT,</span><br><span class="line">    name <span class="type">VARCHAR</span>(<span class="number">200</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">    category_id <span class="type">INT</span>,</span><br><span class="line">    price <span class="type">DECIMAL</span>(<span class="number">10</span>, <span class="number">2</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">    stock <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>,</span><br><span class="line">    status TINYINT <span class="keyword">DEFAULT</span> <span class="number">1</span>,</span><br><span class="line">    <span class="keyword">CONSTRAINT</span> chk_price <span class="keyword">CHECK</span> (price <span class="operator">&gt;=</span> <span class="number">0</span>),</span><br><span class="line">    <span class="keyword">CONSTRAINT</span> chk_stock <span class="keyword">CHECK</span> (stock <span class="operator">&gt;=</span> <span class="number">0</span>),</span><br><span class="line">    <span class="keyword">CONSTRAINT</span> chk_status <span class="keyword">CHECK</span> (status <span class="keyword">IN</span> (<span class="number">0</span>, <span class="number">1</span>)),</span><br><span class="line">    <span class="keyword">CONSTRAINT</span> fk_prod_category</span><br><span class="line">        <span class="keyword">FOREIGN KEY</span> (category_id)</span><br><span class="line">        <span class="keyword">REFERENCES</span> categories(id)</span><br><span class="line">        <span class="keyword">ON</span> <span class="keyword">DELETE</span> <span class="keyword">SET</span> <span class="keyword">NULL</span></span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 订单表</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> orders (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT,</span><br><span class="line">    order_no <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">NOT NULL</span> <span class="keyword">UNIQUE</span>,</span><br><span class="line">    user_id <span class="type">INT</span> <span class="keyword">NOT NULL</span>,</span><br><span class="line">    total_amount <span class="type">DECIMAL</span>(<span class="number">10</span>, <span class="number">2</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">    status TINYINT <span class="keyword">DEFAULT</span> <span class="number">0</span>,</span><br><span class="line">    create_time DATETIME <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span>,</span><br><span class="line">    <span class="keyword">CONSTRAINT</span> chk_amount <span class="keyword">CHECK</span> (total_amount <span class="operator">&gt;=</span> <span class="number">0</span>),</span><br><span class="line">    <span class="keyword">CONSTRAINT</span> chk_order_status <span class="keyword">CHECK</span> (status <span class="keyword">IN</span> (<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>)),</span><br><span class="line">    <span class="keyword">CONSTRAINT</span> fk_orders_user</span><br><span class="line">        <span class="keyword">FOREIGN KEY</span> (user_id)</span><br><span class="line">        <span class="keyword">REFERENCES</span> users(id)</span><br><span class="line">        <span class="keyword">ON</span> <span class="keyword">DELETE</span> CASCADE</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 订单明细表</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> order_items (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT,</span><br><span class="line">    order_id <span class="type">INT</span> <span class="keyword">NOT NULL</span>,</span><br><span class="line">    product_id <span class="type">INT</span> <span class="keyword">NOT NULL</span>,</span><br><span class="line">    price <span class="type">DECIMAL</span>(<span class="number">10</span>, <span class="number">2</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">    quantity <span class="type">INT</span> <span class="keyword">NOT NULL</span>,</span><br><span class="line">    <span class="keyword">CONSTRAINT</span> chk_quantity <span class="keyword">CHECK</span> (quantity <span class="operator">&gt;</span> <span class="number">0</span>),</span><br><span class="line">    <span class="keyword">CONSTRAINT</span> chk_item_price <span class="keyword">CHECK</span> (price <span class="operator">&gt;=</span> <span class="number">0</span>),</span><br><span class="line">    <span class="keyword">CONSTRAINT</span> fk_items_order</span><br><span class="line">        <span class="keyword">FOREIGN KEY</span> (order_id)</span><br><span class="line">        <span class="keyword">REFERENCES</span> orders(id)</span><br><span class="line">        <span class="keyword">ON</span> <span class="keyword">DELETE</span> CASCADE,</span><br><span class="line">    <span class="keyword">CONSTRAINT</span> fk_items_product</span><br><span class="line">        <span class="keyword">FOREIGN KEY</span> (product_id)</span><br><span class="line">        <span class="keyword">REFERENCES</span> products(id)</span><br><span class="line">        <span class="keyword">ON</span> <span class="keyword">DELETE</span> RESTRICT</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4;</span><br></pre></td></tr></table></figure>

<h3 id="10-2-约束测试"><a href="#10-2-约束测试" class="headerlink" title="10.2 约束测试"></a>10.2 约束测试</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 测试 1：插入有效数据</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> users (username, password, email)</span><br><span class="line"><span class="keyword">VALUES</span> (<span class="string">&#x27;test&#x27;</span>, <span class="string">&#x27;pwd123&#x27;</span>, <span class="string">&#x27;test@example.com&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 测试 2：违反唯一约束</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> users (username, password, email)</span><br><span class="line"><span class="keyword">VALUES</span> (<span class="string">&#x27;test&#x27;</span>, <span class="string">&#x27;pwd456&#x27;</span>, <span class="string">&#x27;test2@example.com&#x27;</span>);  <span class="comment">-- ERROR: 用户名重复</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 测试 3：违反非空约束</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> users (username, email) <span class="keyword">VALUES</span> (<span class="keyword">NULL</span>, <span class="string">&#x27;test@example.com&#x27;</span>);  <span class="comment">-- ERROR</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 测试 4：违反检查约束</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> products (name, price, stock) <span class="keyword">VALUES</span> (<span class="string">&#x27;商品&#x27;</span>, <span class="number">-100</span>, <span class="number">10</span>);  <span class="comment">-- ERROR</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 测试 5：违反外键约束</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> orders (order_no, user_id, total_amount)</span><br><span class="line"><span class="keyword">VALUES</span> (<span class="string">&#x27;ORD001&#x27;</span>, <span class="number">999</span>, <span class="number">100</span>);  <span class="comment">-- ERROR: 用户不存在</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 测试 6：级联删除</span></span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="comment">-- 该用户的所有订单也会被删除</span></span><br></pre></td></tr></table></figure>

<h2 id="十一、小结"><a href="#十一、小结" class="headerlink" title="十一、小结"></a>十一、小结</h2><h3 id="约束类型总结"><a href="#约束类型总结" class="headerlink" title="约束类型总结"></a>约束类型总结</h3><table>
<thead>
<tr>
<th>约束</th>
<th>关键字</th>
<th>作用</th>
<th>可否命名</th>
</tr>
</thead>
<tbody><tr>
<td>主键</td>
<td>PRIMARY KEY</td>
<td>唯一标识记录</td>
<td>是</td>
</tr>
<tr>
<td>外键</td>
<td>FOREIGN KEY</td>
<td>建立表间关系</td>
<td>是</td>
</tr>
<tr>
<td>唯一</td>
<td>UNIQUE</td>
<td>保证列值唯一</td>
<td>是</td>
</tr>
<tr>
<td>非空</td>
<td>NOT NULL</td>
<td>禁止 NULL 值</td>
<td>否</td>
</tr>
<tr>
<td>默认</td>
<td>DEFAULT</td>
<td>设置默认值</td>
<td>否</td>
</tr>
<tr>
<td>检查</td>
<td>CHECK</td>
<td>验证数据有效性</td>
<td>是</td>
</tr>
</tbody></table>
<h3 id="最佳实践"><a href="#最佳实践" class="headerlink" title="最佳实践"></a>最佳实践</h3><ol>
<li><strong>主键选择</strong>：使用无业务意义的自增 ID</li>
<li><strong>外键使用</strong>：明确指定 ON DELETE&#x2F;UPDATE 行为</li>
<li><strong>约束命名</strong>：使用有意义的约束名便于维护</li>
<li><strong>检查约束</strong>：在数据库层面验证业务规则</li>
<li><strong>适度使用</strong>：不要过度约束影响性能</li>
</ol>
<h3 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h3><ol>
<li>外键只在 InnoDB 引擎中生效</li>
<li>MySQL 8.0.16 之前不支持 CHECK 约束</li>
<li>外键会影响插入、删除、更新性能</li>
<li>级联删除要小心使用，避免误删数据</li>
</ol>
<hr>
<p><strong>下一篇</strong>：[MySQL 进阶教程（三）：多表查询详解](&#x2F;2026&#x2F;02&#x2F;23&#x2F;MySQL 进阶教程（三）多表查询详解&#x2F;)</p>
<p><strong>上一篇</strong>：[MySQL 进阶教程（一）：常用函数详解](&#x2F;2026&#x2F;02&#x2F;23&#x2F;MySQL 进阶教程（一）常用函数详解&#x2F;)</p>
]]></content>
      <categories>
        <category>MySQL 进阶教程</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
        <tag>约束</tag>
        <tag>外键</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQL 进阶教程（五）基础篇总结</title>
    <url>/2026/02/23/MySQL%20%E8%BF%9B%E9%98%B6%E6%95%99%E7%A8%8B%EF%BC%88%E4%BA%94%EF%BC%89%E5%9F%BA%E7%A1%80%E7%AF%87%E6%80%BB%E7%BB%93/</url>
    <content><![CDATA[<h1 id="MySQL-进阶教程（五）基础篇总结"><a href="#MySQL-进阶教程（五）基础篇总结" class="headerlink" title="MySQL 进阶教程（五）基础篇总结"></a>MySQL 进阶教程（五）基础篇总结</h1><p>至此，MySQL 基础篇和进阶教程全部完成！本文将对整个系列进行系统总结，并提供学习路线建议。</p>
<h2 id="一、系列文章回顾"><a href="#一、系列文章回顾" class="headerlink" title="一、系列文章回顾"></a>一、系列文章回顾</h2><h3 id="基础教程系列"><a href="#基础教程系列" class="headerlink" title="基础教程系列"></a>基础教程系列</h3><table>
<thead>
<tr>
<th>篇目</th>
<th>主题</th>
<th>核心内容</th>
</tr>
</thead>
<tbody><tr>
<td>基础（一）</td>
<td>数据库基础与环境搭建</td>
<td>数据库概念、MySQL 安装、数据模型、SQL 分类</td>
</tr>
<tr>
<td>基础（二）</td>
<td>DDL 数据定义语言</td>
<td>数据库操作、表操作、数据类型、DataGrip</td>
</tr>
<tr>
<td>基础（三）</td>
<td>DML 数据操作语言</td>
<td>INSERT、UPDATE、DELETE、事务基础</td>
</tr>
<tr>
<td>基础（四）</td>
<td>DQL 数据查询语言</td>
<td>基础查询、条件查询、聚合函数、分组、排序、分页、连接查询、子查询</td>
</tr>
<tr>
<td>基础（五）</td>
<td>DCL 数据控制语言</td>
<td>用户管理、权限控制、事务控制</td>
</tr>
</tbody></table>
<h3 id="进阶教程系列"><a href="#进阶教程系列" class="headerlink" title="进阶教程系列"></a>进阶教程系列</h3><table>
<thead>
<tr>
<th>篇目</th>
<th>主题</th>
<th>核心内容</th>
</tr>
</thead>
<tbody><tr>
<td>进阶（一）</td>
<td>常用函数详解</td>
<td>字符串函数、数值函数、日期函数、流程函数</td>
</tr>
<tr>
<td>进阶（二）</td>
<td>数据库约束</td>
<td>主键、外键、唯一、非空、默认、检查约束</td>
</tr>
<tr>
<td>进阶（三）</td>
<td>多表查询</td>
<td>表关系、连接查询、联合查询、子查询</td>
</tr>
<tr>
<td>进阶（四）</td>
<td>事务</td>
<td>ACID 特性、并发问题、隔离级别、锁机制</td>
</tr>
</tbody></table>
<h2 id="二、知识体系思维导图"><a href="#二、知识体系思维导图" class="headerlink" title="二、知识体系思维导图"></a>二、知识体系思维导图</h2><h3 id="2-1-SQL-语言分类"><a href="#2-1-SQL-语言分类" class="headerlink" title="2.1 SQL 语言分类"></a>2.1 SQL 语言分类</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">SQL</span><br><span class="line">├── DDL（数据定义语言）</span><br><span class="line">│   ├── CREATE DATABASE/TABLE</span><br><span class="line">│   ├── ALTER DATABASE/TABLE</span><br><span class="line">│   ├── DROP DATABASE/TABLE</span><br><span class="line">│   └── TRUNCATE TABLE</span><br><span class="line">│</span><br><span class="line">├── DML（数据操作语言）</span><br><span class="line">│   ├── INSERT INTO ... VALUES</span><br><span class="line">│   ├── UPDATE ... SET ... WHERE</span><br><span class="line">│   └── DELETE FROM ... WHERE</span><br><span class="line">│</span><br><span class="line">├── DQL（数据查询语言）</span><br><span class="line">│   ├── SELECT ... FROM ... WHERE</span><br><span class="line">│   ├── GROUP BY ... HAVING</span><br><span class="line">│   ├── ORDER BY ... LIMIT</span><br><span class="line">│   └── JOIN / UNION / 子查询</span><br><span class="line">│</span><br><span class="line">└── DCL（数据控制语言）</span><br><span class="line">    ├── CREATE USER / DROP USER</span><br><span class="line">    ├── GRANT / REVOKE</span><br><span class="line">    ├── START TRANSACTION / COMMIT / ROLLBACK</span><br><span class="line">    └── SAVEPOINT</span><br></pre></td></tr></table></figure>

<h3 id="2-2-核心知识点"><a href="#2-2-核心知识点" class="headerlink" title="2.2 核心知识点"></a>2.2 核心知识点</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">MySQL</span><br><span class="line">├── 基础概念</span><br><span class="line">│   ├── 数据库、DBMS、SQL</span><br><span class="line">│   ├── 数据模型（关系模型、ER 图）</span><br><span class="line">│   └── 三大范式</span><br><span class="line">│</span><br><span class="line">├── 数据类型</span><br><span class="line">│   ├── 数值类型（INT、DECIMAL、FLOAT）</span><br><span class="line">│   ├── 字符串类型（CHAR、VARCHAR、TEXT）</span><br><span class="line">│   └── 日期时间类型（DATE、DATETIME、TIMESTAMP）</span><br><span class="line">│</span><br><span class="line">├── 函数</span><br><span class="line">│   ├── 字符串函数（CONCAT、SUBSTRING、REPLACE）</span><br><span class="line">│   ├── 数值函数（ABS、ROUND、CEIL、FLOOR）</span><br><span class="line">│   ├── 日期函数（NOW、DATE_FORMAT、DATEDIFF）</span><br><span class="line">│   └── 流程函数（IF、CASE、IFNULL）</span><br><span class="line">│</span><br><span class="line">├── 约束</span><br><span class="line">│   ├── PRIMARY KEY（主键）</span><br><span class="line">│   ├── FOREIGN KEY（外键）</span><br><span class="line">│   ├── UNIQUE（唯一）</span><br><span class="line">│   ├── NOT NULL（非空）</span><br><span class="line">│   ├── DEFAULT（默认）</span><br><span class="line">│   └── CHECK（检查）</span><br><span class="line">│</span><br><span class="line">├── 查询</span><br><span class="line">│   ├── 单表查询</span><br><span class="line">│   ├── 多表连接（INNER/LEFT/RIGHT JOIN）</span><br><span class="line">│   ├── 自连接</span><br><span class="line">│   ├── UNION 联合</span><br><span class="line">│   └── 子查询（标量/列/行/表）</span><br><span class="line">│</span><br><span class="line">└── 事务</span><br><span class="line">    ├── ACID 特性</span><br><span class="line">    ├── 隔离级别</span><br><span class="line">    ├── 并发问题（脏读/不可重复读/幻读）</span><br><span class="line">    └── 锁机制</span><br></pre></td></tr></table></figure>

<h2 id="三、SQL-语法速查"><a href="#三、SQL-语法速查" class="headerlink" title="三、SQL 语法速查"></a>三、SQL 语法速查</h2><h3 id="3-1-完整-SELECT-语法"><a href="#3-1-完整-SELECT-语法" class="headerlink" title="3.1 完整 SELECT 语法"></a>3.1 完整 SELECT 语法</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> [<span class="keyword">DISTINCT</span>] 列名 [<span class="keyword">AS</span> 别名], ...</span><br><span class="line"><span class="keyword">FROM</span> 表名 [<span class="keyword">AS</span> 别名]</span><br><span class="line">[<span class="keyword">INNER</span> <span class="operator">|</span> <span class="keyword">LEFT</span> <span class="operator">|</span> <span class="keyword">RIGHT</span>] <span class="keyword">JOIN</span> 表名 <span class="keyword">ON</span> 连接条件</span><br><span class="line">[<span class="keyword">WHERE</span> 条件]</span><br><span class="line">[<span class="keyword">GROUP</span> <span class="keyword">BY</span> 分组列 [<span class="keyword">HAVING</span> 分组过滤]]</span><br><span class="line">[<span class="keyword">ORDER</span> <span class="keyword">BY</span> 排序列 [<span class="keyword">ASC</span> <span class="operator">|</span> <span class="keyword">DESC</span>]]</span><br><span class="line">[LIMIT [<span class="keyword">offset</span>,] count];</span><br></pre></td></tr></table></figure>

<h3 id="3-2-SQL-执行顺序"><a href="#3-2-SQL-执行顺序" class="headerlink" title="3.2 SQL 执行顺序"></a>3.2 SQL 执行顺序</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">FROM → JOIN → WHERE → GROUP BY → HAVING → SELECT → DISTINCT → ORDER BY → LIMIT</span><br></pre></td></tr></table></figure>

<p><strong>记忆要点</strong>：</p>
<ul>
<li>WHERE 在 SELECT 之前执行（不能使用别名）</li>
<li>HAVING 在 GROUP BY 之后执行（可以使用聚合函数）</li>
<li>ORDER BY 在 HAVING 之后执行</li>
<li>LIMIT 最后执行</li>
</ul>
<h3 id="3-3-常用命令速查"><a href="#3-3-常用命令速查" class="headerlink" title="3.3 常用命令速查"></a>3.3 常用命令速查</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 数据库操作</span></span><br><span class="line"><span class="keyword">SHOW</span> DATABASES;</span><br><span class="line"><span class="keyword">CREATE</span> DATABASE db_name;</span><br><span class="line">USE db_name;</span><br><span class="line"><span class="keyword">DROP</span> DATABASE db_name;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 表操作</span></span><br><span class="line"><span class="keyword">SHOW</span> TABLES;</span><br><span class="line"><span class="keyword">DESC</span> table_name;</span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">CREATE TABLE</span> table_name;</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> table_name;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 数据操作</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> <span class="keyword">table</span> (col1, col2) <span class="keyword">VALUES</span> (val1, val2);</span><br><span class="line"><span class="keyword">UPDATE</span> <span class="keyword">table</span> <span class="keyword">SET</span> col1 <span class="operator">=</span> val1 <span class="keyword">WHERE</span> <span class="keyword">condition</span>;</span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> <span class="keyword">table</span> <span class="keyword">WHERE</span> <span class="keyword">condition</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询操作</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> <span class="keyword">table</span> <span class="keyword">WHERE</span> <span class="keyword">condition</span>;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">FROM</span> <span class="keyword">table</span>;</span><br><span class="line"><span class="keyword">SELECT</span> col, <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">FROM</span> <span class="keyword">table</span> <span class="keyword">GROUP</span> <span class="keyword">BY</span> col;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 事务操作</span></span><br><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br><span class="line"><span class="keyword">ROLLBACK</span>;</span><br><span class="line"><span class="keyword">SAVEPOINT</span> sp_name;</span><br><span class="line"><span class="keyword">ROLLBACK</span> <span class="keyword">TO</span> sp_name;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 用户权限</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> <span class="string">&#x27;user&#x27;</span>@<span class="string">&#x27;host&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;pwd&#x27;</span>;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">SELECT</span> <span class="keyword">ON</span> db.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;user&#x27;</span>@<span class="string">&#x27;host&#x27;</span>;</span><br><span class="line"><span class="keyword">REVOKE</span> <span class="keyword">SELECT</span> <span class="keyword">ON</span> db.<span class="operator">*</span> <span class="keyword">FROM</span> <span class="string">&#x27;user&#x27;</span>@<span class="string">&#x27;host&#x27;</span>;</span><br><span class="line"><span class="keyword">SHOW</span> GRANTS <span class="keyword">FOR</span> <span class="string">&#x27;user&#x27;</span>@<span class="string">&#x27;host&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h2 id="四、常用函数速查"><a href="#四、常用函数速查" class="headerlink" title="四、常用函数速查"></a>四、常用函数速查</h2><h3 id="4-1-字符串函数"><a href="#4-1-字符串函数" class="headerlink" title="4.1 字符串函数"></a>4.1 字符串函数</h3><table>
<thead>
<tr>
<th>函数</th>
<th>说明</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td>CONCAT(s1, s2, …)</td>
<td>连接字符串</td>
<td><code>CONCAT(&#39;Hello&#39;, &#39;World&#39;)</code></td>
</tr>
<tr>
<td>LENGTH(s)</td>
<td>字节长度</td>
<td><code>LENGTH(&#39;hello&#39;)</code></td>
</tr>
<tr>
<td>CHAR_LENGTH(s)</td>
<td>字符数</td>
<td><code>CHAR_LENGTH(&#39;你好&#39;)</code></td>
</tr>
<tr>
<td>UPPER(s)</td>
<td>转大写</td>
<td><code>UPPER(&#39;hello&#39;)</code></td>
</tr>
<tr>
<td>LOWER(s)</td>
<td>转小写</td>
<td><code>LOWER(&#39;HELLO&#39;)</code></td>
</tr>
<tr>
<td>SUBSTRING(s, pos, len)</td>
<td>截取字符串</td>
<td><code>SUBSTRING(&#39;hello&#39;, 1, 3)</code></td>
</tr>
<tr>
<td>REPLACE(s, from, to)</td>
<td>替换</td>
<td><code>REPLACE(&#39;hello&#39;, &#39;l&#39;, &#39;x&#39;)</code></td>
</tr>
<tr>
<td>TRIM(s)</td>
<td>去空格</td>
<td><code>TRIM(&#39; hello &#39;)</code></td>
</tr>
<tr>
<td>LPAD&#x2F;RPAD</td>
<td>左右填充</td>
<td><code>LPAD(&#39;123&#39;, 6, &#39;0&#39;)</code></td>
</tr>
</tbody></table>
<h3 id="4-2-数值函数"><a href="#4-2-数值函数" class="headerlink" title="4.2 数值函数"></a>4.2 数值函数</h3><table>
<thead>
<tr>
<th>函数</th>
<th>说明</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td>ABS(n)</td>
<td>绝对值</td>
<td><code>ABS(-10)</code></td>
</tr>
<tr>
<td>ROUND(n, d)</td>
<td>四舍五入</td>
<td><code>ROUND(3.14159, 2)</code></td>
</tr>
<tr>
<td>CEIL(n)</td>
<td>向上取整</td>
<td><code>CEIL(3.14)</code></td>
</tr>
<tr>
<td>FLOOR(n)</td>
<td>向下取整</td>
<td><code>FLOOR(3.99)</code></td>
</tr>
<tr>
<td>MOD(n, m)</td>
<td>取模</td>
<td><code>MOD(10, 3)</code></td>
</tr>
<tr>
<td>RAND()</td>
<td>随机数</td>
<td><code>RAND()</code></td>
</tr>
<tr>
<td>SQRT(n)</td>
<td>平方根</td>
<td><code>SQRT(16)</code></td>
</tr>
</tbody></table>
<h3 id="4-3-日期函数"><a href="#4-3-日期函数" class="headerlink" title="4.3 日期函数"></a>4.3 日期函数</h3><table>
<thead>
<tr>
<th>函数</th>
<th>说明</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td>NOW()</td>
<td>当前日期时间</td>
<td><code>NOW()</code></td>
</tr>
<tr>
<td>CURDATE()</td>
<td>当前日期</td>
<td><code>CURDATE()</code></td>
</tr>
<tr>
<td>YEAR(d)</td>
<td>年份</td>
<td><code>YEAR(NOW())</code></td>
</tr>
<tr>
<td>MONTH(d)</td>
<td>月份</td>
<td><code>MONTH(NOW())</code></td>
</tr>
<tr>
<td>DAY(d)</td>
<td>日期</td>
<td><code>DAY(NOW())</code></td>
</tr>
<tr>
<td>DATE_FORMAT(d, fmt)</td>
<td>格式化</td>
<td><code>DATE_FORMAT(NOW(), &#39;%Y-%m-%d&#39;)</code></td>
</tr>
<tr>
<td>DATE_ADD(d, INTERVAL n UNIT)</td>
<td>日期增加</td>
<td><code>DATE_ADD(NOW(), INTERVAL 1 DAY)</code></td>
</tr>
<tr>
<td>DATEDIFF(d1, d2)</td>
<td>日期差</td>
<td><code>DATEDIFF(d1, d2)</code></td>
</tr>
</tbody></table>
<h3 id="4-4-流程函数"><a href="#4-4-流程函数" class="headerlink" title="4.4 流程函数"></a>4.4 流程函数</h3><table>
<thead>
<tr>
<th>函数</th>
<th>说明</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td>IF(expr, v1, v2)</td>
<td>条件判断</td>
<td><code>IF(1&gt;2, &#39;Y&#39;, &#39;N&#39;)</code></td>
</tr>
<tr>
<td>IFNULL(v1, v2)</td>
<td>NULL 处理</td>
<td><code>IFNULL(val, 0)</code></td>
</tr>
<tr>
<td>NULLIF(v1, v2)</td>
<td>相等返回 NULL</td>
<td><code>NULLIF(a, 0)</code></td>
</tr>
<tr>
<td>CASE WHEN … THEN … END</td>
<td>条件表达式</td>
<td><code>CASE WHEN x&gt;0 THEN &#39;正&#39; ELSE &#39;非正&#39; END</code></td>
</tr>
</tbody></table>
<h2 id="五、常见场景-SQL-模板"><a href="#五、常见场景-SQL-模板" class="headerlink" title="五、常见场景 SQL 模板"></a>五、常见场景 SQL 模板</h2><h3 id="5-1-分页查询"><a href="#5-1-分页查询" class="headerlink" title="5.1 分页查询"></a>5.1 分页查询</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 第 n 页，每页 size 条</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> <span class="keyword">table</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> id</span><br><span class="line">LIMIT (n<span class="number">-1</span>)<span class="operator">*</span>size, size;</span><br></pre></td></tr></table></figure>

<h3 id="5-2-分组统计"><a href="#5-2-分组统计" class="headerlink" title="5.2 分组统计"></a>5.2 分组统计</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 按部门统计人数和平均工资</span></span><br><span class="line"><span class="keyword">SELECT</span> dept_id,</span><br><span class="line">       <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">AS</span> emp_count,</span><br><span class="line">       <span class="built_in">AVG</span>(salary) <span class="keyword">AS</span> avg_salary</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> dept_id</span><br><span class="line"><span class="keyword">HAVING</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="operator">&gt;</span> <span class="number">5</span>;</span><br></pre></td></tr></table></figure>

<h3 id="5-3-排名查询"><a href="#5-3-排名查询" class="headerlink" title="5.3 排名查询"></a>5.3 排名查询</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 按工资降序排名</span></span><br><span class="line"><span class="keyword">SELECT</span> name, salary,</span><br><span class="line">       <span class="built_in">ROW_NUMBER</span>() <span class="keyword">OVER</span> (<span class="keyword">ORDER</span> <span class="keyword">BY</span> salary <span class="keyword">DESC</span>) <span class="keyword">AS</span> rank</span><br><span class="line"><span class="keyword">FROM</span> employees;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- MySQL 8.0 之前使用变量</span></span><br><span class="line"><span class="keyword">SELECT</span> name, salary,</span><br><span class="line">       <span class="variable">@rank</span> :<span class="operator">=</span> <span class="variable">@rank</span> <span class="operator">+</span> <span class="number">1</span> <span class="keyword">AS</span> rank</span><br><span class="line"><span class="keyword">FROM</span> employees, (<span class="keyword">SELECT</span> <span class="variable">@rank</span> :<span class="operator">=</span> <span class="number">0</span>) r</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> salary <span class="keyword">DESC</span>;</span><br></pre></td></tr></table></figure>

<h3 id="5-4-去重查询"><a href="#5-4-去重查询" class="headerlink" title="5.4 去重查询"></a>5.4 去重查询</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 删除重复记录，保留 ID 最小的</span></span><br><span class="line"><span class="keyword">DELETE</span> t1 <span class="keyword">FROM</span> <span class="keyword">table</span> t1</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> <span class="keyword">table</span> t2</span><br><span class="line"><span class="keyword">WHERE</span> t1.id <span class="operator">&gt;</span> t2.id <span class="keyword">AND</span> t1.name <span class="operator">=</span> t2.name;</span><br></pre></td></tr></table></figure>

<h3 id="5-5-行列转换"><a href="#5-5-行列转换" class="headerlink" title="5.5 行列转换"></a>5.5 行列转换</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 行转列（使用 CASE）</span></span><br><span class="line"><span class="keyword">SELECT</span> name,</span><br><span class="line">       <span class="built_in">MAX</span>(<span class="keyword">CASE</span> <span class="keyword">WHEN</span> subject <span class="operator">=</span> <span class="string">&#x27;数学&#x27;</span> <span class="keyword">THEN</span> score <span class="keyword">END</span>) <span class="keyword">AS</span> 数学，</span><br><span class="line">       <span class="built_in">MAX</span>(<span class="keyword">CASE</span> <span class="keyword">WHEN</span> subject <span class="operator">=</span> <span class="string">&#x27;语文&#x27;</span> <span class="keyword">THEN</span> score <span class="keyword">END</span>) <span class="keyword">AS</span> 语文，</span><br><span class="line">       <span class="built_in">MAX</span>(<span class="keyword">CASE</span> <span class="keyword">WHEN</span> subject <span class="operator">=</span> <span class="string">&#x27;英语&#x27;</span> <span class="keyword">THEN</span> score <span class="keyword">END</span>) <span class="keyword">AS</span> 英语</span><br><span class="line"><span class="keyword">FROM</span> scores</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> name;</span><br></pre></td></tr></table></figure>

<h3 id="5-6-连续日期查询"><a href="#5-6-连续日期查询" class="headerlink" title="5.6 连续日期查询"></a>5.6 连续日期查询</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 查询连续登录 3 天以上的用户</span></span><br><span class="line"><span class="keyword">SELECT</span> user_id, <span class="built_in">MIN</span>(<span class="type">date</span>) <span class="keyword">AS</span> start_date, <span class="built_in">MAX</span>(<span class="type">date</span>) <span class="keyword">AS</span> end_date, <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">AS</span> days</span><br><span class="line"><span class="keyword">FROM</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> user_id, <span class="type">date</span>,</span><br><span class="line">           DATE_SUB(<span class="type">date</span>, <span class="type">INTERVAL</span> <span class="built_in">ROW_NUMBER</span>() <span class="keyword">OVER</span> (<span class="keyword">PARTITION</span> <span class="keyword">BY</span> user_id <span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="type">date</span>) <span class="keyword">DAY</span>) <span class="keyword">AS</span> grp</span><br><span class="line">    <span class="keyword">FROM</span> logins</span><br><span class="line">) t</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> user_id, grp</span><br><span class="line"><span class="keyword">HAVING</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="operator">&gt;=</span> <span class="number">3</span>;</span><br></pre></td></tr></table></figure>

<h2 id="六、性能优化建议"><a href="#六、性能优化建议" class="headerlink" title="六、性能优化建议"></a>六、性能优化建议</h2><h3 id="6-1-索引优化"><a href="#6-1-索引优化" class="headerlink" title="6.1 索引优化"></a>6.1 索引优化</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 创建索引</span></span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_name <span class="keyword">ON</span> <span class="keyword">table</span>(<span class="keyword">column</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 联合索引</span></span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_dept_salary <span class="keyword">ON</span> employees(dept_id, salary);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看索引</span></span><br><span class="line"><span class="keyword">SHOW</span> INDEX <span class="keyword">FROM</span> table_name;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 分析查询</span></span><br><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> dept_id <span class="operator">=</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<p><strong>索引使用原则</strong>：</p>
<ol>
<li>在 WHERE 和 JOIN 的列上创建索引</li>
<li>使用联合索引时注意最左前缀原则</li>
<li>避免在索引列上使用函数</li>
<li>避免 SELECT *</li>
</ol>
<h3 id="6-2-查询优化"><a href="#6-2-查询优化" class="headerlink" title="6.2 查询优化"></a>6.2 查询优化</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 优化前：全表扫描</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> <span class="keyword">YEAR</span>(hire_date) <span class="operator">=</span> <span class="number">2024</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 优化后：使用索引</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> hire_date <span class="operator">&gt;=</span> <span class="string">&#x27;2024-01-01&#x27;</span></span><br><span class="line"><span class="keyword">AND</span> hire_date <span class="operator">&lt;</span> <span class="string">&#x27;2025-01-01&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 优化前：OR 条件可能不使用索引</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> dept_id <span class="operator">=</span> <span class="number">1</span> <span class="keyword">OR</span> dept_id <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 优化后：使用 UNION</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> dept_id <span class="operator">=</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">UNION</span> <span class="keyword">ALL</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> dept_id <span class="operator">=</span> <span class="number">2</span>;</span><br></pre></td></tr></table></figure>

<h3 id="6-3-表结构优化"><a href="#6-3-表结构优化" class="headerlink" title="6.3 表结构优化"></a>6.3 表结构优化</h3><ol>
<li><p><strong>选择合适的数据类型</strong></p>
<ul>
<li>能用 TINYINT 就不用 INT</li>
<li>金额使用 DECIMAL</li>
<li>字符串长度合理</li>
</ul>
</li>
<li><p><strong>范式与反范式</strong></p>
<ul>
<li>遵循三大范式减少冗余</li>
<li>适当冗余提高查询性能</li>
</ul>
</li>
<li><p><strong>分区表</strong></p>
<ul>
<li>大表按时间或范围分区</li>
<li>提高查询和管理效率</li>
</ul>
</li>
</ol>
<h2 id="七、学习路线建议"><a href="#七、学习路线建议" class="headerlink" title="七、学习路线建议"></a>七、学习路线建议</h2><h3 id="7-1-入门阶段（已完成）"><a href="#7-1-入门阶段（已完成）" class="headerlink" title="7.1 入门阶段（已完成）"></a>7.1 入门阶段（已完成）</h3><ul>
<li><input checked="" disabled="" type="checkbox"> 数据库基础概念</li>
<li><input checked="" disabled="" type="checkbox"> MySQL 安装配置</li>
<li><input checked="" disabled="" type="checkbox"> 基本 SQL 语法（DDL、DML、DQL、DCL）</li>
<li><input checked="" disabled="" type="checkbox"> 常用函数</li>
<li><input checked="" disabled="" type="checkbox"> 约束和多表查询</li>
<li><input checked="" disabled="" type="checkbox"> 事务基础</li>
</ul>
<h3 id="7-2-进阶阶段"><a href="#7-2-进阶阶段" class="headerlink" title="7.2 进阶阶段"></a>7.2 进阶阶段</h3><ul>
<li><input disabled="" type="checkbox"> 索引原理与优化</li>
<li><input disabled="" type="checkbox"> 执行计划分析（EXPLAIN）</li>
<li><input disabled="" type="checkbox"> 锁机制深入</li>
<li><input disabled="" type="checkbox"> 存储引擎（InnoDB vs MyISAM）</li>
<li><input disabled="" type="checkbox"> 日志系统（redo log、undo log、binlog）</li>
<li><input disabled="" type="checkbox"> 主从复制</li>
<li><input disabled="" type="checkbox"> 备份恢复</li>
</ul>
<h3 id="7-3-高级阶段"><a href="#7-3-高级阶段" class="headerlink" title="7.3 高级阶段"></a>7.3 高级阶段</h3><ul>
<li><input disabled="" type="checkbox"> 性能调优</li>
<li><input disabled="" type="checkbox"> 分库分表</li>
<li><input disabled="" type="checkbox"> 读写分离</li>
<li><input disabled="" type="checkbox"> 高可用架构</li>
<li><input disabled="" type="checkbox"> MySQL 8.0 新特性</li>
<li><input disabled="" type="checkbox"> 与其他数据库对比（PostgreSQL、MongoDB）</li>
</ul>
<h3 id="7-4-实战建议"><a href="#7-4-实战建议" class="headerlink" title="7.4 实战建议"></a>7.4 实战建议</h3><ol>
<li><strong>搭建个人博客&#x2F;项目</strong>：实践数据库设计</li>
<li><strong>LeetCode 刷题</strong>：练习 SQL 查询</li>
<li><strong>阅读优秀项目</strong>：学习实际数据库设计</li>
<li><strong>性能测试</strong>：了解不同查询的性能差异</li>
<li><strong>参与开源</strong>：贡献或学习数据库相关项目</li>
</ol>
<h2 id="八、常见问题-FAQ"><a href="#八、常见问题-FAQ" class="headerlink" title="八、常见问题 FAQ"></a>八、常见问题 FAQ</h2><h3 id="Q1-COUNT-、COUNT-1-、COUNT-列-的区别？"><a href="#Q1-COUNT-、COUNT-1-、COUNT-列-的区别？" class="headerlink" title="Q1: COUNT(*)、COUNT(1)、COUNT(列) 的区别？"></a>Q1: COUNT(*)、COUNT(1)、COUNT(列) 的区别？</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="built_in">COUNT</span>(<span class="operator">*</span>)   <span class="comment">-- 统计所有行（包括 NULL），推荐</span></span><br><span class="line"><span class="built_in">COUNT</span>(<span class="number">1</span>)   <span class="comment">-- 同 COUNT(*)</span></span><br><span class="line"><span class="built_in">COUNT</span>(col) <span class="comment">-- 只统计非 NULL 的行</span></span><br></pre></td></tr></table></figure>

<h3 id="Q2-DELETE、TRUNCATE、DROP-的区别？"><a href="#Q2-DELETE、TRUNCATE、DROP-的区别？" class="headerlink" title="Q2: DELETE、TRUNCATE、DROP 的区别？"></a>Q2: DELETE、TRUNCATE、DROP 的区别？</h3><table>
<thead>
<tr>
<th>命令</th>
<th>类型</th>
<th>作用</th>
<th>可回滚</th>
</tr>
</thead>
<tbody><tr>
<td>DELETE</td>
<td>DML</td>
<td>删除符合条件的行</td>
<td>是</td>
</tr>
<tr>
<td>TRUNCATE</td>
<td>DDL</td>
<td>清空整张表</td>
<td>否</td>
</tr>
<tr>
<td>DROP</td>
<td>DDL</td>
<td>删除整个表</td>
<td>否</td>
</tr>
</tbody></table>
<h3 id="Q3-WHERE-和-HAVING-的区别？"><a href="#Q3-WHERE-和-HAVING-的区别？" class="headerlink" title="Q3: WHERE 和 HAVING 的区别？"></a>Q3: WHERE 和 HAVING 的区别？</h3><ul>
<li>WHERE：在分组前过滤，不能使用聚合函数</li>
<li>HAVING：在分组后过滤，可以使用聚合函数</li>
</ul>
<h3 id="Q4-INNER-JOIN-和-LEFT-JOIN-的选择？"><a href="#Q4-INNER-JOIN-和-LEFT-JOIN-的选择？" class="headerlink" title="Q4: INNER JOIN 和 LEFT JOIN 的选择？"></a>Q4: INNER JOIN 和 LEFT JOIN 的选择？</h3><ul>
<li>只返回匹配记录：INNER JOIN</li>
<li>需要保留左表全部记录：LEFT JOIN</li>
</ul>
<h3 id="Q5-如何避免-SQL-注入？"><a href="#Q5-如何避免-SQL-注入？" class="headerlink" title="Q5: 如何避免 SQL 注入？"></a>Q5: 如何避免 SQL 注入？</h3><ol>
<li>使用预编译语句（Prepare Statement）</li>
<li>使用 ORM 框架</li>
<li>验证用户输入</li>
<li>最小权限原则</li>
</ol>
<h2 id="九、推荐资源"><a href="#九、推荐资源" class="headerlink" title="九、推荐资源"></a>九、推荐资源</h2><h3 id="官方文档"><a href="#官方文档" class="headerlink" title="官方文档"></a>官方文档</h3><ul>
<li><a href="https://dev.mysql.com/doc/">MySQL 官方文档</a></li>
<li><a href="https://dev.mysql.com/doc/refman/8.0/en/tutorial.html">MySQL 教程</a></li>
</ul>
<h3 id="在线练习"><a href="#在线练习" class="headerlink" title="在线练习"></a>在线练习</h3><ul>
<li><a href="https://leetcode.com/problemset/database/">LeetCode 数据库题</a></li>
<li>[牛客网 SQL 练习](<a href="https://www.nowcoder.com/exam/oj?tab=SQL">https://www.nowcoder.com/exam/oj?tab=SQL</a> 篇)</li>
<li><a href="https://sqlzoo.net/">SQLZOO</a></li>
</ul>
<h3 id="书籍推荐"><a href="#书籍推荐" class="headerlink" title="书籍推荐"></a>书籍推荐</h3><ul>
<li>《MySQL 必知必会》- 入门经典</li>
<li>《高性能 MySQL》- 进阶必读</li>
<li>《MySQL 技术内幕：InnoDB 存储引擎》- 深入理解</li>
</ul>
<h2 id="十、结语"><a href="#十、结语" class="headerlink" title="十、结语"></a>十、结语</h2><p>恭喜完成 MySQL 基础篇和进阶教程的学习！</p>
<p><strong>学习建议</strong>：</p>
<ol>
<li>理论结合实践，多动手写 SQL</li>
<li>理解原理，不只是死记语法</li>
<li>关注性能，养成写高效 SQL 的习惯</li>
<li>持续学习，数据库技术不断更新</li>
</ol>
<p><strong>下一步</strong>：</p>
<ul>
<li>开始进阶阶段的学习</li>
<li>在项目中实践所学知识</li>
<li>深入学习 InnoDB 存储引擎</li>
<li>了解数据库性能优化</li>
</ul>
<p>祝你在数据库学习的道路上越走越远！</p>
<hr>
<p><strong>上一篇</strong>：[MySQL 进阶教程（四）：事务详解](&#x2F;2026&#x2F;02&#x2F;23&#x2F;MySQL 进阶教程（四）事务详解&#x2F;)</p>
<p><strong>基础教程系列</strong>：</p>
<ul>
<li>[（一）数据库基础与环境搭建](&#x2F;2026&#x2F;02&#x2F;23&#x2F;MySQL 基础教程（一）数据库基础与环境搭建&#x2F;)</li>
<li>[（二）DDL 数据定义语言详解](&#x2F;2026&#x2F;02&#x2F;23&#x2F;MySQL 基础教程（二）DDL 数据定义语言详解&#x2F;)</li>
<li>[（三）DML 数据操作语言详解](&#x2F;2026&#x2F;02&#x2F;23&#x2F;MySQL 基础教程（三）DML 数据操作语言详解&#x2F;)</li>
<li>[（四）DQL 数据查询语言详解](&#x2F;2026&#x2F;02&#x2F;23&#x2F;MySQL 基础教程（四）DQL 数据查询语言详解（上）&#x2F;)</li>
<li>[（五）DCL 数据控制语言详解](&#x2F;2026&#x2F;02&#x2F;23&#x2F;MySQL 基础教程（五）DCL 数据控制语言详解&#x2F;)</li>
</ul>
<p><strong>进阶教程系列</strong>：</p>
<ul>
<li>[（一）常用函数详解](&#x2F;2026&#x2F;02&#x2F;23&#x2F;MySQL 进阶教程（一）常用函数详解&#x2F;)</li>
<li>[（二）数据库约束详解](&#x2F;2026&#x2F;02&#x2F;23&#x2F;MySQL 进阶教程（二）数据库约束详解&#x2F;)</li>
<li>[（三）多表查询详解](&#x2F;2026&#x2F;02&#x2F;23&#x2F;MySQL 进阶教程（三）多表查询详解&#x2F;)</li>
<li>[（四）事务详解](&#x2F;2026&#x2F;02&#x2F;23&#x2F;MySQL 进阶教程（四）事务详解&#x2F;)</li>
</ul>
]]></content>
      <categories>
        <category>MySQL 进阶教程</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
        <tag>总结</tag>
        <tag>学习路线</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQL 进阶教程（四）事务详解</title>
    <url>/2026/02/23/MySQL%20%E8%BF%9B%E9%98%B6%E6%95%99%E7%A8%8B%EF%BC%88%E5%9B%9B%EF%BC%89%E4%BA%8B%E5%8A%A1%E8%AF%A6%E8%A7%A3/</url>
    <content><![CDATA[<h1 id="MySQL-进阶教程（四）事务详解"><a href="#MySQL-进阶教程（四）事务详解" class="headerlink" title="MySQL 进阶教程（四）事务详解"></a>MySQL 进阶教程（四）事务详解</h1><p>事务是数据库管理的核心技术之一，用于保证数据的完整性和一致性。本文将详细讲解事务的概念、ACID 特性、并发问题以及隔离级别。</p>
<h2 id="一、事务简介"><a href="#一、事务简介" class="headerlink" title="一、事务简介"></a>一、事务简介</h2><h3 id="1-1-什么是事务？"><a href="#1-1-什么是事务？" class="headerlink" title="1.1 什么是事务？"></a>1.1 什么是事务？</h3><p><strong>事务（Transaction）</strong> 是数据库管理系统执行过程中的一个逻辑单位，由一个有限的数据库操作序列构成。这些操作要么全部成功执行，要么全部不执行，是一个不可分割的工作单位。</p>
<h3 id="1-2-事务的特点"><a href="#1-2-事务的特点" class="headerlink" title="1.2 事务的特点"></a>1.2 事务的特点</h3><ol>
<li><strong>原子性</strong>：事务是一个不可分割的操作序列</li>
<li><strong>一致性</strong>：事务执行前后，数据保持一致</li>
<li><strong>独立性</strong>：多个事务并发执行时互不干扰</li>
<li><strong>持久性</strong>：事务一旦提交，修改永久保存</li>
</ol>
<h3 id="1-3-事务的使用场景"><a href="#1-3-事务的使用场景" class="headerlink" title="1.3 事务的使用场景"></a>1.3 事务的使用场景</h3><table>
<thead>
<tr>
<th>场景</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>银行转账</td>
<td>A 转给 B 钱，A 扣款和 B 收款必须同时成功或失败</td>
</tr>
<tr>
<td>订单创建</td>
<td>创建订单、扣减库存、生成物流单必须同时成功</td>
</tr>
<tr>
<td>批量操作</td>
<td>批量导入数据，要么全部导入成功，要么全部回滚</td>
</tr>
<tr>
<td>数据一致性</td>
<td>更新多个关联表时保持一致性</td>
</tr>
</tbody></table>
<h3 id="1-4-不使用事务的问题"><a href="#1-4-不使用事务的问题" class="headerlink" title="1.4 不使用事务的问题"></a>1.4 不使用事务的问题</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 不使用事务的转账操作</span></span><br><span class="line"><span class="comment">-- 步骤 1：A 账户扣款</span></span><br><span class="line"><span class="keyword">UPDATE</span> accounts <span class="keyword">SET</span> balance <span class="operator">=</span> balance <span class="operator">-</span> <span class="number">100</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 假设这里系统故障或断电...</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 步骤 2：B 账户收款（可能永远不会执行）</span></span><br><span class="line"><span class="keyword">UPDATE</span> accounts <span class="keyword">SET</span> balance <span class="operator">=</span> balance <span class="operator">+</span> <span class="number">100</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 结果：A 的钱扣了，但 B 没收到，数据不一致！</span></span><br></pre></td></tr></table></figure>

<h2 id="二、事务操作演示"><a href="#二、事务操作演示" class="headerlink" title="二、事务操作演示"></a>二、事务操作演示</h2><h3 id="2-1-事务控制语句"><a href="#2-1-事务控制语句" class="headerlink" title="2.1 事务控制语句"></a>2.1 事务控制语句</h3><table>
<thead>
<tr>
<th>语句</th>
<th>功能</th>
</tr>
</thead>
<tbody><tr>
<td>START TRANSACTION &#x2F; BEGIN</td>
<td>开启事务</td>
</tr>
<tr>
<td>COMMIT</td>
<td>提交事务</td>
</tr>
<tr>
<td>ROLLBACK</td>
<td>回滚事务</td>
</tr>
<tr>
<td>SAVEPOINT</td>
<td>设置保存点</td>
</tr>
<tr>
<td>ROLLBACK TO SAVEPOINT</td>
<td>回滚到保存点</td>
</tr>
<tr>
<td>SET autocommit &#x3D; 0&#x2F;1</td>
<td>设置自动提交</td>
</tr>
</tbody></table>
<h3 id="2-2-准备测试数据"><a href="#2-2-准备测试数据" class="headerlink" title="2.2 准备测试数据"></a>2.2 准备测试数据</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 创建账户表</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> accounts;</span><br><span class="line"><span class="keyword">CREATE TABLE</span> accounts (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT,</span><br><span class="line">    account_name <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">    balance <span class="type">DECIMAL</span>(<span class="number">12</span>, <span class="number">2</span>) <span class="keyword">DEFAULT</span> <span class="number">0</span></span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 插入测试数据</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> accounts (account_name, balance) <span class="keyword">VALUES</span></span><br><span class="line">(<span class="string">&#x27;张三&#x27;</span>, <span class="number">10000</span>),</span><br><span class="line">(<span class="string">&#x27;李四&#x27;</span>, <span class="number">5000</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看初始数据</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> accounts;</span><br></pre></td></tr></table></figure>

<h3 id="2-3-基础事务操作"><a href="#2-3-基础事务操作" class="headerlink" title="2.3 基础事务操作"></a>2.3 基础事务操作</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 查看自动提交状态</span></span><br><span class="line"><span class="keyword">SELECT</span> @<span class="variable">@autocommit</span>;  <span class="comment">-- 1 表示开启，0 表示关闭</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 开启事务</span></span><br><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"><span class="comment">-- 或</span></span><br><span class="line"><span class="keyword">BEGIN</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 执行 DML 操作</span></span><br><span class="line"><span class="keyword">UPDATE</span> accounts <span class="keyword">SET</span> balance <span class="operator">=</span> balance <span class="operator">-</span> <span class="number">100</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">UPDATE</span> accounts <span class="keyword">SET</span> balance <span class="operator">=</span> balance <span class="operator">+</span> <span class="number">100</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看临时结果（当前会话可见）</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> accounts;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 提交事务（使更改永久生效）</span></span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 再次查看（其他会话也可见）</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> accounts;</span><br></pre></td></tr></table></figure>

<h3 id="2-4-事务回滚"><a href="#2-4-事务回滚" class="headerlink" title="2.4 事务回滚"></a>2.4 事务回滚</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 开启事务</span></span><br><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 执行操作</span></span><br><span class="line"><span class="keyword">UPDATE</span> accounts <span class="keyword">SET</span> balance <span class="operator">=</span> balance <span class="operator">-</span> <span class="number">1000</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">UPDATE</span> accounts <span class="keyword">SET</span> balance <span class="operator">=</span> balance <span class="operator">+</span> <span class="number">1000</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 发现问题，回滚事务</span></span><br><span class="line"><span class="keyword">ROLLBACK</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 数据恢复原状</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> accounts;</span><br></pre></td></tr></table></figure>

<h3 id="2-5-保存点（SAVEPOINT）"><a href="#2-5-保存点（SAVEPOINT）" class="headerlink" title="2.5 保存点（SAVEPOINT）"></a>2.5 保存点（SAVEPOINT）</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 开启事务</span></span><br><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 操作 1</span></span><br><span class="line"><span class="keyword">UPDATE</span> accounts <span class="keyword">SET</span> balance <span class="operator">=</span> balance <span class="operator">-</span> <span class="number">100</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 设置保存点</span></span><br><span class="line"><span class="keyword">SAVEPOINT</span> sp1;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 操作 2</span></span><br><span class="line"><span class="keyword">UPDATE</span> accounts <span class="keyword">SET</span> balance <span class="operator">=</span> balance <span class="operator">-</span> <span class="number">200</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 设置保存点</span></span><br><span class="line"><span class="keyword">SAVEPOINT</span> sp2;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 操作 3（假设出错了）</span></span><br><span class="line"><span class="keyword">UPDATE</span> accounts <span class="keyword">SET</span> balance <span class="operator">=</span> balance <span class="operator">-</span> <span class="number">300</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 回滚到保存点 sp2（撤销操作 3）</span></span><br><span class="line"><span class="keyword">ROLLBACK</span> <span class="keyword">TO</span> sp2;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 回滚到保存点 sp1（撤销操作 2 和 3）</span></span><br><span class="line"><span class="keyword">ROLLBACK</span> <span class="keyword">TO</span> sp1;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 提交事务（只有操作 1 生效）</span></span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 释放保存点</span></span><br><span class="line"><span class="keyword">RELEASE</span> <span class="keyword">SAVEPOINT</span> sp1;</span><br></pre></td></tr></table></figure>

<h3 id="2-6-自动提交控制"><a href="#2-6-自动提交控制" class="headerlink" title="2.6 自动提交控制"></a>2.6 自动提交控制</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 查看自动提交状态</span></span><br><span class="line"><span class="keyword">SELECT</span> @<span class="variable">@autocommit</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 关闭自动提交（之后所有操作都在事务中）</span></span><br><span class="line"><span class="keyword">SET</span> autocommit <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 执行操作（不会自动提交）</span></span><br><span class="line"><span class="keyword">UPDATE</span> accounts <span class="keyword">SET</span> balance <span class="operator">=</span> balance <span class="operator">-</span> <span class="number">100</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 手动提交</span></span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 开启自动提交</span></span><br><span class="line"><span class="keyword">SET</span> autocommit <span class="operator">=</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<h2 id="三、事务的-ACID-特性"><a href="#三、事务的-ACID-特性" class="headerlink" title="三、事务的 ACID 特性"></a>三、事务的 ACID 特性</h2><h3 id="3-1-原子性（Atomicity）"><a href="#3-1-原子性（Atomicity）" class="headerlink" title="3.1 原子性（Atomicity）"></a>3.1 原子性（Atomicity）</h3><p><strong>原子性</strong> 指事务是一个不可分割的最小工作单位，事务中的操作要么全部成功，要么全部失败。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 原子性演示</span></span><br><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"></span><br><span class="line"><span class="keyword">UPDATE</span> accounts <span class="keyword">SET</span> balance <span class="operator">=</span> balance <span class="operator">-</span> <span class="number">100</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="comment">-- 假设这里发生错误（如除零、违反约束等）</span></span><br><span class="line"><span class="keyword">UPDATE</span> accounts <span class="keyword">SET</span> balance <span class="operator">=</span> balance <span class="operator">/</span> <span class="number">0</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">2</span>;  <span class="comment">-- 错误！</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 由于发生错误，整个事务会自动回滚</span></span><br><span class="line"><span class="comment">-- 操作 1 也会被撤销</span></span><br><span class="line"><span class="keyword">ROLLBACK</span>;  <span class="comment">-- 或者让 MySQL 自动回滚</span></span><br></pre></td></tr></table></figure>

<p><strong>原子性的实现</strong>：通过 undo log（回滚日志）实现。</p>
<h3 id="3-2-一致性（Consistency）"><a href="#3-2-一致性（Consistency）" class="headerlink" title="3.2 一致性（Consistency）"></a>3.2 一致性（Consistency）</h3><p><strong>一致性</strong> 指事务执行前后，数据必须保持一致状态，满足所有约束、触发器等规则。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 一致性演示</span></span><br><span class="line"><span class="comment">-- 假设有检查约束：balance &gt;= 0</span></span><br><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"></span><br><span class="line"><span class="keyword">UPDATE</span> accounts <span class="keyword">SET</span> balance <span class="operator">=</span> balance <span class="operator">-</span> <span class="number">20000</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="comment">-- 如果余额不足，违反约束，事务会回滚</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 一致性确保：</span></span><br><span class="line"><span class="comment">-- 1. 所有约束都被满足</span></span><br><span class="line"><span class="comment">-- 2. 所有触发器都被触发</span></span><br><span class="line"><span class="comment">-- 3. 外键约束被维护</span></span><br><span class="line"><span class="comment">-- 4. 数据逻辑一致</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br></pre></td></tr></table></figure>

<p><strong>一致性的实现</strong>：原子性和持久性保证数据不丢失，隔离性保证并发一致。</p>
<h3 id="3-3-隔离性（Isolation）"><a href="#3-3-隔离性（Isolation）" class="headerlink" title="3.3 隔离性（Isolation）"></a>3.3 隔离性（Isolation）</h3><p><strong>隔离性</strong> 指多个事务并发执行时，一个事务的执行不应影响其他事务。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 会话 A</span></span><br><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"><span class="keyword">SELECT</span> balance <span class="keyword">FROM</span> accounts <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;  <span class="comment">-- 10000</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 会话 B（同时）</span></span><br><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"><span class="keyword">UPDATE</span> accounts <span class="keyword">SET</span> balance <span class="operator">=</span> balance <span class="operator">-</span> <span class="number">100</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 会话 A（再次查询）</span></span><br><span class="line"><span class="keyword">SELECT</span> balance <span class="keyword">FROM</span> accounts <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="comment">-- 不同隔离级别下结果可能不同</span></span><br></pre></td></tr></table></figure>

<p><strong>隔离性的实现</strong>：通过锁机制和 MVCC（多版本并发控制）实现。</p>
<h3 id="3-4-持久性（Durability）"><a href="#3-4-持久性（Durability）" class="headerlink" title="3.4 持久性（Durability）"></a>3.4 持久性（Durability）</h3><p><strong>持久性</strong> 指事务一旦提交，对数据的修改是永久的，即使系统故障也不会丢失。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"><span class="keyword">UPDATE</span> accounts <span class="keyword">SET</span> balance <span class="operator">=</span> balance <span class="operator">-</span> <span class="number">100</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">COMMIT</span>;  <span class="comment">-- 提交后，即使立即断电，数据也不会丢失</span></span><br></pre></td></tr></table></figure>

<p><strong>持久性的实现</strong>：通过 redo log（重做日志）实现。</p>
<h2 id="四、并发事务问题"><a href="#四、并发事务问题" class="headerlink" title="四、并发事务问题"></a>四、并发事务问题</h2><h3 id="4-1-并发事务场景"><a href="#4-1-并发事务场景" class="headerlink" title="4.1 并发事务场景"></a>4.1 并发事务场景</h3><p>当多个事务同时访问同一数据时，可能产生以下问题：</p>
<table>
<thead>
<tr>
<th>问题</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>脏读（Dirty Read）</td>
<td>读到其他事务未提交的数据</td>
</tr>
<tr>
<td>不可重复读（Non-repeatable Read）</td>
<td>同一事务中多次读取结果不一致</td>
</tr>
<tr>
<td>幻读（Phantom Read）</td>
<td>同一事务中多次查询，记录数不一致</td>
</tr>
</tbody></table>
<h3 id="4-2-脏读（Dirty-Read）"><a href="#4-2-脏读（Dirty-Read）" class="headerlink" title="4.2 脏读（Dirty Read）"></a>4.2 脏读（Dirty Read）</h3><p><strong>脏读</strong> 是指一个事务读取了另一个事务未提交的修改。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 会话 A</span></span><br><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"><span class="keyword">UPDATE</span> accounts <span class="keyword">SET</span> balance <span class="operator">=</span> balance <span class="operator">-</span> <span class="number">100</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="comment">-- 尚未提交</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 会话 B</span></span><br><span class="line"><span class="keyword">SELECT</span> balance <span class="keyword">FROM</span> accounts <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="comment">-- 读到了 A 未提交的修改（脏读）</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 会话 A 回滚</span></span><br><span class="line"><span class="keyword">ROLLBACK</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 结果：会话 B 读到的数据是无效的</span></span><br></pre></td></tr></table></figure>

<h3 id="4-3-不可重复读（Non-repeatable-Read）"><a href="#4-3-不可重复读（Non-repeatable-Read）" class="headerlink" title="4.3 不可重复读（Non-repeatable Read）"></a>4.3 不可重复读（Non-repeatable Read）</h3><p><strong>不可重复读</strong> 是指在同一事务中，多次读取同一数据得到不同结果。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 会话 A</span></span><br><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"><span class="keyword">SELECT</span> balance <span class="keyword">FROM</span> accounts <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;  <span class="comment">-- 10000</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 会话 B</span></span><br><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"><span class="keyword">UPDATE</span> accounts <span class="keyword">SET</span> balance <span class="operator">=</span> <span class="number">9900</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 会话 A</span></span><br><span class="line"><span class="keyword">SELECT</span> balance <span class="keyword">FROM</span> accounts <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;  <span class="comment">-- 9900（与第一次不同）</span></span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 结果：同一事务中两次读取结果不同</span></span><br></pre></td></tr></table></figure>

<p><strong>与脏读的区别</strong>：不可重复读读到的是已提交的数据，但不是预期的结果。</p>
<h3 id="4-4-幻读（Phantom-Read）"><a href="#4-4-幻读（Phantom-Read）" class="headerlink" title="4.4 幻读（Phantom Read）"></a>4.4 幻读（Phantom Read）</h3><p><strong>幻读</strong> 是指在同一事务中，多次查询同一范围的数据，记录数不一致。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 会话 A</span></span><br><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> accounts <span class="keyword">WHERE</span> balance <span class="operator">&gt;</span> <span class="number">5000</span>;  <span class="comment">-- 返回 2 条</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 会话 B</span></span><br><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"><span class="keyword">INSERT INTO</span> accounts (account_name, balance) <span class="keyword">VALUES</span> (<span class="string">&#x27;王五&#x27;</span>, <span class="number">6000</span>);</span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 会话 A</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> accounts <span class="keyword">WHERE</span> balance <span class="operator">&gt;</span> <span class="number">5000</span>;  <span class="comment">-- 返回 3 条（多出 1 条）</span></span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 结果：同一事务中两次查询记录数不同</span></span><br></pre></td></tr></table></figure>

<h3 id="4-5-三种问题对比"><a href="#4-5-三种问题对比" class="headerlink" title="4.5 三种问题对比"></a>4.5 三种问题对比</h3><table>
<thead>
<tr>
<th>问题</th>
<th>原因</th>
<th>表现</th>
</tr>
</thead>
<tbody><tr>
<td>脏读</td>
<td>读到未提交数据</td>
<td>数据无效</td>
</tr>
<tr>
<td>不可重复读</td>
<td>读到已提交更新</td>
<td>值变化</td>
</tr>
<tr>
<td>幻读</td>
<td>读到已提交插入</td>
<td>记录数变化</td>
</tr>
</tbody></table>
<h2 id="五、并发事务演示及隔离级别"><a href="#五、并发事务演示及隔离级别" class="headerlink" title="五、并发事务演示及隔离级别"></a>五、并发事务演示及隔离级别</h2><h3 id="5-1-事务隔离级别"><a href="#5-1-事务隔离级别" class="headerlink" title="5.1 事务隔离级别"></a>5.1 事务隔离级别</h3><p>SQL 标准定义了四种隔离级别，从低到高：</p>
<table>
<thead>
<tr>
<th>隔离级别</th>
<th>脏读</th>
<th>不可重复读</th>
<th>幻读</th>
</tr>
</thead>
<tbody><tr>
<td>READ UNCOMMITTED（读未提交）</td>
<td>可能</td>
<td>可能</td>
<td>可能</td>
</tr>
<tr>
<td>READ COMMITTED（读已提交）</td>
<td>否</td>
<td>可能</td>
<td>可能</td>
</tr>
<tr>
<td>REPEATABLE READ（可重复读）</td>
<td>否</td>
<td>否</td>
<td>可能*</td>
</tr>
<tr>
<td>SERIALIZABLE（串行化）</td>
<td>否</td>
<td>否</td>
<td>否</td>
</tr>
</tbody></table>
<p>*MySQL InnoDB 通过 MVCC 在 REPEATABLE READ 级别避免了幻读</p>
<h3 id="5-2-查看和设置隔离级别"><a href="#5-2-查看和设置隔离级别" class="headerlink" title="5.2 查看和设置隔离级别"></a>5.2 查看和设置隔离级别</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 查看当前会话隔离级别</span></span><br><span class="line"><span class="keyword">SELECT</span> @<span class="variable">@transaction_isolation</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看全局隔离级别</span></span><br><span class="line"><span class="keyword">SELECT</span> @<span class="variable">@global</span>.transaction_isolation;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 设置会话隔离级别（只影响当前会话）</span></span><br><span class="line"><span class="keyword">SET</span> SESSION TRANSACTION ISOLATION LEVEL READ UNCOMMITTED;</span><br><span class="line"><span class="keyword">SET</span> SESSION TRANSACTION ISOLATION LEVEL READ COMMITTED;</span><br><span class="line"><span class="keyword">SET</span> SESSION TRANSACTION ISOLATION LEVEL REPEATABLE READ;  <span class="comment">-- MySQL 默认</span></span><br><span class="line"><span class="keyword">SET</span> SESSION TRANSACTION ISOLATION LEVEL SERIALIZABLE;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 设置全局隔离级别（影响新会话）</span></span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span> TRANSACTION ISOLATION LEVEL READ COMMITTED;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 在事务开始前设置</span></span><br><span class="line"><span class="keyword">SET</span> TRANSACTION ISOLATION LEVEL SERIALIZABLE;</span><br><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br></pre></td></tr></table></figure>

<h3 id="5-3-READ-UNCOMMITTED-演示"><a href="#5-3-READ-UNCOMMITTED-演示" class="headerlink" title="5.3 READ UNCOMMITTED 演示"></a>5.3 READ UNCOMMITTED 演示</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 设置隔离级别为读未提交</span></span><br><span class="line"><span class="keyword">SET</span> SESSION TRANSACTION ISOLATION LEVEL READ UNCOMMITTED;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 会话 A</span></span><br><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"><span class="keyword">UPDATE</span> accounts <span class="keyword">SET</span> balance <span class="operator">=</span> balance <span class="operator">-</span> <span class="number">100</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="comment">-- 不提交</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 会话 B</span></span><br><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"><span class="keyword">SELECT</span> balance <span class="keyword">FROM</span> accounts <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;  <span class="comment">-- 读到未提交的值（脏读）</span></span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 会话 A 回滚</span></span><br><span class="line"><span class="keyword">ROLLBACK</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 结果：会话 B 读到的数据是无效的</span></span><br></pre></td></tr></table></figure>

<h3 id="5-4-READ-COMMITTED-演示"><a href="#5-4-READ-COMMITTED-演示" class="headerlink" title="5.4 READ COMMITTED 演示"></a>5.4 READ COMMITTED 演示</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 设置隔离级别为读已提交</span></span><br><span class="line"><span class="keyword">SET</span> SESSION TRANSACTION ISOLATION LEVEL READ COMMITTED;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 会话 A</span></span><br><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"><span class="keyword">SELECT</span> balance <span class="keyword">FROM</span> accounts <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;  <span class="comment">-- 10000</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 会话 B</span></span><br><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"><span class="keyword">UPDATE</span> accounts <span class="keyword">SET</span> balance <span class="operator">=</span> <span class="number">9900</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">COMMIT</span>;  <span class="comment">-- 提交</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 会话 A</span></span><br><span class="line"><span class="keyword">SELECT</span> balance <span class="keyword">FROM</span> accounts <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;  <span class="comment">-- 9900（不可重复读）</span></span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 结果：避免脏读，但出现不可重复读</span></span><br></pre></td></tr></table></figure>

<h3 id="5-5-REPEATABLE-READ-演示（MySQL-默认）"><a href="#5-5-REPEATABLE-READ-演示（MySQL-默认）" class="headerlink" title="5.5 REPEATABLE READ 演示（MySQL 默认）"></a>5.5 REPEATABLE READ 演示（MySQL 默认）</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 设置隔离级别为可重复读</span></span><br><span class="line"><span class="keyword">SET</span> SESSION TRANSACTION ISOLATION LEVEL REPEATABLE READ;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 会话 A</span></span><br><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"><span class="keyword">SELECT</span> balance <span class="keyword">FROM</span> accounts <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;  <span class="comment">-- 10000</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 会话 B</span></span><br><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"><span class="keyword">UPDATE</span> accounts <span class="keyword">SET</span> balance <span class="operator">=</span> <span class="number">9900</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 会话 A</span></span><br><span class="line"><span class="keyword">SELECT</span> balance <span class="keyword">FROM</span> accounts <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;  <span class="comment">-- 10000（仍然是原值）</span></span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 结果：避免脏读和不可重复读</span></span><br></pre></td></tr></table></figure>

<p><strong>InnoDB 的 MVCC</strong>：</p>
<ul>
<li>InnoDB 在 REPEATABLE READ 级别下使用 MVCC 避免幻读</li>
<li>通过读取历史版本实现可重复读</li>
</ul>
<h3 id="5-6-SERIALIZABLE-演示"><a href="#5-6-SERIALIZABLE-演示" class="headerlink" title="5.6 SERIALIZABLE 演示"></a>5.6 SERIALIZABLE 演示</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 设置隔离级别为串行化</span></span><br><span class="line"><span class="keyword">SET</span> SESSION TRANSACTION ISOLATION LEVEL SERIALIZABLE;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 会话 A</span></span><br><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> accounts <span class="keyword">WHERE</span> balance <span class="operator">&gt;</span> <span class="number">5000</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 会话 B（会被阻塞，直到 A 提交）</span></span><br><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"><span class="keyword">INSERT INTO</span> accounts (account_name, balance) <span class="keyword">VALUES</span> (<span class="string">&#x27;王五&#x27;</span>, <span class="number">6000</span>);</span><br><span class="line"><span class="comment">-- 等待...</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 会话 A</span></span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 会话 B 现在可以执行</span></span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 结果：完全串行执行，性能最差</span></span><br></pre></td></tr></table></figure>

<h3 id="5-7-隔离级别选择建议"><a href="#5-7-隔离级别选择建议" class="headerlink" title="5.7 隔离级别选择建议"></a>5.7 隔离级别选择建议</h3><table>
<thead>
<tr>
<th>隔离级别</th>
<th>适用场景</th>
<th>性能</th>
</tr>
</thead>
<tbody><tr>
<td>READ UNCOMMITTED</td>
<td>几乎不用，统计数据等对一致性要求低的场景</td>
<td>最高</td>
</tr>
<tr>
<td>READ COMMITTED</td>
<td>Oracle 默认，大多数场景足够</td>
<td>较高</td>
</tr>
<tr>
<td>REPEATABLE READ</td>
<td>MySQL 默认，适合需要可重复读的场景</td>
<td>中等</td>
</tr>
<tr>
<td>SERIALIZABLE</td>
<td>对一致性要求极高，并发低的场景</td>
<td>最低</td>
</tr>
</tbody></table>
<p><strong>推荐</strong>：</p>
<ul>
<li>一般应用：使用默认的 REPEATABLE READ</li>
<li>高并发场景：可以考虑 READ COMMITTED</li>
<li>特殊场景：根据需求调整</li>
</ul>
<h2 id="六、锁机制"><a href="#六、锁机制" class="headerlink" title="六、锁机制"></a>六、锁机制</h2><h3 id="6-1-锁的类型"><a href="#6-1-锁的类型" class="headerlink" title="6.1 锁的类型"></a>6.1 锁的类型</h3><table>
<thead>
<tr>
<th>锁类型</th>
<th>说明</th>
<th>特点</th>
</tr>
</thead>
<tbody><tr>
<td>共享锁（S 锁）</td>
<td>读锁</td>
<td>多个事务可同时持有</td>
</tr>
<tr>
<td>排他锁（X 锁）</td>
<td>写锁</td>
<td>只能有一个事务持有</td>
</tr>
<tr>
<td>意向锁</td>
<td>表级锁</td>
<td>表明事务要在某行上加锁</td>
</tr>
</tbody></table>
<h3 id="6-2-显式加锁"><a href="#6-2-显式加锁" class="headerlink" title="6.2 显式加锁"></a>6.2 显式加锁</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 共享锁（读锁）</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> accounts <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span> LOCK <span class="keyword">IN</span> SHARE MODE;</span><br><span class="line"><span class="comment">-- MySQL 8.0+ 语法</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> accounts <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span> <span class="keyword">FOR</span> SHARE;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 排他锁（写锁）</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> accounts <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span> <span class="keyword">FOR</span> <span class="keyword">UPDATE</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 跳过已锁定的行</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> accounts <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span> <span class="keyword">FOR</span> <span class="keyword">UPDATE</span> <span class="keyword">SKIP</span> LOCKED;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 不等待锁（立即返回错误）</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> accounts <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span> <span class="keyword">FOR</span> <span class="keyword">UPDATE</span> NOWAIT;</span><br></pre></td></tr></table></figure>

<h3 id="6-3-查看锁信息"><a href="#6-3-查看锁信息" class="headerlink" title="6.3 查看锁信息"></a>6.3 查看锁信息</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 查看正在执行的事务</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> information_schema.innodb_trx;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看锁信息</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> information_schema.innodb_locks;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看锁等待情况</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> information_schema.innodb_lock_waits;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看进程列表</span></span><br><span class="line"><span class="keyword">SHOW</span> PROCESSLIST;</span><br></pre></td></tr></table></figure>

<h2 id="七、事务最佳实践"><a href="#七、事务最佳实践" class="headerlink" title="七、事务最佳实践"></a>七、事务最佳实践</h2><h3 id="7-1-事务使用建议"><a href="#7-1-事务使用建议" class="headerlink" title="7.1 事务使用建议"></a>7.1 事务使用建议</h3><ol>
<li><strong>保持事务简短</strong></li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 不好：事务太长，占用资源</span></span><br><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"><span class="keyword">SELECT</span> ...;</span><br><span class="line"><span class="keyword">UPDATE</span> ...;</span><br><span class="line"><span class="keyword">SELECT</span> ...;</span><br><span class="line"><span class="keyword">UPDATE</span> ...;</span><br><span class="line"><span class="comment">-- 很多操作...</span></span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 好：只包含必要的操作</span></span><br><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"><span class="keyword">UPDATE</span> ...;</span><br><span class="line"><span class="keyword">UPDATE</span> ...;</span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><strong>避免在事务中等待用户输入</strong></li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 不好</span></span><br><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"><span class="keyword">UPDATE</span> accounts <span class="keyword">SET</span> balance <span class="operator">=</span> balance <span class="operator">-</span> <span class="number">100</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="comment">-- 等待用户确认...（事务长时间不提交）</span></span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 好：快速提交，异步处理</span></span><br><span class="line"><span class="keyword">UPDATE</span> accounts <span class="keyword">SET</span> balance <span class="operator">=</span> balance <span class="operator">-</span> <span class="number">100</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="comment">-- 异步发送确认邮件等</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li><strong>处理死锁</strong></li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 应用层捕获死锁异常并重试</span></span><br><span class="line">try &#123;</span><br><span class="line">    <span class="operator">/</span><span class="operator">/</span> 执行事务</span><br><span class="line">&#125; catch (DeadlockException e) &#123;</span><br><span class="line">    <span class="operator">/</span><span class="operator">/</span> 重试逻辑</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="7-2-转账事务完整示例"><a href="#7-2-转账事务完整示例" class="headerlink" title="7.2 转账事务完整示例"></a>7.2 转账事务完整示例</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">DELIMITER <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> transfer_money(</span><br><span class="line">    <span class="keyword">IN</span> from_id <span class="type">INT</span>,</span><br><span class="line">    <span class="keyword">IN</span> to_id <span class="type">INT</span>,</span><br><span class="line">    <span class="keyword">IN</span> amount <span class="type">DECIMAL</span>(<span class="number">12</span>, <span class="number">2</span>)</span><br><span class="line">)</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">DECLARE</span> from_balance <span class="type">DECIMAL</span>(<span class="number">12</span>, <span class="number">2</span>);</span><br><span class="line">    <span class="keyword">DECLARE</span> EXIT HANDLER <span class="keyword">FOR</span> <span class="keyword">SQLEXCEPTION</span></span><br><span class="line">    <span class="keyword">BEGIN</span></span><br><span class="line">        <span class="keyword">ROLLBACK</span>;</span><br><span class="line">        <span class="keyword">SELECT</span> <span class="string">&#x27;Transfer failed&#x27;</span> <span class="keyword">AS</span> <span class="keyword">result</span>;</span><br><span class="line">    <span class="keyword">END</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">START</span> TRANSACTION;</span><br><span class="line"></span><br><span class="line">    <span class="comment">-- 锁定账户（防止并发修改）</span></span><br><span class="line">    <span class="keyword">SELECT</span> balance <span class="keyword">INTO</span> from_balance</span><br><span class="line">    <span class="keyword">FROM</span> accounts <span class="keyword">WHERE</span> id <span class="operator">=</span> from_id</span><br><span class="line">    <span class="keyword">FOR</span> <span class="keyword">UPDATE</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">-- 检查余额</span></span><br><span class="line">    IF from_balance <span class="operator">&lt;</span> amount <span class="keyword">THEN</span></span><br><span class="line">        <span class="keyword">ROLLBACK</span>;</span><br><span class="line">        <span class="keyword">SELECT</span> <span class="string">&#x27;Insufficient balance&#x27;</span> <span class="keyword">AS</span> <span class="keyword">result</span>;</span><br><span class="line">    <span class="keyword">ELSE</span></span><br><span class="line">        <span class="comment">-- 扣款</span></span><br><span class="line">        <span class="keyword">UPDATE</span> accounts <span class="keyword">SET</span> balance <span class="operator">=</span> balance <span class="operator">-</span> amount</span><br><span class="line">        <span class="keyword">WHERE</span> id <span class="operator">=</span> from_id;</span><br><span class="line"></span><br><span class="line">        <span class="comment">-- 收款</span></span><br><span class="line">        <span class="keyword">UPDATE</span> accounts <span class="keyword">SET</span> balance <span class="operator">=</span> balance <span class="operator">+</span> amount</span><br><span class="line">        <span class="keyword">WHERE</span> id <span class="operator">=</span> to_id;</span><br><span class="line"></span><br><span class="line">        <span class="comment">-- 记录日志</span></span><br><span class="line">        <span class="keyword">INSERT INTO</span> transfer_logs (from_id, to_id, amount, create_time)</span><br><span class="line">        <span class="keyword">VALUES</span> (from_id, to_id, amount, NOW());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">COMMIT</span>;</span><br><span class="line">        <span class="keyword">SELECT</span> <span class="string">&#x27;Transfer success&#x27;</span> <span class="keyword">AS</span> <span class="keyword">result</span>;</span><br><span class="line">    <span class="keyword">END</span> IF;</span><br><span class="line"><span class="keyword">END</span> <span class="operator">/</span><span class="operator">/</span></span><br><span class="line">DELIMITER ;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 调用</span></span><br><span class="line"><span class="keyword">CALL</span> transfer_money(<span class="number">1</span>, <span class="number">2</span>, <span class="number">100</span>);</span><br></pre></td></tr></table></figure>

<h2 id="八、小结"><a href="#八、小结" class="headerlink" title="八、小结"></a>八、小结</h2><h3 id="事务知识点回顾"><a href="#事务知识点回顾" class="headerlink" title="事务知识点回顾"></a>事务知识点回顾</h3><ol>
<li><p><strong>事务控制语句</strong></p>
<ul>
<li>START TRANSACTION &#x2F; BEGIN：开启事务</li>
<li>COMMIT：提交事务</li>
<li>ROLLBACK：回滚事务</li>
<li>SAVEPOINT：设置保存点</li>
</ul>
</li>
<li><p><strong>ACID 特性</strong></p>
<ul>
<li>原子性：不可分割</li>
<li>一致性：数据一致</li>
<li>隔离性：互不干扰</li>
<li>持久性：永久保存</li>
</ul>
</li>
<li><p><strong>并发问题</strong></p>
<ul>
<li>脏读：读未提交数据</li>
<li>不可重复读：值变化</li>
<li>幻读：记录数变化</li>
</ul>
</li>
<li><p><strong>隔离级别</strong></p>
<ul>
<li>READ UNCOMMITTED</li>
<li>READ COMMITTED</li>
<li>REPEATABLE READ（MySQL 默认）</li>
<li>SERIALIZABLE</li>
</ul>
</li>
</ol>
<h3 id="隔离级别对比表"><a href="#隔离级别对比表" class="headerlink" title="隔离级别对比表"></a>隔离级别对比表</h3><table>
<thead>
<tr>
<th>隔离级别</th>
<th>脏读</th>
<th>不可重复读</th>
<th>幻读</th>
<th>性能</th>
</tr>
</thead>
<tbody><tr>
<td>READ UNCOMMITTED</td>
<td>✓</td>
<td>✓</td>
<td>✓</td>
<td>最高</td>
</tr>
<tr>
<td>READ COMMITTED</td>
<td>✗</td>
<td>✓</td>
<td>✓</td>
<td>较高</td>
</tr>
<tr>
<td>REPEATABLE READ</td>
<td>✗</td>
<td>✗</td>
<td>✗*</td>
<td>中等</td>
</tr>
<tr>
<td>SERIALIZABLE</td>
<td>✗</td>
<td>✗</td>
<td>✗</td>
<td>最低</td>
</tr>
</tbody></table>
<p>*MySQL InnoDB 通过 MVCC 避免幻读</p>
<h3 id="实际应用建议"><a href="#实际应用建议" class="headerlink" title="实际应用建议"></a>实际应用建议</h3><ol>
<li>使用默认的 REPEATABLE READ 隔离级别</li>
<li>保持事务简短，避免长时间持有锁</li>
<li>处理可能的死锁情况</li>
<li>对于高并发场景，可以考虑 READ COMMITTED</li>
<li>使用合适的索引减少锁竞争</li>
</ol>
<hr>
<p><strong>下一篇</strong>：[MySQL 进阶教程（五）：基础篇总结](&#x2F;2026&#x2F;02&#x2F;23&#x2F;MySQL 进阶教程（五）基础篇总结&#x2F;)</p>
<p><strong>上一篇</strong>：[MySQL 进阶教程（三）：多表查询详解](&#x2F;2026&#x2F;02&#x2F;23&#x2F;MySQL 进阶教程（三）多表查询详解&#x2F;)</p>
]]></content>
      <categories>
        <category>MySQL 进阶教程</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
        <tag>事务</tag>
        <tag>ACID</tag>
        <tag>并发控制</tag>
      </tags>
  </entry>
  <entry>
    <title>Python 基础教程（三）异常处理</title>
    <url>/2026/02/24/Python%20%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B%EF%BC%88%E4%B8%89%EF%BC%89%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86/</url>
    <content><![CDATA[<h1 id="Python-基础教程（三）异常处理"><a href="#Python-基础教程（三）异常处理" class="headerlink" title="Python 基础教程（三）异常处理"></a>Python 基础教程（三）异常处理</h1><p>异常处理是编写健壮程序的关键。本篇将介绍 Python 中的异常处理机制，以及如何优雅地处理错误。</p>
<h2 id="一、异常基础"><a href="#一、异常基础" class="headerlink" title="一、异常基础"></a>一、异常基础</h2><h3 id="1-1-什么是异常？"><a href="#1-1-什么是异常？" class="headerlink" title="1.1 什么是异常？"></a>1.1 什么是异常？</h3><p><strong>异常（Exception）</strong> 是程序运行过程中发生的错误事件。当 Python 无法正常执行代码时，会抛出异常。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 常见异常示例</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ZeroDivisionError: 除以零</span></span><br><span class="line">result = <span class="number">10</span> / <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># FileNotFoundError: 文件不存在</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;不存在的文件.txt&quot;</span>, <span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    content = f.read()</span><br><span class="line"></span><br><span class="line"><span class="comment"># IndexError: 索引超出范围</span></span><br><span class="line">lst = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"><span class="built_in">print</span>(lst[<span class="number">10</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># KeyError: 字典键不存在</span></span><br><span class="line">d = &#123;<span class="string">&quot;a&quot;</span>: <span class="number">1</span>, <span class="string">&quot;b&quot;</span>: <span class="number">2</span>&#125;</span><br><span class="line"><span class="built_in">print</span>(d[<span class="string">&quot;c&quot;</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># ValueError: 值错误</span></span><br><span class="line">num = <span class="built_in">int</span>(<span class="string">&quot;abc&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># TypeError: 类型错误</span></span><br><span class="line">result = <span class="string">&quot;hello&quot;</span> + <span class="number">123</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># AttributeError: 属性不存在</span></span><br><span class="line">name = <span class="string">&quot;张三&quot;</span></span><br><span class="line">name.nonexistent_method()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 提醒自己：遇到异常不要慌，先读懂错误信息</span></span><br></pre></td></tr></table></figure>

<h3 id="1-2-异常的结构"><a href="#1-2-异常的结构" class="headerlink" title="1.2 异常的结构"></a>1.2 异常的结构</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 查看异常继承层次</span></span><br><span class="line"><span class="built_in">print</span>(Exception.__mro__)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 常见异常类型（都是 Exception 的子类）：</span></span><br><span class="line"><span class="comment"># - ArithmeticError: 算术错误</span></span><br><span class="line"><span class="comment"># - AssertionError: 断言失败</span></span><br><span class="line"><span class="comment"># - AttributeError: 属性错误</span></span><br><span class="line"><span class="comment"># - EOFError: 输入结束</span></span><br><span class="line"><span class="comment"># - FileNotFoundError: 文件未找到</span></span><br><span class="line"><span class="comment"># - ImportError: 导入失败</span></span><br><span class="line"><span class="comment"># - IndexError: 索引错误</span></span><br><span class="line"><span class="comment"># - KeyError: 键错误</span></span><br><span class="line"><span class="comment"># - KeyboardInterrupt: Ctrl+C 中断</span></span><br><span class="line"><span class="comment"># - MemoryError: 内存不足</span></span><br><span class="line"><span class="comment"># - NameError: 名称未定义</span></span><br><span class="line"><span class="comment"># - NotImplementedError: 方法未实现</span></span><br><span class="line"><span class="comment"># - OSError: 操作系统错误</span></span><br><span class="line"><span class="comment"># - TypeError: 类型错误</span></span><br><span class="line"><span class="comment"># - ValueError: 值错误</span></span><br></pre></td></tr></table></figure>

<h2 id="二、try-except-语句"><a href="#二、try-except-语句" class="headerlink" title="二、try-except 语句"></a>二、try-except 语句</h2><h3 id="2-1-基础用法"><a href="#2-1-基础用法" class="headerlink" title="2.1 基础用法"></a>2.1 基础用法</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 最简单的异常处理</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    result = <span class="number">10</span> / <span class="number">0</span></span><br><span class="line"><span class="keyword">except</span> ZeroDivisionError:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;错误：不能除以零！&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;程序继续执行...&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出：</span></span><br><span class="line"><span class="comment"># 错误：不能除以零！</span></span><br><span class="line"><span class="comment"># 程序继续执行...</span></span><br></pre></td></tr></table></figure>

<h3 id="2-2-捕获多个异常"><a href="#2-2-捕获多个异常" class="headerlink" title="2.2 捕获多个异常"></a>2.2 捕获多个异常</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 方法一：多个 except 子句</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    num = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&quot;请输入数字：&quot;</span>))</span><br><span class="line">    result = <span class="number">100</span> / num</span><br><span class="line"><span class="keyword">except</span> ValueError:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;错误：请输入有效的数字！&quot;</span>)</span><br><span class="line"><span class="keyword">except</span> ZeroDivisionError:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;错误：不能除以零！&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 方法二：元组捕获多个异常</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    num = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&quot;请输入数字：&quot;</span>))</span><br><span class="line">    result = <span class="number">100</span> / num</span><br><span class="line"><span class="keyword">except</span> (ValueError, ZeroDivisionError):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;错误：输入无效！&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 方法三：捕获所有异常（不推荐滥用）</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    risky_operation()</span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;发生错误：<span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 提醒自己：</span></span><br><span class="line"><span class="comment"># - 不要随意使用 except: 或 except Exception:</span></span><br><span class="line"><span class="comment"># - 应该明确指定要捕获的异常类型</span></span><br><span class="line"><span class="comment"># -  bare except 会捕获所有异常，包括 KeyboardInterrupt</span></span><br></pre></td></tr></table></figure>

<h3 id="2-3-获取异常信息"><a href="#2-3-获取异常信息" class="headerlink" title="2.3 获取异常信息"></a>2.3 获取异常信息</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    result = <span class="number">10</span> / <span class="number">0</span></span><br><span class="line"><span class="keyword">except</span> ZeroDivisionError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;异常类型：<span class="subst">&#123;<span class="built_in">type</span>(e)&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;异常信息：<span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;异常详情：<span class="subst">&#123;<span class="built_in">repr</span>(e)&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出：</span></span><br><span class="line"><span class="comment"># 异常类型：&lt;class &#x27;ZeroDivisionError&#x27;&gt;</span></span><br><span class="line"><span class="comment"># 异常信息：division by zero</span></span><br></pre></td></tr></table></figure>

<h3 id="2-4-else-子句"><a href="#2-4-else-子句" class="headerlink" title="2.4 else 子句"></a>2.4 else 子句</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># else 在没有异常时执行</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    num = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&quot;请输入数字：&quot;</span>))</span><br><span class="line">    result = <span class="number">100</span> / num</span><br><span class="line"><span class="keyword">except</span> (ValueError, ZeroDivisionError) <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;错误：<span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;计算结果：<span class="subst">&#123;result&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;计算成功！&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 提醒自己：</span></span><br><span class="line"><span class="comment"># - else 块在没有异常时执行</span></span><br><span class="line"><span class="comment"># - else 应该包含可能产生异常的代码之后的逻辑</span></span><br><span class="line"><span class="comment"># - 将可能出错的代码放在 try 中，其他放在 else 中</span></span><br></pre></td></tr></table></figure>

<h3 id="2-5-finally-子句"><a href="#2-5-finally-子句" class="headerlink" title="2.5 finally 子句"></a>2.5 finally 子句</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># finally 无论是否发生异常都会执行</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    file = <span class="built_in">open</span>(<span class="string">&quot;test.txt&quot;</span>, <span class="string">&quot;r&quot;</span>)</span><br><span class="line">    content = file.read()</span><br><span class="line">    result = <span class="number">10</span> / <span class="number">0</span>  <span class="comment"># 故意制造异常</span></span><br><span class="line"><span class="keyword">except</span> ZeroDivisionError:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;发生除零错误&quot;</span>)</span><br><span class="line"><span class="keyword">finally</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;始终会执行&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;file&#x27;</span> <span class="keyword">in</span> <span class="built_in">locals</span>():</span><br><span class="line">        file.close()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;文件已关闭&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出：</span></span><br><span class="line"><span class="comment"># 发生除零错误</span></span><br><span class="line"><span class="comment"># 始终会执行</span></span><br><span class="line"><span class="comment"># 文件已关闭</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 提醒自己：</span></span><br><span class="line"><span class="comment"># - finally 总是执行，即使 try 中有 return</span></span><br><span class="line"><span class="comment"># - 常用于资源清理（关闭文件、数据库连接等）</span></span><br><span class="line"><span class="comment"># - 现在更推荐使用 with 语句自动管理资源</span></span><br></pre></td></tr></table></figure>

<h3 id="2-6-完整结构"><a href="#2-6-完整结构" class="headerlink" title="2.6 完整结构"></a>2.6 完整结构</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="comment"># 可能出错的代码</span></span><br><span class="line">    result = risky_operation()</span><br><span class="line"><span class="keyword">except</span> SpecificError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="comment"># 处理特定异常</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;特定错误：<span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">    <span class="comment"># 处理其他异常</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;其他错误：<span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="comment"># 没有异常时执行</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;成功：<span class="subst">&#123;result&#125;</span>&quot;</span>)</span><br><span class="line"><span class="keyword">finally</span>:</span><br><span class="line">    <span class="comment"># 总是执行</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;清理工作&quot;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="三、抛出异常"><a href="#三、抛出异常" class="headerlink" title="三、抛出异常"></a>三、抛出异常</h2><h3 id="3-1-raise-语句"><a href="#3-1-raise-语句" class="headerlink" title="3.1 raise 语句"></a>3.1 raise 语句</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 抛出异常</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">divide</span>(<span class="params">a, b</span>):</span><br><span class="line">    <span class="keyword">if</span> b == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">raise</span> ZeroDivisionError(<span class="string">&quot;除数不能为零！&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> a / b</span><br><span class="line"></span><br><span class="line"><span class="comment"># 抛出异常时携带信息</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">validate_age</span>(<span class="params">age</span>):</span><br><span class="line">    <span class="keyword">if</span> age &lt; <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">&quot;年龄不能为负数&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> age &gt; <span class="number">150</span>:</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">&quot;年龄不合理&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 重新抛出捕获的异常</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    result = <span class="number">10</span> / <span class="number">0</span></span><br><span class="line"><span class="keyword">except</span> ZeroDivisionError:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;记录日志...&quot;</span>)</span><br><span class="line">    <span class="keyword">raise</span>  <span class="comment"># 重新抛出当前异常</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 提醒自己：</span></span><br><span class="line"><span class="comment"># - 只在自己能处理时才捕获异常</span></span><br><span class="line"><span class="comment"># - 否则应该让异常向上传播</span></span><br></pre></td></tr></table></figure>

<h3 id="3-2-自定义异常"><a href="#3-2-自定义异常" class="headerlink" title="3.2 自定义异常"></a>3.2 自定义异常</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 自定义异常类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyError</span>(<span class="title class_ inherited__">Exception</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;自定义异常基类&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ValidationError</span>(<span class="title class_ inherited__">MyError</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;验证错误&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, field, message</span>):</span><br><span class="line">        <span class="variable language_">self</span>.field = field</span><br><span class="line">        <span class="variable language_">self</span>.message = message</span><br><span class="line">        <span class="built_in">super</span>().__init__(<span class="string">f&quot;<span class="subst">&#123;field&#125;</span>: <span class="subst">&#123;message&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DatabaseError</span>(<span class="title class_ inherited__">MyError</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;数据库错误&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, query, reason</span>):</span><br><span class="line">        <span class="variable language_">self</span>.query = query</span><br><span class="line">        <span class="variable language_">self</span>.reason = reason</span><br><span class="line">        <span class="built_in">super</span>().__init__(<span class="string">f&quot;SQL &#x27;<span class="subst">&#123;query&#125;</span>&#x27; 失败：<span class="subst">&#123;reason&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用自定义异常</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">validate_user</span>(<span class="params">username, email</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> username:</span><br><span class="line">        <span class="keyword">raise</span> ValidationError(<span class="string">&quot;username&quot;</span>, <span class="string">&quot;不能为空&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;@&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> email:</span><br><span class="line">        <span class="keyword">raise</span> ValidationError(<span class="string">&quot;email&quot;</span>, <span class="string">&quot;格式不正确&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    validate_user(<span class="string">&quot;&quot;</span>, <span class="string">&quot;invalid&quot;</span>)</span><br><span class="line"><span class="keyword">except</span> ValidationError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;验证失败：<span class="subst">&#123;e.field&#125;</span> - <span class="subst">&#123;e.message&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="3-3-异常链"><a href="#3-3-异常链" class="headerlink" title="3.3 异常链"></a>3.3 异常链</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 在捕获一个异常后抛出另一个异常</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    result = database.query()</span><br><span class="line"><span class="keyword">except</span> DatabaseConnectionError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="keyword">raise</span> ApplicationError(<span class="string">&quot;数据库连接失败&quot;</span>) <span class="keyword">from</span> e</span><br><span class="line"></span><br><span class="line"><span class="comment"># 访问原始异常</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="comment"># ...</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"><span class="keyword">except</span> ApplicationError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;应用错误：<span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;原始错误：<span class="subst">&#123;e.__cause__&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 提醒自己：</span></span><br><span class="line"><span class="comment"># - from e 保留原始异常信息</span></span><br><span class="line"><span class="comment"># - 有助于追踪错误根源</span></span><br></pre></td></tr></table></figure>

<h2 id="四、断言"><a href="#四、断言" class="headerlink" title="四、断言"></a>四、断言</h2><h3 id="4-1-assert-语句"><a href="#4-1-assert-语句" class="headerlink" title="4.1 assert 语句"></a>4.1 assert 语句</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 断言用于调试和验证假设</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">calculate_discount</span>(<span class="params">price, discount</span>):</span><br><span class="line">    <span class="comment"># 断言条件必须为真</span></span><br><span class="line">    <span class="keyword">assert</span> <span class="number">0</span> &lt;= price &lt;= <span class="number">10000</span>, <span class="string">&quot;价格超出范围&quot;</span></span><br><span class="line">    <span class="keyword">assert</span> <span class="number">0</span> &lt;= discount &lt;= <span class="number">1</span>, <span class="string">&quot;折扣必须在 0-1 之间&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> price * (<span class="number">1</span> - discount)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 断言失败会抛出 AssertionError</span></span><br><span class="line"><span class="comment"># calculate_discount(-100, 0.1)  # AssertionError!</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 断言 vs 异常</span></span><br><span class="line"><span class="comment"># - 断言用于检查程序内部逻辑错误（开发阶段）</span></span><br><span class="line"><span class="comment"># - 异常用于处理运行时错误（生产环境）</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 提醒自己：</span></span><br><span class="line"><span class="comment"># - 不要用断言验证用户输入</span></span><br><span class="line"><span class="comment"># - 断言可以用-O 选项禁用</span></span><br><span class="line"><span class="comment"># - 生产环境应该用异常处理</span></span><br></pre></td></tr></table></figure>

<h2 id="五、上下文管理器"><a href="#五、上下文管理器" class="headerlink" title="五、上下文管理器"></a>五、上下文管理器</h2><h3 id="5-1-with-语句"><a href="#5-1-with-语句" class="headerlink" title="5.1 with 语句"></a>5.1 with 语句</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 自动管理资源</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;test.txt&quot;</span>, <span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    content = f.read()</span><br><span class="line"><span class="comment"># 文件自动关闭，即使发生异常</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 等价于：</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    f = <span class="built_in">open</span>(<span class="string">&quot;test.txt&quot;</span>, <span class="string">&quot;r&quot;</span>)</span><br><span class="line">    content = f.read()</span><br><span class="line"><span class="keyword">finally</span>:</span><br><span class="line">    f.close()</span><br></pre></td></tr></table></figure>

<h3 id="5-2-自定义上下文管理器（类方式）"><a href="#5-2-自定义上下文管理器（类方式）" class="headerlink" title="5.2 自定义上下文管理器（类方式）"></a>5.2 自定义上下文管理器（类方式）</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ManagedFile</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;自定义文件管理器&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, filename, mode</span>):</span><br><span class="line">        <span class="variable language_">self</span>.filename = filename</span><br><span class="line">        <span class="variable language_">self</span>.mode = mode</span><br><span class="line">        <span class="variable language_">self</span>.file = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__enter__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;进入上下文时调用&quot;&quot;&quot;</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;打开文件：<span class="subst">&#123;self.filename&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="variable language_">self</span>.file = <span class="built_in">open</span>(<span class="variable language_">self</span>.filename, <span class="variable language_">self</span>.mode)</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.file</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__exit__</span>(<span class="params">self, exc_type, exc_val, exc_tb</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;退出上下文时调用&quot;&quot;&quot;</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;关闭文件&quot;</span>)</span><br><span class="line">        <span class="variable language_">self</span>.file.close()</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 返回 True 会抑制异常，False/None 会传播异常</span></span><br><span class="line">        <span class="keyword">if</span> exc_type <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;发生异常：<span class="subst">&#123;exc_type.__name__&#125;</span>: <span class="subst">&#123;exc_val&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用</span></span><br><span class="line"><span class="keyword">with</span> ManagedFile(<span class="string">&quot;test.txt&quot;</span>, <span class="string">&quot;w&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(<span class="string">&quot;Hello, World!&quot;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="5-3-contextlib-模块"><a href="#5-3-contextlib-模块" class="headerlink" title="5.3 contextlib 模块"></a>5.3 contextlib 模块</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> contextlib <span class="keyword">import</span> contextmanager</span><br><span class="line"></span><br><span class="line"><span class="meta">@contextmanager</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">managed_file</span>(<span class="params">filename, mode</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;使用生成器创建上下文管理器&quot;&quot;&quot;</span></span><br><span class="line">    f = <span class="built_in">open</span>(filename, mode)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">yield</span> f</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        f.close()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用</span></span><br><span class="line"><span class="keyword">with</span> managed_file(<span class="string">&quot;test.txt&quot;</span>, <span class="string">&quot;w&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(<span class="string">&quot;Hello!&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 处理多个资源</span></span><br><span class="line"><span class="keyword">from</span> contextlib <span class="keyword">import</span> ExitStack</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> ExitStack() <span class="keyword">as</span> stack:</span><br><span class="line">    file1 = stack.enter_context(<span class="built_in">open</span>(<span class="string">&quot;file1.txt&quot;</span>))</span><br><span class="line">    file2 = stack.enter_context(<span class="built_in">open</span>(<span class="string">&quot;file2.txt&quot;</span>))</span><br><span class="line">    <span class="comment"># 所有文件会自动关闭</span></span><br></pre></td></tr></table></figure>

<h2 id="六、最佳实践"><a href="#六、最佳实践" class="headerlink" title="六、最佳实践"></a>六、最佳实践</h2><h3 id="6-1-异常处理原则"><a href="#6-1-异常处理原则" class="headerlink" title="6.1 异常处理原则"></a>6.1 异常处理原则</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ❌ 不好的做法</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. 捕获所有异常</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    do_something()</span><br><span class="line"><span class="keyword">except</span>:  <span class="comment"># 太宽泛！</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 忽略异常</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    dangerous_operation()</span><br><span class="line"><span class="keyword">except</span> Exception:  <span class="comment"># 没有记录或处理</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 异常范围太大</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    connect_db()</span><br><span class="line">    query_db()</span><br><span class="line">    process_data()</span><br><span class="line">    save_result()</span><br><span class="line"><span class="keyword">except</span> Exception:  <span class="comment"># 不知道哪里出错了</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;出错了&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ✅ 好的做法</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. 明确指定异常类型</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    result = <span class="built_in">int</span>(user_input)</span><br><span class="line"><span class="keyword">except</span> ValueError:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;请输入有效的数字&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 记录异常信息</span></span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    risky_operation()</span><br><span class="line"><span class="keyword">except</span> SpecificError <span class="keyword">as</span> e:</span><br><span class="line">    logging.error(<span class="string">f&quot;操作失败：<span class="subst">&#123;e&#125;</span>&quot;</span>, exc_info=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 缩小 try 块范围</span></span><br><span class="line">connect_db()</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    data = query_db()</span><br><span class="line"><span class="keyword">except</span> DatabaseError:</span><br><span class="line">    handle_db_error()</span><br><span class="line"><span class="keyword">finally</span>:</span><br><span class="line">    close_db()</span><br></pre></td></tr></table></figure>

<h3 id="6-2-日志记录"><a href="#6-2-日志记录" class="headerlink" title="6.2 日志记录"></a>6.2 日志记录</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置日志</span></span><br><span class="line">logging.basicConfig(</span><br><span class="line">    level=logging.INFO,</span><br><span class="line">    <span class="built_in">format</span>=<span class="string">&#x27;%(asctime)s - %(name)s - %(levelname)s - %(message)s&#x27;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">logger = logging.getLogger(__name__)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">process_data</span>(<span class="params">data</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        result = risky_operation(data)</span><br><span class="line">        logger.info(<span class="string">f&quot;处理成功：<span class="subst">&#123;result&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line">    <span class="keyword">except</span> ValueError <span class="keyword">as</span> e:</span><br><span class="line">        logger.error(<span class="string">f&quot;数据错误：<span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">raise</span></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        logger.exception(<span class="string">f&quot;未知错误：<span class="subst">&#123;e&#125;</span>&quot;</span>)  <span class="comment"># exception() 会自动记录堆栈</span></span><br><span class="line">        <span class="keyword">raise</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 提醒自己：</span></span><br><span class="line"><span class="comment"># - 生产环境应该记录异常堆栈</span></span><br><span class="line"><span class="comment"># - 使用 logger.exception() 记录完整堆栈信息</span></span><br><span class="line"><span class="comment"># - 不要记录敏感信息（密码、token 等）</span></span><br></pre></td></tr></table></figure>

<h3 id="6-3-资源清理模式"><a href="#6-3-资源清理模式" class="headerlink" title="6.3 资源清理模式"></a>6.3 资源清理模式</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 模式 1：with 语句（推荐）</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;file.txt&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    data = f.read()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 模式 2：try-finally</span></span><br><span class="line">f = <span class="literal">None</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    f = <span class="built_in">open</span>(<span class="string">&quot;file.txt&quot;</span>)</span><br><span class="line">    data = f.read()</span><br><span class="line"><span class="keyword">finally</span>:</span><br><span class="line">    <span class="keyword">if</span> f:</span><br><span class="line">        f.close()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 模式 3：try-except-finally</span></span><br><span class="line">conn = <span class="literal">None</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    conn = create_connection()</span><br><span class="line">    do_work(conn)</span><br><span class="line"><span class="keyword">except</span> ConnectionError:</span><br><span class="line">    handle_error()</span><br><span class="line"><span class="keyword">finally</span>:</span><br><span class="line">    <span class="keyword">if</span> conn:</span><br><span class="line">        conn.close()</span><br></pre></td></tr></table></figure>

<h2 id="七、实战示例"><a href="#七、实战示例" class="headerlink" title="七、实战示例"></a>七、实战示例</h2><h3 id="7-1-文件处理"><a href="#7-1-文件处理" class="headerlink" title="7.1 文件处理"></a>7.1 文件处理</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">from</span> pathlib <span class="keyword">import</span> Path</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">safe_read_json</span>(<span class="params">filepath</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;安全读取 JSON 文件&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        path = Path(filepath)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> path.exists():</span><br><span class="line">            <span class="keyword">raise</span> FileNotFoundError(<span class="string">f&quot;文件不存在：<span class="subst">&#123;filepath&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(path, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            <span class="keyword">return</span> json.load(f)</span><br><span class="line">    <span class="keyword">except</span> json.JSONDecodeError <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;JSON 格式错误：<span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;读取失败：<span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用</span></span><br><span class="line">data = safe_read_json(<span class="string">&quot;config.json&quot;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="7-2-网络请求"><a href="#7-2-网络请求" class="headerlink" title="7.2 网络请求"></a>7.2 网络请求</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> requests.exceptions <span class="keyword">import</span> RequestException, Timeout, HTTPError</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">fetch_url</span>(<span class="params">url, timeout=<span class="number">5</span></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;安全获取 URL 内容&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        response = requests.get(url, timeout=timeout)</span><br><span class="line">        response.raise_for_status()  <span class="comment"># 检查 HTTP 错误</span></span><br><span class="line">        <span class="keyword">return</span> response.text</span><br><span class="line">    <span class="keyword">except</span> Timeout:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;请求超时：<span class="subst">&#123;url&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">    <span class="keyword">except</span> HTTPError <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;HTTP 错误：<span class="subst">&#123;e.response.status_code&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">    <span class="keyword">except</span> RequestException <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;请求失败：<span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用</span></span><br><span class="line">content = fetch_url(<span class="string">&quot;https://api.example.com/data&quot;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="7-3-数据验证"><a href="#7-3-数据验证" class="headerlink" title="7.3 数据验证"></a>7.3 数据验证</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">DataValidationError</span>(<span class="title class_ inherited__">Exception</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;数据验证错误&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">validate_user_data</span>(<span class="params">data</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;验证用户数据&quot;&quot;&quot;</span></span><br><span class="line">    errors = []</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 检查必填字段</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> data.get(<span class="string">&#x27;username&#x27;</span>):</span><br><span class="line">        errors.append(<span class="string">&quot;用户名不能为空&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> data.get(<span class="string">&#x27;email&#x27;</span>):</span><br><span class="line">        errors.append(<span class="string">&quot;邮箱不能为空&quot;</span>)</span><br><span class="line">    <span class="keyword">elif</span> <span class="string">&#x27;@&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> data[<span class="string">&#x27;email&#x27;</span>]:</span><br><span class="line">        errors.append(<span class="string">&quot;邮箱格式不正确&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;age&#x27;</span> <span class="keyword">in</span> data:</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">isinstance</span>(data[<span class="string">&#x27;age&#x27;</span>], <span class="built_in">int</span>):</span><br><span class="line">            errors.append(<span class="string">&quot;年龄必须是整数&quot;</span>)</span><br><span class="line">        <span class="keyword">elif</span> data[<span class="string">&#x27;age&#x27;</span>] &lt; <span class="number">0</span> <span class="keyword">or</span> data[<span class="string">&#x27;age&#x27;</span>] &gt; <span class="number">150</span>:</span><br><span class="line">            errors.append(<span class="string">&quot;年龄不合理&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> errors:</span><br><span class="line">        <span class="keyword">raise</span> DataValidationError(<span class="string">&quot;; &quot;</span>.join(errors))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    validate_user_data(&#123;<span class="string">&quot;username&quot;</span>: <span class="string">&quot;&quot;</span>, <span class="string">&quot;email&quot;</span>: <span class="string">&quot;invalid&quot;</span>&#125;)</span><br><span class="line"><span class="keyword">except</span> DataValidationError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;验证失败：<span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="八、总结"><a href="#八、总结" class="headerlink" title="八、总结"></a>八、总结</h2><blockquote>
<p><strong>提醒自己</strong>：</p>
<ol>
<li><strong>只捕获能处理的异常</strong>：不要为了捕获而捕获</li>
<li><strong>明确异常类型</strong>：避免使用 bare except</li>
<li><strong>记录异常信息</strong>：方便调试和问题追踪</li>
<li><strong>及时清理资源</strong>：使用 with 或 finally</li>
<li><strong>合理的异常层次</strong>：不要过度嵌套 try-except</li>
<li><strong>自定义异常要有意义</strong>：有助于问题定位</li>
</ol>
</blockquote>
<h2 id="九、练习"><a href="#九、练习" class="headerlink" title="九、练习"></a>九、练习</h2><ol>
<li>编写一个函数，安全地将字符串转换为整数，处理各种异常情况</li>
<li>实现一个文件复制函数，处理文件不存在、权限不足等情况</li>
<li>自定义一个 API 调用异常类，处理超时、HTTP 错误等情况</li>
<li>编写一个配置文件加载器，处理各种可能的错误</li>
<li>实现一个简单的日志系统，记录异常信息到文件</li>
</ol>
<hr>
<p><strong>上一篇</strong>：<a href="/2026/02/24/Python-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B%EF%BC%88%E4%BA%8C%EF%BC%89%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%BC%96%E7%A8%8B/">Python 基础教程（二）：面向对象编程</a></p>
<p><strong>下一篇</strong>：[Python 数据科学（一）：NumPy 数值计算](&#x2F;2026&#x2F;02&#x2F;24&#x2F;Python-数据科学（一）NumPy 数值计算&#x2F;)</p>
<p><strong>参考资源</strong>：</p>
<ul>
<li><a href="https://docs.python.org/zh-cn/3/tutorial/errors.html">Python 官方文档 - 异常处理</a></li>
<li><a href="https://docs.python.org/zh-cn/3/library/exceptions.html">Python 官方文档 - 内置异常</a></li>
<li><a href="https://docs.python.org/zh-cn/3/library/contextlib.html">contextlib 模块文档</a></li>
</ul>
]]></content>
      <categories>
        <category>Python 教程</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>异常处理</tag>
        <tag>错误处理</tag>
      </tags>
  </entry>
  <entry>
    <title>Python 基础教程（一）基础语法入门</title>
    <url>/2026/02/24/Python%20%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B%EF%BC%88%E4%B8%80%EF%BC%89%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95%E5%85%A5%E9%97%A8/</url>
    <content><![CDATA[<h1 id="Python-基础教程（一）基础语法入门"><a href="#Python-基础教程（一）基础语法入门" class="headerlink" title="Python 基础教程（一）基础语法入门"></a>Python 基础教程（一）基础语法入门</h1><p>欢迎来到 Python 基础教程系列！本篇将从零开始介绍 Python 的基础语法，帮助你快速上手 Python 编程。</p>
<h2 id="一、Python-简介"><a href="#一、Python-简介" class="headerlink" title="一、Python 简介"></a>一、Python 简介</h2><h3 id="1-1-为什么选择-Python？"><a href="#1-1-为什么选择-Python？" class="headerlink" title="1.1 为什么选择 Python？"></a>1.1 为什么选择 Python？</h3><ul>
<li><strong>语法简洁</strong>：代码可读性强，接近自然语言</li>
<li><strong>生态丰富</strong>：拥有庞大的第三方库生态系统</li>
<li><strong>应用广泛</strong>：Web 开发、数据分析、人工智能、自动化脚本等</li>
<li><strong>跨平台</strong>：Windows、Linux、macOS 均可运行</li>
<li><strong>社区活跃</strong>：遇到问题容易找到解决方案</li>
</ul>
<h3 id="1-2-Python-版本选择"><a href="#1-2-Python-版本选择" class="headerlink" title="1.2 Python 版本选择"></a>1.2 Python 版本选择</h3><blockquote>
<p><strong>提醒自己</strong>：务必使用 <strong>Python 3.x</strong>（推荐 3.8+），Python 2 已停止维护。</p>
</blockquote>
<h2 id="二、环境搭建"><a href="#二、环境搭建" class="headerlink" title="二、环境搭建"></a>二、环境搭建</h2><h3 id="2-1-安装-Python"><a href="#2-1-安装-Python" class="headerlink" title="2.1 安装 Python"></a>2.1 安装 Python</h3><p><strong>Windows：</strong></p>
<ol>
<li>访问 <a href="https://www.python.org/downloads/">https://www.python.org/downloads/</a></li>
<li>下载最新稳定版（如 3.11.x）</li>
<li>安装时勾选 <strong>“Add Python to PATH”</strong></li>
</ol>
<p><strong>验证安装：</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">python --version</span><br><span class="line"><span class="comment"># 或</span></span><br><span class="line">python3 --version</span><br></pre></td></tr></table></figure>

<h3 id="2-2-包管理工具-pip"><a href="#2-2-包管理工具-pip" class="headerlink" title="2.2 包管理工具 pip"></a>2.2 包管理工具 pip</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 查看 pip 版本</span></span><br><span class="line">pip --version</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装包</span></span><br><span class="line">pip install 包名</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装指定版本</span></span><br><span class="line">pip install 包名==1.0.0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 升级包</span></span><br><span class="line">pip install --upgrade 包名</span><br><span class="line"></span><br><span class="line"><span class="comment"># 卸载包</span></span><br><span class="line">pip uninstall 包名</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看已安装的包</span></span><br><span class="line">pip list</span><br><span class="line"></span><br><span class="line"><span class="comment"># 导出依赖</span></span><br><span class="line">pip freeze &gt; requirements.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># 从文件安装依赖</span></span><br><span class="line">pip install -r requirements.txt</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>提醒自己</strong>：</p>
<ul>
<li>国内用户可使用清华&#x2F;阿里镜像源加速安装</li>
<li><code>pip install -i https://pypi.tuna.tsinghua.edu.cn/simple 包名</code></li>
</ul>
</blockquote>
<h3 id="2-3-虚拟环境（重要！）"><a href="#2-3-虚拟环境（重要！）" class="headerlink" title="2.3 虚拟环境（重要！）"></a>2.3 虚拟环境（重要！）</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 创建虚拟环境</span></span><br><span class="line">python -m venv venv</span><br><span class="line"></span><br><span class="line"><span class="comment"># Windows 激活</span></span><br><span class="line">venv\Scripts\activate</span><br><span class="line"></span><br><span class="line"><span class="comment"># Linux/macOS 激活</span></span><br><span class="line"><span class="built_in">source</span> venv/bin/activate</span><br><span class="line"></span><br><span class="line"><span class="comment"># 退出虚拟环境</span></span><br><span class="line">deactivate</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>提醒自己</strong>：</p>
<ul>
<li>每个项目都应该使用独立的虚拟环境</li>
<li>避免不同项目之间的依赖冲突</li>
<li>虚拟环境目录不要提交到 Git</li>
</ul>
</blockquote>
<h3 id="2-4-第一个-Python-程序"><a href="#2-4-第一个-Python-程序" class="headerlink" title="2.4 第一个 Python 程序"></a>2.4 第一个 Python 程序</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># hello.py</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Hello, World!&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>运行：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">python hello.py</span><br></pre></td></tr></table></figure>

<h2 id="三、基础语法"><a href="#三、基础语法" class="headerlink" title="三、基础语法"></a>三、基础语法</h2><h3 id="3-1-注释"><a href="#3-1-注释" class="headerlink" title="3.1 注释"></a>3.1 注释</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 这是单行注释</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">这是多行注释（文档字符串）</span></span><br><span class="line"><span class="string">可以写多行</span></span><br><span class="line"><span class="string">通常用于函数、类的说明</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 提醒自己：函数和模块应该用 docstring 说明用途</span></span><br></pre></td></tr></table></figure>

<h3 id="3-2-变量与数据类型"><a href="#3-2-变量与数据类型" class="headerlink" title="3.2 变量与数据类型"></a>3.2 变量与数据类型</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 变量定义（无需声明类型）</span></span><br><span class="line">name = <span class="string">&quot;张三&quot;</span>       <span class="comment"># 字符串 str</span></span><br><span class="line">age = <span class="number">25</span>            <span class="comment"># 整数 int</span></span><br><span class="line">height = <span class="number">1.75</span>       <span class="comment"># 浮点数 float</span></span><br><span class="line">is_student = <span class="literal">False</span>  <span class="comment"># 布尔 bool</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 同时给多个变量赋值</span></span><br><span class="line">x, y, z = <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span></span><br><span class="line">a = b = c = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看类型</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(name))   <span class="comment"># &lt;class &#x27;str&#x27;&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 类型转换</span></span><br><span class="line">num_str = <span class="string">&quot;123&quot;</span></span><br><span class="line">num_int = <span class="built_in">int</span>(num_str)  <span class="comment"># 字符串转整数</span></span><br><span class="line"></span><br><span class="line">float_num = <span class="built_in">float</span>(<span class="number">10</span>)   <span class="comment"># 整数转浮点数：10.0</span></span><br><span class="line">str_num = <span class="built_in">str</span>(<span class="number">123</span>)      <span class="comment"># 整数转字符串：&quot;123&quot;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>提醒自己</strong>：</p>
<ul>
<li>变量名只能包含字母、数字、下划线</li>
<li>变量名不能以数字开头</li>
<li>不能使用 Python 关键字（如 if、for、while 等）</li>
<li>推荐使用<strong>小写字母 + 下划线</strong>的命名风格（snake_case）</li>
</ul>
</blockquote>
<h3 id="3-3-常用数据类型"><a href="#3-3-常用数据类型" class="headerlink" title="3.3 常用数据类型"></a>3.3 常用数据类型</h3><h4 id="字符串（str）"><a href="#字符串（str）" class="headerlink" title="字符串（str）"></a>字符串（str）</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 字符串定义</span></span><br><span class="line">s1 = <span class="string">&#x27;单引号&#x27;</span></span><br><span class="line">s2 = <span class="string">&quot;双引号&quot;</span></span><br><span class="line">s3 = <span class="string">&quot;&quot;&quot;三引号，可以跨行&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 字符串操作</span></span><br><span class="line">name = <span class="string">&quot;Hello, Python&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(name))           <span class="comment"># 长度：13</span></span><br><span class="line"><span class="built_in">print</span>(name[<span class="number">0</span>])             <span class="comment"># 第一个字符：H</span></span><br><span class="line"><span class="built_in">print</span>(name[-<span class="number">1</span>])            <span class="comment"># 最后一个字符：n</span></span><br><span class="line"><span class="built_in">print</span>(name[<span class="number">0</span>:<span class="number">5</span>])           <span class="comment"># 切片：Hello</span></span><br><span class="line"><span class="built_in">print</span>(name.lower())        <span class="comment"># 转小写：hello, python</span></span><br><span class="line"><span class="built_in">print</span>(name.upper())        <span class="comment"># 转大写：HELLO, PYTHON</span></span><br><span class="line"><span class="built_in">print</span>(name.split(<span class="string">&quot;, &quot;</span>))    <span class="comment"># 分割：[&#x27;Hello&#x27;, &#x27;Python&#x27;]</span></span><br><span class="line"><span class="built_in">print</span>(name.replace(<span class="string">&quot;Python&quot;</span>, <span class="string">&quot;World&quot;</span>))  <span class="comment"># 替换</span></span><br><span class="line"><span class="built_in">print</span>(name.find(<span class="string">&quot;Python&quot;</span>)) <span class="comment"># 查找位置：7</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Python&quot;</span> <span class="keyword">in</span> name)    <span class="comment"># 判断包含：True</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># f-string 格式化（Python 3.6+）</span></span><br><span class="line">name = <span class="string">&quot;张三&quot;</span></span><br><span class="line">age = <span class="number">25</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;我叫<span class="subst">&#123;name&#125;</span>，今年<span class="subst">&#123;age&#125;</span>岁&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 格式化数字</span></span><br><span class="line">pi = <span class="number">3.1415926</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;π ≈ <span class="subst">&#123;pi:<span class="number">.2</span>f&#125;</span>&quot;</span>)     <span class="comment"># π ≈ 3.14</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 提醒自己：优先使用 f-string，比 format() 更简洁</span></span><br></pre></td></tr></table></figure>

<h4 id="列表（list）"><a href="#列表（list）" class="headerlink" title="列表（list）"></a>列表（list）</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 列表定义</span></span><br><span class="line">fruits = [<span class="string">&quot;苹果&quot;</span>, <span class="string">&quot;香蕉&quot;</span>, <span class="string">&quot;橙子&quot;</span>]</span><br><span class="line">numbers = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]</span><br><span class="line">mixed = [<span class="number">1</span>, <span class="string">&quot;hello&quot;</span>, <span class="number">3.14</span>, <span class="literal">True</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 访问元素</span></span><br><span class="line"><span class="built_in">print</span>(fruits[<span class="number">0</span>])      <span class="comment"># 苹果</span></span><br><span class="line"><span class="built_in">print</span>(fruits[-<span class="number">1</span>])     <span class="comment"># 橙子（最后一个）</span></span><br><span class="line"><span class="built_in">print</span>(fruits[<span class="number">1</span>:<span class="number">3</span>])    <span class="comment"># 切片：[&#x27;香蕉&#x27;, &#x27;橙子&#x27;]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改元素</span></span><br><span class="line">fruits[<span class="number">0</span>] = <span class="string">&quot;葡萄&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 列表操作</span></span><br><span class="line">fruits.append(<span class="string">&quot;西瓜&quot;</span>)           <span class="comment"># 末尾添加</span></span><br><span class="line">fruits.insert(<span class="number">1</span>, <span class="string">&quot;柠檬&quot;</span>)        <span class="comment"># 指定位置插入</span></span><br><span class="line">fruits.remove(<span class="string">&quot;香蕉&quot;</span>)           <span class="comment"># 删除指定值</span></span><br><span class="line">last = fruits.pop()             <span class="comment"># 删除并返回最后一个</span></span><br><span class="line"><span class="keyword">del</span> fruits[<span class="number">0</span>]                   <span class="comment"># 删除指定索引</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 列表运算</span></span><br><span class="line">list1 = [<span class="number">1</span>, <span class="number">2</span>]</span><br><span class="line">list2 = [<span class="number">3</span>, <span class="number">4</span>]</span><br><span class="line"><span class="built_in">print</span>(list1 + list2)   <span class="comment"># [1, 2, 3, 4]</span></span><br><span class="line"><span class="built_in">print</span>(list1 * <span class="number">3</span>)       <span class="comment"># [1, 2, 1, 2, 1, 2]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 列表推导式（重要！）</span></span><br><span class="line">squares = [x**<span class="number">2</span> <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>)]          <span class="comment"># [0, 1, 4, 9, 16, ...]</span></span><br><span class="line">evens = [x <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">20</span>) <span class="keyword">if</span> x % <span class="number">2</span> == <span class="number">0</span>] <span class="comment"># 偶数列表</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 提醒自己：列表推导式可以简化代码，但不要太复杂</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 常用函数</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(fruits))       <span class="comment"># 长度</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">max</span>(numbers))      <span class="comment"># 最大值</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">min</span>(numbers))      <span class="comment"># 最小值</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">sum</span>(numbers))      <span class="comment"># 求和</span></span><br></pre></td></tr></table></figure>

<h4 id="元组（tuple）"><a href="#元组（tuple）" class="headerlink" title="元组（tuple）"></a>元组（tuple）</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 元组定义（不可变列表）</span></span><br><span class="line">colors = (<span class="string">&quot;红&quot;</span>, <span class="string">&quot;绿&quot;</span>, <span class="string">&quot;蓝&quot;</span>)</span><br><span class="line">point = (<span class="number">10</span>, <span class="number">20</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 访问元素</span></span><br><span class="line"><span class="built_in">print</span>(colors[<span class="number">0</span>])    <span class="comment"># 红</span></span><br><span class="line"><span class="built_in">print</span>(colors[-<span class="number">1</span>])   <span class="comment"># 蓝</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 元组解包</span></span><br><span class="line">x, y = point</span><br><span class="line"><span class="built_in">print</span>(x, y)         <span class="comment"># 10 20</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 交换变量</span></span><br><span class="line">a, b = <span class="number">1</span>, <span class="number">2</span></span><br><span class="line">a, b = b, a</span><br><span class="line"><span class="built_in">print</span>(a, b)         <span class="comment"># 2 1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 提醒自己：</span></span><br><span class="line"><span class="comment"># - 元组不可修改，适合存储不应改变的数据</span></span><br><span class="line"><span class="comment"># - 函数返回多个值时实际返回的是元组</span></span><br></pre></td></tr></table></figure>

<h4 id="字典（dict）"><a href="#字典（dict）" class="headerlink" title="字典（dict）"></a>字典（dict）</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 字典定义（键值对）</span></span><br><span class="line">person = &#123;</span><br><span class="line">    <span class="string">&quot;name&quot;</span>: <span class="string">&quot;张三&quot;</span>,</span><br><span class="line">    <span class="string">&quot;age&quot;</span>: <span class="number">25</span>,</span><br><span class="line">    <span class="string">&quot;city&quot;</span>: <span class="string">&quot;北京&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 访问值</span></span><br><span class="line"><span class="built_in">print</span>(person[<span class="string">&quot;name&quot;</span>])        <span class="comment"># 张三</span></span><br><span class="line"><span class="built_in">print</span>(person.get(<span class="string">&quot;age&quot;</span>))     <span class="comment"># 25</span></span><br><span class="line"><span class="built_in">print</span>(person.get(<span class="string">&quot;email&quot;</span>, <span class="string">&quot;未提供&quot;</span>))  <span class="comment"># 默认值</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改/添加</span></span><br><span class="line">person[<span class="string">&quot;age&quot;</span>] = <span class="number">26</span></span><br><span class="line">person[<span class="string">&quot;email&quot;</span>] = <span class="string">&quot;zhangsan@example.com&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除</span></span><br><span class="line"><span class="keyword">del</span> person[<span class="string">&quot;city&quot;</span>]</span><br><span class="line">email = person.pop(<span class="string">&quot;email&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 遍历字典</span></span><br><span class="line"><span class="keyword">for</span> key, value <span class="keyword">in</span> person.items():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;key&#125;</span>: <span class="subst">&#123;value&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取所有键/值</span></span><br><span class="line"><span class="built_in">print</span>(person.keys())</span><br><span class="line"><span class="built_in">print</span>(person.values())</span><br><span class="line"></span><br><span class="line"><span class="comment"># 字典推导式</span></span><br><span class="line">squares = &#123;x: x**<span class="number">2</span> <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>)&#125;</span><br><span class="line"><span class="comment"># &#123;0: 0, 1: 1, 2: 4, 3: 9, 4: 16&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 提醒自己：字典查找速度很快（O(1)），适合频繁查找的场景</span></span><br></pre></td></tr></table></figure>

<h4 id="集合（set）"><a href="#集合（set）" class="headerlink" title="集合（set）"></a>集合（set）</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 集合定义（无序、不重复）</span></span><br><span class="line">fruits = &#123;<span class="string">&quot;苹果&quot;</span>, <span class="string">&quot;香蕉&quot;</span>, <span class="string">&quot;橙子&quot;</span>&#125;</span><br><span class="line">numbers = <span class="built_in">set</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">3</span>])  <span class="comment"># &#123;1, 2, 3&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 集合操作</span></span><br><span class="line">fruits.add(<span class="string">&quot;葡萄&quot;</span>)           <span class="comment"># 添加元素</span></span><br><span class="line">fruits.remove(<span class="string">&quot;香蕉&quot;</span>)         <span class="comment"># 删除元素</span></span><br><span class="line">fruits.discard(<span class="string">&quot;西瓜&quot;</span>)        <span class="comment"># 删除（不存在不报错）</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 集合运算</span></span><br><span class="line">set1 = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>&#125;</span><br><span class="line">set2 = &#123;<span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(set1 | set2)   <span class="comment"># 并集：&#123;1, 2, 3, 4, 5, 6&#125;</span></span><br><span class="line"><span class="built_in">print</span>(set1 &amp; set2)   <span class="comment"># 交集：&#123;3, 4&#125;</span></span><br><span class="line"><span class="built_in">print</span>(set1 - set2)   <span class="comment"># 差集：&#123;1, 2&#125;</span></span><br><span class="line"><span class="built_in">print</span>(set1 ^ set2)   <span class="comment"># 对称差集：&#123;1, 2, 5, 6&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 提醒自己：集合适合去重和判断成员关系</span></span><br></pre></td></tr></table></figure>

<h3 id="3-4-运算符"><a href="#3-4-运算符" class="headerlink" title="3.4 运算符"></a>3.4 运算符</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 算术运算符</span></span><br><span class="line">a, b = <span class="number">10</span>, <span class="number">3</span></span><br><span class="line"><span class="built_in">print</span>(a + b)   <span class="comment"># 加：13</span></span><br><span class="line"><span class="built_in">print</span>(a - b)   <span class="comment"># 减：7</span></span><br><span class="line"><span class="built_in">print</span>(a * b)   <span class="comment"># 乘：30</span></span><br><span class="line"><span class="built_in">print</span>(a / b)   <span class="comment"># 除：3.333...</span></span><br><span class="line"><span class="built_in">print</span>(a // b)  <span class="comment"># 整除：3</span></span><br><span class="line"><span class="built_in">print</span>(a % b)   <span class="comment"># 取余：1</span></span><br><span class="line"><span class="built_in">print</span>(a ** b)  <span class="comment"># 幂：1000</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 比较运算符</span></span><br><span class="line"><span class="built_in">print</span>(a &gt; b)    <span class="comment"># True</span></span><br><span class="line"><span class="built_in">print</span>(a &lt; b)    <span class="comment"># False</span></span><br><span class="line"><span class="built_in">print</span>(a == b)   <span class="comment"># False</span></span><br><span class="line"><span class="built_in">print</span>(a != b)   <span class="comment"># True</span></span><br><span class="line"><span class="built_in">print</span>(a &gt;= <span class="number">10</span>)  <span class="comment"># True</span></span><br><span class="line"><span class="built_in">print</span>(a &lt;= <span class="number">10</span>)  <span class="comment"># True</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 逻辑运算符</span></span><br><span class="line"><span class="built_in">print</span>(<span class="literal">True</span> <span class="keyword">and</span> <span class="literal">False</span>)   <span class="comment"># False</span></span><br><span class="line"><span class="built_in">print</span>(<span class="literal">True</span> <span class="keyword">or</span> <span class="literal">False</span>)    <span class="comment"># True</span></span><br><span class="line"><span class="built_in">print</span>(<span class="keyword">not</span> <span class="literal">True</span>)         <span class="comment"># False</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 成员运算符</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;a&quot;</span> <span class="keyword">in</span> <span class="string">&quot;abc&quot;</span>)      <span class="comment"># True</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;x&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> <span class="string">&quot;abc&quot;</span>)  <span class="comment"># True</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 身份运算符（比较内存地址）</span></span><br><span class="line">x = [<span class="number">1</span>, <span class="number">2</span>]</span><br><span class="line">y = [<span class="number">1</span>, <span class="number">2</span>]</span><br><span class="line">z = x</span><br><span class="line"><span class="built_in">print</span>(x == y)   <span class="comment"># True（值相等）</span></span><br><span class="line"><span class="built_in">print</span>(x <span class="keyword">is</span> y)   <span class="comment"># False（不是同一个对象）</span></span><br><span class="line"><span class="built_in">print</span>(x <span class="keyword">is</span> z)   <span class="comment"># True（同一个对象）</span></span><br></pre></td></tr></table></figure>

<h2 id="四、流程控制"><a href="#四、流程控制" class="headerlink" title="四、流程控制"></a>四、流程控制</h2><h3 id="4-1-条件语句"><a href="#4-1-条件语句" class="headerlink" title="4.1 条件语句"></a>4.1 条件语句</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># if-elif-else 结构</span></span><br><span class="line">score = <span class="number">85</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> score &gt;= <span class="number">90</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;优秀&quot;</span>)</span><br><span class="line"><span class="keyword">elif</span> score &gt;= <span class="number">80</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;良好&quot;</span>)</span><br><span class="line"><span class="keyword">elif</span> score &gt;= <span class="number">60</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;及格&quot;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;不及格&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 简化写法（三元表达式）</span></span><br><span class="line">result = <span class="string">&quot;及格&quot;</span> <span class="keyword">if</span> score &gt;= <span class="number">60</span> <span class="keyword">else</span> <span class="string">&quot;不及格&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 提醒自己：Python 用缩进表示代码块，不要用 Tab 和空格混用</span></span><br></pre></td></tr></table></figure>

<h3 id="4-2-循环语句"><a href="#4-2-循环语句" class="headerlink" title="4.2 循环语句"></a>4.2 循环语句</h3><h4 id="for-循环"><a href="#for-循环" class="headerlink" title="for 循环"></a>for 循环</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 遍历列表</span></span><br><span class="line">fruits = [<span class="string">&quot;苹果&quot;</span>, <span class="string">&quot;香蕉&quot;</span>, <span class="string">&quot;橙子&quot;</span>]</span><br><span class="line"><span class="keyword">for</span> fruit <span class="keyword">in</span> fruits:</span><br><span class="line">    <span class="built_in">print</span>(fruit)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 带索引遍历</span></span><br><span class="line"><span class="keyword">for</span> i, fruit <span class="keyword">in</span> <span class="built_in">enumerate</span>(fruits):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;i&#125;</span>: <span class="subst">&#123;fruit&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 遍历范围</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):        <span class="comment"># 0 到 4</span></span><br><span class="line">    <span class="built_in">print</span>(i)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">6</span>):     <span class="comment"># 1 到 5</span></span><br><span class="line">    <span class="built_in">print</span>(i)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">10</span>, <span class="number">2</span>): <span class="comment"># 1, 3, 5, 7, 9（步长为 2）</span></span><br><span class="line">    <span class="built_in">print</span>(i)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 遍历字典</span></span><br><span class="line">person = &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;张三&quot;</span>, <span class="string">&quot;age&quot;</span>: <span class="number">25</span>&#125;</span><br><span class="line"><span class="keyword">for</span> key, value <span class="keyword">in</span> person.items():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;key&#125;</span>: <span class="subst">&#123;value&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<h4 id="while-循环"><a href="#while-循环" class="headerlink" title="while 循环"></a>while 循环</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">count = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> count &lt; <span class="number">5</span>:</span><br><span class="line">    <span class="built_in">print</span>(count)</span><br><span class="line">    count += <span class="number">1</span></span><br></pre></td></tr></table></figure>

<h4 id="循环控制"><a href="#循环控制" class="headerlink" title="循环控制"></a>循环控制</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># break - 跳出循环</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">    <span class="keyword">if</span> i == <span class="number">5</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="built_in">print</span>(i)  <span class="comment"># 0, 1, 2, 3, 4</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># continue - 跳过本次</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">    <span class="keyword">if</span> i == <span class="number">2</span>:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="built_in">print</span>(i)  <span class="comment"># 0, 1, 3, 4</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># else - 循环正常结束（非 break 退出）时执行</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">    <span class="built_in">print</span>(i)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;循环结束&quot;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="五、函数"><a href="#五、函数" class="headerlink" title="五、函数"></a>五、函数</h2><h3 id="5-1-函数定义"><a href="#5-1-函数定义" class="headerlink" title="5.1 函数定义"></a>5.1 函数定义</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 定义函数</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">greet</span>(<span class="params">name</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;问候函数&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">f&quot;Hello, <span class="subst">&#123;name&#125;</span>!&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 调用函数</span></span><br><span class="line">result = greet(<span class="string">&quot;张三&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(result)  <span class="comment"># Hello, 张三！</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 多个返回值</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_person</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;张三&quot;</span>, <span class="number">25</span>, <span class="string">&quot;北京&quot;</span></span><br><span class="line"></span><br><span class="line">name, age, city = get_person()</span><br></pre></td></tr></table></figure>

<h3 id="5-2-函数参数"><a href="#5-2-函数参数" class="headerlink" title="5.2 函数参数"></a>5.2 函数参数</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 位置参数</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">describe_pet</span>(<span class="params">pet_name, animal_type</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;animal_type&#125;</span>: <span class="subst">&#123;pet_name&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">describe_pet(<span class="string">&quot;旺财&quot;</span>, <span class="string">&quot;狗&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 关键字参数</span></span><br><span class="line">describe_pet(animal_type=<span class="string">&quot;猫&quot;</span>, pet_name=<span class="string">&quot;咪咪&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 默认参数</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">greet</span>(<span class="params">name=<span class="string">&quot;朋友&quot;</span></span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Hello, <span class="subst">&#123;name&#125;</span>!&quot;</span>)</span><br><span class="line"></span><br><span class="line">greet()           <span class="comment"># Hello, 朋友！</span></span><br><span class="line">greet(<span class="string">&quot;张三&quot;</span>)     <span class="comment"># Hello, 张三！</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 可变参数</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sum_all</span>(<span class="params">*args</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;接收任意数量的位置参数&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">sum</span>(args)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(sum_all(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>))  <span class="comment"># 10</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">print_info</span>(<span class="params">**kwargs</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;接收任意数量的关键字参数&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> key, value <span class="keyword">in</span> kwargs.items():</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;key&#125;</span>: <span class="subst">&#123;value&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">print_info(name=<span class="string">&quot;张三&quot;</span>, age=<span class="number">25</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 组合使用</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">func</span>(<span class="params">a, b, *args, default=<span class="literal">True</span>, **kwargs</span>):</span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>

<h3 id="5-3-Lambda-表达式"><a href="#5-3-Lambda-表达式" class="headerlink" title="5.3 Lambda 表达式"></a>5.3 Lambda 表达式</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 匿名函数</span></span><br><span class="line">square = <span class="keyword">lambda</span> x: x ** <span class="number">2</span></span><br><span class="line"><span class="built_in">print</span>(square(<span class="number">5</span>))  <span class="comment"># 25</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 用于排序</span></span><br><span class="line">students = [(<span class="string">&quot;张三&quot;</span>, <span class="number">85</span>), (<span class="string">&quot;李四&quot;</span>, <span class="number">92</span>), (<span class="string">&quot;王五&quot;</span>, <span class="number">78</span>)]</span><br><span class="line">students.sort(key=<span class="keyword">lambda</span> x: x[<span class="number">1</span>], reverse=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 提醒自己：lambda 适合简单函数，复杂逻辑还是用 def</span></span><br></pre></td></tr></table></figure>

<h2 id="六、模块与导入"><a href="#六、模块与导入" class="headerlink" title="六、模块与导入"></a>六、模块与导入</h2><h3 id="6-1-导入模块"><a href="#6-1-导入模块" class="headerlink" title="6.1 导入模块"></a>6.1 导入模块</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 导入整个模块</span></span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"><span class="built_in">print</span>(math.sqrt(<span class="number">16</span>))  <span class="comment"># 4.0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 导入特定函数</span></span><br><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> sqrt, ceil</span><br><span class="line"><span class="built_in">print</span>(sqrt(<span class="number">16</span>))  <span class="comment"># 4.0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 导入并重命名</span></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime <span class="keyword">as</span> dt</span><br><span class="line"></span><br><span class="line"><span class="comment"># 导入所有（不推荐）</span></span><br><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> *</span><br></pre></td></tr></table></figure>

<h3 id="6-2-常用内置模块"><a href="#6-2-常用内置模块" class="headerlink" title="6.2 常用内置模块"></a>6.2 常用内置模块</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># os - 操作系统接口</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line">os.getcwd()              <span class="comment"># 当前工作目录</span></span><br><span class="line">os.listdir()             <span class="comment"># 列出目录内容</span></span><br><span class="line">os.path.join(<span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>)   <span class="comment"># 拼接路径</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># datetime - 日期时间</span></span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime, timedelta</span><br><span class="line">now = datetime.now()</span><br><span class="line">tomorrow = now + timedelta(days=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># random - 随机数</span></span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line">random.random()          <span class="comment"># 0-1 随机浮点数</span></span><br><span class="line">random.randint(<span class="number">1</span>, <span class="number">10</span>)    <span class="comment"># 1-10 随机整数</span></span><br><span class="line">random.choice([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]) <span class="comment"># 随机选择</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># json - JSON 处理</span></span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line">json.dumps(&#123;<span class="string">&quot;a&quot;</span>: <span class="number">1</span>&#125;)     <span class="comment"># 字典转 JSON 字符串</span></span><br><span class="line">json.loads(<span class="string">&#x27;&#123;&quot;a&quot;: 1&#125;&#x27;</span>)   <span class="comment"># JSON 字符串转字典</span></span><br></pre></td></tr></table></figure>

<h2 id="七、文件操作"><a href="#七、文件操作" class="headerlink" title="七、文件操作"></a>七、文件操作</h2><h3 id="7-1-读写文件"><a href="#7-1-读写文件" class="headerlink" title="7.1 读写文件"></a>7.1 读写文件</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 写入文件</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;test.txt&quot;</span>, <span class="string">&quot;w&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(<span class="string">&quot;Hello, World!\n&quot;</span>)</span><br><span class="line">    f.write(<span class="string">&quot;第二行\n&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 读取文件</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;test.txt&quot;</span>, <span class="string">&quot;r&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    content = f.read()      <span class="comment"># 读取全部内容</span></span><br><span class="line">    <span class="built_in">print</span>(content)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 逐行读取</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;test.txt&quot;</span>, <span class="string">&quot;r&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> f:</span><br><span class="line">        <span class="built_in">print</span>(line.strip())</span><br><span class="line"></span><br><span class="line"><span class="comment"># 读取所有行</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;test.txt&quot;</span>, <span class="string">&quot;r&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    lines = f.readlines()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 提醒自己：</span></span><br><span class="line"><span class="comment"># - 务必使用 with 语句，自动关闭文件</span></span><br><span class="line"><span class="comment"># - 指定 encoding=&#x27;utf-8&#x27; 避免中文乱码</span></span><br><span class="line"><span class="comment"># - 模式：&#x27;r&#x27; 读取，&#x27;w&#x27; 写入（覆盖），&#x27;a&#x27; 追加，&#x27;b&#x27; 二进制</span></span><br></pre></td></tr></table></figure>

<h2 id="八、实践建议"><a href="#八、实践建议" class="headerlink" title="八、实践建议"></a>八、实践建议</h2><blockquote>
<p><strong>提醒自己</strong>：</p>
<ol>
<li><strong>多动手写代码</strong>：看十遍不如写一遍</li>
<li><strong>善用调试</strong>：用 print() 或断点调试理解代码执行</li>
<li><strong>阅读错误信息</strong>：Python 的错误信息很友好，仔细阅读能找到问题</li>
<li><strong>代码规范</strong>：遵循 PEP 8 规范，变量命名要有意义</li>
<li><strong>写注释</strong>：关键逻辑要写注释，但不要注释显而易见的代码</li>
</ol>
</blockquote>
<h2 id="九、练习"><a href="#九、练习" class="headerlink" title="九、练习"></a>九、练习</h2><ol>
<li>编写程序，计算 1 到 100 的和</li>
<li>编写函数，判断一个数是否为素数</li>
<li>编写程序，统计字符串中每个字符出现的次数</li>
<li>编写函数，将列表中的重复元素去重</li>
<li>读取一个文件，统计文件行数</li>
</ol>
<hr>
<p><strong>下一篇</strong>：<a href="/2026/02/24/Python-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B%EF%BC%88%E4%BA%8C%EF%BC%89%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%BC%96%E7%A8%8B/">Python 基础教程（二）：面向对象编程</a></p>
<p><strong>参考资源</strong>：</p>
<ul>
<li><a href="https://docs.python.org/zh-cn/3/">Python 官方文档</a></li>
<li><a href="https://www.liaoxuefeng.com/wiki/1016959663602400">Python 入门教程</a></li>
<li><a href="https://peps.python.org/pep-0008/">PEP 8 代码风格指南</a></li>
</ul>
]]></content>
      <categories>
        <category>Python 教程</category>
      </categories>
      <tags>
        <tag>入门教程</tag>
        <tag>Python</tag>
        <tag>基础语法</tag>
      </tags>
  </entry>
  <entry>
    <title>Python 基础教程（二）面向对象编程</title>
    <url>/2026/02/24/Python%20%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B%EF%BC%88%E4%BA%8C%EF%BC%89%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%BC%96%E7%A8%8B/</url>
    <content><![CDATA[<h1 id="Python-基础教程（二）面向对象编程"><a href="#Python-基础教程（二）面向对象编程" class="headerlink" title="Python 基础教程（二）面向对象编程"></a>Python 基础教程（二）面向对象编程</h1><p>面向对象编程（OOP）是 Python 的核心编程范式之一。本篇将详细介绍 Python 中的类与对象、继承、多态等核心概念。</p>
<h2 id="一、面向对象基础"><a href="#一、面向对象基础" class="headerlink" title="一、面向对象基础"></a>一、面向对象基础</h2><h3 id="1-1-什么是面向对象？"><a href="#1-1-什么是面向对象？" class="headerlink" title="1.1 什么是面向对象？"></a>1.1 什么是面向对象？</h3><p><strong>面向对象编程（Object-Oriented Programming, OOP）</strong> 是一种编程范式，它将数据和处理数据的方法封装在一起，形成”对象”。</p>
<p><strong>核心概念：</strong></p>
<ul>
<li><strong>类（Class）</strong>：对象的模板&#x2F;蓝图，定义对象的属性和方法</li>
<li><strong>对象（Object）</strong>：类的实例，具体的实体</li>
<li><strong>属性（Attribute）</strong>：对象的特征&#x2F;数据</li>
<li><strong>方法（Method）</strong>：对象的行为&#x2F;操作</li>
</ul>
<p><strong>比喻理解：</strong></p>
<ul>
<li>类 &#x3D; 房屋设计图</li>
<li>对象 &#x3D; 根据设计图建造的具体房屋</li>
</ul>
<h3 id="1-2-为什么使用面向对象？"><a href="#1-2-为什么使用面向对象？" class="headerlink" title="1.2 为什么使用面向对象？"></a>1.2 为什么使用面向对象？</h3><blockquote>
<p><strong>提醒自己</strong>：</p>
<ul>
<li><strong>代码复用</strong>：继承机制减少重复代码</li>
<li><strong>易于维护</strong>：封装使代码结构清晰</li>
<li><strong>模块化</strong>：不同对象独立工作，降低耦合</li>
<li><strong>模拟现实</strong>：更符合人类思维方式</li>
</ul>
</blockquote>
<h2 id="二、类的定义与使用"><a href="#二、类的定义与使用" class="headerlink" title="二、类的定义与使用"></a>二、类的定义与使用</h2><h3 id="2-1-定义类"><a href="#2-1-定义类" class="headerlink" title="2.1 定义类"></a>2.1 定义类</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;人类&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 类属性（所有实例共享）</span></span><br><span class="line">    species = <span class="string">&quot;Homo sapiens&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 构造方法（初始化方法）</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name, age</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        初始化 Person 对象</span></span><br><span class="line"><span class="string">        :param name: 姓名</span></span><br><span class="line"><span class="string">        :param age: 年龄</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="comment"># 实例属性（每个实例独立）</span></span><br><span class="line">        <span class="variable language_">self</span>.name = name</span><br><span class="line">        <span class="variable language_">self</span>.age = age</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 实例方法</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">greet</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;问候&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&quot;你好，我是<span class="subst">&#123;self.name&#125;</span>！&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">birthday</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;过生日，年龄 +1&quot;&quot;&quot;</span></span><br><span class="line">        <span class="variable language_">self</span>.age += <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&quot;我<span class="subst">&#123;self.age&#125;</span>岁了！&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 类方法</span></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_species</span>(<span class="params">cls</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;获取物种&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> cls.species</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 静态方法</span></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">is_adult</span>(<span class="params">age</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;判断是否成年&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> age &gt;= <span class="number">18</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建对象</span></span><br><span class="line">p1 = Person(<span class="string">&quot;张三&quot;</span>, <span class="number">25</span>)</span><br><span class="line">p2 = Person(<span class="string">&quot;李四&quot;</span>, <span class="number">30</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 访问属性</span></span><br><span class="line"><span class="built_in">print</span>(p1.name)        <span class="comment"># 张三</span></span><br><span class="line"><span class="built_in">print</span>(p2.age)         <span class="comment"># 30</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 调用方法</span></span><br><span class="line"><span class="built_in">print</span>(p1.greet())     <span class="comment"># 你好，我是张三！</span></span><br><span class="line">p1.birthday()         <span class="comment"># 我 26 岁了！</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 访问类属性</span></span><br><span class="line"><span class="built_in">print</span>(Person.species)     <span class="comment"># Homo sapiens</span></span><br><span class="line"><span class="built_in">print</span>(p1.species)         <span class="comment"># Homo sapiens（实例也能访问）</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 调用类方法</span></span><br><span class="line"><span class="built_in">print</span>(Person.get_species())  <span class="comment"># Homo sapiens</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 调用静态方法</span></span><br><span class="line"><span class="built_in">print</span>(Person.is_adult(<span class="number">20</span>))   <span class="comment"># True</span></span><br><span class="line"><span class="built_in">print</span>(Person.is_adult(<span class="number">15</span>))   <span class="comment"># False</span></span><br></pre></td></tr></table></figure>

<h3 id="2-2-self-参数"><a href="#2-2-self-参数" class="headerlink" title="2.2 self 参数"></a>2.2 self 参数</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyClass</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">method</span>(<span class="params">instance_self, arg</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        self 只是一个约定俗成的名字</span></span><br><span class="line"><span class="string">        第一个参数始终代表实例本身</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;实例：<span class="subst">&#123;instance_self&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;参数：<span class="subst">&#123;arg&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># self 在调用时自动传入，不需要手动传递</span></span><br><span class="line">obj = MyClass()</span><br><span class="line">obj.method(<span class="string">&quot;hello&quot;</span>)</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>提醒自己</strong>：</p>
<ul>
<li><code>self</code> 是实例方法的第一个参数，代表调用该方法的对象</li>
<li><code>self</code> 是约定俗成的命名，可以用其他名字但不推荐</li>
<li>类方法的第一个参数是 <code>cls</code>，代表类本身</li>
<li>静态方法不需要 <code>self</code> 或 <code>cls</code></li>
</ul>
</blockquote>
<h3 id="2-3-属性封装"><a href="#2-3-属性封装" class="headerlink" title="2.3 属性封装"></a>2.3 属性封装</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">BankAccount</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;银行账户&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, owner, balance=<span class="number">0</span></span>):</span><br><span class="line">        <span class="variable language_">self</span>.owner = owner</span><br><span class="line">        <span class="variable language_">self</span>.__balance = balance  <span class="comment"># 私有属性（双下划线开头）</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">deposit</span>(<span class="params">self, amount</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;存款&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> amount &gt; <span class="number">0</span>:</span><br><span class="line">            <span class="variable language_">self</span>.__balance += amount</span><br><span class="line">            <span class="keyword">return</span> <span class="string">f&quot;存入<span class="subst">&#123;amount&#125;</span>，余额<span class="subst">&#123;self.__balance&#125;</span>&quot;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;存款金额必须大于 0&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">withdraw</span>(<span class="params">self, amount</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;取款&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> amount &gt; <span class="variable language_">self</span>.__balance:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;余额不足&quot;</span></span><br><span class="line">        <span class="variable language_">self</span>.__balance -= amount</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&quot;取出<span class="subst">&#123;amount&#125;</span>，余额<span class="subst">&#123;self.__balance&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_balance</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;查询余额（只读访问）&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.__balance</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 使用@property 装饰器</span></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">balance</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;getter 方法&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.__balance</span><br><span class="line"></span><br><span class="line"><span class="meta">    @balance.setter</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">balance</span>(<span class="params">self, value</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;setter 方法&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> value &lt; <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">&quot;余额不能为负数&quot;</span>)</span><br><span class="line">        <span class="variable language_">self</span>.__balance = value</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用</span></span><br><span class="line">account = BankAccount(<span class="string">&quot;张三&quot;</span>, <span class="number">1000</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 不能直接访问私有属性</span></span><br><span class="line"><span class="comment"># print(account.__balance)  # AttributeError!</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 通过方法访问</span></span><br><span class="line"><span class="built_in">print</span>(account.get_balance())  <span class="comment"># 1000</span></span><br><span class="line"><span class="built_in">print</span>(account.deposit(<span class="number">500</span>))   <span class="comment"># 存入 500，余额 1500</span></span><br><span class="line"><span class="built_in">print</span>(account.withdraw(<span class="number">200</span>))  <span class="comment"># 取出 200，余额 1300</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用@property</span></span><br><span class="line"><span class="built_in">print</span>(account.balance)  <span class="comment"># 1300（像访问属性一样）</span></span><br><span class="line">account.balance = <span class="number">2000</span>  <span class="comment"># 调用 setter</span></span><br><span class="line"><span class="built_in">print</span>(account.balance)  <span class="comment"># 2000</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 提醒自己：</span></span><br><span class="line"><span class="comment"># - 单下划线 _attr：约定俗成的&quot;保护&quot;属性（外部仍可访问）</span></span><br><span class="line"><span class="comment"># - 双下划线 __attr：私有属性（名称修饰，外部无法直接访问）</span></span><br></pre></td></tr></table></figure>

<h2 id="三、继承"><a href="#三、继承" class="headerlink" title="三、继承"></a>三、继承</h2><h3 id="3-1-基础继承"><a href="#3-1-基础继承" class="headerlink" title="3.1 基础继承"></a>3.1 基础继承</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 父类（基类）</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Animal</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;动物类&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name</span>):</span><br><span class="line">        <span class="variable language_">self</span>.name = name</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">speak</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;说话&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;...&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">info</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;信息&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&quot;我是<span class="subst">&#123;self.name&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 子类（派生类）</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Dog</span>(<span class="title class_ inherited__">Animal</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;狗类&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name, breed</span>):</span><br><span class="line">        <span class="comment"># 调用父类构造方法</span></span><br><span class="line">        <span class="built_in">super</span>().__init__(name)</span><br><span class="line">        <span class="variable language_">self</span>.breed = breed  <span class="comment"># 新增属性</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 重写父类方法</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">speak</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;汪汪汪！&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 新增方法</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">fetch</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;捡球&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Cat</span>(<span class="title class_ inherited__">Animal</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;猫类&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">speak</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;喵喵喵！&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用</span></span><br><span class="line">dog = Dog(<span class="string">&quot;旺财&quot;</span>, <span class="string">&quot;金毛&quot;</span>)</span><br><span class="line">cat = Cat(<span class="string">&quot;咪咪&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(dog.info())    <span class="comment"># 我是旺财（继承自父类）</span></span><br><span class="line"><span class="built_in">print</span>(dog.speak())   <span class="comment"># 汪汪汪！（重写）</span></span><br><span class="line"><span class="built_in">print</span>(dog.fetch())   <span class="comment"># 捡球（子类特有）</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(cat.info())    <span class="comment"># 我是咪咪</span></span><br><span class="line"><span class="built_in">print</span>(cat.speak())   <span class="comment"># 喵喵喵！</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 判断类型</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">isinstance</span>(dog, Dog))    <span class="comment"># True</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">isinstance</span>(dog, Animal)) <span class="comment"># True（狗也是动物）</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">isinstance</span>(cat, Dog))    <span class="comment"># False</span></span><br></pre></td></tr></table></figure>

<h3 id="3-2-多重继承"><a href="#3-2-多重继承" class="headerlink" title="3.2 多重继承"></a>3.2 多重继承</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Flyable</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;会飞的&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">fly</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;我会飞！&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Swimmable</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;会游泳的&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">swim</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;我会游泳！&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Duck</span>(Flyable, Swimmable):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;鸭子&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name</span>):</span><br><span class="line">        <span class="variable language_">self</span>.name = name</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">speak</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;嘎嘎嘎！&quot;</span></span><br><span class="line"></span><br><span class="line">duck = Duck(<span class="string">&quot;唐老鸭&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(duck.speak())  <span class="comment"># 嘎嘎嘎！</span></span><br><span class="line"><span class="built_in">print</span>(duck.fly())    <span class="comment"># 我会飞！</span></span><br><span class="line"><span class="built_in">print</span>(duck.swim())   <span class="comment"># 我会游泳！</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看继承顺序（MRO）</span></span><br><span class="line"><span class="built_in">print</span>(Duck.__mro__)</span><br><span class="line"><span class="comment"># (&lt;class &#x27;Duck&#x27;&gt;, &lt;class &#x27;Flyable&#x27;&gt;, &lt;class &#x27;Swimmable&#x27;&gt;, &lt;class &#x27;object&#x27;&gt;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 提醒自己：</span></span><br><span class="line"><span class="comment"># - 多重继承可能导致&quot;菱形问题&quot;</span></span><br><span class="line"><span class="comment"># - Python 使用 C3 算法确定方法解析顺序（MRO）</span></span><br><span class="line"><span class="comment"># - 能用组合解决的就不要用多重继承</span></span><br></pre></td></tr></table></figure>

<h3 id="3-3-super-的使用"><a href="#3-3-super-的使用" class="headerlink" title="3.3 super() 的使用"></a>3.3 super() 的使用</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Parent</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name</span>):</span><br><span class="line">        <span class="variable language_">self</span>.name = name</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Parent: <span class="subst">&#123;name&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Child</span>(<span class="title class_ inherited__">Parent</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name, age</span>):</span><br><span class="line">        <span class="comment"># 调用父类的__init__</span></span><br><span class="line">        <span class="built_in">super</span>().__init__(name)</span><br><span class="line">        <span class="variable language_">self</span>.age = age</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Child: <span class="subst">&#123;name&#125;</span>, <span class="subst">&#123;age&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">c = Child(<span class="string">&quot;张三&quot;</span>, <span class="number">10</span>)</span><br><span class="line"><span class="comment"># 输出：</span></span><br><span class="line"><span class="comment"># Parent: 张三</span></span><br><span class="line"><span class="comment"># Child: 张三，10</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>提醒自己</strong>：</p>
<ul>
<li><code>super()</code> 用于调用父类方法</li>
<li>在多重继承中，<code>super()</code> 按照 MRO 顺序调用</li>
<li>始终使用 <code>super()</code> 而不是直接调用父类名</li>
</ul>
</blockquote>
<h2 id="四、多态"><a href="#四、多态" class="headerlink" title="四、多态"></a>四、多态</h2><h3 id="4-1-什么是多态？"><a href="#4-1-什么是多态？" class="headerlink" title="4.1 什么是多态？"></a>4.1 什么是多态？</h3><p><strong>多态（Polymorphism）</strong> 指同一个接口可以作用于不同的对象。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Dog</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">speak</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;汪汪！&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Cat</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">speak</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;喵喵！&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Duck</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">speak</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;嘎嘎！&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 多态函数</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">animal_sound</span>(<span class="params">animal</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;不关心对象类型，只关心对象是否有 speak 方法&quot;&quot;&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(animal.speak())</span><br><span class="line"></span><br><span class="line"><span class="comment"># 不同的对象，相同的接口</span></span><br><span class="line">animals = [Dog(), Cat(), Duck()]</span><br><span class="line"><span class="keyword">for</span> animal <span class="keyword">in</span> animals:</span><br><span class="line">    animal_sound(animal)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出：</span></span><br><span class="line"><span class="comment"># 汪汪！</span></span><br><span class="line"><span class="comment"># 喵喵！</span></span><br><span class="line"><span class="comment"># 嘎嘎！</span></span><br></pre></td></tr></table></figure>

<h3 id="4-2-Python-的”鸭子类型”"><a href="#4-2-Python-的”鸭子类型”" class="headerlink" title="4.2 Python 的”鸭子类型”"></a>4.2 Python 的”鸭子类型”</h3><blockquote>
<p>“如果走起来像鸭子，叫起来像鸭子，那它就是鸭子。”</p>
</blockquote>
<p>Python 不关心对象的类型，只关心对象是否有需要的方法&#x2F;属性。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 不检查类型，只检查方法</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">make_sound</span>(<span class="params">obj</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">hasattr</span>(obj, <span class="string">&#x27;speak&#x27;</span>):</span><br><span class="line">        <span class="built_in">print</span>(obj.speak())</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;这个对象不会说话&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 任何有 speak 方法的对象都可以</span></span><br><span class="line">make_sound(Dog())  <span class="comment"># 汪汪！</span></span><br><span class="line">make_sound(Cat())  <span class="comment"># 喵喵！</span></span><br></pre></td></tr></table></figure>

<h2 id="五、特殊方法（魔术方法）"><a href="#五、特殊方法（魔术方法）" class="headerlink" title="五、特殊方法（魔术方法）"></a>五、特殊方法（魔术方法）</h2><h3 id="5-1-字符串表示"><a href="#5-1-字符串表示" class="headerlink" title="5.1 字符串表示"></a>5.1 字符串表示</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name, age</span>):</span><br><span class="line">        <span class="variable language_">self</span>.name = name</span><br><span class="line">        <span class="variable language_">self</span>.age = age</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__str__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;用户看到的字符串表示（print() 时使用）&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&quot;<span class="subst">&#123;self.name&#125;</span>，<span class="subst">&#123;self.age&#125;</span>岁&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__repr__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;开发者看到的字符串表示（交互式命令行/调试时使用）&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&quot;Person(&#x27;<span class="subst">&#123;self.name&#125;</span>&#x27;, <span class="subst">&#123;self.age&#125;</span>)&quot;</span></span><br><span class="line"></span><br><span class="line">p = Person(<span class="string">&quot;张三&quot;</span>, <span class="number">25</span>)</span><br><span class="line"><span class="built_in">print</span>(p)          <span class="comment"># 张三，25 岁（调用__str__）</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">repr</span>(p))    <span class="comment"># Person(&#x27;张三&#x27;, 25)（调用__repr__）</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 提醒自己：</span></span><br><span class="line"><span class="comment"># - __str__ 给用户看，应该友好易读</span></span><br><span class="line"><span class="comment"># - __repr__ 给开发者看，应该精确无歧义（理想情况下 eval(repr(obj)) == obj）</span></span><br></pre></td></tr></table></figure>

<h3 id="5-2-数值运算"><a href="#5-2-数值运算" class="headerlink" title="5.2 数值运算"></a>5.2 数值运算</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Vector</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;二维向量&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, x, y</span>):</span><br><span class="line">        <span class="variable language_">self</span>.x = x</span><br><span class="line">        <span class="variable language_">self</span>.y = y</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__add__</span>(<span class="params">self, other</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;向量相加 v1 + v2&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> Vector(<span class="variable language_">self</span>.x + other.x, <span class="variable language_">self</span>.y + other.y)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__sub__</span>(<span class="params">self, other</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;向量相减 v1 - v2&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> Vector(<span class="variable language_">self</span>.x - other.x, <span class="variable language_">self</span>.y - other.y)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__mul__</span>(<span class="params">self, scalar</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;数乘 v * n&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> Vector(<span class="variable language_">self</span>.x * scalar, <span class="variable language_">self</span>.y * scalar)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__eq__</span>(<span class="params">self, other</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;相等判断 v1 == v2&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.x == other.x <span class="keyword">and</span> <span class="variable language_">self</span>.y == other.y</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__len__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;向量长度（模）&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">int</span>((<span class="variable language_">self</span>.x ** <span class="number">2</span> + <span class="variable language_">self</span>.y ** <span class="number">2</span>) ** <span class="number">0.5</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__str__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&quot;Vector(<span class="subst">&#123;self.x&#125;</span>, <span class="subst">&#123;self.y&#125;</span>)&quot;</span></span><br><span class="line"></span><br><span class="line">v1 = Vector(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line">v2 = Vector(<span class="number">3</span>, <span class="number">4</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(v1 + v2)   <span class="comment"># Vector(4, 6)</span></span><br><span class="line"><span class="built_in">print</span>(v1 - v2)   <span class="comment"># Vector(-2, -2)</span></span><br><span class="line"><span class="built_in">print</span>(v1 * <span class="number">3</span>)    <span class="comment"># Vector(3, 6)</span></span><br><span class="line"><span class="built_in">print</span>(v1 == v2)  <span class="comment"># False</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(v1))   <span class="comment"># 2（向下取整）</span></span><br></pre></td></tr></table></figure>

<h3 id="5-3-常用魔术方法"><a href="#5-3-常用魔术方法" class="headerlink" title="5.3 常用魔术方法"></a>5.3 常用魔术方法</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyList</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;自定义列表&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, items</span>):</span><br><span class="line">        <span class="variable language_">self</span>.items = items</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__len__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;len(obj)&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">len</span>(<span class="variable language_">self</span>.items)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__getitem__</span>(<span class="params">self, index</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;obj[index]&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.items[index]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__setitem__</span>(<span class="params">self, index, value</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;obj[index] = value&quot;&quot;&quot;</span></span><br><span class="line">        <span class="variable language_">self</span>.items[index] = value</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__delitem__</span>(<span class="params">self, index</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;del obj[index]&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">del</span> <span class="variable language_">self</span>.items[index]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__iter__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;迭代器&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">iter</span>(<span class="variable language_">self</span>.items)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__contains__</span>(<span class="params">self, item</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;item in obj&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> item <span class="keyword">in</span> <span class="variable language_">self</span>.items</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__call__</span>(<span class="params">self, *args</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;obj() 使对象可调用&quot;&quot;&quot;</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;被调用了！参数：<span class="subst">&#123;args&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="六、抽象基类（ABC）"><a href="#六、抽象基类（ABC）" class="headerlink" title="六、抽象基类（ABC）"></a>六、抽象基类（ABC）</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> abc <span class="keyword">import</span> ABC, abstractmethod</span><br><span class="line"></span><br><span class="line"><span class="comment"># 抽象基类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Shape</span>(<span class="title class_ inherited__">ABC</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;形状抽象基类&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">area</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;计算面积（必须由子类实现）&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">perimeter</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;计算周长（必须由子类实现）&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 普通方法（子类可继承）</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">describe</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;我是一个形状&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 具体实现</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Rectangle</span>(<span class="title class_ inherited__">Shape</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, width, height</span>):</span><br><span class="line">        <span class="variable language_">self</span>.width = width</span><br><span class="line">        <span class="variable language_">self</span>.height = height</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">area</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.width * <span class="variable language_">self</span>.height</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">perimeter</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="number">2</span> * (<span class="variable language_">self</span>.width + <span class="variable language_">self</span>.height)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Circle</span>(<span class="title class_ inherited__">Shape</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, radius</span>):</span><br><span class="line">        <span class="variable language_">self</span>.radius = radius</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">area</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="number">3.14159</span> * <span class="variable language_">self</span>.radius ** <span class="number">2</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">perimeter</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="number">2</span> * <span class="number">3.14159</span> * <span class="variable language_">self</span>.radius</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用</span></span><br><span class="line">rect = Rectangle(<span class="number">5</span>, <span class="number">3</span>)</span><br><span class="line">circle = Circle(<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(rect.area())        <span class="comment"># 15</span></span><br><span class="line"><span class="built_in">print</span>(circle.area())      <span class="comment"># 50.27</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 不能实例化抽象基类</span></span><br><span class="line"><span class="comment"># shape = Shape()  # TypeError!</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 提醒自己：</span></span><br><span class="line"><span class="comment"># - ABC 强制子类实现指定方法</span></span><br><span class="line"><span class="comment"># - 适合定义接口/规范</span></span><br><span class="line"><span class="comment"># - @abstractmethod 装饰的方法必须被子类重写</span></span><br></pre></td></tr></table></figure>

<h2 id="七、类与实例的关系总结"><a href="#七、类与实例的关系总结" class="headerlink" title="七、类与实例的关系总结"></a>七、类与实例的关系总结</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyClass</span>:</span><br><span class="line">    class_attr = <span class="string">&quot;我是类属性&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.instance_attr = <span class="string">&quot;我是实例属性&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">class_method</span>(<span class="params">cls</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&quot;类方法，访问：<span class="subst">&#123;cls.class_attr&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">static_method</span>():</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;静态方法，不访问类或实例&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">instance_method</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&quot;实例方法，访问：<span class="subst">&#123;self.instance_attr&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 类属性 vs 实例属性</span></span><br><span class="line">obj1 = MyClass()</span><br><span class="line">obj2 = MyClass()</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(MyClass.class_attr)  <span class="comment"># 类属性（所有实例共享）</span></span><br><span class="line"><span class="built_in">print</span>(obj1.instance_attr)  <span class="comment"># 实例属性（每个实例独立）</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改类属性</span></span><br><span class="line">MyClass.class_attr = <span class="string">&quot;新的类属性&quot;</span></span><br><span class="line"><span class="built_in">print</span>(obj2.class_attr)  <span class="comment"># 新的类属性</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 提醒自己：</span></span><br><span class="line"><span class="comment"># - 类属性：所有实例共享，通过类或实例访问</span></span><br><span class="line"><span class="comment"># - 实例属性：每个实例独立，只能通过实例访问</span></span><br><span class="line"><span class="comment"># - 类方法：用@classmethod，第一个参数是 cls</span></span><br><span class="line"><span class="comment"># - 静态方法：用@staticmethod，不需要 cls 或 self</span></span><br><span class="line"><span class="comment"># - 实例方法：默认，第一个参数是 self</span></span><br></pre></td></tr></table></figure>

<h2 id="八、实践建议"><a href="#八、实践建议" class="headerlink" title="八、实践建议"></a>八、实践建议</h2><blockquote>
<p><strong>提醒自己</strong>：</p>
<ol>
<li><strong>优先使用组合而非继承</strong>：组合更灵活，继承层次不要太深</li>
<li><strong>遵循单一职责原则</strong>：一个类只做一件事</li>
<li><strong>善用封装</strong>：私有属性保护数据，提供公共接口访问</li>
<li><strong>不要过度设计</strong>：简单的脚本不需要类</li>
<li><strong>理解 Python 的哲学</strong>：约定优于强制</li>
</ol>
</blockquote>
<h2 id="九、练习"><a href="#九、练习" class="headerlink" title="九、练习"></a>九、练习</h2><ol>
<li>定义一个 <code>Student</code> 类，包含姓名、学号、成绩等属性，以及计算平均分的方法</li>
<li>定义 <code>Teacher</code> 类，继承自 <code>Person</code> 类，添加工资、所教科目等属性</li>
<li>实现一个简易的栈（Stack）类，支持 push、pop、peek 操作</li>
<li>使用继承实现一个图形计算器，支持计算矩形、圆形、三角形的面积</li>
<li>实现一个上下文管理器类，用于自动关闭文件</li>
</ol>
<hr>
<p><strong>上一篇</strong>：<a href="/2026/02/24/Python-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B%EF%BC%88%E4%B8%80%EF%BC%89%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95%E5%85%A5%E9%97%A8/">Python 基础教程（一）：基础语法入门</a></p>
<p><strong>下一篇</strong>：<a href="/2026/02/24/Python-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B%EF%BC%88%E4%B8%89%EF%BC%89%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86/">Python 基础教程（三）：异常处理</a></p>
<p><strong>参考资源</strong>：</p>
<ul>
<li><a href="https://docs.python.org/zh-cn/3/tutorial/classes.html">Python 官方文档 - 类</a></li>
<li><a href="https://docs.python.org/zh-cn/3/reference/datamodel.html">Python 官方文档 - 数据模型</a></li>
</ul>
]]></content>
      <categories>
        <category>Python 教程</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>面向对象</tag>
        <tag>类与对象</tag>
      </tags>
  </entry>
  <entry>
    <title>Python 常用库（一）requests API 调用</title>
    <url>/2026/02/24/Python%20%E5%B8%B8%E7%94%A8%E5%BA%93%EF%BC%88%E4%B8%80%EF%BC%89requests%20API%20%E8%B0%83%E7%94%A8/</url>
    <content><![CDATA[<h1 id="Python-常用库（一）requests-API-调用"><a href="#Python-常用库（一）requests-API-调用" class="headerlink" title="Python 常用库（一）requests API 调用"></a>Python 常用库（一）requests API 调用</h1><p>requests 是 Python 最流行的 HTTP 客户端库。本篇将介绍如何使用 requests 进行 API 调用、处理响应、文件上传等实用技能。</p>
<h2 id="一、requests-简介"><a href="#一、requests-简介" class="headerlink" title="一、requests 简介"></a>一、requests 简介</h2><h3 id="1-1-为什么使用-requests？"><a href="#1-1-为什么使用-requests？" class="headerlink" title="1.1 为什么使用 requests？"></a>1.1 为什么使用 requests？</h3><ul>
<li><strong>简洁 API</strong>：人性化设计，代码简单易读</li>
<li><strong>功能强大</strong>：支持各种 HTTP 方法、认证、会话等</li>
<li><strong>生态完善</strong>：文档丰富，社区活跃</li>
<li><strong>自动处理</strong>：自动处理 URL 编码、Cookie、Session 等</li>
</ul>
<h3 id="1-2-安装与导入"><a href="#1-2-安装与导入" class="headerlink" title="1.2 安装与导入"></a>1.2 安装与导入</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pip install requests</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看版本</span></span><br><span class="line"><span class="built_in">print</span>(requests.__version__)</span><br></pre></td></tr></table></figure>

<h2 id="二、基础请求"><a href="#二、基础请求" class="headerlink" title="二、基础请求"></a>二、基础请求</h2><h3 id="2-1-GET-请求"><a href="#2-1-GET-请求" class="headerlink" title="2.1 GET 请求"></a>2.1 GET 请求</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="comment"># 最简单的 GET 请求</span></span><br><span class="line">response = requests.get(<span class="string">&#x27;https://api.example.com/data&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 带参数的 GET 请求</span></span><br><span class="line">params = &#123;<span class="string">&#x27;q&#x27;</span>: <span class="string">&#x27;python&#x27;</span>, <span class="string">&#x27;page&#x27;</span>: <span class="number">1</span>&#125;</span><br><span class="line">response = requests.get(<span class="string">&#x27;https://api.example.com/search&#x27;</span>, params=params)</span><br><span class="line"></span><br><span class="line"><span class="comment"># params 会自动拼接成 URL</span></span><br><span class="line"><span class="comment"># https://api.example.com/search?q=python&amp;page=1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看最终 URL</span></span><br><span class="line"><span class="built_in">print</span>(response.url)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加请求头</span></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Accept&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line">response = requests.get(<span class="string">&#x27;https://api.example.com/data&#x27;</span>, headers=headers)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置超时（秒）</span></span><br><span class="line">response = requests.get(<span class="string">&#x27;https://api.example.com/data&#x27;</span>, timeout=<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 提醒自己：</span></span><br><span class="line"><span class="comment"># - timeout 是必须的，防止程序无限等待</span></span><br><span class="line"><span class="comment"># - User-Agent 避免被某些网站屏蔽</span></span><br></pre></td></tr></table></figure>

<h3 id="2-2-POST-请求"><a href="#2-2-POST-请求" class="headerlink" title="2.2 POST 请求"></a>2.2 POST 请求</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 发送 JSON 数据</span></span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">&#x27;username&#x27;</span>: <span class="string">&#x27;张三&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;password&#x27;</span>: <span class="string">&#x27;123456&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;email&#x27;</span>: <span class="string">&#x27;zhangsan@example.com&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line">response = requests.post(<span class="string">&#x27;https://api.example.com/login&#x27;</span>, json=data)</span><br><span class="line"></span><br><span class="line"><span class="comment"># json 参数会自动：</span></span><br><span class="line"><span class="comment"># 1. 将字典序列化为 JSON</span></span><br><span class="line"><span class="comment"># 2. 设置 Content-Type: application/json</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 发送表单数据</span></span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">&#x27;username&#x27;</span>: <span class="string">&#x27;张三&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;password&#x27;</span>: <span class="string">&#x27;123456&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line">response = requests.post(<span class="string">&#x27;https://api.example.com/login&#x27;</span>, data=data)</span><br><span class="line"></span><br><span class="line"><span class="comment"># data 参数会发送 application/x-www-form-urlencoded</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 提醒自己：</span></span><br><span class="line"><span class="comment"># - 发送 JSON 用 json= 参数</span></span><br><span class="line"><span class="comment"># - 发送表单用 data= 参数</span></span><br></pre></td></tr></table></figure>

<h3 id="2-3-其他-HTTP-方法"><a href="#2-3-其他-HTTP-方法" class="headerlink" title="2.3 其他 HTTP 方法"></a>2.3 其他 HTTP 方法</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># PUT 请求（更新资源）</span></span><br><span class="line">response = requests.put(<span class="string">&#x27;https://api.example.com/users/1&#x27;</span>, json=&#123;</span><br><span class="line">    <span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;新名字&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;email&#x27;</span>: <span class="string">&#x27;new@example.com&#x27;</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># PATCH 请求（部分更新）</span></span><br><span class="line">response = requests.patch(<span class="string">&#x27;https://api.example.com/users/1&#x27;</span>, json=&#123;</span><br><span class="line">    <span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;新名字&#x27;</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># DELETE 请求（删除资源）</span></span><br><span class="line">response = requests.delete(<span class="string">&#x27;https://api.example.com/users/1&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># HEAD 请求（只获取响应头）</span></span><br><span class="line">response = requests.head(<span class="string">&#x27;https://api.example.com/data&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(response.headers)</span><br><span class="line"></span><br><span class="line"><span class="comment"># OPTIONS 请求（获取服务器支持的方法）</span></span><br><span class="line">response = requests.options(<span class="string">&#x27;https://api.example.com/data&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(response.headers[<span class="string">&#x27;Allow&#x27;</span>])</span><br></pre></td></tr></table></figure>

<h2 id="三、响应处理"><a href="#三、响应处理" class="headerlink" title="三、响应处理"></a>三、响应处理</h2><h3 id="3-1-响应状态码"><a href="#3-1-响应状态码" class="headerlink" title="3.1 响应状态码"></a>3.1 响应状态码</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">response = requests.get(<span class="string">&#x27;https://api.example.com/data&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 状态码</span></span><br><span class="line"><span class="built_in">print</span>(response.status_code)  <span class="comment"># 200, 404, 500 等</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 常用状态码含义</span></span><br><span class="line"><span class="comment"># 200 OK - 请求成功</span></span><br><span class="line"><span class="comment"># 201 Created - 资源创建成功</span></span><br><span class="line"><span class="comment"># 204 No Content - 成功但无内容返回</span></span><br><span class="line"><span class="comment"># 400 Bad Request - 请求参数错误</span></span><br><span class="line"><span class="comment"># 401 Unauthorized - 未授权</span></span><br><span class="line"><span class="comment"># 403 Forbidden - 禁止访问</span></span><br><span class="line"><span class="comment"># 404 Not Found - 资源不存在</span></span><br><span class="line"><span class="comment"># 500 Internal Server Error - 服务器内部错误</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查是否成功</span></span><br><span class="line"><span class="keyword">if</span> response.ok:  <span class="comment"># 状态码 200-399</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;请求成功&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> response.status_code == <span class="number">200</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;成功&quot;</span>)</span><br><span class="line"><span class="keyword">elif</span> response.status_code == <span class="number">404</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;资源不存在&quot;</span>)</span><br><span class="line"><span class="keyword">elif</span> response.status_code &gt;= <span class="number">500</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;服务器错误&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 抛出异常（如果不是 200）</span></span><br><span class="line">response.raise_for_status()  <span class="comment"># 非 2xx 会抛出 HTTPError</span></span><br></pre></td></tr></table></figure>

<h3 id="3-2-响应内容"><a href="#3-2-响应内容" class="headerlink" title="3.2 响应内容"></a>3.2 响应内容</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">response = requests.get(<span class="string">&#x27;https://api.example.com/data&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># JSON 响应</span></span><br><span class="line">data = response.json()  <span class="comment"># 返回字典或列表</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 文本响应</span></span><br><span class="line">text = response.text  <span class="comment"># 字符串，自动解码</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 字节响应</span></span><br><span class="line">content = response.content  <span class="comment"># bytes，适合下载文件</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 响应头</span></span><br><span class="line"><span class="built_in">print</span>(response.headers)</span><br><span class="line"><span class="built_in">print</span>(response.headers[<span class="string">&#x27;Content-Type&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 编码</span></span><br><span class="line"><span class="built_in">print</span>(response.encoding)  <span class="comment"># 检测的编码</span></span><br><span class="line">response.encoding = <span class="string">&#x27;utf-8&#x27;</span>  <span class="comment"># 手动设置编码</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 提醒自己：</span></span><br><span class="line"><span class="comment"># - response.json() 会解析 JSON</span></span><br><span class="line"><span class="comment"># - response.text 自动解码</span></span><br><span class="line"><span class="comment"># - response.content 原始字节</span></span><br></pre></td></tr></table></figure>

<h3 id="3-3-下载文件"><a href="#3-3-下载文件" class="headerlink" title="3.3 下载文件"></a>3.3 下载文件</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 小文件下载</span></span><br><span class="line">response = requests.get(<span class="string">&#x27;https://example.com/file.jpg&#x27;</span>)</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;file.jpg&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(response.content)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 大文件下载（流式，节省内存）</span></span><br><span class="line">response = requests.get(<span class="string">&#x27;https://example.com/large_file.zip&#x27;</span>, stream=<span class="literal">True</span>)</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;large_file.zip&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="keyword">for</span> chunk <span class="keyword">in</span> response.iter_content(chunk_size=<span class="number">8192</span>):</span><br><span class="line">        f.write(chunk)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 带进度条的下载（需要 tqdm）</span></span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> tqdm</span><br><span class="line"></span><br><span class="line">response = requests.get(<span class="string">&#x27;https://example.com/large_file.zip&#x27;</span>, stream=<span class="literal">True</span>)</span><br><span class="line">total = <span class="built_in">int</span>(response.headers.get(<span class="string">&#x27;content-length&#x27;</span>, <span class="number">0</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;large_file.zip&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="keyword">with</span> tqdm(total=total, unit=<span class="string">&#x27;B&#x27;</span>, unit_scale=<span class="literal">True</span>) <span class="keyword">as</span> pbar:</span><br><span class="line">        <span class="keyword">for</span> chunk <span class="keyword">in</span> response.iter_content(chunk_size=<span class="number">8192</span>):</span><br><span class="line">            f.write(chunk)</span><br><span class="line">            pbar.update(<span class="built_in">len</span>(chunk))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 提醒自己：</span></span><br><span class="line"><span class="comment"># - 大文件一定要用 stream=True</span></span><br><span class="line"><span class="comment"># - iter_content 分块读取，避免内存溢出</span></span><br></pre></td></tr></table></figure>

<h2 id="四、请求头与认证"><a href="#四、请求头与认证" class="headerlink" title="四、请求头与认证"></a>四、请求头与认证</h2><h3 id="4-1-自定义请求头"><a href="#4-1-自定义请求头" class="headerlink" title="4.1 自定义请求头"></a>4.1 自定义请求头</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;MyApp/1.0&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Accept&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Authorization&#x27;</span>: <span class="string">&#x27;Bearer YOUR_TOKEN&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;X-Custom-Header&#x27;</span>: <span class="string">&#x27;value&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">response = requests.get(<span class="string">&#x27;https://api.example.com/data&#x27;</span>, headers=headers)</span><br></pre></td></tr></table></figure>

<h3 id="4-2-Basic-认证"><a href="#4-2-Basic-认证" class="headerlink" title="4.2 Basic 认证"></a>4.2 Basic 认证</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> requests.auth <span class="keyword">import</span> HTTPBasicAuth</span><br><span class="line"></span><br><span class="line"><span class="comment"># 方式一：使用 HTTPBasicAuth</span></span><br><span class="line">response = requests.get(</span><br><span class="line">    <span class="string">&#x27;https://api.example.com/protected&#x27;</span>,</span><br><span class="line">    auth=HTTPBasicAuth(<span class="string">&#x27;username&#x27;</span>, <span class="string">&#x27;password&#x27;</span>)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 方式二：简化写法</span></span><br><span class="line">response = requests.get(</span><br><span class="line">    <span class="string">&#x27;https://api.example.com/protected&#x27;</span>,</span><br><span class="line">    auth=(<span class="string">&#x27;username&#x27;</span>, <span class="string">&#x27;password&#x27;</span>)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 方式三：手动设置 Header</span></span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line">credentials = base64.b64encode(<span class="string">b&#x27;username:password&#x27;</span>).decode()</span><br><span class="line">headers = &#123;<span class="string">&#x27;Authorization&#x27;</span>: <span class="string">f&#x27;Basic <span class="subst">&#123;credentials&#125;</span>&#x27;</span>&#125;</span><br><span class="line">response = requests.get(<span class="string">&#x27;https://api.example.com/protected&#x27;</span>, headers=headers)</span><br></pre></td></tr></table></figure>

<h3 id="4-3-Token-Bearer-认证"><a href="#4-3-Token-Bearer-认证" class="headerlink" title="4.3 Token&#x2F;Bearer 认证"></a>4.3 Token&#x2F;Bearer 认证</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># API Key</span></span><br><span class="line">headers = &#123;<span class="string">&#x27;Authorization&#x27;</span>: <span class="string">&#x27;Bearer YOUR_ACCESS_TOKEN&#x27;</span>&#125;</span><br><span class="line">response = requests.get(<span class="string">&#x27;https://api.example.com/data&#x27;</span>, headers=headers)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 或者</span></span><br><span class="line">headers = &#123;<span class="string">&#x27;X-API-Key&#x27;</span>: <span class="string">&#x27;YOUR_API_KEY&#x27;</span>&#125;</span><br><span class="line">response = requests.get(<span class="string">&#x27;https://api.example.com/data&#x27;</span>, headers=headers)</span><br></pre></td></tr></table></figure>

<h3 id="4-4-Cookie-处理"><a href="#4-4-Cookie-处理" class="headerlink" title="4.4 Cookie 处理"></a>4.4 Cookie 处理</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 发送 Cookie</span></span><br><span class="line">cookies = &#123;<span class="string">&#x27;session_id&#x27;</span>: <span class="string">&#x27;abc123&#x27;</span>, <span class="string">&#x27;user&#x27;</span>: <span class="string">&#x27;zhangsan&#x27;</span>&#125;</span><br><span class="line">response = requests.get(<span class="string">&#x27;https://api.example.com/data&#x27;</span>, cookies=cookies)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取 Cookie</span></span><br><span class="line">response = requests.get(<span class="string">&#x27;https://api.example.com/login&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(response.cookies.get_dict())</span><br><span class="line"><span class="built_in">print</span>(response.cookies[<span class="string">&#x27;session_id&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 持久化 Cookie（使用 Session）</span></span><br><span class="line">session = requests.Session()</span><br><span class="line">session.get(<span class="string">&#x27;https://api.example.com/login&#x27;</span>, data=&#123;<span class="string">&#x27;user&#x27;</span>: <span class="string">&#x27;张三&#x27;</span>, <span class="string">&#x27;pwd&#x27;</span>: <span class="string">&#x27;123&#x27;</span>&#125;)</span><br><span class="line"><span class="comment"># Cookie 自动保存</span></span><br><span class="line">response = session.get(<span class="string">&#x27;https://api.example.com/protected&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="五、Session-会话"><a href="#五、Session-会话" class="headerlink" title="五、Session 会话"></a>五、Session 会话</h2><h3 id="5-1-Session-基础"><a href="#5-1-Session-基础" class="headerlink" title="5.1 Session 基础"></a>5.1 Session 基础</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 创建会话</span></span><br><span class="line">session = requests.Session()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 会话会保持 Cookie 和连接</span></span><br><span class="line">session.get(<span class="string">&#x27;https://api.example.com/login&#x27;</span>, data=&#123;</span><br><span class="line">    <span class="string">&#x27;username&#x27;</span>: <span class="string">&#x27;张三&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;password&#x27;</span>: <span class="string">&#x27;123456&#x27;</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 后续请求自动携带 Cookie</span></span><br><span class="line">response = session.get(<span class="string">&#x27;https://api.example.com/profile&#x27;</span>)</span><br><span class="line">response = session.get(<span class="string">&#x27;https://api.example.com/settings&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 关闭会话</span></span><br><span class="line">session.close()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 推荐使用上下文管理器</span></span><br><span class="line"><span class="keyword">with</span> requests.Session() <span class="keyword">as</span> session:</span><br><span class="line">    session.get(<span class="string">&#x27;https://api.example.com/login&#x27;</span>, data=&#123;...&#125;)</span><br><span class="line">    response = session.get(<span class="string">&#x27;https://api.example.com/profile&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="5-2-Session-配置"><a href="#5-2-Session-配置" class="headerlink" title="5.2 Session 配置"></a>5.2 Session 配置</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">session = requests.Session()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置默认请求头</span></span><br><span class="line">session.headers.update(&#123;</span><br><span class="line">    <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;MyApp/1.0&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Accept&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置默认超时</span></span><br><span class="line"><span class="comment"># 注意：requests 不直接支持 Session 级别的超时设置</span></span><br><span class="line"><span class="comment"># 需要在每次请求时指定</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加 Adapter（连接池配置）</span></span><br><span class="line"><span class="keyword">from</span> requests.adapters <span class="keyword">import</span> HTTPAdapter</span><br><span class="line"></span><br><span class="line">adapter = HTTPAdapter(</span><br><span class="line">    pool_connections=<span class="number">10</span>,      <span class="comment"># 连接池大小</span></span><br><span class="line">    pool_maxsize=<span class="number">20</span>,          <span class="comment"># 最大连接数</span></span><br><span class="line">    max_retries=<span class="number">3</span>,            <span class="comment"># 重试次数</span></span><br><span class="line">    pool_block=<span class="literal">False</span>          <span class="comment"># 是否阻塞</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">session.mount(<span class="string">&#x27;https://&#x27;</span>, adapter)</span><br><span class="line">session.mount(<span class="string">&#x27;http://&#x27;</span>, adapter)</span><br></pre></td></tr></table></figure>

<h3 id="5-3-性能优势"><a href="#5-3-性能优势" class="headerlink" title="5.3 性能优势"></a>5.3 性能优势</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="comment"># 不使用 Session（每次新建连接）</span></span><br><span class="line">start = time.time()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">    requests.get(<span class="string">&#x27;https://api.example.com/data&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Without Session: <span class="subst">&#123;time.time() - start:<span class="number">.2</span>f&#125;</span>s&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用 Session（复用连接）</span></span><br><span class="line">start = time.time()</span><br><span class="line">session = requests.Session()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">    session.get(<span class="string">&#x27;https://api.example.com/data&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;With Session: <span class="subst">&#123;time.time() - start:<span class="number">.2</span>f&#125;</span>s&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 提醒自己：</span></span><br><span class="line"><span class="comment"># - 多次请求同一域名一定要用 Session</span></span><br><span class="line"><span class="comment"># - 连接池可以显著提升性能</span></span><br></pre></td></tr></table></figure>

<h2 id="六、异常处理"><a href="#六、异常处理" class="headerlink" title="六、异常处理"></a>六、异常处理</h2><h3 id="6-1-常见异常"><a href="#6-1-常见异常" class="headerlink" title="6.1 常见异常"></a>6.1 常见异常</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> requests.exceptions <span class="keyword">import</span> (</span><br><span class="line">    RequestException,</span><br><span class="line">    Timeout,</span><br><span class="line">    ConnectionError,</span><br><span class="line">    HTTPError,</span><br><span class="line">    TooManyRedirects,</span><br><span class="line">    JSONDecodeError</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    response = requests.get(<span class="string">&#x27;https://api.example.com/data&#x27;</span>, timeout=<span class="number">5</span>)</span><br><span class="line">    response.raise_for_status()</span><br><span class="line">    data = response.json()</span><br><span class="line"><span class="keyword">except</span> Timeout:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;请求超时&quot;</span>)</span><br><span class="line"><span class="keyword">except</span> ConnectionError:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;连接错误&quot;</span>)</span><br><span class="line"><span class="keyword">except</span> HTTPError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;HTTP 错误：<span class="subst">&#123;e.response.status_code&#125;</span>&quot;</span>)</span><br><span class="line"><span class="keyword">except</span> JSONDecodeError:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;JSON 解析失败&quot;</span>)</span><br><span class="line"><span class="keyword">except</span> RequestException <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;请求异常：<span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="6-2-重试机制"><a href="#6-2-重试机制" class="headerlink" title="6.2 重试机制"></a>6.2 重试机制</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> requests.adapters <span class="keyword">import</span> HTTPAdapter</span><br><span class="line"><span class="keyword">from</span> urllib3.util.retry <span class="keyword">import</span> Retry</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">create_retry_session</span>():</span><br><span class="line">    session = requests.Session()</span><br><span class="line"></span><br><span class="line">    retry = Retry(</span><br><span class="line">        total=<span class="number">3</span>,                    <span class="comment"># 总重试次数</span></span><br><span class="line">        backoff_factor=<span class="number">0.5</span>,         <span class="comment"># 重试间隔倍数</span></span><br><span class="line">        status_forcelist=[<span class="number">500</span>, <span class="number">502</span>, <span class="number">503</span>, <span class="number">504</span>],  <span class="comment"># 需要重试的状态码</span></span><br><span class="line">        allowed_methods=[<span class="string">&quot;HEAD&quot;</span>, <span class="string">&quot;GET&quot;</span>, <span class="string">&quot;POST&quot;</span>, <span class="string">&quot;PUT&quot;</span>]  <span class="comment"># 可重试的方法</span></span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    adapter = HTTPAdapter(max_retries=retry)</span><br><span class="line">    session.mount(<span class="string">&#x27;https://&#x27;</span>, adapter)</span><br><span class="line">    session.mount(<span class="string">&#x27;http://&#x27;</span>, adapter)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> session</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用</span></span><br><span class="line">session = create_retry_session()</span><br><span class="line">response = session.get(<span class="string">&#x27;https://api.example.com/data&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="七、高级用法"><a href="#七、高级用法" class="headerlink" title="七、高级用法"></a>七、高级用法</h2><h3 id="7-1-文件上传"><a href="#7-1-文件上传" class="headerlink" title="7.1 文件上传"></a>7.1 文件上传</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 上传单个文件</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;file.txt&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    files = &#123;<span class="string">&#x27;file&#x27;</span>: f&#125;</span><br><span class="line">    response = requests.post(<span class="string">&#x27;https://api.example.com/upload&#x27;</span>, files=files)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定文件名</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;file.txt&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    files = &#123;<span class="string">&#x27;file&#x27;</span>: (<span class="string">&#x27;custom_name.txt&#x27;</span>, f)&#125;</span><br><span class="line">    response = requests.post(<span class="string">&#x27;https://api.example.com/upload&#x27;</span>, files=files)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定文件类型</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;image.jpg&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    files = &#123;<span class="string">&#x27;file&#x27;</span>: (<span class="string">&#x27;image.jpg&#x27;</span>, f, <span class="string">&#x27;image/jpeg&#x27;</span>)&#125;</span><br><span class="line">    response = requests.post(<span class="string">&#x27;https://api.example.com/upload&#x27;</span>, files=files)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 完整格式</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;file.txt&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    files = &#123;</span><br><span class="line">        <span class="string">&#x27;file&#x27;</span>: (<span class="string">&#x27;filename.txt&#x27;</span>, f, <span class="string">&#x27;text/plain&#x27;</span>, &#123;<span class="string">&#x27;Expires&#x27;</span>: <span class="string">&#x27;0&#x27;</span>&#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    response = requests.post(<span class="string">&#x27;https://api.example.com/upload&#x27;</span>, files=files)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 上传多个文件</span></span><br><span class="line">files = &#123;</span><br><span class="line">    <span class="string">&#x27;file1&#x27;</span>: <span class="built_in">open</span>(<span class="string">&#x27;file1.txt&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>),</span><br><span class="line">    <span class="string">&#x27;file2&#x27;</span>: <span class="built_in">open</span>(<span class="string">&#x27;file2.txt&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line">response = requests.post(<span class="string">&#x27;https://api.example.com/upload&#x27;</span>, files=files)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 带其他表单数据</span></span><br><span class="line">data = &#123;<span class="string">&#x27;description&#x27;</span>: <span class="string">&#x27;文件描述&#x27;</span>&#125;</span><br><span class="line">files = &#123;<span class="string">&#x27;file&#x27;</span>: <span class="built_in">open</span>(<span class="string">&#x27;file.txt&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>)&#125;</span><br><span class="line">response = requests.post(<span class="string">&#x27;https://api.example.com/upload&#x27;</span>, data=data, files=files)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 提醒自己：</span></span><br><span class="line"><span class="comment"># - 文件要用 &#x27;rb&#x27; 模式打开</span></span><br><span class="line"><span class="comment"># - 上传后记得关闭文件</span></span><br></pre></td></tr></table></figure>

<h3 id="7-2-发送-Cookie"><a href="#7-2-发送-Cookie" class="headerlink" title="7.2 发送 Cookie"></a>7.2 发送 Cookie</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 发送 Cookie</span></span><br><span class="line">cookies = &#123;<span class="string">&#x27;session&#x27;</span>: <span class="string">&#x27;abc123&#x27;</span>, <span class="string">&#x27;user&#x27;</span>: <span class="string">&#x27;zhangsan&#x27;</span>&#125;</span><br><span class="line">response = requests.get(<span class="string">&#x27;https://api.example.com/data&#x27;</span>, cookies=cookies)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用 CookieJar</span></span><br><span class="line"><span class="keyword">from</span> http.cookiejar <span class="keyword">import</span> CookieJar</span><br><span class="line"></span><br><span class="line">cj = CookieJar()</span><br><span class="line">session = requests.Session()</span><br><span class="line">session.cookies = cj</span><br><span class="line"></span><br><span class="line"><span class="comment"># 登录后 Cookie 自动保存</span></span><br><span class="line">session.post(<span class="string">&#x27;https://api.example.com/login&#x27;</span>, data=&#123;<span class="string">&#x27;user&#x27;</span>: <span class="string">&#x27;张三&#x27;</span>, <span class="string">&#x27;pwd&#x27;</span>: <span class="string">&#x27;123&#x27;</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 后续请求自动携带 Cookie</span></span><br><span class="line">response = session.get(<span class="string">&#x27;https://api.example.com/protected&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="7-3-代理设置"><a href="#7-3-代理设置" class="headerlink" title="7.3 代理设置"></a>7.3 代理设置</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 单个请求使用代理</span></span><br><span class="line">proxies = &#123;</span><br><span class="line">    <span class="string">&#x27;http&#x27;</span>: <span class="string">&#x27;http://proxy.example.com:8080&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;https&#x27;</span>: <span class="string">&#x27;https://proxy.example.com:8080&#x27;</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">response = requests.get(<span class="string">&#x27;https://api.example.com/data&#x27;</span>, proxies=proxies)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 带认证的代理</span></span><br><span class="line">proxies = &#123;</span><br><span class="line">    <span class="string">&#x27;https&#x27;</span>: <span class="string">&#x27;http://user:password@proxy.example.com:8080&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Session 级别设置代理</span></span><br><span class="line">session = requests.Session()</span><br><span class="line">session.proxies = &#123;</span><br><span class="line">    <span class="string">&#x27;https&#x27;</span>: <span class="string">&#x27;https://proxy.example.com:8080&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="7-4-请求准备与发送"><a href="#7-4-请求准备与发送" class="headerlink" title="7.4 请求准备与发送"></a>7.4 请求准备与发送</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 手动准备请求</span></span><br><span class="line">req = requests.Request(<span class="string">&#x27;POST&#x27;</span>, <span class="string">&#x27;https://api.example.com/data&#x27;</span>, json=&#123;<span class="string">&#x27;key&#x27;</span>: <span class="string">&#x27;value&#x27;</span>&#125;)</span><br><span class="line">prepared = req.prepare()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看请求详情</span></span><br><span class="line"><span class="built_in">print</span>(prepared.url)</span><br><span class="line"><span class="built_in">print</span>(prepared.headers)</span><br><span class="line"><span class="built_in">print</span>(prepared.body)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用 Session 发送</span></span><br><span class="line">session = requests.Session()</span><br><span class="line">response = session.send(prepared)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 提醒自己：</span></span><br><span class="line"><span class="comment"># - 适合需要完全控制请求的场景</span></span><br><span class="line"><span class="comment"># - 可以用于请求签名等高级操作</span></span><br></pre></td></tr></table></figure>

<h2 id="八、实战示例"><a href="#八、实战示例" class="headerlink" title="八、实战示例"></a>八、实战示例</h2><h3 id="8-1-调用-REST-API"><a href="#8-1-调用-REST-API" class="headerlink" title="8.1 调用 REST API"></a>8.1 调用 REST API</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">APIClient</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;简单的 API 客户端&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, base_url, api_key=<span class="literal">None</span></span>):</span><br><span class="line">        <span class="variable language_">self</span>.base_url = base_url</span><br><span class="line">        <span class="variable language_">self</span>.session = requests.Session()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> api_key:</span><br><span class="line">            <span class="variable language_">self</span>.session.headers.update(&#123;</span><br><span class="line">                <span class="string">&#x27;Authorization&#x27;</span>: <span class="string">f&#x27;Bearer <span class="subst">&#123;api_key&#125;</span>&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;Accept&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span></span><br><span class="line">            &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">self, endpoint, **kwargs</span>):</span><br><span class="line">        url = <span class="string">f&quot;<span class="subst">&#123;self.base_url&#125;</span>/<span class="subst">&#123;endpoint&#125;</span>&quot;</span></span><br><span class="line">        response = <span class="variable language_">self</span>.session.get(url, **kwargs)</span><br><span class="line">        response.raise_for_status()</span><br><span class="line">        <span class="keyword">return</span> response.json()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">post</span>(<span class="params">self, endpoint, data=<span class="literal">None</span>, **kwargs</span>):</span><br><span class="line">        url = <span class="string">f&quot;<span class="subst">&#123;self.base_url&#125;</span>/<span class="subst">&#123;endpoint&#125;</span>&quot;</span></span><br><span class="line">        response = <span class="variable language_">self</span>.session.post(url, json=data, **kwargs)</span><br><span class="line">        response.raise_for_status()</span><br><span class="line">        <span class="keyword">return</span> response.json()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">put</span>(<span class="params">self, endpoint, data=<span class="literal">None</span>, **kwargs</span>):</span><br><span class="line">        url = <span class="string">f&quot;<span class="subst">&#123;self.base_url&#125;</span>/<span class="subst">&#123;endpoint&#125;</span>&quot;</span></span><br><span class="line">        response = <span class="variable language_">self</span>.session.put(url, json=data, **kwargs)</span><br><span class="line">        response.raise_for_status()</span><br><span class="line">        <span class="keyword">return</span> response.json()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">delete</span>(<span class="params">self, endpoint, **kwargs</span>):</span><br><span class="line">        url = <span class="string">f&quot;<span class="subst">&#123;self.base_url&#125;</span>/<span class="subst">&#123;endpoint&#125;</span>&quot;</span></span><br><span class="line">        response = <span class="variable language_">self</span>.session.delete(url, **kwargs)</span><br><span class="line">        response.raise_for_status()</span><br><span class="line">        <span class="keyword">return</span> response.status_code == <span class="number">204</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用示例</span></span><br><span class="line">client = APIClient(<span class="string">&#x27;https://api.example.com&#x27;</span>, api_key=<span class="string">&#x27;YOUR_KEY&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取列表</span></span><br><span class="line">users = client.get(<span class="string">&#x27;users&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取单个</span></span><br><span class="line">user = client.get(<span class="string">&#x27;users/1&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建</span></span><br><span class="line">new_user = client.post(<span class="string">&#x27;users&#x27;</span>, &#123;<span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;张三&#x27;</span>, <span class="string">&#x27;email&#x27;</span>: <span class="string">&#x27;zhangsan@example.com&#x27;</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 更新</span></span><br><span class="line">client.put(<span class="string">&#x27;users/1&#x27;</span>, &#123;<span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;李四&#x27;</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除</span></span><br><span class="line">client.delete(<span class="string">&#x27;users/1&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="8-2-分页数据获取"><a href="#8-2-分页数据获取" class="headerlink" title="8.2 分页数据获取"></a>8.2 分页数据获取</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">get_all_pages</span>(<span class="params">base_url</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;获取所有分页数据&quot;&quot;&quot;</span></span><br><span class="line">    all_data = []</span><br><span class="line">    page = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        response = requests.get(base_url, params=&#123;<span class="string">&#x27;page&#x27;</span>: page&#125;)</span><br><span class="line">        response.raise_for_status()</span><br><span class="line">        data = response.json()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> data:  <span class="comment"># 没有更多数据</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        all_data.extend(data)</span><br><span class="line">        page += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> all_data</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用</span></span><br><span class="line">all_users = get_all_pages(<span class="string">&#x27;https://api.example.com/users&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="8-3-并发请求（配合-concurrent-futures）"><a href="#8-3-并发请求（配合-concurrent-futures）" class="headerlink" title="8.3 并发请求（配合 concurrent.futures）"></a>8.3 并发请求（配合 concurrent.futures）</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> concurrent.futures <span class="keyword">import</span> ThreadPoolExecutor, as_completed</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">fetch_url</span>(<span class="params">url</span>):</span><br><span class="line">    response = requests.get(url, timeout=<span class="number">5</span>)</span><br><span class="line">    <span class="keyword">return</span> url, response.status_code</span><br><span class="line"></span><br><span class="line">urls = [</span><br><span class="line">    <span class="string">&#x27;https://api.example.com/data1&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;https://api.example.com/data2&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;https://api.example.com/data3&#x27;</span>,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">results = &#123;&#125;</span><br><span class="line"><span class="keyword">with</span> ThreadPoolExecutor(max_workers=<span class="number">5</span>) <span class="keyword">as</span> executor:</span><br><span class="line">    futures = &#123;executor.submit(fetch_url, url): url <span class="keyword">for</span> url <span class="keyword">in</span> urls&#125;</span><br><span class="line">    <span class="keyword">for</span> future <span class="keyword">in</span> as_completed(futures):</span><br><span class="line">        url, status = future.result()</span><br><span class="line">        results[url] = status</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(results)</span><br></pre></td></tr></table></figure>

<h2 id="九、最佳实践"><a href="#九、最佳实践" class="headerlink" title="九、最佳实践"></a>九、最佳实践</h2><blockquote>
<p><strong>提醒自己</strong>：</p>
<ol>
<li><strong>始终设置超时</strong>：防止程序卡死</li>
<li><strong>使用 Session</strong>：复用连接，提高效率</li>
<li><strong>处理异常</strong>：网络请求随时可能失败</li>
<li><strong>检查状态码</strong>：不要假设请求总是成功</li>
<li><strong>限制重试</strong>：避免无限重试</li>
<li><strong>使用上下文管理器</strong>：确保资源正确释放</li>
<li><strong>记录日志</strong>：方便调试和问题追踪</li>
</ol>
</blockquote>
<h2 id="十、练习"><a href="#十、练习" class="headerlink" title="十、练习"></a>十、练习</h2><ol>
<li>编写一个函数，获取 GitHub 用户的公开信息</li>
<li>实现一个带重试机制的下载器</li>
<li>使用 Session 实现需要登录的 API 调用</li>
<li>编写一个批量检测网站可用性的脚本</li>
<li>实现一个简单的 API 客户端类，封装常用的 CRUD 操作</li>
</ol>
<hr>
<p><strong>上一篇</strong>：[Python 数据科学（三）：PyArrow 高性能数据操作](&#x2F;2026&#x2F;02&#x2F;24&#x2F;Python-数据科学（三）PyArrow 高性能数据操作&#x2F;)</p>
<p><strong>下一篇</strong>：<a href="/2026/02/24/Python-%E5%B8%B8%E7%94%A8%E5%BA%93%EF%BC%88%E4%BA%8C%EF%BC%89json-yaml-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/">Python 常用库（二）：json&#x2F;yaml配置文件处理</a></p>
<p><strong>参考资源</strong>：</p>
<ul>
<li><a href="https://requests.readthedocs.io/">requests 官方文档</a></li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status">HTTP 状态码文档</a></li>
<li><a href="https://docs.python-requests.org/en/master/user/advanced/">Real World Requests</a></li>
</ul>
]]></content>
      <categories>
        <category>Python 教程</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>requests</tag>
        <tag>API</tag>
        <tag>HTTP</tag>
      </tags>
  </entry>
  <entry>
    <title>Python 常用库（三）logging 日志模块</title>
    <url>/2026/02/24/Python%20%E5%B8%B8%E7%94%A8%E5%BA%93%EF%BC%88%E4%B8%89%EF%BC%89logging%20%E6%97%A5%E5%BF%97%E6%A8%A1%E5%9D%97/</url>
    <content><![CDATA[<h1 id="Python-常用库（三）logging-日志模块"><a href="#Python-常用库（三）logging-日志模块" class="headerlink" title="Python 常用库（三）logging 日志模块"></a>Python 常用库（三）logging 日志模块</h1><p>日志是程序调试、监控和问题排查的重要工具。本篇将详细介绍 Python 内置的 logging 模块。</p>
<h2 id="一、logging-简介"><a href="#一、logging-简介" class="headerlink" title="一、logging 简介"></a>一、logging 简介</h2><h3 id="1-1-为什么使用-logging？"><a href="#1-1-为什么使用-logging？" class="headerlink" title="1.1 为什么使用 logging？"></a>1.1 为什么使用 logging？</h3><ul>
<li><strong>标准库</strong>：无需安装，开箱即用</li>
<li><strong>灵活配置</strong>：可配置输出格式、级别、目标等</li>
<li><strong>高性能</strong>：内置优化，适合生产环境</li>
<li><strong>可扩展</strong>：支持自定义 Handler、Formatter、Filter</li>
</ul>
<h3 id="1-2-日志级别"><a href="#1-2-日志级别" class="headerlink" title="1.2 日志级别"></a>1.2 日志级别</h3><table>
<thead>
<tr>
<th>级别</th>
<th>数值</th>
<th>说明</th>
<th>使用场景</th>
</tr>
</thead>
<tbody><tr>
<td>DEBUG</td>
<td>10</td>
<td>调试信息</td>
<td>开发调试时的详细信息</td>
</tr>
<tr>
<td>INFO</td>
<td>20</td>
<td>一般信息</td>
<td>程序正常运行的信息</td>
</tr>
<tr>
<td>WARNING</td>
<td>30</td>
<td>警告信息</td>
<td>不影响运行但需要注意</td>
</tr>
<tr>
<td>ERROR</td>
<td>40</td>
<td>错误信息</td>
<td>程序错误但不影响继续运行</td>
</tr>
<tr>
<td>CRITICAL</td>
<td>50</td>
<td>严重错误</td>
<td>严重错误，程序可能无法继续</td>
</tr>
</tbody></table>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"></span><br><span class="line">logging.debug(<span class="string">&quot;调试信息&quot;</span>)</span><br><span class="line">logging.info(<span class="string">&quot;一般信息&quot;</span>)</span><br><span class="line">logging.warning(<span class="string">&quot;警告信息&quot;</span>)</span><br><span class="line">logging.error(<span class="string">&quot;错误信息&quot;</span>)</span><br><span class="line">logging.critical(<span class="string">&quot;严重错误&quot;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="二、基础使用"><a href="#二、基础使用" class="headerlink" title="二、基础使用"></a>二、基础使用</h2><h3 id="2-1-快速开始"><a href="#2-1-快速开始" class="headerlink" title="2.1 快速开始"></a>2.1 快速开始</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"></span><br><span class="line"><span class="comment"># 基础配置</span></span><br><span class="line">logging.basicConfig(</span><br><span class="line">    level=logging.INFO,</span><br><span class="line">    <span class="built_in">format</span>=<span class="string">&#x27;%(asctime)s - %(name)s - %(levelname)s - %(message)s&#x27;</span>,</span><br><span class="line">    datefmt=<span class="string">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 记录日志</span></span><br><span class="line">logging.info(<span class="string">&quot;程序启动&quot;</span>)</span><br><span class="line">logging.warning(<span class="string">&quot;这是一个警告&quot;</span>)</span><br><span class="line">logging.error(<span class="string">&quot;发生了一个错误&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出：</span></span><br><span class="line"><span class="comment"># 2026-02-24 10:00:00 - root - INFO - 程序启动</span></span><br><span class="line"><span class="comment"># 2026-02-24 10:00:00 - root - WARNING - 这是一个警告</span></span><br><span class="line"><span class="comment"># 2026-02-24 10:00:00 - root - ERROR - 发生了一个错误</span></span><br></pre></td></tr></table></figure>

<h3 id="2-2-日志输出目标"><a href="#2-2-日志输出目标" class="headerlink" title="2.2 日志输出目标"></a>2.2 日志输出目标</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出到控制台（默认）</span></span><br><span class="line">logging.info(<span class="string">&quot;输出到控制台&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出到文件</span></span><br><span class="line">logging.basicConfig(</span><br><span class="line">    filename=<span class="string">&#x27;app.log&#x27;</span>,</span><br><span class="line">    level=logging.INFO,</span><br><span class="line">    filemode=<span class="string">&#x27;a&#x27;</span>,  <span class="comment"># &#x27;a&#x27; 追加，&#x27;w&#x27; 覆盖</span></span><br><span class="line">    encoding=<span class="string">&#x27;utf-8&#x27;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">logging.info(<span class="string">&quot;输出到文件&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 提醒自己：</span></span><br><span class="line"><span class="comment"># - basicConfig 只能在第一次调用时生效</span></span><br><span class="line"><span class="comment"># - 多次调用需要更复杂的配置</span></span><br></pre></td></tr></table></figure>

<h2 id="三、核心组件"><a href="#三、核心组件" class="headerlink" title="三、核心组件"></a>三、核心组件</h2><h3 id="3-1-Logger（记录器）"><a href="#3-1-Logger（记录器）" class="headerlink" title="3.1 Logger（记录器）"></a>3.1 Logger（记录器）</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取 Logger</span></span><br><span class="line">logger = logging.getLogger(__name__)  <span class="comment"># 推荐使用模块名</span></span><br><span class="line">logger = logging.getLogger(<span class="string">&#x27;myapp&#x27;</span>)   <span class="comment"># 或使用自定义名</span></span><br><span class="line">logger = logging.getLogger()          <span class="comment"># root logger</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置日志级别</span></span><br><span class="line">logger.setLevel(logging.DEBUG)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 记录日志</span></span><br><span class="line">logger.debug(<span class="string">&quot;调试信息&quot;</span>)</span><br><span class="line">logger.info(<span class="string">&quot;一般信息&quot;</span>)</span><br><span class="line">logger.warning(<span class="string">&quot;警告信息&quot;</span>)</span><br><span class="line">logger.error(<span class="string">&quot;错误信息&quot;</span>)</span><br><span class="line">logger.critical(<span class="string">&quot;严重错误&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 带异常的日志</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    result = <span class="number">10</span> / <span class="number">0</span></span><br><span class="line"><span class="keyword">except</span> ZeroDivisionError:</span><br><span class="line">    logger.exception(<span class="string">&quot;除零错误&quot;</span>)  <span class="comment"># 自动记录堆栈</span></span><br></pre></td></tr></table></figure>

<h3 id="3-2-Handler（处理器）"><a href="#3-2-Handler（处理器）" class="headerlink" title="3.2 Handler（处理器）"></a>3.2 Handler（处理器）</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"></span><br><span class="line">logger = logging.getLogger(<span class="string">&#x27;myapp&#x27;</span>)</span><br><span class="line">logger.setLevel(logging.DEBUG)  <span class="comment"># Logger 级别设低</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 控制台 Handler（只输出 INFO 及以上）</span></span><br><span class="line">console_handler = logging.StreamHandler()</span><br><span class="line">console_handler.setLevel(logging.INFO)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 文件 Handler（输出所有级别）</span></span><br><span class="line">file_handler = logging.FileHandler(<span class="string">&#x27;app.log&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">file_handler.setLevel(logging.DEBUG)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加到 Logger</span></span><br><span class="line">logger.addHandler(console_handler)</span><br><span class="line">logger.addHandler(file_handler)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 移除 Handler</span></span><br><span class="line">logger.removeHandler(file_handler)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 提醒自己：</span></span><br><span class="line"><span class="comment"># - Logger 级别决定哪些日志被处理</span></span><br><span class="line"><span class="comment"># - Handler 级别决定哪些日志被输出</span></span><br><span class="line"><span class="comment"># - 日志需要同时通过 Logger 和 Handler 的级别检查</span></span><br></pre></td></tr></table></figure>

<h3 id="3-3-Formatter（格式化器）"><a href="#3-3-Formatter（格式化器）" class="headerlink" title="3.3 Formatter（格式化器）"></a>3.3 Formatter（格式化器）</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"></span><br><span class="line">logger = logging.getLogger(<span class="string">&#x27;myapp&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建 Formatter</span></span><br><span class="line">formatter = logging.Formatter(</span><br><span class="line">    fmt=<span class="string">&#x27;%(asctime)s - %(name)s - %(levelname)s - %(message)s&#x27;</span>,</span><br><span class="line">    datefmt=<span class="string">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 常用格式参数：</span></span><br><span class="line"><span class="comment"># %(name)s       Logger 名称</span></span><br><span class="line"><span class="comment"># %(levelname)s  日志级别</span></span><br><span class="line"><span class="comment"># %(message)s    日志消息</span></span><br><span class="line"><span class="comment"># %(asctime)s    时间戳</span></span><br><span class="line"><span class="comment"># %(filename)s   文件名</span></span><br><span class="line"><span class="comment"># %(lineno)d     行号</span></span><br><span class="line"><span class="comment"># %(funcName)s   函数名</span></span><br><span class="line"><span class="comment"># %(threadName)s 线程名</span></span><br><span class="line"><span class="comment"># %(process)d    进程 ID</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 更详细的格式</span></span><br><span class="line">detailed_formatter = logging.Formatter(</span><br><span class="line">    fmt=<span class="string">&#x27;%(asctime)s - %(name)s - %(levelname)s [%(filename)s:%(lineno)d - %(funcName)s()] - %(message)s&#x27;</span>,</span><br><span class="line">    datefmt=<span class="string">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 应用到 Handler</span></span><br><span class="line">console_handler = logging.StreamHandler()</span><br><span class="line">console_handler.setFormatter(formatter)</span><br><span class="line"></span><br><span class="line">file_handler = logging.FileHandler(<span class="string">&#x27;app.log&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">file_handler.setFormatter(detailed_formatter)</span><br><span class="line"></span><br><span class="line">logger.addHandler(console_handler)</span><br><span class="line">logger.addHandler(file_handler)</span><br></pre></td></tr></table></figure>

<h3 id="3-4-Filter（过滤器）"><a href="#3-4-Filter（过滤器）" class="headerlink" title="3.4 Filter（过滤器）"></a>3.4 Filter（过滤器）</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LevelFilter</span>(logging.Filter):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;只记录特定级别&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, level</span>):</span><br><span class="line">        <span class="variable language_">self</span>.level = level</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">filter</span>(<span class="params">self, record</span>):</span><br><span class="line">        <span class="keyword">return</span> record.levelno == <span class="variable language_">self</span>.level</span><br><span class="line"></span><br><span class="line"><span class="comment"># 只记录 ERROR 级别</span></span><br><span class="line">error_filter = LevelFilter(logging.ERROR)</span><br><span class="line"></span><br><span class="line">handler = logging.StreamHandler()</span><br><span class="line">handler.addFilter(error_filter)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 自定义过滤器</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyFilter</span>(logging.Filter):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">filter</span>(<span class="params">self, record</span>):</span><br><span class="line">        <span class="comment"># 只记录包含特定关键字的日志</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;important&#x27;</span> <span class="keyword">in</span> record.getMessage()</span><br><span class="line"></span><br><span class="line">logger = logging.getLogger(<span class="string">&#x27;myapp&#x27;</span>)</span><br><span class="line">logger.addFilter(MyFilter())</span><br></pre></td></tr></table></figure>

<h2 id="四、完整配置示例"><a href="#四、完整配置示例" class="headerlink" title="四、完整配置示例"></a>四、完整配置示例</h2><h3 id="4-1-控制台-文件输出"><a href="#4-1-控制台-文件输出" class="headerlink" title="4.1 控制台 + 文件输出"></a>4.1 控制台 + 文件输出</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="keyword">import</span> logging.handlers</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">setup_logger</span>(<span class="params">name, log_file, level=logging.INFO</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;设置日志&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 格式化器</span></span><br><span class="line">    formatter = logging.Formatter(</span><br><span class="line">        <span class="string">&#x27;%(asctime)s - %(name)s - %(levelname)s - %(message)s&#x27;</span>,</span><br><span class="line">        datefmt=<span class="string">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span></span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 控制台 Handler</span></span><br><span class="line">    console_handler = logging.StreamHandler()</span><br><span class="line">    console_handler.setLevel(logging.INFO)</span><br><span class="line">    console_handler.setFormatter(formatter)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 文件 Handler</span></span><br><span class="line">    file_handler = logging.FileHandler(log_file, encoding=<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    file_handler.setLevel(level)</span><br><span class="line">    file_handler.setFormatter(formatter)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Logger</span></span><br><span class="line">    logger = logging.getLogger(name)</span><br><span class="line">    logger.setLevel(level)</span><br><span class="line">    logger.addHandler(console_handler)</span><br><span class="line">    logger.addHandler(file_handler)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> logger</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用</span></span><br><span class="line">logger = setup_logger(<span class="string">&#x27;myapp&#x27;</span>, <span class="string">&#x27;app.log&#x27;</span>, logging.DEBUG)</span><br><span class="line">logger.info(<span class="string">&quot;程序启动&quot;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="4-2-日志轮转（RotatingFileHandler）"><a href="#4-2-日志轮转（RotatingFileHandler）" class="headerlink" title="4.2 日志轮转（RotatingFileHandler）"></a>4.2 日志轮转（RotatingFileHandler）</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="keyword">import</span> logging.handlers</span><br><span class="line"></span><br><span class="line">logger = logging.getLogger(<span class="string">&#x27;myapp&#x27;</span>)</span><br><span class="line">logger.setLevel(logging.DEBUG)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 按文件大小轮转</span></span><br><span class="line">handler = logging.handlers.RotatingFileHandler(</span><br><span class="line">    <span class="string">&#x27;app.log&#x27;</span>,</span><br><span class="line">    maxBytes=<span class="number">10</span>*<span class="number">1024</span>*<span class="number">1024</span>,  <span class="comment"># 10MB</span></span><br><span class="line">    backupCount=<span class="number">5</span>,          <span class="comment"># 保留 5 个备份</span></span><br><span class="line">    encoding=<span class="string">&#x27;utf-8&#x27;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 按时间轮转</span></span><br><span class="line">handler = logging.handlers.TimedRotatingFileHandler(</span><br><span class="line">    <span class="string">&#x27;app.log&#x27;</span>,</span><br><span class="line">    when=<span class="string">&#x27;D&#x27;</span>,              <span class="comment"># D=天，W=周，M=月，H=小时，S=秒</span></span><br><span class="line">    interval=<span class="number">1</span>,            <span class="comment"># 每 1 个单位轮转</span></span><br><span class="line">    backupCount=<span class="number">7</span>,         <span class="comment"># 保留 7 个备份</span></span><br><span class="line">    encoding=<span class="string">&#x27;utf-8&#x27;</span>,</span><br><span class="line">    atMidnight=<span class="literal">True</span>        <span class="comment"># 在午夜轮转</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">formatter = logging.Formatter(</span><br><span class="line">    <span class="string">&#x27;%(asctime)s - %(name)s - %(levelname)s - %(message)s&#x27;</span></span><br><span class="line">)</span><br><span class="line">handler.setFormatter(formatter)</span><br><span class="line"></span><br><span class="line">logger.addHandler(handler)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 提醒自己：</span></span><br><span class="line"><span class="comment"># - 生产环境一定要用日志轮转</span></span><br><span class="line"><span class="comment"># - 避免日志文件无限增长</span></span><br></pre></td></tr></table></figure>

<h3 id="4-3-多-Logger-配置"><a href="#4-3-多-Logger-配置" class="headerlink" title="4.3 多 Logger 配置"></a>4.3 多 Logger 配置</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"></span><br><span class="line"><span class="comment"># 主应用 Logger</span></span><br><span class="line">app_logger = logging.getLogger(<span class="string">&#x27;app&#x27;</span>)</span><br><span class="line">app_logger.setLevel(logging.INFO)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 数据库 Logger</span></span><br><span class="line">db_logger = logging.getLogger(<span class="string">&#x27;app.database&#x27;</span>)</span><br><span class="line">db_logger.setLevel(logging.DEBUG)</span><br><span class="line"></span><br><span class="line"><span class="comment"># API Logger</span></span><br><span class="line">api_logger = logging.getLogger(<span class="string">&#x27;app.api&#x27;</span>)</span><br><span class="line">api_logger.setLevel(logging.WARNING)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 不同 Logger 使用不同 Handler</span></span><br><span class="line">app_handler = logging.FileHandler(<span class="string">&#x27;app.log&#x27;</span>)</span><br><span class="line">db_handler = logging.FileHandler(<span class="string">&#x27;database.log&#x27;</span>)</span><br><span class="line">api_handler = logging.FileHandler(<span class="string">&#x27;api.log&#x27;</span>)</span><br><span class="line"></span><br><span class="line">formatter = logging.Formatter(<span class="string">&#x27;%(asctime)s - %(name)s - %(levelname)s - %(message)s&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> handler <span class="keyword">in</span> [app_handler, db_handler, api_handler]:</span><br><span class="line">    handler.setFormatter(formatter)</span><br><span class="line"></span><br><span class="line">app_logger.addHandler(app_handler)</span><br><span class="line">db_logger.addHandler(db_handler)</span><br><span class="line">api_logger.addHandler(api_handler)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用</span></span><br><span class="line">app_logger.info(<span class="string">&quot;应用信息&quot;</span>)</span><br><span class="line">db_logger.debug(<span class="string">&quot;数据库查询：SELECT * FROM users&quot;</span>)</span><br><span class="line">api_logger.warning(<span class="string">&quot;API 调用失败&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 日志传播（子 Logger 的日志会传递给父 Logger）</span></span><br><span class="line">db_logger.propagate = <span class="literal">False</span>  <span class="comment"># 禁止传播</span></span><br></pre></td></tr></table></figure>

<h2 id="五、字典配置"><a href="#五、字典配置" class="headerlink" title="五、字典配置"></a>五、字典配置</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="keyword">import</span> logging.config</span><br><span class="line"></span><br><span class="line">LOGGING_CONFIG = &#123;</span><br><span class="line">    <span class="string">&#x27;version&#x27;</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="string">&#x27;disable_existing_loggers&#x27;</span>: <span class="literal">False</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 格式化器</span></span><br><span class="line">    <span class="string">&#x27;formatters&#x27;</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;default&#x27;</span>: &#123;</span><br><span class="line">            <span class="string">&#x27;format&#x27;</span>: <span class="string">&#x27;%(asctime)s - %(name)s - %(levelname)s - %(message)s&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;datefmt&#x27;</span>: <span class="string">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&#x27;detailed&#x27;</span>: &#123;</span><br><span class="line">            <span class="string">&#x27;format&#x27;</span>: <span class="string">&#x27;%(asctime)s - %(name)s - %(levelname)s [%(filename)s:%(lineno)d] - %(message)s&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;datefmt&#x27;</span>: <span class="string">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Handler</span></span><br><span class="line">    <span class="string">&#x27;handlers&#x27;</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;console&#x27;</span>: &#123;</span><br><span class="line">            <span class="string">&#x27;class&#x27;</span>: <span class="string">&#x27;logging.StreamHandler&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;level&#x27;</span>: <span class="string">&#x27;INFO&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;formatter&#x27;</span>: <span class="string">&#x27;default&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;stream&#x27;</span>: <span class="string">&#x27;ext://sys.stdout&#x27;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&#x27;file&#x27;</span>: &#123;</span><br><span class="line">            <span class="string">&#x27;class&#x27;</span>: <span class="string">&#x27;logging.FileHandler&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;level&#x27;</span>: <span class="string">&#x27;DEBUG&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;formatter&#x27;</span>: <span class="string">&#x27;detailed&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;filename&#x27;</span>: <span class="string">&#x27;app.log&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;encoding&#x27;</span>: <span class="string">&#x27;utf-8&#x27;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&#x27;rotating&#x27;</span>: &#123;</span><br><span class="line">            <span class="string">&#x27;class&#x27;</span>: <span class="string">&#x27;logging.handlers.RotatingFileHandler&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;level&#x27;</span>: <span class="string">&#x27;DEBUG&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;formatter&#x27;</span>: <span class="string">&#x27;detailed&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;filename&#x27;</span>: <span class="string">&#x27;app_rotating.log&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;encoding&#x27;</span>: <span class="string">&#x27;utf-8&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;maxBytes&#x27;</span>: <span class="number">10485760</span>,  <span class="comment"># 10MB</span></span><br><span class="line">            <span class="string">&#x27;backupCount&#x27;</span>: <span class="number">5</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Logger</span></span><br><span class="line">    <span class="string">&#x27;loggers&#x27;</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;app&#x27;</span>: &#123;</span><br><span class="line">            <span class="string">&#x27;level&#x27;</span>: <span class="string">&#x27;DEBUG&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;handlers&#x27;</span>: [<span class="string">&#x27;console&#x27;</span>, <span class="string">&#x27;file&#x27;</span>],</span><br><span class="line">            <span class="string">&#x27;propagate&#x27;</span>: <span class="literal">False</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&#x27;app.database&#x27;</span>: &#123;</span><br><span class="line">            <span class="string">&#x27;level&#x27;</span>: <span class="string">&#x27;DEBUG&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;handlers&#x27;</span>: [<span class="string">&#x27;console&#x27;</span>, <span class="string">&#x27;rotating&#x27;</span>],</span><br><span class="line">            <span class="string">&#x27;propagate&#x27;</span>: <span class="literal">False</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Root Logger</span></span><br><span class="line">    <span class="string">&#x27;root&#x27;</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;level&#x27;</span>: <span class="string">&#x27;INFO&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;handlers&#x27;</span>: [<span class="string">&#x27;console&#x27;</span>, <span class="string">&#x27;file&#x27;</span>]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 应用配置</span></span><br><span class="line">logging.config.dictConfig(LOGGING_CONFIG)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用</span></span><br><span class="line">logger = logging.getLogger(<span class="string">&#x27;app&#x27;</span>)</span><br><span class="line">logger.info(<span class="string">&quot;程序启动&quot;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="从-YAML-文件加载配置"><a href="#从-YAML-文件加载配置" class="headerlink" title="从 YAML 文件加载配置"></a>从 YAML 文件加载配置</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="keyword">import</span> logging.config</span><br><span class="line"><span class="keyword">import</span> yaml</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;logging_config.yaml&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    config = yaml.safe_load(f)</span><br><span class="line">    logging.config.dictConfig(config)</span><br></pre></td></tr></table></figure>

<h2 id="六、实用技巧"><a href="#六、实用技巧" class="headerlink" title="六、实用技巧"></a>六、实用技巧</h2><h3 id="6-1-日志性能优化"><a href="#6-1-日志性能优化" class="headerlink" title="6.1 日志性能优化"></a>6.1 日志性能优化</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"></span><br><span class="line">logger = logging.getLogger(__name__)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 方式一：使用 lazy evaluation（推荐）</span></span><br><span class="line"><span class="keyword">if</span> logger.isEnabledFor(logging.DEBUG):</span><br><span class="line">    logger.debug(<span class="string">&quot;详细信息：%s&quot;</span>, expensive_operation())</span><br><span class="line"></span><br><span class="line"><span class="comment"># 方式二：使用 % 格式化（延迟求值）</span></span><br><span class="line">logger.debug(<span class="string">&quot;详细信息：%s&quot;</span>, expensive_operation())  <span class="comment"># 只有需要时才执行</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 不要这样做（总是会执行）</span></span><br><span class="line">logger.debug(<span class="string">f&quot;详细信息：<span class="subst">&#123;expensive_operation()&#125;</span>&quot;</span>)  <span class="comment"># 即使不输出也会执行</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 提醒自己：</span></span><br><span class="line"><span class="comment"># - 使用 % 格式化而不是 f-string</span></span><br><span class="line"><span class="comment"># - 避免在日志中执行昂贵操作</span></span><br></pre></td></tr></table></figure>

<h3 id="6-2-记录异常"><a href="#6-2-记录异常" class="headerlink" title="6.2 记录异常"></a>6.2 记录异常</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="keyword">import</span> traceback</span><br><span class="line"></span><br><span class="line">logger = logging.getLogger(__name__)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 方式一：exception() 自动记录堆栈</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    result = <span class="number">10</span> / <span class="number">0</span></span><br><span class="line"><span class="keyword">except</span> ZeroDivisionError:</span><br><span class="line">    logger.exception(<span class="string">&quot;除零错误&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 方式二：手动记录堆栈</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    result = <span class="number">10</span> / <span class="number">0</span></span><br><span class="line"><span class="keyword">except</span> ZeroDivisionError:</span><br><span class="line">    logger.error(<span class="string">&quot;除零错误&quot;</span>, exc_info=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 方式三：在任何地方记录堆栈</span></span><br><span class="line">logger.error(<span class="string">&quot;错误信息&quot;</span>, exc_info=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 方式四：记录完整堆栈</span></span><br><span class="line">logger.error(<span class="string">&quot;错误信息&quot;</span>, exc_info=<span class="literal">True</span>, stack_info=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 提醒自己：</span></span><br><span class="line"><span class="comment"># - exception() 只在 except 块中使用</span></span><br><span class="line"><span class="comment"># - exc_info=True 可以在任何地方记录堆栈</span></span><br></pre></td></tr></table></figure>

<h3 id="6-3-上下文日志"><a href="#6-3-上下文日志" class="headerlink" title="6.3 上下文日志"></a>6.3 上下文日志</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="keyword">from</span> contextlib <span class="keyword">import</span> contextmanager</span><br><span class="line"></span><br><span class="line"><span class="meta">@contextmanager</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">log_context</span>(<span class="params">logger, message</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;带上下文的日志&quot;&quot;&quot;</span></span><br><span class="line">    logger.info(<span class="string">f&quot;开始：<span class="subst">&#123;message&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">yield</span></span><br><span class="line">        logger.info(<span class="string">f&quot;完成：<span class="subst">&#123;message&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        logger.error(<span class="string">f&quot;失败：<span class="subst">&#123;message&#125;</span> - <span class="subst">&#123;e&#125;</span>&quot;</span>, exc_info=<span class="literal">True</span>)</span><br><span class="line">        <span class="keyword">raise</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用</span></span><br><span class="line">logger = logging.getLogger(__name__)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> log_context(logger, <span class="string">&quot;处理数据&quot;</span>):</span><br><span class="line">    process_data()</span><br></pre></td></tr></table></figure>

<h3 id="6-4-彩色日志（控制台）"><a href="#6-4-彩色日志（控制台）" class="headerlink" title="6.4 彩色日志（控制台）"></a>6.4 彩色日志（控制台）</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"></span><br><span class="line"><span class="comment"># ANSI 颜色代码</span></span><br><span class="line">COLORS = &#123;</span><br><span class="line">    <span class="string">&#x27;DEBUG&#x27;</span>: <span class="string">&#x27;\033[36m&#x27;</span>,     <span class="comment"># 青色</span></span><br><span class="line">    <span class="string">&#x27;INFO&#x27;</span>: <span class="string">&#x27;\033[32m&#x27;</span>,      <span class="comment"># 绿色</span></span><br><span class="line">    <span class="string">&#x27;WARNING&#x27;</span>: <span class="string">&#x27;\033[33m&#x27;</span>,   <span class="comment"># 黄色</span></span><br><span class="line">    <span class="string">&#x27;ERROR&#x27;</span>: <span class="string">&#x27;\033[31m&#x27;</span>,     <span class="comment"># 红色</span></span><br><span class="line">    <span class="string">&#x27;CRITICAL&#x27;</span>: <span class="string">&#x27;\033[35m&#x27;</span>,  <span class="comment"># 紫色</span></span><br><span class="line">    <span class="string">&#x27;RESET&#x27;</span>: <span class="string">&#x27;\033[0m&#x27;</span>       <span class="comment"># 重置</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ColoredFormatter</span>(logging.Formatter):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">format</span>(<span class="params">self, record</span>):</span><br><span class="line">        log_color = COLORS.get(record.levelname, COLORS[<span class="string">&#x27;RESET&#x27;</span>])</span><br><span class="line">        record.levelname = <span class="string">f&quot;<span class="subst">&#123;log_color&#125;</span><span class="subst">&#123;record.levelname&#125;</span><span class="subst">&#123;COLORS[<span class="string">&#x27;RESET&#x27;</span>]&#125;</span>&quot;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>().<span class="built_in">format</span>(record)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用</span></span><br><span class="line">logger = logging.getLogger(<span class="string">&#x27;myapp&#x27;</span>)</span><br><span class="line">handler = logging.StreamHandler()</span><br><span class="line">handler.setFormatter(ColoredFormatter(<span class="string">&#x27;%(asctime)s - %(levelname)s - %(message)s&#x27;</span>))</span><br><span class="line">logger.addHandler(handler)</span><br></pre></td></tr></table></figure>

<h3 id="6-5-JSON-日志（适合日志收集系统）"><a href="#6-5-JSON-日志（适合日志收集系统）" class="headerlink" title="6.5 JSON 日志（适合日志收集系统）"></a>6.5 JSON 日志（适合日志收集系统）</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">JSONFormatter</span>(logging.Formatter):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">format</span>(<span class="params">self, record</span>):</span><br><span class="line">        log_data = &#123;</span><br><span class="line">            <span class="string">&#x27;timestamp&#x27;</span>: datetime.utcnow().isoformat(),</span><br><span class="line">            <span class="string">&#x27;level&#x27;</span>: record.levelname,</span><br><span class="line">            <span class="string">&#x27;logger&#x27;</span>: record.name,</span><br><span class="line">            <span class="string">&#x27;message&#x27;</span>: record.getMessage(),</span><br><span class="line">            <span class="string">&#x27;module&#x27;</span>: record.module,</span><br><span class="line">            <span class="string">&#x27;function&#x27;</span>: record.funcName,</span><br><span class="line">            <span class="string">&#x27;line&#x27;</span>: record.lineno</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> record.exc_info:</span><br><span class="line">            log_data[<span class="string">&#x27;exception&#x27;</span>] = <span class="variable language_">self</span>.formatException(record.exc_info)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> json.dumps(log_data, ensure_ascii=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用</span></span><br><span class="line">logger = logging.getLogger(<span class="string">&#x27;myapp&#x27;</span>)</span><br><span class="line">handler = logging.FileHandler(<span class="string">&#x27;app.json.log&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">handler.setFormatter(JSONFormatter())</span><br><span class="line">logger.addHandler(handler)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出：</span></span><br><span class="line"><span class="comment"># &#123;&quot;timestamp&quot;: &quot;2026-02-24T10:00:00&quot;, &quot;level&quot;: &quot;ERROR&quot;, &quot;logger&quot;: &quot;myapp&quot;, &quot;message&quot;: &quot;错误信息&quot;, ...&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="七、最佳实践"><a href="#七、最佳实践" class="headerlink" title="七、最佳实践"></a>七、最佳实践</h2><blockquote>
<p><strong>提醒自己</strong>：</p>
<ol>
<li><strong>使用模块名作为 Logger 名</strong>：<code>logging.getLogger(__name__)</code></li>
<li><strong>不要在循环中创建 Logger</strong>：在模块级别创建</li>
<li><strong>合理设置日志级别</strong>：开发 DEBUG，生产 INFO 或 WARNING</li>
<li><strong>使用日志轮转</strong>：避免日志文件过大</li>
<li><strong>不要记录敏感信息</strong>：密码、token、个人信息等</li>
<li><strong>结构化日志</strong>：便于日志收集和分析</li>
<li><strong>使用%格式化</strong>：延迟求值，提高性能</li>
</ol>
</blockquote>
<h2 id="八、完整示例"><a href="#八、完整示例" class="headerlink" title="八、完整示例"></a>八、完整示例</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># app.py</span></span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="keyword">import</span> logging.handlers</span><br><span class="line"><span class="keyword">from</span> pathlib <span class="keyword">import</span> Path</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">setup_logging</span>(<span class="params">app_name=<span class="string">&#x27;myapp&#x27;</span>, log_dir=<span class="string">&#x27;logs&#x27;</span>, level=logging.INFO</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;设置日志配置&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 创建日志目录</span></span><br><span class="line">    Path(log_dir).mkdir(parents=<span class="literal">True</span>, exist_ok=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 格式化器</span></span><br><span class="line">    formatter = logging.Formatter(</span><br><span class="line">        <span class="string">&#x27;%(asctime)s - %(name)s - %(levelname)s [%(filename)s:%(lineno)d] - %(message)s&#x27;</span>,</span><br><span class="line">        datefmt=<span class="string">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span></span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 控制台 Handler</span></span><br><span class="line">    console_handler = logging.StreamHandler()</span><br><span class="line">    console_handler.setLevel(logging.INFO)</span><br><span class="line">    console_handler.setFormatter(formatter)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 文件 Handler（所有级别）</span></span><br><span class="line">    file_handler = logging.FileHandler(</span><br><span class="line">        <span class="string">f&#x27;<span class="subst">&#123;log_dir&#125;</span>/<span class="subst">&#123;app_name&#125;</span>.log&#x27;</span>,</span><br><span class="line">        encoding=<span class="string">&#x27;utf-8&#x27;</span></span><br><span class="line">    )</span><br><span class="line">    file_handler.setLevel(level)</span><br><span class="line">    file_handler.setFormatter(formatter)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 错误文件 Handler（只记录 ERROR 及以上）</span></span><br><span class="line">    error_handler = logging.FileHandler(</span><br><span class="line">        <span class="string">f&#x27;<span class="subst">&#123;log_dir&#125;</span>/<span class="subst">&#123;app_name&#125;</span>_error.log&#x27;</span>,</span><br><span class="line">        encoding=<span class="string">&#x27;utf-8&#x27;</span></span><br><span class="line">    )</span><br><span class="line">    error_handler.setLevel(logging.ERROR)</span><br><span class="line">    error_handler.setFormatter(formatter)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 日志轮转（可选）</span></span><br><span class="line">    <span class="comment"># rotating_handler = logging.handlers.RotatingFileHandler(</span></span><br><span class="line">    <span class="comment">#     f&#x27;&#123;log_dir&#125;/&#123;app_name&#125;.log&#x27;,</span></span><br><span class="line">    <span class="comment">#     maxBytes=10*1024*1024,  # 10MB</span></span><br><span class="line">    <span class="comment">#     backupCount=5,</span></span><br><span class="line">    <span class="comment">#     encoding=&#x27;utf-8&#x27;</span></span><br><span class="line">    <span class="comment"># )</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Root Logger</span></span><br><span class="line">    root_logger = logging.getLogger()</span><br><span class="line">    root_logger.setLevel(level)</span><br><span class="line">    root_logger.addHandler(console_handler)</span><br><span class="line">    root_logger.addHandler(file_handler)</span><br><span class="line">    root_logger.addHandler(error_handler)</span><br><span class="line"></span><br><span class="line">    logging.info(<span class="string">f&quot;<span class="subst">&#123;app_name&#125;</span> 日志系统初始化完成&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用</span></span><br><span class="line">setup_logging(<span class="string">&#x27;myapp&#x27;</span>, <span class="string">&#x27;logs&#x27;</span>, logging.DEBUG)</span><br><span class="line"></span><br><span class="line">logger = logging.getLogger(__name__)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    logger.info(<span class="string">&quot;程序启动&quot;</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># 业务逻辑</span></span><br><span class="line">        process_data()</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        logger.exception(<span class="string">&quot;程序执行失败&quot;</span>)</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        logger.info(<span class="string">&quot;程序结束&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<h2 id="九、练习"><a href="#九、练习" class="headerlink" title="九、练习"></a>九、练习</h2><ol>
<li>创建一个完整的日志配置，包含控制台、文件、轮转输出</li>
<li>使用字典配置方式设置日志系统</li>
<li>实现一个 JSON 格式的日志输出器</li>
<li>编写一个带上下文的日志装饰器</li>
<li>配置多 Logger，使不同模块输出到不同文件</li>
</ol>
<hr>
<p><strong>上一篇</strong>：<a href="/2026/02/24/Python-%E5%B8%B8%E7%94%A8%E5%BA%93%EF%BC%88%E4%BA%8C%EF%BC%89json-yaml-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/">Python 常用库（二）：json&#x2F;yaml 配置文件处理</a></p>
<p><strong>系列完成！</strong></p>
<p><strong>参考资源</strong>：</p>
<ul>
<li><a href="https://docs.python.org/zh-cn/3/library/logging.html">logging 官方文档</a></li>
<li><a href="https://docs.python.org/zh-cn/3/library/logging.config.html">logging 配置文档</a></li>
<li><a href="https://docs.python.org/3/howto/logging-cookbook.html">Python Logging Cookbook</a></li>
</ul>
]]></content>
      <categories>
        <category>Python 教程</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>logging</tag>
        <tag>日志</tag>
        <tag>调试</tag>
      </tags>
  </entry>
  <entry>
    <title>Python 常用库（二）json/yaml 配置文件处理</title>
    <url>/2026/02/24/Python%20%E5%B8%B8%E7%94%A8%E5%BA%93%EF%BC%88%E4%BA%8C%EF%BC%89json%20yaml%20%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/</url>
    <content><![CDATA[<h1 id="Python-常用库（二）json-yaml-配置文件处理"><a href="#Python-常用库（二）json-yaml-配置文件处理" class="headerlink" title="Python 常用库（二）json&#x2F;yaml 配置文件处理"></a>Python 常用库（二）json&#x2F;yaml 配置文件处理</h1><p>配置文件是项目中不可或缺的部分。本篇将介绍如何使用 json 和 yaml 格式进行配置管理。</p>
<h2 id="一、JSON-基础"><a href="#一、JSON-基础" class="headerlink" title="一、JSON 基础"></a>一、JSON 基础</h2><h3 id="1-1-JSON-简介"><a href="#1-1-JSON-简介" class="headerlink" title="1.1 JSON 简介"></a>1.1 JSON 简介</h3><p><strong>JSON（JavaScript Object Notation）</strong> 是一种轻量级的数据交换格式，易于人阅读和编写，也易于机器解析和生成。</p>
<p><strong>JSON 支持的数据类型：</strong></p>
<ul>
<li>字符串（string）</li>
<li>数字（number）</li>
<li>布尔值（boolean）</li>
<li>null</li>
<li>数组（array）</li>
<li>对象（object）</li>
</ul>
<h3 id="1-2-JSON-与-Python-类型对应"><a href="#1-2-JSON-与-Python-类型对应" class="headerlink" title="1.2 JSON 与 Python 类型对应"></a>1.2 JSON 与 Python 类型对应</h3><table>
<thead>
<tr>
<th>JSON</th>
<th>Python</th>
</tr>
</thead>
<tbody><tr>
<td>object</td>
<td>dict</td>
</tr>
<tr>
<td>array</td>
<td>list</td>
</tr>
<tr>
<td>string</td>
<td>str</td>
</tr>
<tr>
<td>number (int)</td>
<td>int</td>
</tr>
<tr>
<td>number (float)</td>
<td>float</td>
</tr>
<tr>
<td>true</td>
<td>True</td>
</tr>
<tr>
<td>false</td>
<td>False</td>
</tr>
<tr>
<td>null</td>
<td>None</td>
</tr>
</tbody></table>
<h2 id="二、json-模块使用"><a href="#二、json-模块使用" class="headerlink" title="二、json 模块使用"></a>二、json 模块使用</h2><h3 id="2-1-序列化与反序列化"><a href="#2-1-序列化与反序列化" class="headerlink" title="2.1 序列化与反序列化"></a>2.1 序列化与反序列化</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="comment"># Python 对象</span></span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;张三&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;age&#x27;</span>: <span class="number">25</span>,</span><br><span class="line">    <span class="string">&#x27;is_student&#x27;</span>: <span class="literal">False</span>,</span><br><span class="line">    <span class="string">&#x27;skills&#x27;</span>: [<span class="string">&#x27;Python&#x27;</span>, <span class="string">&#x27;Java&#x27;</span>, <span class="string">&#x27;Go&#x27;</span>],</span><br><span class="line">    <span class="string">&#x27;address&#x27;</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;city&#x27;</span>: <span class="string">&#x27;北京&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;district&#x27;</span>: <span class="string">&#x27;海淀区&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&#x27;salary&#x27;</span>: <span class="literal">None</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 序列化：Python -&gt; JSON 字符串</span></span><br><span class="line">json_str = json.dumps(data)</span><br><span class="line"><span class="built_in">print</span>(json_str)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 带格式的 JSON 字符串</span></span><br><span class="line">json_str = json.dumps(data, indent=<span class="number">2</span>, ensure_ascii=<span class="literal">False</span>)</span><br><span class="line"><span class="built_in">print</span>(json_str)</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">  &quot;name&quot;: &quot;张三&quot;,</span></span><br><span class="line"><span class="string">  &quot;age&quot;: 25,</span></span><br><span class="line"><span class="string">  &quot;is_student&quot;: false,</span></span><br><span class="line"><span class="string">  &quot;skills&quot;: [</span></span><br><span class="line"><span class="string">    &quot;Python&quot;,</span></span><br><span class="line"><span class="string">    &quot;Java&quot;,</span></span><br><span class="line"><span class="string">    &quot;Go&quot;</span></span><br><span class="line"><span class="string">  ],</span></span><br><span class="line"><span class="string">  &quot;address&quot;: &#123;</span></span><br><span class="line"><span class="string">    &quot;city&quot;: &quot;北京&quot;,</span></span><br><span class="line"><span class="string">    &quot;district&quot;: &quot;海淀区&quot;</span></span><br><span class="line"><span class="string">  &#125;,</span></span><br><span class="line"><span class="string">  &quot;salary&quot;: null</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 反序列化：JSON 字符串 -&gt; Python 对象</span></span><br><span class="line">data = json.loads(json_str)</span><br><span class="line"><span class="built_in">print</span>(data[<span class="string">&#x27;name&#x27;</span>])  <span class="comment"># 张三</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 提醒自己：</span></span><br><span class="line"><span class="comment"># - indent 控制缩进，让 JSON 更可读</span></span><br><span class="line"><span class="comment"># - ensure_ascii=False 保留中文字符</span></span><br></pre></td></tr></table></figure>

<h3 id="2-2-文件读写"><a href="#2-2-文件读写" class="headerlink" title="2.2 文件读写"></a>2.2 文件读写</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="comment"># 写入 JSON 文件</span></span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;张三&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;age&#x27;</span>: <span class="number">25</span>,</span><br><span class="line">    <span class="string">&#x27;skills&#x27;</span>: [<span class="string">&#x27;Python&#x27;</span>, <span class="string">&#x27;Java&#x27;</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;data.json&#x27;</span>, <span class="string">&#x27;w&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    json.dump(data, f, indent=<span class="number">2</span>, ensure_ascii=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 读取 JSON 文件</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;data.json&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    data = json.load(f)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(data)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 提醒自己：</span></span><br><span class="line"><span class="comment"># - json.dump() 写入文件</span></span><br><span class="line"><span class="comment"># - json.load() 从文件读取</span></span><br><span class="line"><span class="comment"># - json.dumps() 转为字符串（s = string）</span></span><br><span class="line"><span class="comment"># - json.loads() 从字符串读取</span></span><br></pre></td></tr></table></figure>

<h3 id="2-3-自定义序列化"><a href="#2-3-自定义序列化" class="headerlink" title="2.3 自定义序列化"></a>2.3 自定义序列化</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line"><span class="comment"># 自定义类型无法直接序列化</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name, age</span>):</span><br><span class="line">        <span class="variable language_">self</span>.name = name</span><br><span class="line">        <span class="variable language_">self</span>.age = age</span><br><span class="line"></span><br><span class="line">person = Person(<span class="string">&#x27;张三&#x27;</span>, <span class="number">25</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 方式一：使用 default 参数</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">default_handler</span>(<span class="params">obj</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">hasattr</span>(obj, <span class="string">&#x27;__dict__&#x27;</span>):</span><br><span class="line">        <span class="keyword">return</span> obj.__dict__</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(obj, datetime):</span><br><span class="line">        <span class="keyword">return</span> obj.isoformat()</span><br><span class="line">    <span class="keyword">raise</span> TypeError(<span class="string">f&quot;Type <span class="subst">&#123;<span class="built_in">type</span>(obj)&#125;</span> not serializable&quot;</span>)</span><br><span class="line"></span><br><span class="line">json_str = json.dumps(person, default=default_handler, ensure_ascii=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 方式二：使用 JSONEncoder</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CustomEncoder</span>(json.JSONEncoder):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">default</span>(<span class="params">self, obj</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(obj, Person):</span><br><span class="line">            <span class="keyword">return</span> &#123;<span class="string">&#x27;name&#x27;</span>: obj.name, <span class="string">&#x27;age&#x27;</span>: obj.age, <span class="string">&#x27;__type__&#x27;</span>: <span class="string">&#x27;Person&#x27;</span>&#125;</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(obj, datetime):</span><br><span class="line">            <span class="keyword">return</span> obj.isoformat()</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>().default(obj)</span><br><span class="line"></span><br><span class="line">json_str = json.dumps(person, cls=CustomEncoder, ensure_ascii=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 方式三：实现 to_dict 方法</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name, age</span>):</span><br><span class="line">        <span class="variable language_">self</span>.name = name</span><br><span class="line">        <span class="variable language_">self</span>.age = age</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">to_dict</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> &#123;<span class="string">&#x27;name&#x27;</span>: <span class="variable language_">self</span>.name, <span class="string">&#x27;age&#x27;</span>: <span class="variable language_">self</span>.age&#125;</span><br><span class="line"></span><br><span class="line">person = Person(<span class="string">&#x27;张三&#x27;</span>, <span class="number">25</span>)</span><br><span class="line">json_str = json.dumps(person.to_dict(), ensure_ascii=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 提醒自己：</span></span><br><span class="line"><span class="comment"># - default 参数处理无法序列化的对象</span></span><br><span class="line"><span class="comment"># - 自定义 Encoder 更灵活</span></span><br><span class="line"><span class="comment"># - 最简单的方式是自己实现 to_dict()</span></span><br></pre></td></tr></table></figure>

<h3 id="2-4-自定义反序列化"><a href="#2-4-自定义反序列化" class="headerlink" title="2.4 自定义反序列化"></a>2.4 自定义反序列化</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="comment"># 恢复自定义类型</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">object_hook</span>(<span class="params">d</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;__type__&#x27;</span> <span class="keyword">in</span> d:</span><br><span class="line">        <span class="keyword">if</span> d[<span class="string">&#x27;__type__&#x27;</span>] == <span class="string">&#x27;Person&#x27;</span>:</span><br><span class="line">            <span class="keyword">return</span> Person(d[<span class="string">&#x27;name&#x27;</span>], d[<span class="string">&#x27;age&#x27;</span>])</span><br><span class="line">    <span class="keyword">return</span> d</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name, age</span>):</span><br><span class="line">        <span class="variable language_">self</span>.name = name</span><br><span class="line">        <span class="variable language_">self</span>.age = age</span><br><span class="line"></span><br><span class="line">json_str = <span class="string">&#x27;&#123;&quot;name&quot;: &quot;张三&quot;, &quot;age&quot;: 25, &quot;__type__&quot;: &quot;Person&quot;&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line">person = json.loads(json_str, object_hook=object_hook)</span><br><span class="line"><span class="built_in">print</span>(person.name)  <span class="comment"># 张三</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(person))  <span class="comment"># &lt;class &#x27;__main__.Person&#x27;&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="三、YAML-基础"><a href="#三、YAML-基础" class="headerlink" title="三、YAML 基础"></a>三、YAML 基础</h2><h3 id="3-1-YAML-简介"><a href="#3-1-YAML-简介" class="headerlink" title="3.1 YAML 简介"></a>3.1 YAML 简介</h3><p><strong>YAML（YAML Ain’t a Markup Language）</strong> 是一种人类可读的数据序列化格式，特别适合配置文件。</p>
<p><strong>YAML 特点：</strong></p>
<ul>
<li>使用缩进表示层级（类似 Python）</li>
<li>支持注释（# 开头）</li>
<li>语法简洁，可读性好</li>
</ul>
<h3 id="3-2-YAML-语法"><a href="#3-2-YAML-语法" class="headerlink" title="3.2 YAML 语法"></a>3.2 YAML 语法</h3><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 基本数据类型</span></span><br><span class="line"><span class="attr">string:</span> <span class="string">hello</span></span><br><span class="line"><span class="attr">number:</span> <span class="number">42</span></span><br><span class="line"><span class="attr">float:</span> <span class="number">3.14</span></span><br><span class="line"><span class="attr">boolean:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">null_value:</span> <span class="literal">null</span></span><br><span class="line"><span class="attr">another_null:</span> <span class="string">~</span>  <span class="comment"># YAML 特有的 null 表示法</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 字符串</span></span><br><span class="line"><span class="attr">plain:</span> <span class="string">普通字符串</span></span><br><span class="line"><span class="attr">quoted:</span> <span class="string">&quot;带引号的字符串&quot;</span></span><br><span class="line"><span class="attr">with_newline:</span> <span class="string">|</span></span><br><span class="line"><span class="string">  这是多行字符串</span></span><br><span class="line"><span class="string">  第二行</span></span><br><span class="line"><span class="string">  第三行</span></span><br><span class="line"><span class="string"></span><span class="attr">folded:</span> <span class="string">&gt;</span></span><br><span class="line"><span class="string">  这是折叠的多行字符串</span></span><br><span class="line"><span class="string">  会被合并成一行</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="comment"># 列表/数组</span></span><br><span class="line"><span class="attr">fruits:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">apple</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">banana</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">orange</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 行内列表</span></span><br><span class="line"><span class="attr">colors:</span> [<span class="string">red</span>, <span class="string">green</span>, <span class="string">blue</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 字典/对象</span></span><br><span class="line"><span class="attr">person:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">张三</span></span><br><span class="line">  <span class="attr">age:</span> <span class="number">25</span></span><br><span class="line">  <span class="attr">city:</span> <span class="string">北京</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 行内字典</span></span><br><span class="line"><span class="attr">point:</span> &#123;<span class="attr">x:</span> <span class="number">10</span>, <span class="attr">y:</span> <span class="number">20</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 嵌套结构</span></span><br><span class="line"><span class="attr">company:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">ABC</span> <span class="string">公司</span></span><br><span class="line">  <span class="attr">employees:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">张三</span></span><br><span class="line">      <span class="attr">role:</span> <span class="string">开发</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">李四</span></span><br><span class="line">      <span class="attr">role:</span> <span class="string">测试</span></span><br><span class="line">  <span class="attr">departments:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">技术部</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">产品部</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 锚点和引用（YAML 高级特性）</span></span><br><span class="line"><span class="attr">defaults:</span> <span class="meta">&amp;defaults</span></span><br><span class="line">  <span class="attr">adapter:</span> <span class="string">postgres</span></span><br><span class="line">  <span class="attr">host:</span> <span class="string">localhost</span></span><br><span class="line"></span><br><span class="line"><span class="attr">development:</span></span><br><span class="line">  <span class="attr">database:</span> <span class="string">dev_db</span></span><br><span class="line">  <span class="string">&lt;&lt;:</span> <span class="string">*defaults</span>  <span class="comment"># 合并引用</span></span><br><span class="line"></span><br><span class="line"><span class="attr">production:</span></span><br><span class="line">  <span class="attr">database:</span> <span class="string">prod_db</span></span><br><span class="line">  <span class="string">&lt;&lt;:</span> <span class="meta">*defaults</span></span><br><span class="line">  <span class="attr">host:</span> <span class="string">production.example.com</span></span><br></pre></td></tr></table></figure>

<h3 id="3-3-安装-PyYAML"><a href="#3-3-安装-PyYAML" class="headerlink" title="3.3 安装 PyYAML"></a>3.3 安装 PyYAML</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pip install pyyaml</span><br></pre></td></tr></table></figure>

<h2 id="四、yaml-模块使用"><a href="#四、yaml-模块使用" class="headerlink" title="四、yaml 模块使用"></a>四、yaml 模块使用</h2><h3 id="4-1-读取-YAML"><a href="#4-1-读取-YAML" class="headerlink" title="4.1 读取 YAML"></a>4.1 读取 YAML</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> yaml</span><br><span class="line"></span><br><span class="line"><span class="comment"># YAML 字符串</span></span><br><span class="line">yaml_str = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">name: 张三</span></span><br><span class="line"><span class="string">age: 25</span></span><br><span class="line"><span class="string">skills:</span></span><br><span class="line"><span class="string">  - Python</span></span><br><span class="line"><span class="string">  - Java</span></span><br><span class="line"><span class="string">address:</span></span><br><span class="line"><span class="string">  city: 北京</span></span><br><span class="line"><span class="string">  district: 海淀区</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 反序列化：YAML 字符串 -&gt; Python 对象</span></span><br><span class="line">data = yaml.safe_load(yaml_str)</span><br><span class="line"><span class="built_in">print</span>(data)</span><br><span class="line"><span class="comment"># &#123;&#x27;name&#x27;: &#x27;张三&#x27;, &#x27;age&#x27;: 25, &#x27;skills&#x27;: [&#x27;Python&#x27;, &#x27;Java&#x27;], &#x27;address&#x27;: &#123;&#x27;city&#x27;: &#x27;北京&#x27;, &#x27;district&#x27;: &#x27;海淀区&#x27;&#125;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 读取 YAML 文件</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;config.yaml&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    data = yaml.safe_load(f)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 读取多个文档（一个文件包含多个 YAML 文档）</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;multi.yaml&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    docs = yaml.safe_load_all(f)</span><br><span class="line">    <span class="keyword">for</span> doc <span class="keyword">in</span> docs:</span><br><span class="line">        <span class="built_in">print</span>(doc)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 提醒自己：</span></span><br><span class="line"><span class="comment"># - 始终使用 safe_load() 而不是 load()</span></span><br><span class="line"><span class="comment"># - load() 会执行任意 Python 对象，有安全风险</span></span><br></pre></td></tr></table></figure>

<h3 id="4-2-写入-YAML"><a href="#4-2-写入-YAML" class="headerlink" title="4.2 写入 YAML"></a>4.2 写入 YAML</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> yaml</span><br><span class="line"></span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;张三&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;age&#x27;</span>: <span class="number">25</span>,</span><br><span class="line">    <span class="string">&#x27;skills&#x27;</span>: [<span class="string">&#x27;Python&#x27;</span>, <span class="string">&#x27;Java&#x27;</span>, <span class="string">&#x27;Go&#x27;</span>],</span><br><span class="line">    <span class="string">&#x27;address&#x27;</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;city&#x27;</span>: <span class="string">&#x27;北京&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;district&#x27;</span>: <span class="string">&#x27;海淀区&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&#x27;is_student&#x27;</span>: <span class="literal">False</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 写入文件</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;output.yaml&#x27;</span>, <span class="string">&#x27;w&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    yaml.dump(data, f, allow_unicode=<span class="literal">True</span>, default_flow_style=<span class="literal">False</span>, sort_keys=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">输出：</span></span><br><span class="line"><span class="string">name: 张三</span></span><br><span class="line"><span class="string">age: 25</span></span><br><span class="line"><span class="string">skills:</span></span><br><span class="line"><span class="string">- Python</span></span><br><span class="line"><span class="string">- Java</span></span><br><span class="line"><span class="string">- Go</span></span><br><span class="line"><span class="string">address:</span></span><br><span class="line"><span class="string">  city: 北京</span></span><br><span class="line"><span class="string">  district: 海淀区</span></span><br><span class="line"><span class="string">is_student: false</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 序列化为字符串</span></span><br><span class="line">yaml_str = yaml.dump(data, allow_unicode=<span class="literal">True</span>, default_flow_style=<span class="literal">False</span>, sort_keys=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 参数说明：</span></span><br><span class="line"><span class="comment"># - allow_unicode=True: 保留中文</span></span><br><span class="line"><span class="comment"># - default_flow_style=False: 使用块式风格（更易读）</span></span><br><span class="line"><span class="comment"># - sort_keys=False: 不排序键（保持插入顺序）</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 提醒自己：</span></span><br><span class="line"><span class="comment"># - Python 3.7+ 字典保持插入顺序</span></span><br><span class="line"><span class="comment"># - sort_keys=False 保持这个特性</span></span><br></pre></td></tr></table></figure>

<h3 id="4-3-自定义类型处理"><a href="#4-3-自定义类型处理" class="headerlink" title="4.3 自定义类型处理"></a>4.3 自定义类型处理</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> yaml</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name, age</span>):</span><br><span class="line">        <span class="variable language_">self</span>.name = name</span><br><span class="line">        <span class="variable language_">self</span>.age = age</span><br><span class="line"></span><br><span class="line"><span class="comment"># 自定义序列化</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">represent_person</span>(<span class="params">dumper, person</span>):</span><br><span class="line">    <span class="keyword">return</span> dumper.represent_mapping(<span class="string">&#x27;tag:yaml.org,2002:map&#x27;</span>, &#123;</span><br><span class="line">        <span class="string">&#x27;__type__&#x27;</span>: <span class="string">&#x27;Person&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;name&#x27;</span>: person.name,</span><br><span class="line">        <span class="string">&#x27;age&#x27;</span>: person.age</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">yaml.add_representer(Person, represent_person)</span><br><span class="line"></span><br><span class="line">person = Person(<span class="string">&#x27;张三&#x27;</span>, <span class="number">25</span>)</span><br><span class="line">yaml_str = yaml.dump(person, allow_unicode=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 自定义反序列化</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">construct_person</span>(<span class="params">loader, node</span>):</span><br><span class="line">    data = loader.construct_mapping(node)</span><br><span class="line">    <span class="keyword">return</span> Person(data[<span class="string">&#x27;name&#x27;</span>], data[<span class="string">&#x27;age&#x27;</span>])</span><br><span class="line"></span><br><span class="line">yaml.add_constructor(<span class="string">&#x27;tag:yaml.org,2002:map&#x27;</span>, construct_person)</span><br><span class="line"></span><br><span class="line">data = yaml.safe_load(yaml_str)</span><br></pre></td></tr></table></figure>

<h2 id="五、配置文件管理实践"><a href="#五、配置文件管理实践" class="headerlink" title="五、配置文件管理实践"></a>五、配置文件管理实践</h2><h3 id="5-1-配置文件示例"><a href="#5-1-配置文件示例" class="headerlink" title="5.1 配置文件示例"></a>5.1 配置文件示例</h3><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># config.yaml</span></span><br><span class="line"><span class="comment"># 应用配置</span></span><br><span class="line"><span class="attr">app:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">我的应用</span></span><br><span class="line">  <span class="attr">version:</span> <span class="number">1.0</span><span class="number">.0</span></span><br><span class="line">  <span class="attr">debug:</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 数据库配置</span></span><br><span class="line"><span class="attr">database:</span></span><br><span class="line">  <span class="attr">host:</span> <span class="string">localhost</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">5432</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">mydb</span></span><br><span class="line">  <span class="attr">user:</span> <span class="string">admin</span></span><br><span class="line">  <span class="attr">password:</span> <span class="string">$&#123;DB_PASSWORD&#125;</span>  <span class="comment"># 环境变量引用</span></span><br><span class="line">  <span class="attr">pool_size:</span> <span class="number">10</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 日志配置</span></span><br><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">level:</span> <span class="string">INFO</span></span><br><span class="line">  <span class="attr">format:</span> <span class="string">&quot;%(asctime)s - %(name)s - %(levelname)s - %(message)s&quot;</span></span><br><span class="line">  <span class="attr">file:</span> <span class="string">logs/app.log</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># API 配置</span></span><br><span class="line"><span class="attr">api:</span></span><br><span class="line">  <span class="attr">base_url:</span> <span class="string">https://api.example.com</span></span><br><span class="line">  <span class="attr">timeout:</span> <span class="number">30</span></span><br><span class="line">  <span class="attr">retry:</span> <span class="number">3</span></span><br><span class="line">  <span class="attr">endpoints:</span></span><br><span class="line">    <span class="attr">users:</span> <span class="string">/users</span></span><br><span class="line">    <span class="attr">posts:</span> <span class="string">/posts</span></span><br><span class="line">    <span class="attr">comments:</span> <span class="string">/comments</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 功能开关</span></span><br><span class="line"><span class="attr">features:</span></span><br><span class="line">  <span class="attr">enable_cache:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">enable_auth:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">enable_rate_limit:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure>

<h3 id="5-2-配置加载类"><a href="#5-2-配置加载类" class="headerlink" title="5.2 配置加载类"></a>5.2 配置加载类</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> yaml</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">from</span> pathlib <span class="keyword">import</span> Path</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Any</span>, <span class="type">Dict</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Config</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;配置文件管理器&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, config_path: <span class="built_in">str</span></span>):</span><br><span class="line">        <span class="variable language_">self</span>.config_path = Path(config_path)</span><br><span class="line">        <span class="variable language_">self</span>._config: <span class="type">Dict</span>[<span class="built_in">str</span>, <span class="type">Any</span>] = &#123;&#125;</span><br><span class="line">        <span class="variable language_">self</span>.load()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">load</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;加载配置文件&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="variable language_">self</span>.config_path.exists():</span><br><span class="line">            <span class="keyword">raise</span> FileNotFoundError(<span class="string">f&quot;配置文件不存在：<span class="subst">&#123;self.config_path&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">        suffix = <span class="variable language_">self</span>.config_path.suffix.lower()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(<span class="variable language_">self</span>.config_path, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            <span class="keyword">if</span> suffix <span class="keyword">in</span> [<span class="string">&#x27;.yaml&#x27;</span>, <span class="string">&#x27;.yml&#x27;</span>]:</span><br><span class="line">                <span class="variable language_">self</span>._config = yaml.safe_load(f)</span><br><span class="line">            <span class="keyword">elif</span> suffix == <span class="string">&#x27;.json&#x27;</span>:</span><br><span class="line">                <span class="variable language_">self</span>._config = json.load(f)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">raise</span> ValueError(<span class="string">f&quot;不支持的配置格式：<span class="subst">&#123;suffix&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 处理环境变量引用 $&#123;VAR_NAME&#125;</span></span><br><span class="line">        <span class="variable language_">self</span>._config = <span class="variable language_">self</span>._expand_env(<span class="variable language_">self</span>._config)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_expand_env</span>(<span class="params">self, obj: <span class="type">Any</span></span>) -&gt; <span class="type">Any</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;递归展开环境变量引用&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(obj, <span class="built_in">str</span>):</span><br><span class="line">            <span class="comment"># 替换 $&#123;VAR_NAME&#125; 格式</span></span><br><span class="line">            <span class="keyword">import</span> re</span><br><span class="line">            pattern = <span class="string">r&#x27;\$\&#123;(\w+)\&#125;&#x27;</span></span><br><span class="line">            matches = re.findall(pattern, obj)</span><br><span class="line">            <span class="keyword">for</span> var_name <span class="keyword">in</span> matches:</span><br><span class="line">                env_value = os.environ.get(var_name, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">                obj = obj.replace(<span class="string">f&#x27;$&#123;&#123;<span class="subst">&#123;var_name&#125;</span>&#125;&#125;&#x27;</span>, env_value)</span><br><span class="line">            <span class="keyword">return</span> obj</span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">isinstance</span>(obj, <span class="built_in">dict</span>):</span><br><span class="line">            <span class="keyword">return</span> &#123;k: <span class="variable language_">self</span>._expand_env(v) <span class="keyword">for</span> k, v <span class="keyword">in</span> obj.items()&#125;</span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">isinstance</span>(obj, <span class="built_in">list</span>):</span><br><span class="line">            <span class="keyword">return</span> [<span class="variable language_">self</span>._expand_env(item) <span class="keyword">for</span> item <span class="keyword">in</span> obj]</span><br><span class="line">        <span class="keyword">return</span> obj</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">self, key: <span class="built_in">str</span>, default: <span class="type">Any</span> = <span class="literal">None</span></span>) -&gt; <span class="type">Any</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;获取配置值&quot;&quot;&quot;</span></span><br><span class="line">        keys = key.split(<span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        value = <span class="variable language_">self</span>._config</span><br><span class="line">        <span class="keyword">for</span> k <span class="keyword">in</span> keys:</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">isinstance</span>(value, <span class="built_in">dict</span>) <span class="keyword">and</span> k <span class="keyword">in</span> value:</span><br><span class="line">                value = value[k]</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span> default</span><br><span class="line">        <span class="keyword">return</span> value</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__getitem__</span>(<span class="params">self, key: <span class="built_in">str</span></span>) -&gt; <span class="type">Any</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.get(key)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__repr__</span>(<span class="params">self</span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&quot;Config(<span class="subst">&#123;self._config&#125;</span>)&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用示例</span></span><br><span class="line">config = Config(<span class="string">&#x27;config.yaml&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取配置</span></span><br><span class="line">app_name = config.get(<span class="string">&#x27;app.name&#x27;</span>)</span><br><span class="line">db_host = config.get(<span class="string">&#x27;database.host&#x27;</span>)</span><br><span class="line">api_timeout = config.get(<span class="string">&#x27;api.timeout&#x27;</span>, <span class="number">30</span>)  <span class="comment"># 带默认值</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 链式访问</span></span><br><span class="line">db_config = config.get(<span class="string">&#x27;database&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(db_config[<span class="string">&#x27;host&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 或者</span></span><br><span class="line">db_host = config[<span class="string">&#x27;database.host&#x27;</span>]</span><br></pre></td></tr></table></figure>

<h3 id="5-3-多环境配置"><a href="#5-3-多环境配置" class="headerlink" title="5.3 多环境配置"></a>5.3 多环境配置</h3><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># config.yaml</span></span><br><span class="line"><span class="comment"># 公共配置</span></span><br><span class="line"><span class="attr">common:</span></span><br><span class="line">  <span class="attr">app_name:</span> <span class="string">我的应用</span></span><br><span class="line">  <span class="attr">version:</span> <span class="number">1.0</span><span class="number">.0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 开发环境</span></span><br><span class="line"><span class="attr">development:</span></span><br><span class="line">  <span class="attr">debug:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">database:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="string">localhost</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">5432</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">dev_db</span></span><br><span class="line">  <span class="attr">logging:</span></span><br><span class="line">    <span class="attr">level:</span> <span class="string">DEBUG</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 测试环境</span></span><br><span class="line"><span class="attr">testing:</span></span><br><span class="line">  <span class="attr">debug:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">database:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="string">test-db.example.com</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">5432</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">test_db</span></span><br><span class="line">  <span class="attr">logging:</span></span><br><span class="line">    <span class="attr">level:</span> <span class="string">INFO</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 生产环境</span></span><br><span class="line"><span class="attr">production:</span></span><br><span class="line">  <span class="attr">debug:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">database:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="string">prod-db.example.com</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">5432</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">prod_db</span></span><br><span class="line">  <span class="attr">logging:</span></span><br><span class="line">    <span class="attr">level:</span> <span class="string">WARNING</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MultiEnvConfig</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;多环境配置管理&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, config_path: <span class="built_in">str</span>, env: <span class="built_in">str</span> = <span class="literal">None</span></span>):</span><br><span class="line">        <span class="variable language_">self</span>.env = env <span class="keyword">or</span> os.environ.get(<span class="string">&#x27;APP_ENV&#x27;</span>, <span class="string">&#x27;development&#x27;</span>)</span><br><span class="line">        <span class="variable language_">self</span>.config_path = Path(config_path)</span><br><span class="line">        <span class="variable language_">self</span>._config = &#123;&#125;</span><br><span class="line">        <span class="variable language_">self</span>.load()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">load</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(<span class="variable language_">self</span>.config_path, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            full_config = yaml.safe_load(f)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 合并公共配置和环境配置</span></span><br><span class="line">        common = full_config.get(<span class="string">&#x27;common&#x27;</span>, &#123;&#125;)</span><br><span class="line">        env_config = full_config.get(<span class="variable language_">self</span>.env, &#123;&#125;)</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>._config = <span class="variable language_">self</span>._deep_merge(common, env_config)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_deep_merge</span>(<span class="params">self, base: <span class="built_in">dict</span>, override: <span class="built_in">dict</span></span>) -&gt; <span class="built_in">dict</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;深度合并字典&quot;&quot;&quot;</span></span><br><span class="line">        result = base.copy()</span><br><span class="line">        <span class="keyword">for</span> key, value <span class="keyword">in</span> override.items():</span><br><span class="line">            <span class="keyword">if</span> key <span class="keyword">in</span> result <span class="keyword">and</span> <span class="built_in">isinstance</span>(result[key], <span class="built_in">dict</span>) <span class="keyword">and</span> <span class="built_in">isinstance</span>(value, <span class="built_in">dict</span>):</span><br><span class="line">                result[key] = <span class="variable language_">self</span>._deep_merge(result[key], value)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                result[key] = value</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">self, key: <span class="built_in">str</span>, default: <span class="type">Any</span> = <span class="literal">None</span></span>) -&gt; <span class="type">Any</span>:</span><br><span class="line">        keys = key.split(<span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        value = <span class="variable language_">self</span>._config</span><br><span class="line">        <span class="keyword">for</span> k <span class="keyword">in</span> keys:</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">isinstance</span>(value, <span class="built_in">dict</span>) <span class="keyword">and</span> k <span class="keyword">in</span> value:</span><br><span class="line">                value = value[k]</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span> default</span><br><span class="line">        <span class="keyword">return</span> value</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用</span></span><br><span class="line">config = MultiEnvConfig(<span class="string">&#x27;config.yaml&#x27;</span>)</span><br><span class="line"><span class="comment"># 或设置环境变量：export APP_ENV=production</span></span><br></pre></td></tr></table></figure>

<h3 id="5-4-配置验证"><a href="#5-4-配置验证" class="headerlink" title="5.4 配置验证"></a>5.4 配置验证</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Any</span>, <span class="type">Dict</span>, <span class="type">List</span>, <span class="type">Optional</span></span><br><span class="line"><span class="keyword">from</span> dataclasses <span class="keyword">import</span> dataclass</span><br><span class="line"></span><br><span class="line"><span class="meta">@dataclass</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DatabaseConfig</span>:</span><br><span class="line">    host: <span class="built_in">str</span></span><br><span class="line">    port: <span class="built_in">int</span></span><br><span class="line">    name: <span class="built_in">str</span></span><br><span class="line">    user: <span class="built_in">str</span></span><br><span class="line">    password: <span class="built_in">str</span></span><br><span class="line">    pool_size: <span class="built_in">int</span> = <span class="number">10</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@dataclass</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AppConfig</span>:</span><br><span class="line">    name: <span class="built_in">str</span></span><br><span class="line">    version: <span class="built_in">str</span></span><br><span class="line">    debug: <span class="built_in">bool</span> = <span class="literal">False</span></span><br><span class="line">    database: <span class="type">Optional</span>[DatabaseConfig] = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">validate_config</span>(<span class="params">config: <span class="type">Dict</span></span>) -&gt; AppConfig:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;验证配置并返回类型安全的配置对象&quot;&quot;&quot;</span></span><br><span class="line">    errors = []</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 验证 app 配置</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;app&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> config:</span><br><span class="line">        errors.append(<span class="string">&quot;缺少 app 配置&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        app = config[<span class="string">&#x27;app&#x27;</span>]</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;name&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> app:</span><br><span class="line">            errors.append(<span class="string">&quot;缺少 app.name&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;version&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> app:</span><br><span class="line">            errors.append(<span class="string">&quot;缺少 app.version&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 验证数据库配置</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;database&#x27;</span> <span class="keyword">in</span> config:</span><br><span class="line">        db = config[<span class="string">&#x27;database&#x27;</span>]</span><br><span class="line">        required_fields = [<span class="string">&#x27;host&#x27;</span>, <span class="string">&#x27;port&#x27;</span>, <span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;user&#x27;</span>]</span><br><span class="line">        <span class="keyword">for</span> field <span class="keyword">in</span> required_fields:</span><br><span class="line">            <span class="keyword">if</span> field <span class="keyword">not</span> <span class="keyword">in</span> db:</span><br><span class="line">                errors.append(<span class="string">f&quot;缺少 database.<span class="subst">&#123;field&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> errors:</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">&quot;配置验证失败:\n&quot;</span> + <span class="string">&quot;\n&quot;</span>.join(errors))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 构建配置对象</span></span><br><span class="line">    app_config = AppConfig(</span><br><span class="line">        name=config[<span class="string">&#x27;app&#x27;</span>][<span class="string">&#x27;name&#x27;</span>],</span><br><span class="line">        version=config[<span class="string">&#x27;app&#x27;</span>][<span class="string">&#x27;version&#x27;</span>],</span><br><span class="line">        debug=config.get(<span class="string">&#x27;app&#x27;</span>, &#123;&#125;).get(<span class="string">&#x27;debug&#x27;</span>, <span class="literal">False</span>)</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;database&#x27;</span> <span class="keyword">in</span> config:</span><br><span class="line">        db = config[<span class="string">&#x27;database&#x27;</span>]</span><br><span class="line">        app_config.database = DatabaseConfig(</span><br><span class="line">            host=db[<span class="string">&#x27;host&#x27;</span>],</span><br><span class="line">            port=db[<span class="string">&#x27;port&#x27;</span>],</span><br><span class="line">            name=db[<span class="string">&#x27;name&#x27;</span>],</span><br><span class="line">            user=db[<span class="string">&#x27;user&#x27;</span>],</span><br><span class="line">            password=db.get(<span class="string">&#x27;password&#x27;</span>, <span class="string">&#x27;&#x27;</span>),</span><br><span class="line">            pool_size=db.get(<span class="string">&#x27;pool_size&#x27;</span>, <span class="number">10</span>)</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> app_config</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;config.yaml&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    raw_config = yaml.safe_load(f)</span><br><span class="line"></span><br><span class="line">config = validate_config(raw_config)</span><br><span class="line"><span class="built_in">print</span>(config.name)</span><br><span class="line"><span class="built_in">print</span>(config.database.host)</span><br></pre></td></tr></table></figure>

<h2 id="六、JSON-vs-YAML-对比"><a href="#六、JSON-vs-YAML-对比" class="headerlink" title="六、JSON vs YAML 对比"></a>六、JSON vs YAML 对比</h2><table>
<thead>
<tr>
<th>特性</th>
<th>JSON</th>
<th>YAML</th>
</tr>
</thead>
<tbody><tr>
<td>可读性</td>
<td>一般</td>
<td>优秀</td>
</tr>
<tr>
<td>简洁性</td>
<td>一般（需要大量括号）</td>
<td>优秀（缩进表示层级）</td>
</tr>
<tr>
<td>注释支持</td>
<td>不支持</td>
<td>支持</td>
</tr>
<tr>
<td>数据类型</td>
<td>基础类型</td>
<td>基础类型 + 更多</td>
</tr>
<tr>
<td>解析速度</td>
<td>快</td>
<td>较慢</td>
</tr>
<tr>
<td>适用场景</td>
<td>API 数据交换</td>
<td>配置文件</td>
</tr>
<tr>
<td>Python 标准库</td>
<td>内置 json</td>
<td>需要 PyYAML</td>
</tr>
</tbody></table>
<h2 id="七、最佳实践"><a href="#七、最佳实践" class="headerlink" title="七、最佳实践"></a>七、最佳实践</h2><blockquote>
<p><strong>提醒自己</strong>：</p>
<ol>
<li><strong>配置文件不要提交敏感信息</strong>：使用环境变量或单独的 secrets 文件</li>
<li><strong>提供默认值</strong>：配置项应该有合理的默认值</li>
<li><strong>配置验证</strong>：启动时验证配置完整性</li>
<li><strong>使用合适的格式</strong>：API 用 JSON，配置用 YAML</li>
<li><strong>注释说明</strong>：配置项要有注释说明用途</li>
<li><strong>环境分离</strong>：不同环境使用不同配置</li>
</ol>
</blockquote>
<h2 id="八、练习"><a href="#八、练习" class="headerlink" title="八、练习"></a>八、练习</h2><ol>
<li>创建一个项目配置文件（YAML 格式），包含数据库、日志、API 等配置</li>
<li>实现一个配置加载器，支持环境变量替换</li>
<li>编写配置验证函数，确保必要配置项存在</li>
<li>实现多环境配置合并功能</li>
<li>创建一个 JSON 配置文件，并实现读取和写入功能</li>
</ol>
<hr>
<p><strong>上一篇</strong>：<a href="/2026/02/24/Python-%E5%B8%B8%E7%94%A8%E5%BA%93%EF%BC%88%E4%B8%80%EF%BC%89requests-API-%E8%B0%83%E7%94%A8/">Python 常用库（一）：requests API 调用</a></p>
<p><strong>下一篇</strong>：<a href="/2026/02/24/Python-%E5%B8%B8%E7%94%A8%E5%BA%93%EF%BC%88%E4%B8%89%EF%BC%89logging-%E6%97%A5%E5%BF%97%E6%A8%A1%E5%9D%97/">Python 常用库（三）：logging 日志模块</a></p>
<p><strong>参考资源</strong>：</p>
<ul>
<li><a href="https://docs.python.org/zh-cn/3/library/json.html">json 官方文档</a></li>
<li><a href="https://pyyaml.org/wiki/PyYAMLDocumentation">PyYAML 官方文档</a></li>
<li><a href="https://yaml.org/spec/">YAML 语法教程</a></li>
</ul>
]]></content>
      <categories>
        <category>Python 教程</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>json</tag>
        <tag>yaml</tag>
        <tag>配置文件</tag>
      </tags>
  </entry>
  <entry>
    <title>Python 数据科学（一）NumPy 数值计算</title>
    <url>/2026/02/24/Python%20%E6%95%B0%E6%8D%AE%E7%A7%91%E5%AD%A6%EF%BC%88%E4%B8%80%EF%BC%89NumPy%20%E6%95%B0%E5%80%BC%E8%AE%A1%E7%AE%97/</url>
    <content><![CDATA[<h1 id="Python-数据科学（一）NumPy-数值计算"><a href="#Python-数据科学（一）NumPy-数值计算" class="headerlink" title="Python 数据科学（一）NumPy 数值计算"></a>Python 数据科学（一）NumPy 数值计算</h1><p>NumPy 是 Python 数据科学的基石。本篇将介绍 NumPy 的核心功能，包括 ndarray 数组、向量化计算、广播机制等。</p>
<h2 id="一、NumPy-简介"><a href="#一、NumPy-简介" class="headerlink" title="一、NumPy 简介"></a>一、NumPy 简介</h2><h3 id="1-1-为什么使用-NumPy？"><a href="#1-1-为什么使用-NumPy？" class="headerlink" title="1.1 为什么使用 NumPy？"></a>1.1 为什么使用 NumPy？</h3><ul>
<li><strong>性能优势</strong>：底层用 C 实现，比纯 Python 快 10-100 倍</li>
<li><strong>内存效率</strong>：连续存储，占用更少内存</li>
<li><strong>向量化操作</strong>：无需循环，代码更简洁</li>
<li><strong>生态基础</strong>：Pandas、SciPy、scikit-learn 等都基于 NumPy</li>
</ul>
<h3 id="1-2-安装与导入"><a href="#1-2-安装与导入" class="headerlink" title="1.2 安装与导入"></a>1.2 安装与导入</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pip install numpy</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看版本</span></span><br><span class="line"><span class="built_in">print</span>(np.__version__)</span><br></pre></td></tr></table></figure>

<h2 id="二、ndarray-数组"><a href="#二、ndarray-数组" class="headerlink" title="二、ndarray 数组"></a>二、ndarray 数组</h2><h3 id="2-1-创建数组"><a href="#2-1-创建数组" class="headerlink" title="2.1 创建数组"></a>2.1 创建数组</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="comment"># 从列表创建</span></span><br><span class="line">arr1 = np.array([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>])</span><br><span class="line">arr2 = np.array([[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], [<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>]])  <span class="comment"># 二维数组</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 特殊数组</span></span><br><span class="line">zeros = np.zeros((<span class="number">3</span>, <span class="number">4</span>))      <span class="comment"># 3x4 全零数组</span></span><br><span class="line">ones = np.ones((<span class="number">2</span>, <span class="number">3</span>))        <span class="comment"># 2x3 全一数组</span></span><br><span class="line">full = np.full((<span class="number">2</span>, <span class="number">2</span>), <span class="number">7</span>)     <span class="comment"># 2x2 填充 7 的数组</span></span><br><span class="line">empty = np.empty((<span class="number">3</span>, <span class="number">3</span>))      <span class="comment"># 未初始化的数组（速度快，值随机）</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 范围数组</span></span><br><span class="line">range1 = np.arange(<span class="number">0</span>, <span class="number">10</span>, <span class="number">2</span>)     <span class="comment"># [0, 2, 4, 6, 8]</span></span><br><span class="line">range2 = np.linspace(<span class="number">0</span>, <span class="number">1</span>, <span class="number">5</span>)    <span class="comment"># [0., 0.25, 0.5, 0.75, 1.] 等间距</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 随机数组</span></span><br><span class="line">rand1 = np.random.rand(<span class="number">3</span>, <span class="number">3</span>)          <span class="comment"># 0-1 均匀分布</span></span><br><span class="line">rand2 = np.random.randn(<span class="number">3</span>, <span class="number">3</span>)         <span class="comment"># 标准正态分布</span></span><br><span class="line">rand3 = np.random.randint(<span class="number">0</span>, <span class="number">10</span>, <span class="number">5</span>)   <span class="comment"># [0,10) 随机整数</span></span><br><span class="line">rand4 = np.random.random((<span class="number">2</span>, <span class="number">3</span>))      <span class="comment"># 0-1 均匀分布</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 单位矩阵</span></span><br><span class="line">eye = np.eye(<span class="number">3</span>)</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">[[1. 0. 0.]</span></span><br><span class="line"><span class="string"> [0. 1. 0.]</span></span><br><span class="line"><span class="string"> [0. 0. 1.]]</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 提醒自己：</span></span><br><span class="line"><span class="comment"># - arange 类似 Python 的 range，但支持浮点数</span></span><br><span class="line"><span class="comment"># - linspace 指定的是点数而非步长</span></span><br></pre></td></tr></table></figure>

<h3 id="2-2-数组属性"><a href="#2-2-数组属性" class="headerlink" title="2.2 数组属性"></a>2.2 数组属性</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">arr = np.array([[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], [<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>]])</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(arr.ndim)      <span class="comment"># 2 维度</span></span><br><span class="line"><span class="built_in">print</span>(arr.shape)     <span class="comment"># (2, 3) 形状</span></span><br><span class="line"><span class="built_in">print</span>(arr.size)      <span class="comment"># 6 元素总数</span></span><br><span class="line"><span class="built_in">print</span>(arr.dtype)     <span class="comment"># int32/int64 数据类型</span></span><br><span class="line"><span class="built_in">print</span>(arr.itemsize)  <span class="comment"># 8 每个元素的字节数</span></span><br><span class="line"><span class="built_in">print</span>(arr.nbytes)    <span class="comment"># 48 总字节数</span></span><br></pre></td></tr></table></figure>

<h3 id="2-3-数据类型"><a href="#2-3-数据类型" class="headerlink" title="2.3 数据类型"></a>2.3 数据类型</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 指定数据类型</span></span><br><span class="line">arr = np.array([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], dtype=np.float32)</span><br><span class="line">arr = np.array([<span class="number">1.0</span>, <span class="number">2.0</span>], dtype=np.complex128)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 常用数据类型</span></span><br><span class="line"><span class="comment"># - np.int8/16/32/64: 有符号整数</span></span><br><span class="line"><span class="comment"># - np.uint8/16/32/64: 无符号整数</span></span><br><span class="line"><span class="comment"># - np.float16/32/64: 浮点数</span></span><br><span class="line"><span class="comment"># - np.complex64/128: 复数</span></span><br><span class="line"><span class="comment"># - np.bool_: 布尔值</span></span><br><span class="line"><span class="comment"># - np.str_: 字符串</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 类型转换</span></span><br><span class="line">arr = arr.astype(np.int32)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 提醒自己：</span></span><br><span class="line"><span class="comment"># - float64 是默认浮点类型</span></span><br><span class="line"><span class="comment"># - 大规模计算可用 float32 节省内存</span></span><br></pre></td></tr></table></figure>

<h2 id="三、数组索引与切片"><a href="#三、数组索引与切片" class="headerlink" title="三、数组索引与切片"></a>三、数组索引与切片</h2><h3 id="3-1-基础索引"><a href="#3-1-基础索引" class="headerlink" title="3.1 基础索引"></a>3.1 基础索引</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">arr = np.array([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>])</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(arr[<span class="number">0</span>])      <span class="comment"># 1</span></span><br><span class="line"><span class="built_in">print</span>(arr[-<span class="number">1</span>])     <span class="comment"># 5</span></span><br><span class="line"><span class="built_in">print</span>(arr[<span class="number">2</span>:<span class="number">4</span>])    <span class="comment"># [3, 4] 切片</span></span><br><span class="line"><span class="built_in">print</span>(arr[::<span class="number">2</span>])    <span class="comment"># [1, 3, 5] 步长</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 二维数组</span></span><br><span class="line">arr2d = np.array([[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], [<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>], [<span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>]])</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(arr2d[<span class="number">0</span>, <span class="number">1</span>])    <span class="comment"># 2 第 0 行第 1 列</span></span><br><span class="line"><span class="built_in">print</span>(arr2d[<span class="number">0</span>])       <span class="comment"># [1, 2, 3] 第一行</span></span><br><span class="line"><span class="built_in">print</span>(arr2d[:, <span class="number">1</span>])    <span class="comment"># [2, 5, 8] 第二列</span></span><br><span class="line"><span class="built_in">print</span>(arr2d[<span class="number">1</span>:<span class="number">3</span>, <span class="number">0</span>:<span class="number">2</span>]) <span class="comment"># [[4, 5], [7, 8]]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 提醒自己：NumPy 切片返回的是视图（view），不是拷贝！</span></span><br></pre></td></tr></table></figure>

<h3 id="3-2-布尔索引"><a href="#3-2-布尔索引" class="headerlink" title="3.2 布尔索引"></a>3.2 布尔索引</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">arr = np.array([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 条件筛选</span></span><br><span class="line">mask = arr &gt; <span class="number">3</span></span><br><span class="line"><span class="built_in">print</span>(mask)         <span class="comment"># [False, False, False, True, True, True]</span></span><br><span class="line"><span class="built_in">print</span>(arr[mask])    <span class="comment"># [4, 5, 6]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 简化写法</span></span><br><span class="line"><span class="built_in">print</span>(arr[arr &gt; <span class="number">3</span>])    <span class="comment"># [4, 5, 6]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 多条件</span></span><br><span class="line"><span class="built_in">print</span>(arr[(arr &gt; <span class="number">2</span>) &amp; (arr &lt; <span class="number">5</span>)])  <span class="comment"># [3, 4]  与</span></span><br><span class="line"><span class="built_in">print</span>(arr[(arr &lt; <span class="number">2</span>) | (arr &gt; <span class="number">5</span>)])  <span class="comment"># [1, 6]  或</span></span><br><span class="line"><span class="built_in">print</span>(arr[~(arr % <span class="number">2</span> == <span class="number">0</span>)])        <span class="comment"># [1, 3, 5] 非</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 提醒自己：</span></span><br><span class="line"><span class="comment"># - 多条件用 &amp; | ~，不能用 and or not</span></span><br><span class="line"><span class="comment"># - 条件要用括号括起来</span></span><br></pre></td></tr></table></figure>

<h3 id="3-3-花式索引"><a href="#3-3-花式索引" class="headerlink" title="3.3 花式索引"></a>3.3 花式索引</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">arr = np.array([<span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>, <span class="number">40</span>, <span class="number">50</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 按索引数组取值</span></span><br><span class="line">indices = [<span class="number">0</span>, <span class="number">2</span>, <span class="number">4</span>]</span><br><span class="line"><span class="built_in">print</span>(arr[indices])  <span class="comment"># [10, 30, 50]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 二维数组花式索引</span></span><br><span class="line">arr2d = np.array([[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], [<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>], [<span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>]])</span><br><span class="line">rows = [<span class="number">0</span>, <span class="number">2</span>]</span><br><span class="line">cols = [<span class="number">1</span>, <span class="number">2</span>]</span><br><span class="line"><span class="built_in">print</span>(arr2d[rows, cols])  <span class="comment"># [2, 9] 对应 (0,1) 和 (2,2)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 提醒自己：花式索引返回的是拷贝，不是视图</span></span><br></pre></td></tr></table></figure>

<h2 id="四、数组操作"><a href="#四、数组操作" class="headerlink" title="四、数组操作"></a>四、数组操作</h2><h3 id="4-1-形状变换"><a href="#4-1-形状变换" class="headerlink" title="4.1 形状变换"></a>4.1 形状变换</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">arr = np.arange(<span class="number">12</span>)  <span class="comment"># [0, 1, 2, ..., 11]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># reshape 改变形状</span></span><br><span class="line">arr2d = arr.reshape(<span class="number">3</span>, <span class="number">4</span>)</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">[[ 0,  1,  2,  3],</span></span><br><span class="line"><span class="string"> [ 4,  5,  6,  7],</span></span><br><span class="line"><span class="string"> [ 8,  9, 10, 11]]</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># -1 自动推断</span></span><br><span class="line">arr3d = arr.reshape(<span class="number">2</span>, <span class="number">2</span>, -<span class="number">1</span>)  <span class="comment"># (2, 2, 3)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># flatten 展平</span></span><br><span class="line">flat = arr2d.flatten()  <span class="comment"># 返回拷贝</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ravel 展平</span></span><br><span class="line">flat = arr2d.ravel()  <span class="comment"># 返回视图（更快）</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># transpose 转置</span></span><br><span class="line">transposed = arr2d.T</span><br><span class="line"></span><br><span class="line"><span class="comment"># swapaxes 交换轴</span></span><br><span class="line">swapped = arr3d.swapaxes(<span class="number">0</span>, <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 提醒自己：</span></span><br><span class="line"><span class="comment"># - reshape 不改变原数组</span></span><br><span class="line"><span class="comment"># - -1 表示自动计算该维度大小</span></span><br></pre></td></tr></table></figure>

<h3 id="4-2-合并与分割"><a href="#4-2-合并与分割" class="headerlink" title="4.2 合并与分割"></a>4.2 合并与分割</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 合并</span></span><br><span class="line">arr1 = np.array([[<span class="number">1</span>, <span class="number">2</span>], [<span class="number">3</span>, <span class="number">4</span>]])</span><br><span class="line">arr2 = np.array([[<span class="number">5</span>, <span class="number">6</span>], [<span class="number">7</span>, <span class="number">8</span>]])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 垂直堆叠</span></span><br><span class="line">vstack = np.vstack([arr1, arr2])</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">[[1, 2],</span></span><br><span class="line"><span class="string"> [3, 4],</span></span><br><span class="line"><span class="string"> [5, 6],</span></span><br><span class="line"><span class="string"> [7, 8]]</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 水平堆叠</span></span><br><span class="line">hstack = np.hstack([arr1, arr2])</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">[[1, 2, 5, 6],</span></span><br><span class="line"><span class="string"> [3, 4, 7, 8]]</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 按行/列堆叠</span></span><br><span class="line">concat_v = np.concatenate([arr1, arr2], axis=<span class="number">0</span>)  <span class="comment"># 按行</span></span><br><span class="line">concat_h = np.concatenate([arr1, arr2], axis=<span class="number">1</span>)  <span class="comment"># 按列</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 分割</span></span><br><span class="line">arr = np.arange(<span class="number">12</span>).reshape(<span class="number">3</span>, <span class="number">4</span>)</span><br><span class="line"></span><br><span class="line">split_v = np.vsplit(arr, <span class="number">3</span>)  <span class="comment"># 垂直分割成 3 份</span></span><br><span class="line">split_h = np.hsplit(arr, <span class="number">2</span>)  <span class="comment"># 水平分割成 2 份</span></span><br><span class="line">split = np.split(arr, <span class="number">3</span>, axis=<span class="number">0</span>)  <span class="comment"># 按轴分割</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 提醒自己：</span></span><br><span class="line"><span class="comment"># - axis=0 表示行（垂直），axis=1 表示列（水平）</span></span><br></pre></td></tr></table></figure>

<h3 id="4-3-增删元素"><a href="#4-3-增删元素" class="headerlink" title="4.3 增删元素"></a>4.3 增删元素</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">arr = np.array([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加元素</span></span><br><span class="line">arr_append = np.append(arr, [<span class="number">6</span>, <span class="number">7</span>])  <span class="comment"># [1, 2, 3, 4, 5, 6, 7]</span></span><br><span class="line">arr_insert = np.insert(arr, <span class="number">2</span>, [<span class="number">10</span>, <span class="number">20</span>])  <span class="comment"># 在索引 2 插入 [1, 2, 10, 20, 3, 4, 5]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除元素</span></span><br><span class="line">arr_delete = np.delete(arr, [<span class="number">1</span>, <span class="number">3</span>])  <span class="comment"># [1, 3, 5] 删除索引 1 和 3</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 提醒自己：这些操作返回新数组，不修改原数组</span></span><br></pre></td></tr></table></figure>

<h2 id="五、向量化计算"><a href="#五、向量化计算" class="headerlink" title="五、向量化计算"></a>五、向量化计算</h2><h3 id="5-1-算术运算"><a href="#5-1-算术运算" class="headerlink" title="5.1 算术运算"></a>5.1 算术运算</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">arr1 = np.array([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>])</span><br><span class="line">arr2 = np.array([<span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 元素级运算</span></span><br><span class="line"><span class="built_in">print</span>(arr1 + arr2)    <span class="comment"># [3, 4, 5, 6]</span></span><br><span class="line"><span class="built_in">print</span>(arr1 - arr2)    <span class="comment"># [-1, 0, 1, 2]</span></span><br><span class="line"><span class="built_in">print</span>(arr1 * arr2)    <span class="comment"># [2, 4, 6, 8]</span></span><br><span class="line"><span class="built_in">print</span>(arr1 / arr2)    <span class="comment"># [0.5, 1.0, 1.5, 2.0]</span></span><br><span class="line"><span class="built_in">print</span>(arr1 // arr2)   <span class="comment"># [0, 1, 1, 2] 整除</span></span><br><span class="line"><span class="built_in">print</span>(arr1 ** <span class="number">2</span>)      <span class="comment"># [1, 4, 9, 16] 幂</span></span><br><span class="line"><span class="built_in">print</span>(arr1 % <span class="number">2</span>)       <span class="comment"># [1, 0, 1, 0] 取余</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 数学函数</span></span><br><span class="line">arr = np.array([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>])</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(np.sqrt(arr))      <span class="comment"># 平方根</span></span><br><span class="line"><span class="built_in">print</span>(np.exp(arr))       <span class="comment"># e 的幂</span></span><br><span class="line"><span class="built_in">print</span>(np.log(arr))       <span class="comment"># 自然对数</span></span><br><span class="line"><span class="built_in">print</span>(np.log10(arr))     <span class="comment"># 常用对数</span></span><br><span class="line"><span class="built_in">print</span>(np.sin(arr))       <span class="comment"># 正弦</span></span><br><span class="line"><span class="built_in">print</span>(np.cos(arr))       <span class="comment"># 余弦</span></span><br><span class="line"><span class="built_in">print</span>(np.<span class="built_in">abs</span>(arr))       <span class="comment"># 绝对值</span></span><br><span class="line"><span class="built_in">print</span>(np.ceil(arr/<span class="number">2</span>))    <span class="comment"># 向上取整</span></span><br><span class="line"><span class="built_in">print</span>(np.floor(arr/<span class="number">2</span>))   <span class="comment"># 向下取整</span></span><br><span class="line"><span class="built_in">print</span>(np.<span class="built_in">round</span>(arr/<span class="number">2</span>))   <span class="comment"># 四舍五入</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 提醒自己：</span></span><br><span class="line"><span class="comment"># - 向量化运算比循环快得多</span></span><br><span class="line"><span class="comment"># - 避免使用 for 循环处理数组</span></span><br></pre></td></tr></table></figure>

<h3 id="5-2-聚合函数"><a href="#5-2-聚合函数" class="headerlink" title="5.2 聚合函数"></a>5.2 聚合函数</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">arr = np.array([[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], [<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>]])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 全局聚合</span></span><br><span class="line"><span class="built_in">print</span>(arr.<span class="built_in">sum</span>())        <span class="comment"># 21 总和</span></span><br><span class="line"><span class="built_in">print</span>(arr.mean())       <span class="comment"># 3.5 平均值</span></span><br><span class="line"><span class="built_in">print</span>(arr.std())        <span class="comment"># 标准差</span></span><br><span class="line"><span class="built_in">print</span>(arr.var())        <span class="comment"># 方差</span></span><br><span class="line"><span class="built_in">print</span>(arr.<span class="built_in">min</span>())        <span class="comment"># 1 最小值</span></span><br><span class="line"><span class="built_in">print</span>(arr.<span class="built_in">max</span>())        <span class="comment"># 6 最大值</span></span><br><span class="line"><span class="built_in">print</span>(arr.argmin())     <span class="comment"># 0 最小值索引</span></span><br><span class="line"><span class="built_in">print</span>(arr.argmax())     <span class="comment"># 5 最大值索引</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 按轴聚合</span></span><br><span class="line"><span class="built_in">print</span>(arr.<span class="built_in">sum</span>(axis=<span class="number">0</span>))   <span class="comment"># [5, 7, 9] 每列求和</span></span><br><span class="line"><span class="built_in">print</span>(arr.<span class="built_in">sum</span>(axis=<span class="number">1</span>))   <span class="comment"># [6, 15] 每行求和</span></span><br><span class="line"><span class="built_in">print</span>(arr.mean(axis=<span class="number">0</span>))  <span class="comment"># [2.5, 3.5, 4.5] 每列平均</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 累积运算</span></span><br><span class="line"><span class="built_in">print</span>(arr.cumsum())      <span class="comment"># 累积和</span></span><br><span class="line"><span class="built_in">print</span>(arr.cumprod())     <span class="comment"># 累积积</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 提醒自己：</span></span><br><span class="line"><span class="comment"># - axis=0 按列（跨行），axis=1 按行（跨列）</span></span><br><span class="line"><span class="comment"># - 记住：axis 指的是&quot;沿着哪个轴操作&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="5-3-排序"><a href="#5-3-排序" class="headerlink" title="5.3 排序"></a>5.3 排序</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">arr = np.array([<span class="number">3</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">9</span>, <span class="number">2</span>, <span class="number">6</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 排序</span></span><br><span class="line">sorted_arr = np.sort(arr)  <span class="comment"># [1, 1, 2, 3, 4, 5, 6, 9]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 排序索引</span></span><br><span class="line">indices = np.argsort(arr)  <span class="comment"># 排序后的索引</span></span><br><span class="line"><span class="comment"># [1, 3, 6, 0, 2, 4, 7, 5]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 分区（部分排序）</span></span><br><span class="line">partitioned = np.partition(arr, <span class="number">3</span>)  <span class="comment"># 前 3 个是最小的</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 二维数组排序</span></span><br><span class="line">arr2d = np.array([[<span class="number">3</span>, <span class="number">1</span>, <span class="number">4</span>], [<span class="number">1</span>, <span class="number">5</span>, <span class="number">9</span>]])</span><br><span class="line"><span class="built_in">print</span>(np.sort(arr2d, axis=<span class="number">1</span>))  <span class="comment"># 每行排序</span></span><br><span class="line"><span class="built_in">print</span>(np.sort(arr2d, axis=<span class="number">0</span>))  <span class="comment"># 每列排序</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 提醒自己：</span></span><br><span class="line"><span class="comment"># - np.sort 返回新数组</span></span><br><span class="line"><span class="comment"># - arr.sort() 原地排序</span></span><br></pre></td></tr></table></figure>

<h2 id="六、广播机制"><a href="#六、广播机制" class="headerlink" title="六、广播机制"></a>六、广播机制</h2><h3 id="6-1-广播规则"><a href="#6-1-广播规则" class="headerlink" title="6.1 广播规则"></a>6.1 广播规则</h3><p>广播（Broadcasting）允许不同形状的数组进行运算。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 规则 1：标量与数组</span></span><br><span class="line">arr = np.array([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>])</span><br><span class="line"><span class="built_in">print</span>(arr + <span class="number">5</span>)  <span class="comment"># [6, 7, 8]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 规则 2：形状兼容</span></span><br><span class="line">arr1 = np.array([[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], [<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>]])  <span class="comment"># (2, 3)</span></span><br><span class="line">arr2 = np.array([<span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>])             <span class="comment"># (3,)</span></span><br><span class="line"><span class="built_in">print</span>(arr1 + arr2)</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">[[11, 22, 33],</span></span><br><span class="line"><span class="string"> [14, 24, 34]]</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 规则 3：多维广播</span></span><br><span class="line">arr1 = np.array([[<span class="number">1</span>], [<span class="number">2</span>], [<span class="number">3</span>]])  <span class="comment"># (3, 1)</span></span><br><span class="line">arr2 = np.array([<span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>])     <span class="comment"># (3,)</span></span><br><span class="line"><span class="built_in">print</span>(arr1 + arr2)</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">[[11, 21, 31],</span></span><br><span class="line"><span class="string"> [12, 22, 32],</span></span><br><span class="line"><span class="string"> [13, 23, 33]]</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 广播条件：</span></span><br><span class="line"><span class="comment"># 1. 维度相同或其中一个为 1</span></span><br><span class="line"><span class="comment"># 2. 从后向前比较维度，每个维度要么相等，要么其中一个为 1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 提醒自己：</span></span><br><span class="line"><span class="comment"># - 广播可以节省内存（不需要实际复制数据）</span></span><br><span class="line"><span class="comment"># - 不兼容的形状会报错</span></span><br></pre></td></tr></table></figure>

<h3 id="6-2-广播示例"><a href="#6-2-广播示例" class="headerlink" title="6.2 广播示例"></a>6.2 广播示例</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 标准化数据</span></span><br><span class="line">data = np.random.randn(<span class="number">100</span>, <span class="number">5</span>)  <span class="comment"># 100 个样本，5 个特征</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 每列标准化（减去均值，除以标准差）</span></span><br><span class="line">mean = data.mean(axis=<span class="number">0</span>)  <span class="comment"># (5,)</span></span><br><span class="line">std = data.std(axis=<span class="number">0</span>)    <span class="comment"># (5,)</span></span><br><span class="line">standardized = (data - mean) / std</span><br><span class="line"></span><br><span class="line"><span class="comment"># 计算距离</span></span><br><span class="line">points = np.array([[<span class="number">1</span>, <span class="number">2</span>], [<span class="number">3</span>, <span class="number">4</span>], [<span class="number">5</span>, <span class="number">6</span>]])  <span class="comment"># (3, 2)</span></span><br><span class="line">origin = np.array([<span class="number">0</span>, <span class="number">0</span>])                    <span class="comment"># (2,)</span></span><br><span class="line">distances = np.sqrt(((points - origin) ** <span class="number">2</span>).<span class="built_in">sum</span>(axis=<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 外积</span></span><br><span class="line">a = np.array([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>])    <span class="comment"># (3,)</span></span><br><span class="line">b = np.array([<span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>, <span class="number">40</span>])  <span class="comment"># (4,)</span></span><br><span class="line">outer = a[:, np.newaxis] * b  <span class="comment"># (3, 4)</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">[[10, 20, 30, 40],</span></span><br><span class="line"><span class="string"> [20, 40, 60, 80],</span></span><br><span class="line"><span class="string"> [30, 60, 90, 120]]</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="七、线性代数"><a href="#七、线性代数" class="headerlink" title="七、线性代数"></a>七、线性代数</h2><h3 id="7-1-矩阵运算"><a href="#7-1-矩阵运算" class="headerlink" title="7.1 矩阵运算"></a>7.1 矩阵运算</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">A = np.array([[<span class="number">1</span>, <span class="number">2</span>], [<span class="number">3</span>, <span class="number">4</span>]])</span><br><span class="line">B = np.array([[<span class="number">5</span>, <span class="number">6</span>], [<span class="number">7</span>, <span class="number">8</span>]])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 矩阵乘法</span></span><br><span class="line">C = A @ B           <span class="comment"># Python 3.5+</span></span><br><span class="line">C = np.dot(A, B)    <span class="comment"># 点积</span></span><br><span class="line">C = A.dot(B)        <span class="comment"># 方法形式</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 元素级乘法</span></span><br><span class="line">C = A * B</span><br><span class="line"></span><br><span class="line"><span class="comment"># 转置</span></span><br><span class="line">A_T = A.T</span><br><span class="line">A_T = np.transpose(A)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 逆矩阵</span></span><br><span class="line">A_inv = np.linalg.inv(A)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 行列式</span></span><br><span class="line">det = np.linalg.det(A)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 特征值和特征向量</span></span><br><span class="line">eigenvalues, eigenvectors = np.linalg.eig(A)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 解线性方程组 Ax = b</span></span><br><span class="line">A = np.array([[<span class="number">3</span>, <span class="number">1</span>], [<span class="number">1</span>, <span class="number">2</span>]])</span><br><span class="line">b = np.array([<span class="number">9</span>, <span class="number">8</span>])</span><br><span class="line">x = np.linalg.solve(A, b)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 提醒自己去查文档：</span></span><br><span class="line"><span class="comment"># - np.linalg 包含更多线性代数函数</span></span><br></pre></td></tr></table></figure>

<h3 id="7-2-实用示例"><a href="#7-2-实用示例" class="headerlink" title="7.2 实用示例"></a>7.2 实用示例</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 最小二乘法拟合</span></span><br><span class="line">x = np.array([<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>])</span><br><span class="line">y = np.array([<span class="number">0</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">8</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 拟合 y = ax + b</span></span><br><span class="line">A = np.vstack([x, np.ones(<span class="built_in">len</span>(x))]).T</span><br><span class="line">a, b = np.linalg.lstsq(A, y, rcond=<span class="literal">None</span>)[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 协方差矩阵</span></span><br><span class="line">data = np.random.randn(<span class="number">100</span>, <span class="number">5</span>)</span><br><span class="line">cov_matrix = np.cov(data.T)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 相关系数矩阵</span></span><br><span class="line">corr_matrix = np.corrcoef(data.T)</span><br></pre></td></tr></table></figure>

<h2 id="八、文件操作"><a href="#八、文件操作" class="headerlink" title="八、文件操作"></a>八、文件操作</h2><h3 id="8-1-NumPy-文件读写"><a href="#8-1-NumPy-文件读写" class="headerlink" title="8.1 NumPy 文件读写"></a>8.1 NumPy 文件读写</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 保存为 npy 格式</span></span><br><span class="line">arr = np.array([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>])</span><br><span class="line">np.save(<span class="string">&#x27;arr.npy&#x27;</span>, arr)</span><br><span class="line">loaded = np.load(<span class="string">&#x27;arr.npy&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 保存多个数组</span></span><br><span class="line">np.savez(<span class="string">&#x27;arrays.npz&#x27;</span>, a=arr1, b=arr2)</span><br><span class="line">data = np.load(<span class="string">&#x27;arrays.npz&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(data[<span class="string">&#x27;a&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 保存为文本</span></span><br><span class="line">np.savetxt(<span class="string">&#x27;arr.txt&#x27;</span>, arr, fmt=<span class="string">&#x27;%.2f&#x27;</span>, delimiter=<span class="string">&#x27;,&#x27;</span>)</span><br><span class="line">loaded = np.loadtxt(<span class="string">&#x27;arr.txt&#x27;</span>, delimiter=<span class="string">&#x27;,&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># CSV 文件</span></span><br><span class="line">data = np.genfromtxt(<span class="string">&#x27;data.csv&#x27;</span>, delimiter=<span class="string">&#x27;,&#x27;</span>, skip_header=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 提醒自己：</span></span><br><span class="line"><span class="comment"># - npy 是 NumPy 专用格式，速度快</span></span><br><span class="line"><span class="comment"># - txt/csv 可读性好，但慢且占用空间大</span></span><br></pre></td></tr></table></figure>

<h2 id="九、性能优化建议"><a href="#九、性能优化建议" class="headerlink" title="九、性能优化建议"></a>九、性能优化建议</h2><blockquote>
<p><strong>提醒自己</strong>：</p>
<ol>
<li><strong>使用向量化</strong>：避免 Python 循环</li>
<li><strong>利用广播</strong>：减少内存复制</li>
<li><strong>选择合适的数据类型</strong>：float32 比 float64 快且省内存</li>
<li><strong>原地操作</strong>：使用 out 参数减少内存分配</li>
<li><strong>使用 views 而非 copies</strong>：切片时注意</li>
</ol>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 性能对比</span></span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="comment"># 循环方式（慢）</span></span><br><span class="line">arr = np.random.randn(<span class="number">1000000</span>)</span><br><span class="line">start = time.time()</span><br><span class="line">result = []</span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> arr:</span><br><span class="line">    result.append(x ** <span class="number">2</span>)</span><br><span class="line"><span class="built_in">print</span>(time.time() - start)  <span class="comment"># ~0.5 秒</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 向量化（快）</span></span><br><span class="line">start = time.time()</span><br><span class="line">result = arr ** <span class="number">2</span></span><br><span class="line"><span class="built_in">print</span>(time.time() - start)  <span class="comment"># ~0.001 秒</span></span><br></pre></td></tr></table></figure>

<h2 id="十、练习"><a href="#十、练习" class="headerlink" title="十、练习"></a>十、练习</h2><ol>
<li>创建一个 5x5 的随机矩阵，计算每行每列的平均值</li>
<li>使用布尔索引找出数组中所有大于均值的元素</li>
<li>实现矩阵乘法（不使用@ 或 dot）</li>
<li>使用广播计算两组点之间的欧氏距离</li>
<li>生成 1000 个正态分布随机数，计算均值和标准差</li>
</ol>
<hr>
<p><strong>上一篇</strong>：<a href="/2026/02/24/Python-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B%EF%BC%88%E4%B8%89%EF%BC%89%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86/">Python 基础教程（三）：异常处理</a></p>
<p><strong>下一篇</strong>：[Python 数据科学（二）：Pandas 数据处理](&#x2F;2026&#x2F;02&#x2F;24&#x2F;Python-数据科学（二）Pandas 数据处理&#x2F;)</p>
<p><strong>参考资源</strong>：</p>
<ul>
<li><a href="https://numpy.org/doc/stable/">NumPy 官方文档</a></li>
<li><a href="https://numpy.org/doc/stable/user/quickstart.html">NumPy 快速入门</a></li>
<li><a href="https://github.com/rougier/numpy-100">100 道 NumPy 练习题</a></li>
</ul>
]]></content>
      <categories>
        <category>Python 数据科学</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>NumPy</tag>
        <tag>数据科学</tag>
        <tag>数值计算</tag>
      </tags>
  </entry>
  <entry>
    <title>Python 数据科学（三）PyArrow 高性能数据操作</title>
    <url>/2026/02/24/Python%20%E6%95%B0%E6%8D%AE%E7%A7%91%E5%AD%A6%EF%BC%88%E4%B8%89%EF%BC%89PyArrow%20%E9%AB%98%E6%80%A7%E8%83%BD%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C/</url>
    <content><![CDATA[<h1 id="Python-数据科学（三）PyArrow-高性能数据操作"><a href="#Python-数据科学（三）PyArrow-高性能数据操作" class="headerlink" title="Python 数据科学（三）PyArrow 高性能数据操作"></a>Python 数据科学（三）PyArrow 高性能数据操作</h1><p>PyArrow 是一个高性能的数据处理库，提供列式内存格式和快速的数据 I&#x2F;O。本篇将介绍 PyArrow 的核心功能和使用技巧。</p>
<h2 id="一、PyArrow-简介"><a href="#一、PyArrow-简介" class="headerlink" title="一、PyArrow 简介"></a>一、PyArrow 简介</h2><h3 id="1-1-为什么使用-PyArrow？"><a href="#1-1-为什么使用-PyArrow？" class="headerlink" title="1.1 为什么使用 PyArrow？"></a>1.1 为什么使用 PyArrow？</h3><ul>
<li><strong>高性能</strong>：列式存储，比 Pandas 快数倍到数十倍</li>
<li><strong>零拷贝</strong>：与 Pandas、NumPy 无缝集成，无需数据复制</li>
<li><strong>跨语言</strong>：支持 Python、C++、Java、R 等</li>
<li><strong>大文件处理</strong>：支持流式处理超大文件</li>
<li><strong>现代格式</strong>：Parquet、Feather 等高效格式支持</li>
</ul>
<h3 id="1-2-安装与导入"><a href="#1-2-安装与导入" class="headerlink" title="1.2 安装与导入"></a>1.2 安装与导入</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pip install pyarrow</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pyarrow <span class="keyword">as</span> pa</span><br><span class="line"><span class="keyword">import</span> pyarrow.parquet <span class="keyword">as</span> pq</span><br><span class="line"><span class="keyword">import</span> pyarrow.csv <span class="keyword">as</span> csv</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看版本</span></span><br><span class="line"><span class="built_in">print</span>(pa.__version__)</span><br></pre></td></tr></table></figure>

<h2 id="二、PyArrow-数据结构"><a href="#二、PyArrow-数据结构" class="headerlink" title="二、PyArrow 数据结构"></a>二、PyArrow 数据结构</h2><h3 id="2-1-Table（表格）"><a href="#2-1-Table（表格）" class="headerlink" title="2.1 Table（表格）"></a>2.1 Table（表格）</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pyarrow <span class="keyword">as</span> pa</span><br><span class="line"></span><br><span class="line"><span class="comment"># 从字典创建</span></span><br><span class="line">table = pa.table(&#123;</span><br><span class="line">    <span class="string">&#x27;name&#x27;</span>: [<span class="string">&#x27;张三&#x27;</span>, <span class="string">&#x27;李四&#x27;</span>, <span class="string">&#x27;王五&#x27;</span>],</span><br><span class="line">    <span class="string">&#x27;age&#x27;</span>: [<span class="number">25</span>, <span class="number">30</span>, <span class="number">35</span>],</span><br><span class="line">    <span class="string">&#x27;city&#x27;</span>: [<span class="string">&#x27;北京&#x27;</span>, <span class="string">&#x27;上海&#x27;</span>, <span class="string">&#x27;广州&#x27;</span>]</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 从 Pandas DataFrame 创建（零拷贝）</span></span><br><span class="line">df = pd.DataFrame(&#123;</span><br><span class="line">    <span class="string">&#x27;name&#x27;</span>: [<span class="string">&#x27;张三&#x27;</span>, <span class="string">&#x27;李四&#x27;</span>],</span><br><span class="line">    <span class="string">&#x27;age&#x27;</span>: [<span class="number">25</span>, <span class="number">30</span>]</span><br><span class="line">&#125;)</span><br><span class="line">table = pa.Table.from_pandas(df)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 转回 Pandas（零拷贝）</span></span><br><span class="line">df = table.to_pandas()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 提醒自己：PyArrow Table 与 Pandas DataFrame 互转非常高效</span></span><br></pre></td></tr></table></figure>

<h3 id="2-2-数据类型"><a href="#2-2-数据类型" class="headerlink" title="2.2 数据类型"></a>2.2 数据类型</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 基本类型</span></span><br><span class="line">pa.int8()      <span class="comment"># 8 位整数</span></span><br><span class="line">pa.int32()     <span class="comment"># 32 位整数</span></span><br><span class="line">pa.int64()     <span class="comment"># 64 位整数</span></span><br><span class="line">pa.float32()   <span class="comment"># 单精度浮点</span></span><br><span class="line">pa.float64()   <span class="comment"># 双精度浮点</span></span><br><span class="line">pa.string()    <span class="comment"># 字符串</span></span><br><span class="line">pa.bool_()     <span class="comment"># 布尔值</span></span><br><span class="line">pa.timestamp() <span class="comment"># 时间戳</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 复杂类型</span></span><br><span class="line">pa.list_(pa.int32())           <span class="comment"># 列表</span></span><br><span class="line">pa.struct([(<span class="string">&#x27;x&#x27;</span>, pa.int32()), (<span class="string">&#x27;y&#x27;</span>, pa.int32())])  <span class="comment"># 结构体</span></span><br><span class="line">pa.dictionary(pa.int32(), pa.string())  <span class="comment"># 字典编码</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建带类型的数组</span></span><br><span class="line">arr = pa.array([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], <span class="built_in">type</span>=pa.int32())</span><br></pre></td></tr></table></figure>

<h3 id="2-3-Array-和-ChunkedArray"><a href="#2-3-Array-和-ChunkedArray" class="headerlink" title="2.3 Array 和 ChunkedArray"></a>2.3 Array 和 ChunkedArray</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Array（连续数组）</span></span><br><span class="line">arr = pa.array([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>])</span><br><span class="line">arr = pa.array([<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>])</span><br><span class="line">arr = pa.array([<span class="literal">True</span>, <span class="literal">False</span>, <span class="literal">True</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 带空值的数组</span></span><br><span class="line">arr = pa.array([<span class="number">1</span>, <span class="literal">None</span>, <span class="number">3</span>, <span class="literal">None</span>, <span class="number">5</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># ChunkedArray（分块数组，适合大数据）</span></span><br><span class="line">chunk1 = pa.array([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>])</span><br><span class="line">chunk2 = pa.array([<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>])</span><br><span class="line">chunked = pa.chunked_array([chunk1, chunk2])</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(chunked))      <span class="comment"># 6</span></span><br><span class="line"><span class="built_in">print</span>(chunked.num_chunks)  <span class="comment"># 2</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 提醒自己：</span></span><br><span class="line"><span class="comment"># - Array 是连续内存</span></span><br><span class="line"><span class="comment"># - ChunkedArray 由多个 Array 组成，适合流式处理</span></span><br></pre></td></tr></table></figure>

<h2 id="三、数据-I-O"><a href="#三、数据-I-O" class="headerlink" title="三、数据 I&#x2F;O"></a>三、数据 I&#x2F;O</h2><h3 id="3-1-Parquet-文件读写"><a href="#3-1-Parquet-文件读写" class="headerlink" title="3.1 Parquet 文件读写"></a>3.1 Parquet 文件读写</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pyarrow.parquet <span class="keyword">as</span> pq</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建示例数据</span></span><br><span class="line">table = pa.table(&#123;</span><br><span class="line">    <span class="string">&#x27;id&#x27;</span>: <span class="built_in">range</span>(<span class="number">1000000</span>),</span><br><span class="line">    <span class="string">&#x27;value&#x27;</span>: [i * <span class="number">2</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1000000</span>)],</span><br><span class="line">    <span class="string">&#x27;category&#x27;</span>: [<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;C&#x27;</span>] * <span class="number">333333</span> + [<span class="string">&#x27;A&#x27;</span>]</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 写入 Parquet</span></span><br><span class="line">pq.write_table(table, <span class="string">&#x27;data.parquet&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 写入带压缩</span></span><br><span class="line">pq.write_table(table, <span class="string">&#x27;data.parquet&#x27;</span>, compression=<span class="string">&#x27;gzip&#x27;</span>)</span><br><span class="line">pq.write_table(table, <span class="string">&#x27;data.parquet&#x27;</span>, compression=<span class="string">&#x27;snappy&#x27;</span>)  <span class="comment"># 更快</span></span><br><span class="line">pq.write_table(table, <span class="string">&#x27;data.parquet&#x27;</span>, compression=<span class="string">&#x27;brotli&#x27;</span>)  <span class="comment"># 更高压缩率</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 读取 Parquet</span></span><br><span class="line">table = pq.read_table(<span class="string">&#x27;data.parquet&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 读取部分列</span></span><br><span class="line">table = pq.read_table(<span class="string">&#x27;data.parquet&#x27;</span>, columns=[<span class="string">&#x27;id&#x27;</span>, <span class="string">&#x27;value&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 读取部分行（行组过滤）</span></span><br><span class="line">parquet_file = pq.ParquetFile(<span class="string">&#x27;data.parquet&#x27;</span>)</span><br><span class="line">table = parquet_file.read_row_group(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 元数据</span></span><br><span class="line">meta = parquet_file.metadata</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;行数：<span class="subst">&#123;meta.num_rows&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;列数：<span class="subst">&#123;meta.num_columns&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;行组数：<span class="subst">&#123;meta.num_row_groups&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 分区读取（适合大数据集）</span></span><br><span class="line"><span class="comment"># 数据按年/月分区存储</span></span><br><span class="line"><span class="comment"># data/year=2024/month=01/data.parquet</span></span><br><span class="line"><span class="comment"># data/year=2024/month=02/data.parquet</span></span><br><span class="line">dataset = pq.read_table(<span class="string">&#x27;data/&#x27;</span>, filters=[(<span class="string">&#x27;year&#x27;</span>, <span class="string">&#x27;=&#x27;</span>, <span class="number">2024</span>), (<span class="string">&#x27;month&#x27;</span>, <span class="string">&#x27;&gt;&#x27;</span>, <span class="number">6</span>)])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 提醒自己：</span></span><br><span class="line"><span class="comment"># - Parquet 是列式存储，读取特定列非常快</span></span><br><span class="line"><span class="comment"># - 压缩可以显著减小文件大小</span></span><br><span class="line"><span class="comment"># - 分区查询可以只读取需要的数据</span></span><br></pre></td></tr></table></figure>

<h3 id="3-2-CSV-文件读写"><a href="#3-2-CSV-文件读写" class="headerlink" title="3.2 CSV 文件读写"></a>3.2 CSV 文件读写</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pyarrow.csv <span class="keyword">as</span> csv</span><br><span class="line"></span><br><span class="line"><span class="comment"># 读取 CSV</span></span><br><span class="line">table = csv.read_csv(<span class="string">&#x27;data.csv&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 读取时指定类型</span></span><br><span class="line">table = csv.read_csv(<span class="string">&#x27;data.csv&#x27;</span>,</span><br><span class="line">    convert_options=csv.ConvertOptions(</span><br><span class="line">        column_types=&#123;</span><br><span class="line">            <span class="string">&#x27;id&#x27;</span>: pa.int32(),</span><br><span class="line">            <span class="string">&#x27;value&#x27;</span>: pa.float64(),</span><br><span class="line">            <span class="string">&#x27;category&#x27;</span>: pa.string()</span><br><span class="line">        &#125;</span><br><span class="line">    )</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 读取部分列</span></span><br><span class="line">table = csv.read_csv(<span class="string">&#x27;data.csv&#x27;</span>,</span><br><span class="line">    usecols=[<span class="string">&#x27;id&#x27;</span>, <span class="string">&#x27;value&#x27;</span>]</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 写入 CSV</span></span><br><span class="line">csv.write_csv(table, <span class="string">&#x27;output.csv&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 流式读取大 CSV（内存友好）</span></span><br><span class="line">reader = csv.open_csv(<span class="string">&#x27;large_file.csv&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> batch <span class="keyword">in</span> reader:</span><br><span class="line">    <span class="comment"># batch 是 RecordBatch，逐个处理</span></span><br><span class="line">    process(batch)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 提醒自己：</span></span><br><span class="line"><span class="comment"># - PyArrow 读取 CSV 比 Pandas 快 5-10 倍</span></span><br><span class="line"><span class="comment"># - 流式读取适合处理超大文件</span></span><br></pre></td></tr></table></figure>

<h3 id="3-3-Feather-格式"><a href="#3-3-Feather-格式" class="headerlink" title="3.3 Feather 格式"></a>3.3 Feather 格式</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Feather 是超快的中间存储格式</span></span><br><span class="line"><span class="keyword">import</span> pyarrow.feather <span class="keyword">as</span> feather</span><br><span class="line"></span><br><span class="line"><span class="comment"># 写入</span></span><br><span class="line">feather.write_feather(table, <span class="string">&#x27;data.feather&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 读取</span></span><br><span class="line">table = feather.read_table(<span class="string">&#x27;data.feather&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 与 Pandas 互转</span></span><br><span class="line">df = pd.DataFrame(&#123;<span class="string">&#x27;a&#x27;</span>: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]&#125;)</span><br><span class="line">df.to_feather(<span class="string">&#x27;data.feather&#x27;</span>)</span><br><span class="line">df = pd.read_feather(<span class="string">&#x27;data.feather&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 提醒自己：</span></span><br><span class="line"><span class="comment"># - Feather 比 Parquet 更快，但压缩率较低</span></span><br><span class="line"><span class="comment"># - 适合临时存储和进程间数据传输</span></span><br></pre></td></tr></table></figure>

<h3 id="3-4-IPC-格式（进程间通信）"><a href="#3-4-IPC-格式（进程间通信）" class="headerlink" title="3.4 IPC 格式（进程间通信）"></a>3.4 IPC 格式（进程间通信）</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 写入</span></span><br><span class="line"><span class="keyword">with</span> pa.ipc.new_file(<span class="string">&#x27;data.arrow&#x27;</span>, table.schema) <span class="keyword">as</span> writer:</span><br><span class="line">    writer.write_table(table)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 读取</span></span><br><span class="line"><span class="keyword">with</span> pa.ipc.open_file(<span class="string">&#x27;data.arrow&#x27;</span>) <span class="keyword">as</span> reader:</span><br><span class="line">    table = reader.read_all()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 流式写入（多个 RecordBatch）</span></span><br><span class="line"><span class="keyword">with</span> pa.ipc.new_stream(<span class="string">&#x27;data.arrow&#x27;</span>, table.schema) <span class="keyword">as</span> writer:</span><br><span class="line">    <span class="keyword">for</span> batch <span class="keyword">in</span> table.to_batches():</span><br><span class="line">        writer.write_batch(batch)</span><br></pre></td></tr></table></figure>

<h2 id="四、数据操作"><a href="#四、数据操作" class="headerlink" title="四、数据操作"></a>四、数据操作</h2><h3 id="4-1-列操作"><a href="#4-1-列操作" class="headerlink" title="4.1 列操作"></a>4.1 列操作</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">table = pa.table(&#123;</span><br><span class="line">    <span class="string">&#x27;a&#x27;</span>: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>],</span><br><span class="line">    <span class="string">&#x27;b&#x27;</span>: [<span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>, <span class="number">40</span>, <span class="number">50</span>],</span><br><span class="line">    <span class="string">&#x27;c&#x27;</span>: [<span class="string">&#x27;x&#x27;</span>, <span class="string">&#x27;y&#x27;</span>, <span class="string">&#x27;z&#x27;</span>, <span class="string">&#x27;w&#x27;</span>, <span class="string">&#x27;v&#x27;</span>]</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 选择列</span></span><br><span class="line">col = table[<span class="string">&#x27;a&#x27;</span>]</span><br><span class="line">cols = table.select([<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加列</span></span><br><span class="line">new_col = pa.array([<span class="number">100</span>, <span class="number">200</span>, <span class="number">300</span>, <span class="number">400</span>, <span class="number">500</span>])</span><br><span class="line">table = table.append_column(<span class="string">&#x27;d&#x27;</span>, new_col)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重命名列</span></span><br><span class="line">table = table.rename_columns([<span class="string">&#x27;col1&#x27;</span>, <span class="string">&#x27;col2&#x27;</span>, <span class="string">&#x27;col3&#x27;</span>, <span class="string">&#x27;col4&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除列</span></span><br><span class="line">table = table.drop([<span class="string">&#x27;c&#x27;</span>])</span><br><span class="line">table = table.remove_column(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 替换列</span></span><br><span class="line">table = table.set_column(<span class="number">0</span>, <span class="string">&#x27;a&#x27;</span>, pa.array([<span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>]))</span><br></pre></td></tr></table></figure>

<h3 id="4-2-行操作"><a href="#4-2-行操作" class="headerlink" title="4.2 行操作"></a>4.2 行操作</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 切片</span></span><br><span class="line">subset = table.<span class="built_in">slice</span>(<span class="number">0</span>, <span class="number">3</span>)  <span class="comment"># 前三行</span></span><br><span class="line">subset = table.<span class="built_in">slice</span>(-<span class="number">2</span>)    <span class="comment"># 最后两行</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 过滤（使用表达式）</span></span><br><span class="line"><span class="keyword">import</span> pyarrow.compute <span class="keyword">as</span> pc</span><br><span class="line"></span><br><span class="line"><span class="comment"># 条件过滤</span></span><br><span class="line">mask = pc.greater(table[<span class="string">&#x27;a&#x27;</span>], <span class="number">2</span>)  <span class="comment"># a &gt; 2</span></span><br><span class="line">filtered = table.<span class="built_in">filter</span>(mask)</span><br><span class="line"></span><br><span class="line">mask = pc.equal(table[<span class="string">&#x27;c&#x27;</span>], <span class="string">&#x27;x&#x27;</span>)  <span class="comment"># c == &#x27;x&#x27;</span></span><br><span class="line">filtered = table.<span class="built_in">filter</span>(mask)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 多条件</span></span><br><span class="line">mask1 = pc.greater(table[<span class="string">&#x27;a&#x27;</span>], <span class="number">2</span>)</span><br><span class="line">mask2 = pc.less(table[<span class="string">&#x27;b&#x27;</span>], <span class="number">40</span>)</span><br><span class="line">combined = pc.and_(mask1, mask2)</span><br><span class="line">filtered = table.<span class="built_in">filter</span>(combined)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 排序</span></span><br><span class="line">sorted_table = table.sort_by(<span class="string">&#x27;a&#x27;</span>)           <span class="comment"># 升序</span></span><br><span class="line">sorted_table = table.sort_by([(<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;descending&#x27;</span>)])  <span class="comment"># 降序</span></span><br><span class="line">sorted_table = table.sort_by([(<span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;ascending&#x27;</span>), (<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;descending&#x27;</span>)])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 去重</span></span><br><span class="line">unique_table = table.drop_duplicates()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 提醒自己：</span></span><br><span class="line"><span class="comment"># - pc 是 pyarrow.compute 的缩写</span></span><br><span class="line"><span class="comment"># - 过滤操作返回新表，不修改原表</span></span><br></pre></td></tr></table></figure>

<h3 id="4-3-计算函数（compute）"><a href="#4-3-计算函数（compute）" class="headerlink" title="4.3 计算函数（compute）"></a>4.3 计算函数（compute）</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pyarrow.compute <span class="keyword">as</span> pc</span><br><span class="line"></span><br><span class="line">arr = pa.array([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 算术运算</span></span><br><span class="line"><span class="built_in">print</span>(pc.add(arr, <span class="number">10</span>))        <span class="comment"># [11, 12, 13, 14, 15]</span></span><br><span class="line"><span class="built_in">print</span>(pc.subtract(arr, <span class="number">1</span>))    <span class="comment"># [2, 3, 4, 5, 6]</span></span><br><span class="line"><span class="built_in">print</span>(pc.multiply(arr, <span class="number">2</span>))    <span class="comment"># [2, 4, 6, 8, 10]</span></span><br><span class="line"><span class="built_in">print</span>(pc.divide(arr, <span class="number">2</span>))      <span class="comment"># [0.5, 1.0, 1.5, 2.0, 2.5]</span></span><br><span class="line"><span class="built_in">print</span>.pc.power(arr, <span class="number">2</span>))       <span class="comment"># [1, 4, 9, 16, 25]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 比较运算</span></span><br><span class="line"><span class="built_in">print</span>(pc.greater(arr, <span class="number">3</span>))     <span class="comment"># [False, False, False, True, True]</span></span><br><span class="line"><span class="built_in">print</span>(pc.less(arr, <span class="number">3</span>))        <span class="comment"># [True, True, False, False, False]</span></span><br><span class="line"><span class="built_in">print</span>(pc.equal(arr, <span class="number">3</span>))       <span class="comment"># [False, False, True, False, False]</span></span><br><span class="line"><span class="built_in">print</span>(pc.greater_equal(arr, <span class="number">3</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 聚合函数</span></span><br><span class="line"><span class="built_in">print</span>(pc.<span class="built_in">sum</span>(arr))            <span class="comment"># 15</span></span><br><span class="line"><span class="built_in">print</span>(pc.mean(arr))           <span class="comment"># 3.0</span></span><br><span class="line"><span class="built_in">print</span>(pc.<span class="built_in">min</span>(arr))            <span class="comment"># 1</span></span><br><span class="line"><span class="built_in">print</span>(pc.<span class="built_in">max</span>(arr))            <span class="comment"># 5</span></span><br><span class="line"><span class="built_in">print</span>(pc.count(arr))          <span class="comment"># 5</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 字符串函数</span></span><br><span class="line">str_arr = pa.array([<span class="string">&#x27;hello&#x27;</span>, <span class="string">&#x27;WORLD&#x27;</span>, <span class="string">&#x27;PyArrow&#x27;</span>])</span><br><span class="line"><span class="built_in">print</span>(pc.ascii_upper(str_arr))    <span class="comment"># [&#x27;HELLO&#x27;, &#x27;WORLD&#x27;, &#x27;PYARROW&#x27;]</span></span><br><span class="line"><span class="built_in">print</span>(pc.ascii_lower(str_arr))    <span class="comment"># [&#x27;hello&#x27;, &#x27;world&#x27;, &#x27;pyarrow&#x27;]</span></span><br><span class="line"><span class="built_in">print</span>(pc.utf8_length(str_arr))    <span class="comment"># [5, 5, 8]</span></span><br><span class="line"><span class="built_in">print</span>(pc.utf8_slice_codeunits(str_arr, <span class="number">0</span>, <span class="number">3</span>))  <span class="comment"># [&#x27;hel&#x27;, &#x27;WOR&#x27;, &#x27;PyA&#x27;]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 提醒自己：</span></span><br><span class="line"><span class="comment"># - compute 模块提供大量向量化函数</span></span><br><span class="line"><span class="comment"># - 性能优于 Python 循环</span></span><br></pre></td></tr></table></figure>

<h3 id="4-4-连接和合并"><a href="#4-4-连接和合并" class="headerlink" title="4.4 连接和合并"></a>4.4 连接和合并</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">table1 = pa.table(&#123;<span class="string">&#x27;a&#x27;</span>: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], <span class="string">&#x27;b&#x27;</span>: [<span class="string">&#x27;x&#x27;</span>, <span class="string">&#x27;y&#x27;</span>, <span class="string">&#x27;z&#x27;</span>]&#125;)</span><br><span class="line">table2 = pa.table(&#123;<span class="string">&#x27;a&#x27;</span>: [<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>], <span class="string">&#x27;b&#x27;</span>: [<span class="string">&#x27;w&#x27;</span>, <span class="string">&#x27;v&#x27;</span>, <span class="string">&#x27;u&#x27;</span>]&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 垂直连接（concat）</span></span><br><span class="line">combined = pa.concat_tables([table1, table2])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 连接多个表</span></span><br><span class="line">tables = [table1, table2, table3]</span><br><span class="line">combined = pa.concat_tables(tables)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Join（类似 SQL）</span></span><br><span class="line"><span class="comment"># PyArrow 本身不直接支持 join，需要转 Pandas 或用其他方式</span></span><br><span class="line">df1 = table1.to_pandas()</span><br><span class="line">df2 = table2.to_pandas()</span><br><span class="line">merged = df1.merge(df2, on=<span class="string">&#x27;key&#x27;</span>, how=<span class="string">&#x27;left&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="五、与-Pandas-集成"><a href="#五、与-Pandas-集成" class="headerlink" title="五、与 Pandas 集成"></a>五、与 Pandas 集成</h2><h3 id="5-1-数据转换"><a href="#5-1-数据转换" class="headerlink" title="5.1 数据转换"></a>5.1 数据转换</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># PyArrow -&gt; Pandas</span></span><br><span class="line">table = pa.table(&#123;<span class="string">&#x27;a&#x27;</span>: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], <span class="string">&#x27;b&#x27;</span>: [<span class="string">&#x27;x&#x27;</span>, <span class="string">&#x27;y&#x27;</span>, <span class="string">&#x27;z&#x27;</span>]&#125;)</span><br><span class="line">df = table.to_pandas()</span><br><span class="line"></span><br><span class="line"><span class="comment"># Pandas -&gt; PyArrow</span></span><br><span class="line">df = pd.DataFrame(&#123;<span class="string">&#x27;a&#x27;</span>: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], <span class="string">&#x27;b&#x27;</span>: [<span class="string">&#x27;x&#x27;</span>, <span class="string">&#x27;y&#x27;</span>, <span class="string">&#x27;z&#x27;</span>]&#125;)</span><br><span class="line">table = pa.Table.from_pandas(df)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 零拷贝选项</span></span><br><span class="line">table = pa.Table.from_pandas(df, preserve_index=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure>

<h3 id="5-2-使用-PyArrow-作为-Pandas-后端"><a href="#5-2-使用-PyArrow-作为-Pandas-后端" class="headerlink" title="5.2 使用 PyArrow 作为 Pandas 后端"></a>5.2 使用 PyArrow 作为 Pandas 后端</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Pandas 可以使用 PyArrow 作为后端</span></span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line"><span class="comment"># 读取 CSV 时使用 PyArrow 引擎</span></span><br><span class="line">df = pd.read_csv(<span class="string">&#x27;data.csv&#x27;</span>, engine=<span class="string">&#x27;pyarrow&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 读取 Parquet 时使用 PyArrow</span></span><br><span class="line">df = pd.read_parquet(<span class="string">&#x27;data.parquet&#x27;</span>, engine=<span class="string">&#x27;pyarrow&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用 PyArrow 数据类型</span></span><br><span class="line">df = pd.DataFrame(&#123;</span><br><span class="line">    <span class="string">&#x27;a&#x27;</span>: pd.array([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], dtype=<span class="string">&#x27;int32[pyarrow]&#x27;</span>),</span><br><span class="line">    <span class="string">&#x27;b&#x27;</span>: pd.array([<span class="string">&#x27;x&#x27;</span>, <span class="string">&#x27;y&#x27;</span>, <span class="string">&#x27;z&#x27;</span>], dtype=<span class="string">&#x27;string[pyarrow]&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 提醒自己：</span></span><br><span class="line"><span class="comment"># - PyArrow 引擎通常比默认引擎快</span></span><br><span class="line"><span class="comment"># - PyArrow 数据类型可以节省内存</span></span><br></pre></td></tr></table></figure>

<h3 id="5-3-性能对比"><a href="#5-3-性能对比" class="headerlink" title="5.3 性能对比"></a>5.3 性能对比</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> pyarrow <span class="keyword">as</span> pa</span><br><span class="line"><span class="keyword">import</span> pyarrow.parquet <span class="keyword">as</span> pq</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成大数据</span></span><br><span class="line">n = <span class="number">1000000</span></span><br><span class="line">df_pandas = pd.DataFrame(&#123;</span><br><span class="line">    <span class="string">&#x27;id&#x27;</span>: <span class="built_in">range</span>(n),</span><br><span class="line">    <span class="string">&#x27;value&#x27;</span>: np.random.randn(n),</span><br><span class="line">    <span class="string">&#x27;category&#x27;</span>: np.random.choice([<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;C&#x27;</span>], n)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Pandas 读写 CSV</span></span><br><span class="line">start = time.time()</span><br><span class="line">df_pandas.to_csv(<span class="string">&#x27;pandas.csv&#x27;</span>, index=<span class="literal">False</span>)</span><br><span class="line">df_read = pd.read_csv(<span class="string">&#x27;pandas.csv&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Pandas CSV: <span class="subst">&#123;time.time() - start:<span class="number">.2</span>f&#125;</span>s&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># PyArrow 读写 CSV</span></span><br><span class="line">start = time.time()</span><br><span class="line">table = pa.Table.from_pandas(df_pandas)</span><br><span class="line">pa.csv.write_csv(table, <span class="string">&#x27;arrow.csv&#x27;</span>)</span><br><span class="line">table_read = pa.csv.read_csv(<span class="string">&#x27;arrow.csv&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;PyArrow CSV: <span class="subst">&#123;time.time() - start:<span class="number">.2</span>f&#125;</span>s&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Parquet 格式</span></span><br><span class="line">start = time.time()</span><br><span class="line">pq.write_table(table, <span class="string">&#x27;data.parquet&#x27;</span>)</span><br><span class="line">table_read = pq.read_table(<span class="string">&#x27;data.parquet&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Parquet: <span class="subst">&#123;time.time() - start:<span class="number">.2</span>f&#125;</span>s&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 提醒自己：实际测试中 PyArrow 通常快 3-10 倍</span></span><br></pre></td></tr></table></figure>

<h2 id="六、高级特性"><a href="#六、高级特性" class="headerlink" title="六、高级特性"></a>六、高级特性</h2><h3 id="6-1-Dataset-API（大数据集）"><a href="#6-1-Dataset-API（大数据集）" class="headerlink" title="6.1 Dataset API（大数据集）"></a>6.1 Dataset API（大数据集）</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pyarrow.dataset <span class="keyword">import</span> dataset, write_dataset</span><br><span class="line"></span><br><span class="line"><span class="comment"># 读取多个文件</span></span><br><span class="line">ds = dataset(<span class="string">&#x27;data/&#x27;</span>, <span class="built_in">format</span>=<span class="string">&#x27;parquet&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 过滤读取</span></span><br><span class="line">ds = dataset(<span class="string">&#x27;data/&#x27;</span>, <span class="built_in">format</span>=<span class="string">&#x27;parquet&#x27;</span>)</span><br><span class="line">table = ds.to_table(<span class="built_in">filter</span>=pc.greater(pa.field(<span class="string">&#x27;value&#x27;</span>), <span class="number">100</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 分区数据集</span></span><br><span class="line"><span class="comment"># 自动识别 year=/month= 分区结构</span></span><br><span class="line">ds = dataset(<span class="string">&#x27;data/&#x27;</span>, <span class="built_in">format</span>=<span class="string">&#x27;parquet&#x27;</span>, partitioning=<span class="string">&#x27;hive&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 写入分区数据集</span></span><br><span class="line">table = pa.table(&#123;<span class="string">&#x27;a&#x27;</span>: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], <span class="string">&#x27;b&#x27;</span>: [<span class="string">&#x27;x&#x27;</span>, <span class="string">&#x27;y&#x27;</span>, <span class="string">&#x27;z&#x27;</span>]&#125;)</span><br><span class="line">write_dataset(</span><br><span class="line">    table,</span><br><span class="line">    <span class="string">&#x27;output/&#x27;</span>,</span><br><span class="line">    <span class="built_in">format</span>=<span class="string">&#x27;parquet&#x27;</span>,</span><br><span class="line">    partitioning=[<span class="string">&#x27;b&#x27;</span>]  <span class="comment"># 按 b 列分区</span></span><br><span class="line">)</span><br><span class="line"><span class="comment"># 输出：output/b=x/part-0.parquet, output/b=y/part-0.parquet</span></span><br></pre></td></tr></table></figure>

<h3 id="6-2-内存映射（Memory-Map）"><a href="#6-2-内存映射（Memory-Map）" class="headerlink" title="6.2 内存映射（Memory Map）"></a>6.2 内存映射（Memory Map）</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 内存映射读取大文件（不全部加载到内存）</span></span><br><span class="line">mmap = pa.memory_map(<span class="string">&#x27;large_file.parquet&#x27;</span>)</span><br><span class="line">table = pa.ipc.open_file(mmap).read_all()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 提醒自己：内存映射适合处理超大文件，按需加载数据</span></span><br></pre></td></tr></table></figure>

<h3 id="6-3-批处理"><a href="#6-3-批处理" class="headerlink" title="6.3 批处理"></a>6.3 批处理</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 处理大文件时分批处理</span></span><br><span class="line">parquet_file = pq.ParquetFile(<span class="string">&#x27;large.parquet&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> batch <span class="keyword">in</span> parquet_file.iter_batches(batch_size=<span class="number">10000</span>):</span><br><span class="line">    <span class="comment"># 每次处理 10000 行</span></span><br><span class="line">    process(batch)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 批处理聚合</span></span><br><span class="line">total = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> batch <span class="keyword">in</span> parquet_file.iter_batches():</span><br><span class="line">    total += pc.<span class="built_in">sum</span>(batch[<span class="string">&#x27;value&#x27;</span>]).as_py()</span><br></pre></td></tr></table></figure>

<h2 id="七、实用示例"><a href="#七、实用示例" class="headerlink" title="七、实用示例"></a>七、实用示例</h2><h3 id="7-1-数据管道"><a href="#7-1-数据管道" class="headerlink" title="7.1 数据管道"></a>7.1 数据管道</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pyarrow <span class="keyword">as</span> pa</span><br><span class="line"><span class="keyword">import</span> pyarrow.parquet <span class="keyword">as</span> pq</span><br><span class="line"><span class="keyword">import</span> pyarrow.compute <span class="keyword">as</span> pc</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">process_data</span>(<span class="params">input_file, output_file</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;数据处理管道&quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># 读取</span></span><br><span class="line">    table = pq.read_table(input_file)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 过滤</span></span><br><span class="line">    mask = pc.greater(table[<span class="string">&#x27;value&#x27;</span>], <span class="number">0</span>)</span><br><span class="line">    table = table.<span class="built_in">filter</span>(mask)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 添加计算列</span></span><br><span class="line">    doubled = pc.multiply(table[<span class="string">&#x27;value&#x27;</span>], <span class="number">2</span>)</span><br><span class="line">    table = table.append_column(<span class="string">&#x27;doubled&#x27;</span>, doubled)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 排序</span></span><br><span class="line">    table = table.sort_by(<span class="string">&#x27;value&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 写入</span></span><br><span class="line">    pq.write_table(table, output_file, compression=<span class="string">&#x27;snappy&#x27;</span>)</span><br><span class="line"></span><br><span class="line">process_data(<span class="string">&#x27;input.parquet&#x27;</span>, <span class="string">&#x27;output.parquet&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="7-2-多文件合并"><a href="#7-2-多文件合并" class="headerlink" title="7.2 多文件合并"></a>7.2 多文件合并</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pathlib <span class="keyword">import</span> Path</span><br><span class="line"><span class="keyword">import</span> pyarrow <span class="keyword">as</span> pa</span><br><span class="line"><span class="keyword">import</span> pyarrow.parquet <span class="keyword">as</span> pq</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">merge_parquet_files</span>(<span class="params">input_dir, output_file</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;合并多个 Parquet 文件&quot;&quot;&quot;</span></span><br><span class="line">    files = <span class="built_in">list</span>(Path(input_dir).glob(<span class="string">&#x27;*.parquet&#x27;</span>))</span><br><span class="line">    tables = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> f <span class="keyword">in</span> files:</span><br><span class="line">        table = pq.read_table(<span class="built_in">str</span>(f))</span><br><span class="line">        tables.append(table)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 合并</span></span><br><span class="line">    combined = pa.concat_tables(tables)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 写入</span></span><br><span class="line">    pq.write_table(combined, output_file)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;合并 <span class="subst">&#123;<span class="built_in">len</span>(files)&#125;</span> 个文件，共 <span class="subst">&#123;combined.num_rows&#125;</span> 行&quot;</span>)</span><br><span class="line"></span><br><span class="line">merge_parquet_files(<span class="string">&#x27;data/&#x27;</span>, <span class="string">&#x27;merged.parquet&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="7-3-数据验证"><a href="#7-3-数据验证" class="headerlink" title="7.3 数据验证"></a>7.3 数据验证</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">validate_data</span>(<span class="params">table, schema</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;验证数据是否符合预期&quot;&quot;&quot;</span></span><br><span class="line">    issues = []</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 检查列</span></span><br><span class="line">    <span class="keyword">for</span> col <span class="keyword">in</span> schema.names:</span><br><span class="line">        <span class="keyword">if</span> col <span class="keyword">not</span> <span class="keyword">in</span> table.column_names:</span><br><span class="line">            issues.append(<span class="string">f&quot;缺少列：<span class="subst">&#123;col&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 检查空值</span></span><br><span class="line">    <span class="keyword">for</span> col <span class="keyword">in</span> table.column_names:</span><br><span class="line">        null_count = table[col].null_count</span><br><span class="line">        <span class="keyword">if</span> null_count &gt; <span class="number">0</span>:</span><br><span class="line">            issues.append(<span class="string">f&quot;列 <span class="subst">&#123;col&#125;</span> 有 <span class="subst">&#123;null_count&#125;</span> 个空值&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 检查数据类型</span></span><br><span class="line">    <span class="keyword">for</span> i, col <span class="keyword">in</span> <span class="built_in">enumerate</span>(table.column_names):</span><br><span class="line">        expected_type = schema.field(i).<span class="built_in">type</span></span><br><span class="line">        actual_type = table.schema.field(i).<span class="built_in">type</span></span><br><span class="line">        <span class="keyword">if</span> expected_type != actual_type:</span><br><span class="line">            issues.append(<span class="string">f&quot;列 <span class="subst">&#123;col&#125;</span> 类型不匹配&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> issues</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用</span></span><br><span class="line">schema = pa.schema([</span><br><span class="line">    (<span class="string">&#x27;id&#x27;</span>, pa.int32()),</span><br><span class="line">    (<span class="string">&#x27;value&#x27;</span>, pa.float64()),</span><br><span class="line">    (<span class="string">&#x27;category&#x27;</span>, pa.string())</span><br><span class="line">])</span><br><span class="line">issues = validate_data(table, schema)</span><br><span class="line"><span class="keyword">if</span> issues:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;数据质量问题：&quot;</span>, issues)</span><br></pre></td></tr></table></figure>

<h2 id="八、最佳实践"><a href="#八、最佳实践" class="headerlink" title="八、最佳实践"></a>八、最佳实践</h2><blockquote>
<p><strong>提醒自己</strong>：</p>
<ol>
<li><strong>使用 Parquet 格式</strong>：比 CSV 更快、更节省空间</li>
<li><strong>列式处理</strong>：只读取需要的列</li>
<li><strong>适当压缩</strong>：Snappy 平衡速度和大小，Gzip 追求压缩率</li>
<li><strong>批量处理</strong>：大文件分批次处理，避免内存溢出</li>
<li><strong>利用分区</strong>：按时间&#x2F;类别分区，加速查询</li>
<li><strong>零拷贝转换</strong>：PyArrow 与 Pandas 互转时避免不必要的数据复制</li>
</ol>
</blockquote>
<h2 id="九、练习"><a href="#九、练习" class="headerlink" title="九、练习"></a>九、练习</h2><ol>
<li>将一个大 CSV 文件转换为 Parquet 格式，比较文件大小和读写速度</li>
<li>使用 PyArrow 读取多个 Parquet 文件并合并</li>
<li>实现一个数据过滤管道，筛选符合条件的数据</li>
<li>使用 compute 模块实现数据的聚合统计</li>
<li>创建分区数据集，并演示分区查询的优势</li>
</ol>
<hr>
<p><strong>上一篇</strong>：[Python 数据科学（二）：Pandas 数据处理](&#x2F;2026&#x2F;02&#x2F;24&#x2F;Python-数据科学（二）Pandas 数据处理&#x2F;)</p>
<p><strong>下一篇</strong>：<a href="/2026/02/24/Python-%E5%B8%B8%E7%94%A8%E5%BA%93%EF%BC%88%E4%B8%80%EF%BC%89requests-API-%E8%B0%83%E7%94%A8/">Python 常用库（一）：requests API 调用</a></p>
<p><strong>参考资源</strong>：</p>
<ul>
<li><a href="https://arrow.apache.org/docs/python/">PyArrow 官方文档</a></li>
<li><a href="https://parquet.apache.org/docs/">Parquet 格式规范</a></li>
<li><a href="https://arrow.apache.org/docs/python/benchmarks.html">PyArrow 性能基准</a></li>
</ul>
]]></content>
      <categories>
        <category>Python 数据科学</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>PyArrow</tag>
        <tag>高性能</tag>
        <tag>DataFrame</tag>
      </tags>
  </entry>
  <entry>
    <title>我的第一篇博客</title>
    <url>/2026/02/20/%E6%88%91%E7%9A%84%E7%AC%AC%E4%B8%80%E7%AF%87%E5%8D%9A%E5%AE%A2/</url>
    <content><![CDATA[<p>这是我的第一篇博客文章，记录博客搭建的起点。</p>
]]></content>
      <categories>
        <category>生活随笔</category>
      </categories>
      <tags>
        <tag>博客搭建</tag>
        <tag>Hexo</tag>
        <tag>开始</tag>
      </tags>
  </entry>
  <entry>
    <title>Python 数据科学（二）Pandas 数据处理</title>
    <url>/2026/02/24/Python%20%E6%95%B0%E6%8D%AE%E7%A7%91%E5%AD%A6%EF%BC%88%E4%BA%8C%EF%BC%89Pandas%20%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86/</url>
    <content><![CDATA[<h1 id="Python-数据科学（二）Pandas-数据处理"><a href="#Python-数据科学（二）Pandas-数据处理" class="headerlink" title="Python 数据科学（二）Pandas 数据处理"></a>Python 数据科学（二）Pandas 数据处理</h1><p>Pandas 是 Python 数据分析的核心库。本篇将详细介绍 DataFrame 操作、数据清洗、数据转换等核心技能。</p>
<h2 id="一、Pandas-简介"><a href="#一、Pandas-简介" class="headerlink" title="一、Pandas 简介"></a>一、Pandas 简介</h2><h3 id="1-1-为什么使用-Pandas？"><a href="#1-1-为什么使用-Pandas？" class="headerlink" title="1.1 为什么使用 Pandas？"></a>1.1 为什么使用 Pandas？</h3><ul>
<li><strong>数据处理强大</strong>：支持 CSV、Excel、SQL、JSON 等多种格式</li>
<li><strong>DataFrame 结构</strong>：类似 Excel 表格，直观易用</li>
<li><strong>数据清洗方便</strong>：处理缺失值、重复值、异常值</li>
<li><strong>数据分析功能</strong>：分组、聚合、透视表</li>
<li><strong>与 NumPy 兼容</strong>：底层使用 NumPy，性能优秀</li>
</ul>
<h3 id="1-2-安装与导入"><a href="#1-2-安装与导入" class="headerlink" title="1.2 安装与导入"></a>1.2 安装与导入</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pip install pandas</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看版本</span></span><br><span class="line"><span class="built_in">print</span>(pd.__version__)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置显示选项</span></span><br><span class="line">pd.set_option(<span class="string">&#x27;display.max_columns&#x27;</span>, <span class="literal">None</span>)  <span class="comment"># 显示所有列</span></span><br><span class="line">pd.set_option(<span class="string">&#x27;display.width&#x27;</span>, <span class="literal">None</span>)        <span class="comment"># 自适应宽度</span></span><br></pre></td></tr></table></figure>

<h2 id="二、Series-和-DataFrame"><a href="#二、Series-和-DataFrame" class="headerlink" title="二、Series 和 DataFrame"></a>二、Series 和 DataFrame</h2><h3 id="2-1-Series（系列）"><a href="#2-1-Series（系列）" class="headerlink" title="2.1 Series（系列）"></a>2.1 Series（系列）</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 从列表创建</span></span><br><span class="line">s = pd.Series([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定索引</span></span><br><span class="line">s = pd.Series([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>], index=[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;d&#x27;</span>, <span class="string">&#x27;e&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 从字典创建</span></span><br><span class="line">s = pd.Series(&#123;<span class="string">&#x27;a&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27;b&#x27;</span>: <span class="number">2</span>, <span class="string">&#x27;c&#x27;</span>: <span class="number">3</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 访问元素</span></span><br><span class="line"><span class="built_in">print</span>(s[<span class="number">0</span>])        <span class="comment"># 1 位置索引</span></span><br><span class="line"><span class="built_in">print</span>(s[<span class="string">&#x27;a&#x27;</span>])      <span class="comment"># 1 标签索引</span></span><br><span class="line"><span class="built_in">print</span>(s[<span class="number">0</span>:<span class="number">3</span>])      <span class="comment"># 切片</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Series 运算</span></span><br><span class="line">s1 = pd.Series([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>])</span><br><span class="line">s2 = pd.Series([<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>])</span><br><span class="line"><span class="built_in">print</span>(s1 + s2)     <span class="comment"># [5, 7, 9]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 提醒自己：Series 是一维带标签的数组</span></span><br></pre></td></tr></table></figure>

<h3 id="2-2-DataFrame（数据框）"><a href="#2-2-DataFrame（数据框）" class="headerlink" title="2.2 DataFrame（数据框）"></a>2.2 DataFrame（数据框）</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 从字典创建</span></span><br><span class="line">df = pd.DataFrame(&#123;</span><br><span class="line">    <span class="string">&#x27;name&#x27;</span>: [<span class="string">&#x27;张三&#x27;</span>, <span class="string">&#x27;李四&#x27;</span>, <span class="string">&#x27;王五&#x27;</span>],</span><br><span class="line">    <span class="string">&#x27;age&#x27;</span>: [<span class="number">25</span>, <span class="number">30</span>, <span class="number">35</span>],</span><br><span class="line">    <span class="string">&#x27;city&#x27;</span>: [<span class="string">&#x27;北京&#x27;</span>, <span class="string">&#x27;上海&#x27;</span>, <span class="string">&#x27;广州&#x27;</span>]</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 从列表嵌套创建</span></span><br><span class="line">df = pd.DataFrame([</span><br><span class="line">    [<span class="string">&#x27;张三&#x27;</span>, <span class="number">25</span>, <span class="string">&#x27;北京&#x27;</span>],</span><br><span class="line">    [<span class="string">&#x27;李四&#x27;</span>, <span class="number">30</span>, <span class="string">&#x27;上海&#x27;</span>],</span><br><span class="line">    [<span class="string">&#x27;王五&#x27;</span>, <span class="number">35</span>, <span class="string">&#x27;广州&#x27;</span>]</span><br><span class="line">], columns=[<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;age&#x27;</span>, <span class="string">&#x27;city&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 从 CSV 文件读取</span></span><br><span class="line">df = pd.read_csv(<span class="string">&#x27;data.csv&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 从 Excel 文件读取</span></span><br><span class="line">df = pd.read_excel(<span class="string">&#x27;data.xlsx&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看数据</span></span><br><span class="line"><span class="built_in">print</span>(df.head())      <span class="comment"># 前 5 行</span></span><br><span class="line"><span class="built_in">print</span>(df.tail(<span class="number">3</span>))     <span class="comment"># 后 3 行</span></span><br><span class="line"><span class="built_in">print</span>(df.sample(<span class="number">2</span>))   <span class="comment"># 随机 2 行</span></span><br><span class="line"><span class="built_in">print</span>(df.info())      <span class="comment"># 数据信息</span></span><br><span class="line"><span class="built_in">print</span>(df.describe())  <span class="comment"># 统计摘要</span></span><br><span class="line"><span class="built_in">print</span>(df.shape)       <span class="comment"># 形状 (行，列)</span></span><br><span class="line"><span class="built_in">print</span>(df.columns)     <span class="comment"># 列名</span></span><br><span class="line"><span class="built_in">print</span>(df.index)       <span class="comment"># 索引</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 提醒自己：</span></span><br><span class="line"><span class="comment"># - read_csv 是最常用的数据读取方式</span></span><br><span class="line"><span class="comment"># - info() 快速了解数据结构和缺失情况</span></span><br></pre></td></tr></table></figure>

<h2 id="三、数据选择与索引"><a href="#三、数据选择与索引" class="headerlink" title="三、数据选择与索引"></a>三、数据选择与索引</h2><h3 id="3-1-列选择"><a href="#3-1-列选择" class="headerlink" title="3.1 列选择"></a>3.1 列选择</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 选择单列（返回 Series）</span></span><br><span class="line">col = df[<span class="string">&#x27;name&#x27;</span>]</span><br><span class="line">col = df.name  <span class="comment"># 也可以这样</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 选择多列（返回 DataFrame）</span></span><br><span class="line">cols = df[[<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;age&#x27;</span>]]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 提醒自己：选择单列用 df[&#x27;col&#x27;]，多列用 df[[&#x27;col1&#x27;, &#x27;col2&#x27;]]</span></span><br></pre></td></tr></table></figure>

<h3 id="3-2-行选择"><a href="#3-2-行选择" class="headerlink" title="3.2 行选择"></a>3.2 行选择</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 按位置选择</span></span><br><span class="line"><span class="built_in">print</span>(df.iloc[<span class="number">0</span>])      <span class="comment"># 第一行</span></span><br><span class="line"><span class="built_in">print</span>(df.iloc[<span class="number">0</span>:<span class="number">3</span>])    <span class="comment"># 前三行</span></span><br><span class="line"><span class="built_in">print</span>(df.iloc[-<span class="number">1</span>])     <span class="comment"># 最后一行</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 按标签选择</span></span><br><span class="line"><span class="built_in">print</span>(df.loc[<span class="number">0</span>])       <span class="comment"># 索引为 0 的行</span></span><br><span class="line"><span class="built_in">print</span>(df.loc[<span class="number">0</span>:<span class="number">2</span>])     <span class="comment"># 索引 0 到 2 的行（包含 2）</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 条件选择</span></span><br><span class="line">adults = df[df[<span class="string">&#x27;age&#x27;</span>] &gt; <span class="number">25</span>]</span><br><span class="line">beijing = df[df[<span class="string">&#x27;city&#x27;</span>] == <span class="string">&#x27;北京&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 多条件</span></span><br><span class="line">result = df[(df[<span class="string">&#x27;age&#x27;</span>] &gt; <span class="number">25</span>) &amp; (df[<span class="string">&#x27;city&#x27;</span>] == <span class="string">&#x27;北京&#x27;</span>)]</span><br><span class="line">result = df[(df[<span class="string">&#x27;age&#x27;</span>] &lt; <span class="number">25</span>) | (df[<span class="string">&#x27;age&#x27;</span>] &gt; <span class="number">35</span>)]</span><br><span class="line">result = df[~(df[<span class="string">&#x27;age&#x27;</span>] == <span class="number">25</span>)]  <span class="comment"># 非</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 提醒自己：</span></span><br><span class="line"><span class="comment"># - iloc 按整数位置</span></span><br><span class="line"><span class="comment"># - loc 按标签</span></span><br><span class="line"><span class="comment"># - 多条件用 &amp; | ~，不用 and or not</span></span><br></pre></td></tr></table></figure>

<h3 id="3-3-单元格选择"><a href="#3-3-单元格选择" class="headerlink" title="3.3 单元格选择"></a>3.3 单元格选择</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 按位置</span></span><br><span class="line">val = df.iloc[<span class="number">0</span>, <span class="number">1</span>]      <span class="comment"># 第 0 行第 1 列</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 按标签</span></span><br><span class="line">val = df.loc[<span class="number">0</span>, <span class="string">&#x27;name&#x27;</span>]  <span class="comment"># 索引 0，name 列</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改值</span></span><br><span class="line">df.loc[<span class="number">0</span>, <span class="string">&#x27;age&#x27;</span>] = <span class="number">26</span></span><br><span class="line">df.iloc[<span class="number">0</span>, <span class="number">1</span>] = <span class="number">26</span></span><br></pre></td></tr></table></figure>

<h3 id="3-4-布尔索引进阶"><a href="#3-4-布尔索引进阶" class="headerlink" title="3.4 布尔索引进阶"></a>3.4 布尔索引进阶</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># isin 判断是否在列表中</span></span><br><span class="line">df[df[<span class="string">&#x27;city&#x27;</span>].isin([<span class="string">&#x27;北京&#x27;</span>, <span class="string">&#x27;上海&#x27;</span>])]</span><br><span class="line"></span><br><span class="line"><span class="comment"># str.contains 字符串包含</span></span><br><span class="line">df[df[<span class="string">&#x27;name&#x27;</span>].<span class="built_in">str</span>.contains(<span class="string">&#x27;张&#x27;</span>)]</span><br><span class="line"></span><br><span class="line"><span class="comment"># between 范围判断</span></span><br><span class="line">df[df[<span class="string">&#x27;age&#x27;</span>].between(<span class="number">25</span>, <span class="number">35</span>)]</span><br><span class="line"></span><br><span class="line"><span class="comment"># isnull/notnull 空值判断</span></span><br><span class="line">df[df[<span class="string">&#x27;age&#x27;</span>].isnull()]</span><br><span class="line">df[df[<span class="string">&#x27;age&#x27;</span>].notnull()]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 提醒自己：这些方法在数据筛选中非常常用</span></span><br></pre></td></tr></table></figure>

<h2 id="四、数据清洗"><a href="#四、数据清洗" class="headerlink" title="四、数据清洗"></a>四、数据清洗</h2><h3 id="4-1-处理缺失值"><a href="#4-1-处理缺失值" class="headerlink" title="4.1 处理缺失值"></a>4.1 处理缺失值</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 创建含缺失值的数据</span></span><br><span class="line">df = pd.DataFrame(&#123;</span><br><span class="line">    <span class="string">&#x27;A&#x27;</span>: [<span class="number">1</span>, <span class="number">2</span>, np.nan, <span class="number">4</span>],</span><br><span class="line">    <span class="string">&#x27;B&#x27;</span>: [<span class="number">5</span>, np.nan, np.nan, <span class="number">8</span>],</span><br><span class="line">    <span class="string">&#x27;C&#x27;</span>: [<span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>]</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查缺失值</span></span><br><span class="line"><span class="built_in">print</span>(df.isnull())       <span class="comment"># 布尔矩阵</span></span><br><span class="line"><span class="built_in">print</span>(df.isnull().<span class="built_in">sum</span>()) <span class="comment"># 每列缺失数量</span></span><br><span class="line"><span class="built_in">print</span>(df.notnull())      <span class="comment"># 非缺失</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除缺失值</span></span><br><span class="line">df_dropped = df.dropna()           <span class="comment"># 删除任何含缺失的行</span></span><br><span class="line">df_dropped = df.dropna(axis=<span class="number">1</span>)     <span class="comment"># 删除含缺失的列</span></span><br><span class="line">df_dropped = df.dropna(thresh=<span class="number">2</span>)   <span class="comment"># 至少 2 个非缺失值才保留</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 填充缺失值</span></span><br><span class="line">df_filled = df.fillna(<span class="number">0</span>)           <span class="comment"># 填充为 0</span></span><br><span class="line">df_filled = df.fillna(df.mean())   <span class="comment"># 填充为均值</span></span><br><span class="line">df_filled = df.fillna(method=<span class="string">&#x27;ffill&#x27;</span>)  <span class="comment"># 向前填充</span></span><br><span class="line">df_filled = df.fillna(method=<span class="string">&#x27;bfill&#x27;</span>)  <span class="comment"># 向后填充</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 插值</span></span><br><span class="line">df_interpolated = df.interpolate()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 提醒自己：</span></span><br><span class="line"><span class="comment"># - 删除缺失值会丢失数据</span></span><br><span class="line"><span class="comment"># - 填充策略要根据业务场景选择</span></span><br><span class="line"><span class="comment"># - 均值填充会改变数据分布</span></span><br></pre></td></tr></table></figure>

<h3 id="4-2-处理重复值"><a href="#4-2-处理重复值" class="headerlink" title="4.2 处理重复值"></a>4.2 处理重复值</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">df = pd.DataFrame(&#123;</span><br><span class="line">    <span class="string">&#x27;A&#x27;</span>: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">3</span>],</span><br><span class="line">    <span class="string">&#x27;B&#x27;</span>: [<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>]</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查重复</span></span><br><span class="line"><span class="built_in">print</span>(df.duplicated())      <span class="comment"># 布尔序列</span></span><br><span class="line"><span class="built_in">print</span>(df.duplicated().<span class="built_in">sum</span>()) <span class="comment"># 重复数量</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除重复</span></span><br><span class="line">df_unique = df.drop_duplicates()</span><br><span class="line">df_unique = df.drop_duplicates(subset=[<span class="string">&#x27;A&#x27;</span>])  <span class="comment"># 按指定列</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 保留最后一个</span></span><br><span class="line">df_unique = df.drop_duplicates(keep=<span class="string">&#x27;last&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 不删除（保留所有）</span></span><br><span class="line">df_unique = df.drop_duplicates(keep=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure>

<h3 id="4-3-数据类型转换"><a href="#4-3-数据类型转换" class="headerlink" title="4.3 数据类型转换"></a>4.3 数据类型转换</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">df = pd.DataFrame(&#123;</span><br><span class="line">    <span class="string">&#x27;a&#x27;</span>: [<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;3&#x27;</span>],</span><br><span class="line">    <span class="string">&#x27;b&#x27;</span>: [<span class="number">1.0</span>, <span class="number">2.0</span>, <span class="number">3.0</span>],</span><br><span class="line">    <span class="string">&#x27;c&#x27;</span>: [<span class="string">&#x27;2021-01-01&#x27;</span>, <span class="string">&#x27;2021-01-02&#x27;</span>, <span class="string">&#x27;2021-01-03&#x27;</span>]</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 类型转换</span></span><br><span class="line">df[<span class="string">&#x27;a&#x27;</span>] = df[<span class="string">&#x27;a&#x27;</span>].astype(<span class="built_in">int</span>)</span><br><span class="line">df[<span class="string">&#x27;b&#x27;</span>] = df[<span class="string">&#x27;b&#x27;</span>].astype(<span class="built_in">str</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 日期转换</span></span><br><span class="line">df[<span class="string">&#x27;c&#x27;</span>] = pd.to_datetime(df[<span class="string">&#x27;c&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 分类类型（节省内存）</span></span><br><span class="line">df[<span class="string">&#x27;category&#x27;</span>] = df[<span class="string">&#x27;a&#x27;</span>].astype(<span class="string">&#x27;category&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 数值转换（处理非数值）</span></span><br><span class="line">df[<span class="string">&#x27;a&#x27;</span>] = pd.to_numeric(df[<span class="string">&#x27;a&#x27;</span>], errors=<span class="string">&#x27;coerce&#x27;</span>)  <span class="comment"># 无法转换的变为 NaN</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 提醒自己：</span></span><br><span class="line"><span class="comment"># - category 类型适合取值有限的列（如性别、状态）</span></span><br><span class="line"><span class="comment"># - 可以显著减少内存占用</span></span><br></pre></td></tr></table></figure>

<h3 id="4-4-字符串处理"><a href="#4-4-字符串处理" class="headerlink" title="4.4 字符串处理"></a>4.4 字符串处理</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">df = pd.DataFrame(&#123;<span class="string">&#x27;name&#x27;</span>: [<span class="string">&#x27;  Zhang San &#x27;</span>, <span class="string">&#x27;li si&#x27;</span>, <span class="string">&#x27;WANG wu&#x27;</span>]&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 去除空格</span></span><br><span class="line">df[<span class="string">&#x27;name&#x27;</span>] = df[<span class="string">&#x27;name&#x27;</span>].<span class="built_in">str</span>.strip()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 大小写</span></span><br><span class="line">df[<span class="string">&#x27;name&#x27;</span>] = df[<span class="string">&#x27;name&#x27;</span>].<span class="built_in">str</span>.lower()</span><br><span class="line">df[<span class="string">&#x27;name&#x27;</span>] = df[<span class="string">&#x27;name&#x27;</span>].<span class="built_in">str</span>.upper()</span><br><span class="line">df[<span class="string">&#x27;name&#x27;</span>] = df[<span class="string">&#x27;name&#x27;</span>].<span class="built_in">str</span>.title()  <span class="comment"># 首字母大写</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 分割</span></span><br><span class="line">df = pd.DataFrame(&#123;<span class="string">&#x27;full_name&#x27;</span>: [<span class="string">&#x27;Zhang San&#x27;</span>, <span class="string">&#x27;Li Si&#x27;</span>]&#125;)</span><br><span class="line">df[[<span class="string">&#x27;first&#x27;</span>, <span class="string">&#x27;last&#x27;</span>]] = df[<span class="string">&#x27;full_name&#x27;</span>].<span class="built_in">str</span>.split(<span class="string">&#x27; &#x27;</span>, expand=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 替换</span></span><br><span class="line">df[<span class="string">&#x27;name&#x27;</span>] = df[<span class="string">&#x27;name&#x27;</span>].<span class="built_in">str</span>.replace(<span class="string">&#x27;Zhang&#x27;</span>, <span class="string">&#x27;张&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 提取（正则）</span></span><br><span class="line">df = pd.DataFrame(&#123;<span class="string">&#x27;phone&#x27;</span>: [<span class="string">&#x27;138-0000-0000&#x27;</span>, <span class="string">&#x27;139-1111-1111&#x27;</span>]&#125;)</span><br><span class="line">df[<span class="string">&#x27;area&#x27;</span>] = df[<span class="string">&#x27;phone&#x27;</span>].<span class="built_in">str</span>.extract(<span class="string">r&#x27;(\d&#123;3&#125;)-&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 提醒自己：</span></span><br><span class="line"><span class="comment"># - str 访问器提供所有字符串方法</span></span><br><span class="line"><span class="comment"># - expand=True 返回 DataFrame</span></span><br></pre></td></tr></table></figure>

<h2 id="五、数据转换"><a href="#五、数据转换" class="headerlink" title="五、数据转换"></a>五、数据转换</h2><h3 id="5-1-添加-删除列"><a href="#5-1-添加-删除列" class="headerlink" title="5.1 添加&#x2F;删除列"></a>5.1 添加&#x2F;删除列</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">df = pd.DataFrame(&#123;</span><br><span class="line">    <span class="string">&#x27;name&#x27;</span>: [<span class="string">&#x27;张三&#x27;</span>, <span class="string">&#x27;李四&#x27;</span>],</span><br><span class="line">    <span class="string">&#x27;age&#x27;</span>: [<span class="number">25</span>, <span class="number">30</span>],</span><br><span class="line">    <span class="string">&#x27;salary&#x27;</span>: [<span class="number">10000</span>, <span class="number">15000</span>]</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加列</span></span><br><span class="line">df[<span class="string">&#x27;bonus&#x27;</span>] = df[<span class="string">&#x27;salary&#x27;</span>] * <span class="number">0.1</span></span><br><span class="line">df[<span class="string">&#x27;total&#x27;</span>] = df[<span class="string">&#x27;salary&#x27;</span>] + df[<span class="string">&#x27;bonus&#x27;</span>]</span><br><span class="line">df[<span class="string">&#x27;city&#x27;</span>] = <span class="string">&#x27;北京&#x27;</span>  <span class="comment"># 常量列</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用 assign（链式调用）</span></span><br><span class="line">df = df.assign(</span><br><span class="line">    tax=df[<span class="string">&#x27;salary&#x27;</span>] * <span class="number">0.1</span>,</span><br><span class="line">    net_salary=<span class="keyword">lambda</span> x: x[<span class="string">&#x27;salary&#x27;</span>] - x[<span class="string">&#x27;tax&#x27;</span>]</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除列</span></span><br><span class="line">df = df.drop(<span class="string">&#x27;bonus&#x27;</span>, axis=<span class="number">1</span>)</span><br><span class="line">df.drop([<span class="string">&#x27;city&#x27;</span>, <span class="string">&#x27;total&#x27;</span>], axis=<span class="number">1</span>, inplace=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重命名列</span></span><br><span class="line">df = df.rename(columns=&#123;<span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;姓名&#x27;</span>, <span class="string">&#x27;age&#x27;</span>: <span class="string">&#x27;年龄&#x27;</span>&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="5-2-apply-和-map"><a href="#5-2-apply-和-map" class="headerlink" title="5.2 apply 和 map"></a>5.2 apply 和 map</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">df = pd.DataFrame(&#123;</span><br><span class="line">    <span class="string">&#x27;name&#x27;</span>: [<span class="string">&#x27;张三&#x27;</span>, <span class="string">&#x27;李四&#x27;</span>, <span class="string">&#x27;王五&#x27;</span>],</span><br><span class="line">    <span class="string">&#x27;score&#x27;</span>: [<span class="number">85</span>, <span class="number">92</span>, <span class="number">78</span>]</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># apply 应用函数</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">grade</span>(<span class="params">score</span>):</span><br><span class="line">    <span class="keyword">if</span> score &gt;= <span class="number">90</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;A&#x27;</span></span><br><span class="line">    <span class="keyword">elif</span> score &gt;= <span class="number">80</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;B&#x27;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;C&#x27;</span></span><br><span class="line"></span><br><span class="line">df[<span class="string">&#x27;grade&#x27;</span>] = df[<span class="string">&#x27;score&#x27;</span>].apply(grade)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用 lambda</span></span><br><span class="line">df[<span class="string">&#x27;score_doubled&#x27;</span>] = df[<span class="string">&#x27;score&#x27;</span>].apply(<span class="keyword">lambda</span> x: x * <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 按行应用</span></span><br><span class="line">df[<span class="string">&#x27;info&#x27;</span>] = df.apply(<span class="keyword">lambda</span> row: <span class="string">f&quot;<span class="subst">&#123;row[<span class="string">&#x27;name&#x27;</span>]&#125;</span> - <span class="subst">&#123;row[<span class="string">&#x27;score&#x27;</span>]&#125;</span>&quot;</span>, axis=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># map 映射（Series）</span></span><br><span class="line">mapping = &#123;<span class="string">&#x27;张三&#x27;</span>: <span class="string">&#x27;Male&#x27;</span>, <span class="string">&#x27;李四&#x27;</span>: <span class="string">&#x27;Female&#x27;</span>, <span class="string">&#x27;王五&#x27;</span>: <span class="string">&#x27;Male&#x27;</span>&#125;</span><br><span class="line">df[<span class="string">&#x27;gender&#x27;</span>] = df[<span class="string">&#x27;name&#x27;</span>].<span class="built_in">map</span>(mapping)</span><br><span class="line"></span><br><span class="line"><span class="comment"># replace 替换</span></span><br><span class="line">df[<span class="string">&#x27;grade&#x27;</span>] = df[<span class="string">&#x27;grade&#x27;</span>].replace(&#123;<span class="string">&#x27;A&#x27;</span>: <span class="string">&#x27;优秀&#x27;</span>, <span class="string">&#x27;B&#x27;</span>: <span class="string">&#x27;良好&#x27;</span>, <span class="string">&#x27;C&#x27;</span>: <span class="string">&#x27;及格&#x27;</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 提醒自己：</span></span><br><span class="line"><span class="comment"># - apply 可用于 Series 和 DataFrame</span></span><br><span class="line"><span class="comment"># - map 只用于 Series</span></span><br><span class="line"><span class="comment"># - 向量化操作比 apply 快，优先使用向量化</span></span><br></pre></td></tr></table></figure>

<h3 id="5-3-排序"><a href="#5-3-排序" class="headerlink" title="5.3 排序"></a>5.3 排序</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">df = pd.DataFrame(&#123;</span><br><span class="line">    <span class="string">&#x27;name&#x27;</span>: [<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;C&#x27;</span>],</span><br><span class="line">    <span class="string">&#x27;score&#x27;</span>: [<span class="number">85</span>, <span class="number">92</span>, <span class="number">78</span>],</span><br><span class="line">    <span class="string">&#x27;age&#x27;</span>: [<span class="number">25</span>, <span class="number">30</span>, <span class="number">22</span>]</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 按值排序</span></span><br><span class="line">df_sorted = df.sort_values(<span class="string">&#x27;score&#x27;</span>)           <span class="comment"># 升序</span></span><br><span class="line">df_sorted = df.sort_values(<span class="string">&#x27;score&#x27;</span>, ascending=<span class="literal">False</span>)  <span class="comment"># 降序</span></span><br><span class="line">df_sorted = df.sort_values([<span class="string">&#x27;age&#x27;</span>, <span class="string">&#x27;score&#x27;</span>])  <span class="comment"># 多列排序</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 按索引排序</span></span><br><span class="line">df_sorted = df.sort_index()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 排名</span></span><br><span class="line">df[<span class="string">&#x27;rank&#x27;</span>] = df[<span class="string">&#x27;score&#x27;</span>].rank(ascending=<span class="literal">False</span>)  <span class="comment"># 排名</span></span><br></pre></td></tr></table></figure>

<h2 id="六、数据聚合"><a href="#六、数据聚合" class="headerlink" title="六、数据聚合"></a>六、数据聚合</h2><h3 id="6-1-基础统计"><a href="#6-1-基础统计" class="headerlink" title="6.1 基础统计"></a>6.1 基础统计</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">df = pd.DataFrame(&#123;</span><br><span class="line">    <span class="string">&#x27;A&#x27;</span>: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>],</span><br><span class="line">    <span class="string">&#x27;B&#x27;</span>: [<span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>, <span class="number">40</span>, <span class="number">50</span>]</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 常用统计</span></span><br><span class="line"><span class="built_in">print</span>(df.<span class="built_in">sum</span>())        <span class="comment"># 求和</span></span><br><span class="line"><span class="built_in">print</span>(df.mean())       <span class="comment"># 均值</span></span><br><span class="line"><span class="built_in">print</span>(df.median())     <span class="comment"># 中位数</span></span><br><span class="line"><span class="built_in">print</span>(df.std())        <span class="comment"># 标准差</span></span><br><span class="line"><span class="built_in">print</span>(df.var())        <span class="comment"># 方差</span></span><br><span class="line"><span class="built_in">print</span>(df.<span class="built_in">min</span>())        <span class="comment"># 最小值</span></span><br><span class="line"><span class="built_in">print</span>(df.<span class="built_in">max</span>())        <span class="comment"># 最大值</span></span><br><span class="line"><span class="built_in">print</span>(df.count())      <span class="comment"># 计数</span></span><br><span class="line"><span class="built_in">print</span>(df.quantile(<span class="number">0.25</span>))  <span class="comment"># 25% 分位数</span></span><br><span class="line"><span class="built_in">print</span>(df.describe())   <span class="comment"># 完整统计摘要</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 相关系数</span></span><br><span class="line"><span class="built_in">print</span>(df.corr())</span><br></pre></td></tr></table></figure>

<h3 id="6-2-groupby-分组聚合"><a href="#6-2-groupby-分组聚合" class="headerlink" title="6.2 groupby 分组聚合"></a>6.2 groupby 分组聚合</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">df = pd.DataFrame(&#123;</span><br><span class="line">    <span class="string">&#x27;department&#x27;</span>: [<span class="string">&#x27;HR&#x27;</span>, <span class="string">&#x27;IT&#x27;</span>, <span class="string">&#x27;HR&#x27;</span>, <span class="string">&#x27;IT&#x27;</span>, <span class="string">&#x27;Sales&#x27;</span>],</span><br><span class="line">    <span class="string">&#x27;name&#x27;</span>: [<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;C&#x27;</span>, <span class="string">&#x27;D&#x27;</span>, <span class="string">&#x27;E&#x27;</span>],</span><br><span class="line">    <span class="string">&#x27;salary&#x27;</span>: [<span class="number">5000</span>, <span class="number">10000</span>, <span class="number">6000</span>, <span class="number">12000</span>, <span class="number">8000</span>],</span><br><span class="line">    <span class="string">&#x27;age&#x27;</span>: [<span class="number">25</span>, <span class="number">30</span>, <span class="number">28</span>, <span class="number">35</span>, <span class="number">27</span>]</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 单列分组</span></span><br><span class="line">grouped = df.groupby(<span class="string">&#x27;department&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(grouped[<span class="string">&#x27;salary&#x27;</span>].mean())  <span class="comment"># 各部门平均工资</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 多列分组</span></span><br><span class="line"><span class="built_in">print</span>(df.groupby([<span class="string">&#x27;department&#x27;</span>, <span class="string">&#x27;age&#x27;</span>])[<span class="string">&#x27;salary&#x27;</span>].<span class="built_in">sum</span>())</span><br><span class="line"></span><br><span class="line"><span class="comment"># 多个聚合函数</span></span><br><span class="line"><span class="built_in">print</span>(df.groupby(<span class="string">&#x27;department&#x27;</span>)[<span class="string">&#x27;salary&#x27;</span>].agg([<span class="string">&#x27;mean&#x27;</span>, <span class="string">&#x27;sum&#x27;</span>, <span class="string">&#x27;count&#x27;</span>]))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 不同列不同聚合</span></span><br><span class="line"><span class="built_in">print</span>(df.groupby(<span class="string">&#x27;department&#x27;</span>).agg(&#123;</span><br><span class="line">    <span class="string">&#x27;salary&#x27;</span>: [<span class="string">&#x27;mean&#x27;</span>, <span class="string">&#x27;sum&#x27;</span>],</span><br><span class="line">    <span class="string">&#x27;age&#x27;</span>: [<span class="string">&#x27;min&#x27;</span>, <span class="string">&#x27;max&#x27;</span>]</span><br><span class="line">&#125;))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 自定义聚合</span></span><br><span class="line"><span class="built_in">print</span>(df.groupby(<span class="string">&#x27;department&#x27;</span>)[<span class="string">&#x27;salary&#x27;</span>].agg(<span class="keyword">lambda</span> x: x.<span class="built_in">max</span>() - x.<span class="built_in">min</span>()))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重置索引</span></span><br><span class="line">result = df.groupby(<span class="string">&#x27;department&#x27;</span>)[<span class="string">&#x27;salary&#x27;</span>].mean().reset_index()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 提醒自己：</span></span><br><span class="line"><span class="comment"># - groupby 是数据分析的核心操作</span></span><br><span class="line"><span class="comment"># - agg 可以应用多个聚合函数</span></span><br></pre></td></tr></table></figure>

<h3 id="6-3-pivot-table-透视表"><a href="#6-3-pivot-table-透视表" class="headerlink" title="6.3 pivot_table 透视表"></a>6.3 pivot_table 透视表</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">df = pd.DataFrame(&#123;</span><br><span class="line">    <span class="string">&#x27;date&#x27;</span>: [<span class="string">&#x27;2024-01&#x27;</span>, <span class="string">&#x27;2024-01&#x27;</span>, <span class="string">&#x27;2024-02&#x27;</span>, <span class="string">&#x27;2024-02&#x27;</span>],</span><br><span class="line">    <span class="string">&#x27;region&#x27;</span>: [<span class="string">&#x27;North&#x27;</span>, <span class="string">&#x27;South&#x27;</span>, <span class="string">&#x27;North&#x27;</span>, <span class="string">&#x27;South&#x27;</span>],</span><br><span class="line">    <span class="string">&#x27;sales&#x27;</span>: [<span class="number">100</span>, <span class="number">150</span>, <span class="number">120</span>, <span class="number">180</span>],</span><br><span class="line">    <span class="string">&#x27;profit&#x27;</span>: [<span class="number">20</span>, <span class="number">30</span>, <span class="number">25</span>, <span class="number">35</span>]</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 基础透视表</span></span><br><span class="line">pivot = pd.pivot_table(</span><br><span class="line">    df,</span><br><span class="line">    values=<span class="string">&#x27;sales&#x27;</span>,</span><br><span class="line">    index=<span class="string">&#x27;region&#x27;</span>,</span><br><span class="line">    columns=<span class="string">&#x27;date&#x27;</span>,</span><br><span class="line">    aggfunc=<span class="string">&#x27;sum&#x27;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 多值多聚合</span></span><br><span class="line">pivot = pd.pivot_table(</span><br><span class="line">    df,</span><br><span class="line">    values=[<span class="string">&#x27;sales&#x27;</span>, <span class="string">&#x27;profit&#x27;</span>],</span><br><span class="line">    index=<span class="string">&#x27;region&#x27;</span>,</span><br><span class="line">    aggfunc=&#123;<span class="string">&#x27;sales&#x27;</span>: <span class="string">&#x27;sum&#x27;</span>, <span class="string">&#x27;profit&#x27;</span>: <span class="string">&#x27;mean&#x27;</span>&#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 填充缺失值</span></span><br><span class="line">pivot = pd.pivot_table(</span><br><span class="line">    df,</span><br><span class="line">    values=<span class="string">&#x27;sales&#x27;</span>,</span><br><span class="line">    index=<span class="string">&#x27;region&#x27;</span>,</span><br><span class="line">    columns=<span class="string">&#x27;date&#x27;</span>,</span><br><span class="line">    fill_value=<span class="number">0</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h2 id="七、数据合并"><a href="#七、数据合并" class="headerlink" title="七、数据合并"></a>七、数据合并</h2><h3 id="7-1-concat-连接"><a href="#7-1-concat-连接" class="headerlink" title="7.1 concat 连接"></a>7.1 concat 连接</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">df1 = pd.DataFrame(&#123;<span class="string">&#x27;A&#x27;</span>: [<span class="number">1</span>, <span class="number">2</span>], <span class="string">&#x27;B&#x27;</span>: [<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>]&#125;)</span><br><span class="line">df2 = pd.DataFrame(&#123;<span class="string">&#x27;A&#x27;</span>: [<span class="number">3</span>, <span class="number">4</span>], <span class="string">&#x27;B&#x27;</span>: [<span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;d&#x27;</span>]&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 垂直连接</span></span><br><span class="line">result = pd.concat([df1, df2], axis=<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 水平连接</span></span><br><span class="line">result = pd.concat([df1, df2], axis=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 忽略索引</span></span><br><span class="line">result = pd.concat([df1, df2], ignore_index=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加键</span></span><br><span class="line">result = pd.concat([df1, df2], keys=[<span class="string">&#x27;first&#x27;</span>, <span class="string">&#x27;second&#x27;</span>])</span><br></pre></td></tr></table></figure>

<h3 id="7-2-merge-合并"><a href="#7-2-merge-合并" class="headerlink" title="7.2 merge 合并"></a>7.2 merge 合并</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">df1 = pd.DataFrame(&#123;</span><br><span class="line">    <span class="string">&#x27;id&#x27;</span>: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>],</span><br><span class="line">    <span class="string">&#x27;name&#x27;</span>: [<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;C&#x27;</span>]</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">df2 = pd.DataFrame(&#123;</span><br><span class="line">    <span class="string">&#x27;id&#x27;</span>: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">4</span>],</span><br><span class="line">    <span class="string">&#x27;score&#x27;</span>: [<span class="number">85</span>, <span class="number">92</span>, <span class="number">78</span>]</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 内连接（默认）</span></span><br><span class="line">merged = pd.merge(df1, df2, on=<span class="string">&#x27;id&#x27;</span>)  <span class="comment"># 只有 id 1, 2</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 左连接</span></span><br><span class="line">merged = pd.merge(df1, df2, on=<span class="string">&#x27;id&#x27;</span>, how=<span class="string">&#x27;left&#x27;</span>)  <span class="comment"># 保留 df1 所有行</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 右连接</span></span><br><span class="line">merged = pd.merge(df1, df2, on=<span class="string">&#x27;id&#x27;</span>, how=<span class="string">&#x27;right&#x27;</span>)  <span class="comment"># 保留 df2 所有行</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 外连接</span></span><br><span class="line">merged = pd.merge(df1, df2, on=<span class="string">&#x27;id&#x27;</span>, how=<span class="string">&#x27;outer&#x27;</span>)  <span class="comment"># 保留所有行</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 不同列名合并</span></span><br><span class="line">merged = pd.merge(df1, df2, left_on=<span class="string">&#x27;id1&#x27;</span>, right_on=<span class="string">&#x27;id2&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 多列合并</span></span><br><span class="line">merged = pd.merge(df1, df2, on=[<span class="string">&#x27;id&#x27;</span>, <span class="string">&#x27;date&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 提醒自己：</span></span><br><span class="line"><span class="comment"># - merge 类似 SQL 的 JOIN</span></span><br><span class="line"><span class="comment"># - how 参数决定连接类型</span></span><br></pre></td></tr></table></figure>

<h2 id="八、文件读写"><a href="#八、文件读写" class="headerlink" title="八、文件读写"></a>八、文件读写</h2><h3 id="8-1-CSV-文件"><a href="#8-1-CSV-文件" class="headerlink" title="8.1 CSV 文件"></a>8.1 CSV 文件</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 读取</span></span><br><span class="line">df = pd.read_csv(<span class="string">&#x27;data.csv&#x27;</span>)</span><br><span class="line">df = pd.read_csv(<span class="string">&#x27;data.csv&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">df = pd.read_csv(<span class="string">&#x27;data.csv&#x27;</span>, sep=<span class="string">&#x27;\t&#x27;</span>)  <span class="comment"># TSV</span></span><br><span class="line">df = pd.read_csv(<span class="string">&#x27;data.csv&#x27;</span>, header=<span class="number">0</span>)  <span class="comment"># 第一行为表头</span></span><br><span class="line">df = pd.read_csv(<span class="string">&#x27;data.csv&#x27;</span>, names=[<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;C&#x27;</span>])  <span class="comment"># 指定列名</span></span><br><span class="line">df = pd.read_csv(<span class="string">&#x27;data.csv&#x27;</span>, usecols=[<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>])  <span class="comment"># 只读取部分列</span></span><br><span class="line">df = pd.read_csv(<span class="string">&#x27;data.csv&#x27;</span>, nrows=<span class="number">100</span>)  <span class="comment"># 只读前 100 行</span></span><br><span class="line">df = pd.read_csv(<span class="string">&#x27;data.csv&#x27;</span>, dtype=&#123;<span class="string">&#x27;A&#x27;</span>: <span class="built_in">str</span>&#125;)  <span class="comment"># 指定类型</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 写入</span></span><br><span class="line">df.to_csv(<span class="string">&#x27;output.csv&#x27;</span>, index=<span class="literal">False</span>)  <span class="comment"># 不保存索引</span></span><br><span class="line">df.to_csv(<span class="string">&#x27;output.csv&#x27;</span>, encoding=<span class="string">&#x27;utf-8-sig&#x27;</span>)  <span class="comment"># Excel 兼容</span></span><br></pre></td></tr></table></figure>

<h3 id="8-2-Excel-文件"><a href="#8-2-Excel-文件" class="headerlink" title="8.2 Excel 文件"></a>8.2 Excel 文件</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 读取</span></span><br><span class="line">df = pd.read_excel(<span class="string">&#x27;data.xlsx&#x27;</span>)</span><br><span class="line">df = pd.read_excel(<span class="string">&#x27;data.xlsx&#x27;</span>, sheet_name=<span class="string">&#x27;Sheet1&#x27;</span>)</span><br><span class="line">df = pd.read_excel(<span class="string">&#x27;data.xlsx&#x27;</span>, sheet_name=[<span class="string">&#x27;Sheet1&#x27;</span>, <span class="string">&#x27;Sheet2&#x27;</span>])  <span class="comment"># 多个 sheet</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 写入</span></span><br><span class="line">df.to_excel(<span class="string">&#x27;output.xlsx&#x27;</span>, index=<span class="literal">False</span>)</span><br><span class="line">df.to_excel(<span class="string">&#x27;output.xlsx&#x27;</span>, sheet_name=<span class="string">&#x27;数据&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 多个 DataFrame 写入不同 sheet</span></span><br><span class="line"><span class="keyword">with</span> pd.ExcelWriter(<span class="string">&#x27;output.xlsx&#x27;</span>) <span class="keyword">as</span> writer:</span><br><span class="line">    df1.to_excel(writer, sheet_name=<span class="string">&#x27;Sheet1&#x27;</span>, index=<span class="literal">False</span>)</span><br><span class="line">    df2.to_excel(writer, sheet_name=<span class="string">&#x27;Sheet2&#x27;</span>, index=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure>

<h3 id="8-3-其他格式"><a href="#8-3-其他格式" class="headerlink" title="8.3 其他格式"></a>8.3 其他格式</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># JSON</span></span><br><span class="line">df = pd.read_json(<span class="string">&#x27;data.json&#x27;</span>)</span><br><span class="line">df.to_json(<span class="string">&#x27;output.json&#x27;</span>, force_ascii=<span class="literal">False</span>)  <span class="comment"># 保留中文</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># SQL（需要 SQLAlchemy）</span></span><br><span class="line"><span class="keyword">from</span> sqlalchemy <span class="keyword">import</span> create_engine</span><br><span class="line">engine = create_engine(<span class="string">&#x27;sqlite:///database.db&#x27;</span>)</span><br><span class="line">df = pd.read_sql(<span class="string">&#x27;SELECT * FROM table&#x27;</span>, engine)</span><br><span class="line">df.to_sql(<span class="string">&#x27;table&#x27;</span>, engine, if_exists=<span class="string">&#x27;replace&#x27;</span>, index=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Parquet（高效列式存储）</span></span><br><span class="line">df = pd.read_parquet(<span class="string">&#x27;data.parquet&#x27;</span>)</span><br><span class="line">df.to_parquet(<span class="string">&#x27;output.parquet&#x27;</span>, index=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Pickle</span></span><br><span class="line">df.to_pickle(<span class="string">&#x27;data.pkl&#x27;</span>)</span><br><span class="line">df = pd.read_pickle(<span class="string">&#x27;data.pkl&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="九、实用技巧"><a href="#九、实用技巧" class="headerlink" title="九、实用技巧"></a>九、实用技巧</h2><h3 id="9-1-时间序列处理"><a href="#9-1-时间序列处理" class="headerlink" title="9.1 时间序列处理"></a>9.1 时间序列处理</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 创建日期范围</span></span><br><span class="line">dates = pd.date_range(<span class="string">&#x27;2024-01-01&#x27;</span>, periods=<span class="number">365</span>, freq=<span class="string">&#x27;D&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置日期索引</span></span><br><span class="line">df[<span class="string">&#x27;date&#x27;</span>] = pd.to_datetime(df[<span class="string">&#x27;date&#x27;</span>])</span><br><span class="line">df = df.set_index(<span class="string">&#x27;date&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 日期提取</span></span><br><span class="line">df[<span class="string">&#x27;year&#x27;</span>] = df.index.year</span><br><span class="line">df[<span class="string">&#x27;month&#x27;</span>] = df.index.month</span><br><span class="line">df[<span class="string">&#x27;day&#x27;</span>] = df.index.day</span><br><span class="line">df[<span class="string">&#x27;weekday&#x27;</span>] = df.index.weekday  <span class="comment"># 0=周一</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 重采样（降采样）</span></span><br><span class="line">daily = df.resample(<span class="string">&#x27;D&#x27;</span>).<span class="built_in">sum</span>()  <span class="comment"># 按天</span></span><br><span class="line">monthly = df.resample(<span class="string">&#x27;M&#x27;</span>).<span class="built_in">sum</span>()  <span class="comment"># 按月</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 移动平均</span></span><br><span class="line">df[<span class="string">&#x27;MA7&#x27;</span>] = df[<span class="string">&#x27;value&#x27;</span>].rolling(window=<span class="number">7</span>).mean()</span><br></pre></td></tr></table></figure>

<h3 id="9-2-条件格式化"><a href="#9-2-条件格式化" class="headerlink" title="9.2 条件格式化"></a>9.2 条件格式化</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 样式显示</span></span><br><span class="line">df.style.<span class="built_in">format</span>(&#123;<span class="string">&#x27;salary&#x27;</span>: <span class="string">&#x27;$&#123;:,.0f&#125;&#x27;</span>&#125;)  <span class="comment"># 格式化</span></span><br><span class="line">df.style.background_gradient(cmap=<span class="string">&#x27;Blues&#x27;</span>)  <span class="comment"># 热力图</span></span><br><span class="line">df.style.highlight_max(color=<span class="string">&#x27;yellow&#x27;</span>)  <span class="comment"># 高亮最大值</span></span><br></pre></td></tr></table></figure>

<h3 id="9-3-内存优化"><a href="#9-3-内存优化" class="headerlink" title="9.3 内存优化"></a>9.3 内存优化</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 查看内存使用</span></span><br><span class="line"><span class="built_in">print</span>(df.memory_usage(deep=<span class="literal">True</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 优化数据类型</span></span><br><span class="line">df[<span class="string">&#x27;category&#x27;</span>] = df[<span class="string">&#x27;category&#x27;</span>].astype(<span class="string">&#x27;category&#x27;</span>)</span><br><span class="line">df[<span class="string">&#x27;int_col&#x27;</span>] = pd.to_numeric(df[<span class="string">&#x27;int_col&#x27;</span>], downcast=<span class="string">&#x27;integer&#x27;</span>)</span><br><span class="line">df[<span class="string">&#x27;float_col&#x27;</span>] = pd.to_numeric(df[<span class="string">&#x27;float_col&#x27;</span>], downcast=<span class="string">&#x27;float&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="十、实践建议"><a href="#十、实践建议" class="headerlink" title="十、实践建议"></a>十、实践建议</h2><blockquote>
<p><strong>提醒自己</strong>：</p>
<ol>
<li><strong>先了解数据</strong>：用 head()、info()、describe() 快速了解</li>
<li><strong>处理缺失值</strong>：根据业务选择合适的填充策略</li>
<li><strong>类型优化</strong>：使用 category 等节省内存</li>
<li><strong>链式调用</strong>：提高代码可读性</li>
<li><strong>保存中间结果</strong>：复杂处理时分步保存</li>
<li><strong>向量化优先</strong>：避免使用循环</li>
</ol>
</blockquote>
<h2 id="十一、练习"><a href="#十一、练习" class="headerlink" title="十一、练习"></a>十一、练习</h2><ol>
<li>读取 CSV 文件，统计每列的缺失值比例</li>
<li>对数据进行分组聚合，计算各组的均值、总和、计数</li>
<li>使用 pivot_table 创建销售数据透视表</li>
<li>合并两个 DataFrame，比较不同连接方式的结果</li>
<li>对时间序列数据进行重采样和移动平均计算</li>
</ol>
<hr>
<p><strong>上一篇</strong>：[Python 数据科学（一）：NumPy 数值计算](&#x2F;2026&#x2F;02&#x2F;24&#x2F;Python-数据科学（一）NumPy 数值计算&#x2F;)</p>
<p><strong>下一篇</strong>：[Python 数据科学（三）：PyArrow 高性能数据操作](&#x2F;2026&#x2F;02&#x2F;24&#x2F;Python-数据科学（三）PyArrow 高性能数据操作&#x2F;)</p>
<p><strong>参考资源</strong>：</p>
<ul>
<li><a href="https://pandas.pydata.org/docs/">Pandas 官方文档</a></li>
<li><a href="https://pandas.pydata.org/docs/user_guide/10min.html">Pandas 10 分钟入门</a></li>
<li><a href="https://pandas.pydata.org/docs/user_guide/cookbook.html">Pandas 烹饪书</a></li>
</ul>
]]></content>
      <categories>
        <category>Python 数据科学</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>DataFrame</tag>
        <tag>Pandas</tag>
        <tag>数据分析</tag>
      </tags>
  </entry>
</search>
